/*! EXFE.COM QXdlc29tZSEgV2UncmUgaHVudGluZyB0YWxlbnRzIGxpa2UgeW91LiBQbGVhc2UgZHJvcCB1cyB5b3VyIENWIHRvIHdvcmtAZXhmZS5jb20uCg== */
/*! mobile@2a.3 2013-05-26 10:05:29 */
define(function(e){"use strict";var t=e("zepto"),i=e("tween"),n=e("af"),r=n.request,a=e("mobilemiddleware"),s=e("mobilecontroller").FooterController,o=e("mobileroutes"),l=Date.now||function(){return(new Date).getTime()},c=l(),u=function(e){App.set("tryRedirectAt",l()),window.location="exfe://crosses/"+(e||"")},d=e("lightsaber"),h=window.App=d();h.use(a.setHtmlHeight),h.use(a.cleanup),h.initRouter(),h.use(a.errorHandler),h.controllers={},h.controllers.footer=new s({App:h}),h.get(/^\/+(?:\?)?#{0,}$/,o.index),h.get(/^\/+(?:\?)?#live\/?$/,o.live),h.get(/^\/+\?t=([a-zA-Z0-9]{3,})$/,function(e,t){var i=function(){var e,t=document.getElementsByTagName("head")[0],i=document.getElementsByName("sms-token")[0];return i&&(e=JSON.parse(i.content),t.removeChild(i)),e},n=i();if(n){var r=n.action;e.session.resolveToken=n,"VERIFIED"===r?t.redirect("/#verify"):"INPUT_NEW_PASSWORD"===r&&t.redirect("/#set_password")}else e.error={code:404},e.redirect("/")}),h.get(/^\/+(?:\?)?#verify\/?$/,o.verify),h.get(/^\/+(?:\?)?#set_password\/?$/,o.setPassword),h.get(/^\/+(?:\?)?#token=([a-zA-Z0-9]{64})\/?$/,o.resolveToken),h.get(/^\/+(?:\?)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{4})\/?$/,o.crossPhoneToken),h.get(/^\/+(?:\?)?#!token=([a-zA-Z0-9]{32})\/?$/,o.crossToken),h.set("tryRedirectAt",0),h.on("launched",function(){function e(){r(e),i.update()}var n=this,a=setInterval(function(){var e=l(),i=n.set("tryRedirectAt");i&&(e-c>1500&&1500>Math.abs(i-c)?(clearInterval(a),t(".get-button button").html('Open <span class="exfe">EXFE</span> app').removeClass("hide"),t("#app-footer").off("click.footer",".get-button button").on("click.footer",".get-button button",function(){u()})):2e3>e-i&&(t(".get-button").removeClass("hide"),t(".redirecting").addClass("hide"))),c=e},500);h.set("tryTimer",a),e()}),h.run()});