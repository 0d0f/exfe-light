define(function(e,t,n){e("zepto");var r=e("config"),i=e("store"),s=function(e){var t=window.innerHeight;t>460?t=460:t<350&&(t=350),$("html").css("min-height",t+"px"),$(".dialog-box").css("min-height",window.innerHeight-(e?50:0)+"px"),$(".actions").css("top",t-86-(e?50:0)+"px"),$(".big-x").css("height",t-86-(e?50:0)+"px")},o=function(){$("#app-main").html('<div class="dialog-box"><div class="big-x"><div class="img"><img width="182" height="182" src="/static/img/exfe.png"/></div></div><div class="actions"><div class="get-button"><button>Get <span class="exfe">EXFE</span> App <span class="free">free</span></button><div class="redirecting">Redirecting to EXFE app in <span class="sec">5</span>s.</div></div><div class="web-version"><span class="underline">Proceed</span> with desktop web version.</div></div></div>'),s()},u=function(){window.location="itms://itunes.apple.com/us/app/facebook/id514026604"},a=function(e){window.location="exfe://crosses/"+e},f=function(e){a(e);var t=+(new Date);setTimeout(function(){+(new Date)-t<2e3&&u()},500)},l=function(e){$("#app-main").html('<div class="top-banner"><div class="center"><div class="welcome">Welcome to <span class="exfe">EXFE</span></div><div class="exfe-logo"><img src="/static/img/exfe.png" width="30" height="30" /></div></div></div><div class="dialog-box"><div class="base-info"><span class="by">dm.</span> sends you an invitation, engage in easily with <span class="exfe">EXFE</span> app.</div><div class="cross"><div class="title">Team dinner with Bay Area friends in San Francisco</div><div class="time">6:30PM Fri, Apr 8</div><div class="place">Crab House @ Pier 39</div></div><div class="actions"><div class="get-button"><button>Get <span class="exfe">EXFE</span> App <span class="free">free</span></button><div class="redirecting">Redirecting to EXFE app in <span class="sec">5</span>s.</div></div><div class="web-version"><span class="underline">Proceed</span> with desktop web version.</div></div></div>'),s(!0),$.ajax({type:"post",url:r.api_url+"/Crosses/GetCrossByInvitationToken",data:{invitation_token:e},success:function(t){if(t&&(t=JSON.parse(t))&&t.meta.code===200){$("#cross_title").html(t.response.cross.title),$("#cross_desc").html(t.response.cross.description);var n="?read_only="+t.response.read_only+"&action="+t.response.action+"&invitation_token="+e;if(typeof t.response.cross_access_token!="undefined"){n+="&cross_access_token="+t.response.cross_access_token;var r=i.get("cats");r||(r={}),r[e]=t.response.cross_access_token,i.set("cats",r)}typeof t.authorization!="undefined"&&(n+="&token"+t.response.authorization.token,i.set("authorization",t.response.authorization)),f(n);return}},error:function(){console.log(data)}})},c=function(e){$("#app-main").html('<div class="top-banner"><div class="center"><div class="welcome">Welcome to <span class="exfe">EXFE</span></div><div class="exfe-logo"><img src="/static/img/exfe.png" width="30" height="30" /></div></div></div><div class="dialog-box"><div class="verify-actions"><div class="identity"><img class="avatar" width="40" height="40" src="" /><span class="name">Steve Exfer</span></div><div><input type="text" id="password" placeholder="Set EXFE Password" /><div><div class="error-info">Failed to set password. Please try later.</div><div class="done-info"><span class="status">Password set successfully.</span><span class="redirect">Redirecting to app in <span class="sec">5</span>s.</span></div></div><div class="actions"><div class="get-button"><button>Get <span class="exfe">EXFE</span> App <span class="free">free</span></button><div class="redirecting">Redirecting to EXFE app in <span class="sec">5</span>s.</div></div><div class="web-version"><span class="underline">Proceed</span> with desktop web version.</div></div><div>'),s(!0),$("#submit").click(function(){var t=$("#password").val();t.length>=4?$.ajax({type:"post",url:r.api_url+"/Users/ResetPassword",data:{token:e,password:t},success:function(e){if(e&&(e=JSON.parse(e))&&e.meta.code===200&&e.response.authorization){console.log(e.response.authorization),alert("Done");return}},error:function(){}}):alert("Password must be longer than four!")})},h=function(){$("#app-main").html('<div class="top-banner"><div class="center"><div class="welcome">Welcome to <span class="exfe">EXFE</span></div><div class="exfe-logo"><img src="/static/img/exfe.png" width="30" height="30" /></div></div></div><div class="dialog-box"><div class="verify-actions"><div class="identity"><img class="avatar" width="40" height="40" src="" /><img class="provider" width="18" height="18" src="" /><span class="name">Steve Exfer</span></div><div class="done-info"><span class="status">Verification succeeded.</span><span class="status error">Sorry, this link is expired.</span><span class="redirect">Redirecting to app in <span class="sec">5</span>s.</span></div></div><div class="space"></div><div class="actions"><div class="get-button"><button>Get <span class="exfe">EXFE</span> App <span class="free">free</span></button><div class="redirecting">Redirecting to EXFE app in <span class="sec">5</span>s.</div></div><div class="web-version"><span class="underline">Proceed</span> with desktop web version.</div></div><div>'),s(!0)},p=function(e){$.ajax({type:"post",url:r.api_url+"/Users/ResolveToken",data:{token:e},success:function(t){if(t&&(t=JSON.parse(t))&&t.meta.code===200){switch(t.response.token_type){case"VERIFY":break;case"SET_PASSWORD":}switch(t.response.action){case"VERIFIED":break;case"INPUT_NEW_PASSWORD":c(e)}}},error:function(){}})},d=document.location.hash.replace(/^#/,"");if(d){d=d.split("/");for(var v=0;v<d.length;v++)d[v].match(/\/token=.*/)?p(d[v].replace(/\/token=(.*)/,"$1",d[v])):d[v].match(/\!token=.*/)&&l(d[v].replace(/\!token=(.*)/,"$1",d[v]))}else l()});