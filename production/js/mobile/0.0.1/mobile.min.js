define(function(e){"use strict";var t=e("zepto"),n=e("tween"),r=e("af"),i=r.request,s=e("mobilemiddleware"),o=e("mobilecontroller").FooterController,u=e("mobileroutes"),a=Date.now||function(){return(new Date).getTime()},f=a(),l=function(e){App.set("tryRedirectAt",a()),window.location="exfe://crosses/"+(e||"")},c=e("lightsaber"),h=c();h.use(s.setHtmlHeight),h.use(s.checkSMSToken),h.use(s.cleanup),h.initRouter(),h.use(s.errorHandler),h.controllers={},h.controllers.footer=new o({App:h}),h.get(/^\/+(?:\?)?#{0,}$/,u.index),h.get(/^\/+(?:\?)?#live\/?$/,u.live),h.get(/^\?t=([a-zA-Z0-9]{3,})$/,function(e,t){var n=function(){var e=document.getElementsByTagName("head")[0],t=document.getElementsByName("sms-token")[0],n=null;return t&&(n=JSON.parse(t.content),e.removeChild(t)),n},r=n();if(r){var i=r.action;e.resolveToken=r,"VERIFIED"===i?t.redirect("/#verify"):"INPUT_NEW_PASSWORD"===i&&t.redirect("/#set_password")}else e.error={code:404},e.redirect("/")}),h.get(/^\/+(?:\?)?#verify\/?$/,u.verify),h.get(/^\/+(?:\?)?#set_password\/?$/,u.setPassword),h.get(/^\/+(?:\?)?#token=([a-zA-Z0-9]{64})\/?$/,u.resolveToken),h.get(/^\/+(?:\?)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{4})\/?$/,u.crossPhoneToken),h.get(/^\/+(?:\?)?#!token=([a-zA-Z0-9]{32})\/?$/,u.crossToken),h.set("tryRedirectAt",0),h.on("launched",function(){function s(){i(s),n.update()}var e=this,r=setInterval(function(){var n=a(),i=e.set("tryRedirectAt");i&&(n-f>1500&&Math.abs(i-f)<1500?(clearInterval(r),t(".get-button button").html('Open <span class="exfe">EXFE</span> app').removeClass("hide"),t("#app-footer").off("click.footer",".get-button button").on("click.footer",".get-button button",function(){l()})):n-i<2e3&&(t(".get-button").removeClass("hide"),t(".redirecting").addClass("hide"))),f=n},500);h.set("tryTimer",r),s()}),h.run(),window.App=h});