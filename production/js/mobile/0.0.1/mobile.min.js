define(function(e,t,n){e("zepto");var r=e("config"),i=e("store"),s=function(){},o=function(){window.location="itms://itunes.apple.com/us/app/facebook/id514026604"},u=function(e){alert("exfe://crosses/"+e);return},a=function(e){u(e);var t=+(new Date);setTimeout(function(){+(new Date)-t<2e3&&o()},500)},f=function(e){$("#app-main").html('<div><div id="cross_title"></div><div id="cross_desc"></div><div>'),$.ajax({type:"post",url:r.api_url+"/Crosses/GetCrossByInvitationToken",data:{invitation_token:e},success:function(t){if(t&&(t=JSON.parse(t))&&t.meta.code===200){$("#cross_title").html(t.response.cross.title),$("#cross_desc").html(t.response.cross.description);var n="?read_only="+t.response.read_only+"&action="+t.response.action+"&invitation_token="+e;if(typeof t.response.cross_access_token!="undefined"){n+="&cross_access_token="+t.response.cross_access_token;var r=i.get("cats");r||(r={}),r[e]=t.response.cross_access_token,i.set("cats",r),alert(r)}typeof t.authorization!="undefined"&&(n+="&token"+t.response.authorization.token,i.set("authorization",t.response.authorization)),a(n);return}},error:function(){console.log(data)}})},l=function(e){$("#app-main").html('<div>Password: <input type="text" id="password"><button id="submit">Submit</button><div>'),$("#submit").click(function(){var t=$("#password").val();t.length>=4?$.ajax({type:"post",url:r.api_url+"/Users/ResetPassword",data:{token:e,password:t},success:function(e){if(e&&(e=JSON.parse(e))&&e.meta.code===200&&e.response.authorization){console.log(e.response.authorization),alert("Done");return}},error:function(){}}):alert("Password must be longer than four!")})},c=function(e){$.ajax({type:"post",url:r.api_url+"/Users/ResolveToken",data:{token:e},success:function(t){if(t&&(t=JSON.parse(t))&&t.meta.code===200){switch(t.response.token_type){case"VERIFY":break;case"SET_PASSWORD":}switch(t.response.action){case"VERIFIED":break;case"INPUT_NEW_PASSWORD":l(e)}}},error:function(){}})},h=document.location.hash.replace(/^#/,"");h||s(),h=h.split("/");for(var p=0;p<h.length;p++)h[p].match(/\/token=.*/)?c(h[p].replace(/\/token=(.*)/,"$1",h[p])):h[p].match(/\!token=.*/)&&f(h[p].replace(/\!token=(.*)/,"$1",h[p]))});