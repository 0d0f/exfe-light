define("datepanel",function(e,t,n){var r=e("rex"),i=e("eftime"),s=i.locales[i.locale],o=s.monthsShort,u=s.months,a=e("panel"),f=a.extend({options:{template:'<div class="panel date-panel" tabindex="-1" data-widget="panel" id="date-panel" editarea="date-panel"><div class="panel-body"><div class="pull-left date-container"><input type="text" name="date-string" id="date-string" autocomplete="off" /><div class="date-calendar" tabindex="-1"><ul class="unstyled clearfix" id="date-head"><li>Sun</li><li>Mon</li><li>Tue</li><li>Wed</li><li>Thu</li><li>Fri</li><li>Sat</li></ul><div class="full-month"></div><table class="table" id="date-table"><tbody></tbody></table></div></div><div class="pull-right date-timeline"><div class="gathering">Gathering day</div><ul class="unstyled times"></ul></div></div></div>',parentNode:null,srcNode:null,eftime:null},init:function(){var e=this.options;this.render(),this.originEftime=e.eftime,this.eftime=$.extend({},e.eftime),this.date=i.toDate(this.eftime),delete e.eftime,this.dateInput=new l(this,"#date-string",this.date),this.calendarTable=new c(this,".date-calendar",this.date),this.listen()},listen:function(){this.on("dateinput-tab",this.dateInputTab),this.on("calendartable-tab",this.calendarTableTab)},dateInputTab:function(){var e=this.dateInput,t=this.calendarTable;setTimeout(function(){t.$element.focus()},0)},calendarTableTab:function(){var e=this.dateInput,t=this.calendarTable;setTimeout(function(){e.$element.focus()},0)},showAfter:function(){var e=this.srcNode;if(e){var t=e.offset(),n=this.element.outerWidth();this.element.css({left:t.left-n-15,top:t.top})}this.dateInput.$element.focusend()},destory:function(){this.element.off(),this.element.remove(),this._destory()}}),l=function(e,t,n){this.component=e,this.$container=this.component.element,this.selector=t,this.$element=this.component.$(t),this.date=n,this.input(this.date.text),this.listen()};l.prototype={input:function(e){this.$element.val(e)},listen:function(){var e=this.$container,t=this.selector;e.on("blur.datepanel",t,$.proxy(this.blur,this)).on("keypress.datepanel",t,$.proxy(this.keypress,this)).on("keyup.datepanel",t,$.proxy(this.keyup,this)).on("keydown.datepanel",t,$.proxy(this.keydown,this)).on("focus.datepanel",t,$.proxy(this.focus,this))},click:function(e){},blur:function(e){},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:case 9:case 13:case 27:break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},keyHandler:function(e){var t=this.component,n=e.keyCode;switch(n){case 9:e.preventDefault(),t.emit("dateinput-tab")}},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.keyHandler(e)},keydown:function(e){this.suppressKeyPressRepeat=!!~r.indexOf([9],e.keyCode),this.keyHandler(e)},focus:function(e){},lookup:function(e){}};var c=function(e,t,n){this.component=e,this.$container=this.component.element,this.selector=t,this.$element=this.component.$(t),this.date=n,this.today=new Date,this.todayString=p(this.today),this.startDate=null,this.viewportRows=3,this.viewportIndex=0,this.line=0,this.column=0,this.rowHeight=44,this.scrollIndexs=[0,2],this.scrollNum=1,this.len=0,this.pageNum=0,this.pageHeight=this.rowHeight*this.viewportRows,this.divTemp='<div class="tw"><span class="m hide">{{m}}</span><span class="d">{{d}}</span></div>',this.$table=this.$element.find("table"),this.$tbody=this.$table.find("tbody"),this.initTable(),this.listen()};c.prototype={listen:function(){var e=this.$container,t=this.selector;e.on("blur.datepanel",t,$.proxy(this.blur,this)).on("keypress.datepanel",t,$.proxy(this.keypress,this)).on("keyup.datepanel",t,$.proxy(this.keyup,this)).on("keydown.datepanel",t,$.proxy(this.keydown,this)).on("focus.datepanel",t,$.proxy(this.focus,this)).on("click.datepanel",t,$.proxy(this.click,this)).on("mouseenter.datepanel",t+" td",$.proxy(this.tdMouseenter,this)).on("mouseleave.datepanel",t+" td",$.proxy(this.tdMouseleave,this)).on("click.datepanel",t+" td",$.proxy(this.tdClick,this)).on("mousewheel.datepanel",t,$.proxy(this.mousewheel,this))},mousewheel:function(e,t,n,r){console.log(t,n,r)},tdMouseenter:function(e){console.log(this.column,this.line)},tdMouseleave:function(e){},tdClick:function(e){},blur:function(e){this.removeCursorClass()},keyup:function(e){e.stopPropagation(),e.preventDefault()},keyHandler:function(e){var t=this,n=t.component,r=e.keyCode;switch(r){case 9:e.preventDefault(),n.emit("calendartable-tab");break;case 37:e.preventDefault(),t.moveLeft();break;case 38:e.preventDefault(),t.moveTop();break;case 39:e.preventDefault(),t.moveRight();break;case 40:e.preventDefault(),t.moveDown();break;case 13:e.preventDefault();break;case 32:e.preventDefault(),t.moveSpacing()}},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.keyHandler(e)},keydown:function(e){this.suppressKeyPressRepeat=!!~r.indexOf([9,37,38,39,40,32,13],e.keyCode),this.keyHandler(e)},focus:function(e){this.setCursor()},click:function(e){},generateHTML:function(e){this.len+=3;var t=this.viewportRows,n=this.todayString,r=this.divTemp,i=0,s="";for(;i<t;++i){var u=0,a="<tr>",f="",l,c;for(;u<7;++u){l=p(e),c=l===n,f+='<td data-date="'+l+'"'+(c?' class="today"':"")+">";var h=r,d=e.getDate();f+=h.replace("{{m}}",o[e.getMonth()]).replace("{{d}}",c?"Today":d),f+="</td>",e.setDate(d+1)}a+=f+"</tr>",s+=a}return s},initTable:function(){var e=this.date.day,t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=e.getDay(),s=new Date(t,n,r-i);this.startDate=p(s),this.column=i,this.genNextPage(s),this.endDate=p(s),this.$trs=this.$tbody.find("tr")},genPrevPage:function(e){this.$tbody.prepend(this.generateHTML(e))},genNextPage:function(e){this.$tbody.append(this.generateHTML(e))},setCursor:function(){this.$cursor=this.$trs.eq(this.line).find("td").eq(this.column).addClass("hover")},removeCursorClass:function(){this.$cursor.removeClass("hover")},moveBefore:function(){this.removeCursorClass()},moveAfter:function(){this.setCursor()},selectBefore:function(){this.$select.removeClass("selected")},select:function(){this.$select=this.$cursor.addClass("selected")},selectAfter:function(){},scroll:function(e){var t=this.scrollIndexs,n=t[0],r=t[1],i=this.viewportRows,s=this.len,o=this.scrollNum,u=this.rowHeight,a=this.line,f=this.viewportIndex+=e;console.log(e,this.line,n);if(f===n-1&&a>n||f===r+1&&a<s-(i-r)){var l=parseFloat(this.$table.css("margin-top"))||0;this.$table.css("margin-top",l+ -e*u*o),this.viewportIndex=t[(e+1)/2]}},moveSpacing:function(){this.$select&&this.selectBefore(),this.select(),this.selectAfter()},prevRow:function(){if(0===this.line){var e=this.startDate.split("-");e=new Date(e[0],+e[1]-1,+e[2]-21),this.startDate=p(e),this.genPrevPage(e),this.$table.css("margin-top",-this.viewportRows*this.rowHeight+"px"),this.$trs=this.$tbody.find("tr"),this.line=3}this.scroll(-1),this.line--},nextRow:function(){if(this.len-1===this.line){var e=this.endDate.split("-");e=new Date(e[0],+e[1]-1,e[2]),this.genNextPage(e),this.endDate=p(e),this.$trs=this.$tbody.find("tr")}this.scroll(1),this.line++},moveLeft:function(){this.moveBefore(),0===this.column--&&(this.column=6,this.prevRow()),this.moveAfter()},moveTop:function(){this.moveBefore(),this.prevRow(),this.moveAfter()},moveRight:function(){this.moveBefore(),6===this.column++&&(this.column=0,this.nextRow()),this.moveAfter()},moveDown:function(){this.moveBefore(),this.nextRow(),this.moveAfter()}};var h=function(e){},p=function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()};return f});