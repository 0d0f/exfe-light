define("photoxwidget",function(e){"use strict";var t=e("api").request,n=e("rex"),r=e("bus"),i=e("store"),a=e("photox"),s=e("mnemosyne"),o=e("widget"),l=function(e,n){return t("photox_getPhotoX",{resources:{photox_id:e},data:{sort:"imported_time_desc",limit:11}},n)},c=o.extend({options:{template:'<div class="widget photox-widget"><div class="tab tab-0 hide"><div class="table-wrapper"><table cellspacing="0" cellpadding="0" border-spacing="0" border="0"><tbody><tr></tr></tbody></table></div><div class="btn-open"><i class="ix-wall ix-wall-blue"></i></div></div><div class="tab tab-1 hide"><i class="ix-wall ix-wall-gay"></i>Share photos, save memory.</div></div>',tdTmp:'<td><figure><img class="pic" src="{{url}}" width="{{width}}" height="{{height}}" /></figure></td>',tdTmpMore:'<td class="more">···</td>',parentNode:null,onShowBefore:function(){this.emit("load")},onLoad:function(){this.load()}},init:function(){this.render()},render:function(){var e=this.options;this.parentNode=e.parentNode,this.srcNode=e.srcNode,this.crossId=e.crossId,delete e.parentNode,delete e.srcNode,delete e.crossId,this.limited=10,this.$tr=this.element.find("tr"),this.listen()},listen:function(){var e=this;r.on("update-photoxwidget",function(){e.load()}),this.element.on("click.photoxwidget",".btn-open, .tab-1",function(t){if(t.preventDefault(),t.stopPropagation(),!$("#photox-panel").size()){var r,s=i.get("user"),o=s.identities,l=["facebook","instagram","flickr","dropbox"],c=l.slice(0),u=[];n.each(o,function(e){r=n.indexOf(c,e.provider),-1!==r&&(c.splice(r,1),u.push(e.provider+":"+e.id))}),u.push(""),c.push(""),c=u.join(" ")+c.join(":0 ");var d=new a({options:{parentNode:$("#app-tmp"),srcNode:$(".cross-photox"),crossId:Cross.id,providers:c}});d.show(),e.photoxPanel=d}}),this.element.on("click.photoxwidget",".table-wrapper",function(e){if(e.preventDefault(),!$(".mnemosyne-panel").size()){var t=i.get("user"),n=new s({options:{parentNode:$("#app-tmp"),srcNode:$(".table-wrapper"),crossId:Cross.id,userId:t.id}});n.show()}}),$("body").on("click.photoxwidget",function(e){var t=$("#photox-panel");return t.length&&t[0]!==e.target&&!$.contains(t[0],e.target)?(e.preventDefault(),e.stopPropagation(),t.trigger("destory.widget"),void 0):void 0})},generate:function(e,t){for(var n,r=this.options.tdTmp,i=0,a=e.length,s="";a>i;++i)n=e[i].images.preview,s+=r.replace("{{url}}",n.url).replace("{{height}}",64).replace("{{width}}",64*n.width/n.height);return t&&(s+=this.options.tdTmpMore),s},load:function(){var e=this,t=e.$tr,n=e.element.find(".tab"),r=n.eq(0),i=n.eq(1),a=e.limited;this.defer&&this.defer.abort(),this.defer=l(this.crossId,function(n){var s=n.photox.photos,o=s.length,l=o>a;o?(r.removeClass("hide"),i.addClass("hide"),l&&(s=s.slice(0,a)),t.html(e.generate(s,l))):(r.addClass("hide"),i.removeClass("hide"))})},show:function(){return this.emit("showBefore"),this.element.appendTo(this.parentNode),this.emit("showAfter"),this}});return c});