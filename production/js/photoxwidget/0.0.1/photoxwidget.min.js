define("photoxwidget",function(e){"use strict";var t=e("api").request,n=e("rex"),r=e("config").photo_providers,i=e("store"),s=e("photox"),o=e("widget"),u=function(e,n){return t("photox_getPhotoX",{resources:{photox_id:e}},n)},a=o.extend({options:{template:'<div class="widget photox-widget"><div class="table-wrapper"><table cellspacing="0" cellpadding="0" border-spacing="0" border="0"><tbody><tr></tr></tbody></table></div><div class="btn-open"><i class="ix-wall"></i></div></div>',tdTmp:'<td><figure><img src="{{url}}" width="100" height="70" /></figure></td>',tdTmpMore:'<td class="more"><figure>...</figure></td>',parentNode:null,onShowBefore:function(){this.emit("load")},onLoad:function(){this.load()}},init:function(){this.render()},render:function(){var e=this.options;this.parentNode=e.parentNode,this.srcNode=e.srcNode,this.crossId=e.crossId,delete e.parentNode,delete e.srcNode,delete e.crossId,this.limited=10,this.$tr=this.element.find("tr"),this.listen()},listen:function(){var e=this;this.element.on("click.photoxwidget",".btn-open",function(t){t.preventDefault(),t.stopPropagation();var r=i.get("user"),o=r.identities,u=["facebook","instagram","flickr","dropbox"],a=u.slice(0),f=[],l;n.each(o,function(e){l=n.indexOf(a,e.provider),-1!==l&&(a.splice(l,1),f.push(e.provider+":"+e.id))}),f.push(""),a.push(""),a=f.join(" ")+a.join(":0 ");var c=new s({options:{parentNode:$("#app-tmp"),srcNode:$(".cross-photox"),crossId:Cross.id,providers:a}});c.show(),e.photoxPanel=c}),$(document.body).on("click.photoxwidget",function(t){var n=$("#photox-panel");if(n.length&&n[0]!==t.target&&!$.contains(n[0],t.target)){e.photoxPanel.hide(),e.photoxPanel=null;return}})},generate:function(e,t){var n=this.options.tdTmp,r=0,i=e.length,s="";for(;r<i;++r)s+=n.replace("{{url}}",e[r].images.preview.url);return t&&(s+=this.options.tdTmpMore),s},load:function(){var e=this,t=e.$tr,n=e.limited;u(this.crossId,function(r){var i=r.photox.photos,s=i.length,o=s>n;o&&(i=i.slice(0,n)),t.html(e.generate(i,o))})},show:function(){return this.emit("showBefore"),this.element.appendTo(this.parentNode),this.emit("showAfter"),this}});return a});