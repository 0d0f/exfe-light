define("lightsaber",function(t,e,n){"use strict";function i(){var t=new r;return g(t,b.prototype),t.request=new s,t.response=new o,t.init(),t}function r(){}function s(t){this.enableFullUrlPath=!!t,this.session={},this.path="/",this.method="GET",this.updateUrl()}function o(t,e){this.path=t,this.title=document.title,this.state=e||{}}function a(t){t=t||{};var e=this;this.map=[],this.params={},this._params=[],this.caseSensitive=t.caseSensitive,this.strict=t.strict,this.middleware=function(t,n,i){e._dispatch(t,n,i)}}function u(t,e,n){n=n||{},this.path=t,this.callbacks=e,this.regexp=v(t,this.keys=[],n.sensitive,n.strict)}function c(t,e,n){e=e||{},this.name=t,this.root=e.root,this.engine=e.engine,this.ext=d(t),this.timestamp=n||"",this.path=this.lookup(t)}function h(t){return function(e,n,i){e.app=n.app=t,e.next=i,n.locals=n.locals||m(n),i()}}function l(){return++l.id}function p(t,e,n){var i=t.length;if(!i)return-1;if(n||(n=0),n>i)return-1;for(0>n&&(n=Math.max(0,i+n));i>n;++n)if(n in t&&t[n]===e)return n;return-1}function f(t,e,n,i,r){return w.get(e,function(e){var s,o=e;"html"!==r&&(s=t.compile(e),o=s(n)),i(o)})}function d(t){return t.split(".")[1]||"html"}function m(t){function e(t){for(var n in t)e[n]=t[n];return t}return t.viewCallbacks=t.viewCallbacks||[],e}function g(t,e){var n;if(t&&e)for(n in e)t[n]=e[n];return t}function v(t,e,n,i){return t instanceof RegExp?t:(N(t)&&(t="("+t.join("|")+")"),t=t.concat(i?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,i,r,s,o,a){return e.push({name:r,optional:!!o}),n=n||"",""+(o?"":n)+"(?:"+(o?n:"")+(i||"")+(s||i&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+t+"$",n?"":"i"))}var y,b=t("emitter"),w=t("jquery")||t("zepto"),x=w.proxy,k=window.location,E=window.history,S="/",_=!1;w(window).on("load",function(){_=!0,setTimeout(function(){_=!1},0)}),e=n.exports=i;var T;e.version="0.0.5",T=r.prototype,T.historySupport=y=null!==(null!==E?E.pushState:void 0),w.browser&&w.browser.opera&&(T.historySupport=y=!1),T.init=function(){this.route=S,this.stack=[],this.cache={},this.settings={},this.engines={},this.viewCallbacks=[],this.defaultConfiguration()},T.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(h(this)),this._usedRouter=!1,this._router=new a(this),this.routes=this._router.map,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=m(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},T.use=function(t,e){return"string"!=typeof t&&(e=t,t=S),S!==t&&S===t[t.length-1]&&(t=t.slice(0,-1)),this.stack.push({route:t,handle:e}),this},T.engine=function(t,e){if("function"!=typeof e)throw Error("callback function required");return"."!==t[0]&&(t="."+t),this.engines[t]=e,this},T.set=function(t,e){return 1!==arguments.length?(this.settings[t]=e,this):this.settings.hasOwnProperty(t)?this.settings[t]:void 0},T.enabled=function(t){return!!this.set(t)},T.disabled=function(t){return!this.set(t)},T.enable=function(t){return this.set(t,!0)},T.disable=function(t){return this.set(t,!1)},T.configure=function(t,e){var n="all",i=[].slice.call(arguments);return e=i.pop(),i.length&&(n=i),("all"===n||~p(n,this.settings.env))&&e.call(this),this},T.render=function(t,e,n){var i,r={},s=this.cache;if(this.engine,"function"==typeof e&&(n=e,e={}),g(r,this.locals),e.locals&&g(r,e.locals),g(r,e),r.cache=null===r.cache?this.enabled("view cache"):r.cache,r.cache&&(i=s[t]),!i){if(i=new c(t,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp")),!i.path){var o=Error('Failed to lookup view "'+t+'"');return o.view=i,n(o)}r.cache&&(s[t]=i)}try{i.render(r,n)}catch(o){n(o)}},T.path=function(){return this.route},T.param=function(t,e){var n,i=[].slice.call(arguments,1),r=0;if(N(t))for(n=t.length;n>r;++r)for(var s=0,o=i.length;o>s;++s)this.param(t[r],i[s]);else if("function"==typeof t)this._router.param(t);else for(":"===t[0]&&(t=t.substr(1)),n=i.length;n>r;++r)this._router.param(t,e);return this},T.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},T.get=function(){var t=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,t)},T.handle=function(t,e){function n(a){var u,c=i[o++];if(s&&(t.url=t.url.substr(1),s=!1),t.url=r+t.url,c)try{if(u=t.url,0!==u.indexOf(c.route))return n(a);var h=c.handle.length;r=c.route,t.url=t.url.substr(r.length),"/"!==t.url[0]&&(t.url="/"+t.url,s=!0),a?4===h?c.handle(a,t,e,n):n(a):4>h?c.handle(t,e,n):n()}catch(l){n(l)}}var i=this.stack,r="",s=!1,o=0;n()},T.run=function(t){this.emit("launch"),t=t||{};var e=this.request,n=this.response;this.running||(this.running=!0,!1===t.dispatch&&this.disable("dispatch"),!1!==t.popstate&&(this.historySupport?w(window).on("popstate",x(this.change,this)):w(window).on("hashchange",x(this.change,this))),this.disabled("dispatch")||(this.handle(e,n),this.emit("launched")))},T.change=function(t){if(_)return _=!1;var e=this,n=e.request,i=e.response,r=n.url;return n.updateUrl(),"/"===r||r!==n.url?(e.handle(n,i),t.stopPropagation(),t.preventDefault(),!1):void 0},T.error=function(t,e){var n=Error(e);return n.status=t,n},T=s.prototype,T.updateUrl=function(){this.host=k.hostname,this.port=k.port||80,this.fullpath=k.pathname,this.enableFullUrlPath&&(this.path=this.fullpath),this.hash=decodeURIComponent(k.hash),this.querystring=decodeURIComponent(k.search),this.url=this.path+this.querystring+this.hash},T.param=function(t,e){var n=this.params||{},i=this.query||{};return null!=n[t]&&n.hasOwnProperty(t)?n[t]:null!=i[t]?i[t]:e},T.getPath=function(){return this.path},T.getHost=function(){return this.host},T=o.prototype,T.location=function(t){window.setTimeout(function(){k.href=t},16)},T.redirect=function(t){var e,n;return arguments.length,t=arguments[0],"back"===t||"forward"===t?(E[t](),void 0):y?(e=arguments[1],n=arguments[2]||{},this.path=t,this.title=e||"EXFE.COM",document.title=this.title,this.state=n,this.state.id=l(),this.pushState(),w(window).triggerHandler("popstate"),void 0):(this.location(t),void 0)},T.save=function(){E.replaceState(this.state,this.title,this.path)},T.pushState=function(){E.pushState(this.state,this.title,this.path)},T.render=function(t,e,n){var i=this,e=e||{},r=this.app;"function"==typeof e&&(n=e,e={}),e.locals=i.locals,r.render(t,e,n)},T=a.prototype,T.param=function(t,e){if("function"==typeof t)return this._params.push(t),void 0;var n,i,r=this._params,s=r.length;for(i=0;s>i;++i)(n=r[i](t,e))&&(e=n);if("function"!=typeof e)throw Error("invalid param() call for "+t+", got "+e);return(this.params[t]=this.params[t]||[]).push(e),this},T._dispatch=function(t,e,n){var i=this.params,r=this;(function s(o,a){function u(e){s(t._route_index+1,e)}function c(e){v=0,g=m[o++],f=g&&t.params[g.name],p=g&&i[g.name];try{"route"===e?u():e?(o=0,l(e)):p&&void 0!==f?h():g?c():(o=0,l())}catch(e){c(e)}}function h(n){var i=p[v++];return n||!i?c(n):(i(t,e,h,f,g.name),void 0)}function l(n){var i=d.callbacks[o++];try{if("route"===n)u();else if(n&&i){if(4>i.length)return l(n);i(n,t,e,l)}else i?i(t,e,l):u(n)}catch(n){l(n)}}var p,f,d,m,g,v=0;return t.route=d=r.matchRequest(t,o),d?(t.params=d.params,m=d.keys,o=0,c(a),void 0):n(a)})(0)},T.matchRequest=function(t,e){var n,i=t.url,r=this.map,s=r.length;for(e=e||0;s>e;++e)if(n=r[e],n.match(i))return t._route_index=e,n},T.route=function(t){t||Error("Router#get() requires a path");var e=[].slice.call(arguments,1),n=new u(t,e,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(n),this},T=u.prototype,T.match=function(t){this.regexp.lastIndex=0;var e,n,i,r,s=this.keys,o=this.params=[],a=this.regexp.exec(t);if(!a)return!1;for(e=1,n=a.length;n>e;++e)i=s[e-1],r="string"==typeof a[e]?decodeURIComponent(a[e]):a[e],i?o[i.name]=r:o.push(r);return!0},T=c.prototype,T.lookup=function(t){return this.root+"/"+t+"?t="+this.timestamp},T.render=function(t,e){return f(this.engine,this.path,t,e,this.ext)},l.id=0;var N=Array.isArray;N||(N=function(t){return t instanceof Array})});