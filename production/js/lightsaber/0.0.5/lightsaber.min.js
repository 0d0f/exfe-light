define("lightsaber",function(t,e,i){"use strict";function n(){var t=new r;return m(t,y.prototype),t.request=new s,t.response=new a,t.init(),t}function r(){}function s(t){this.enableFullUrlPath=!!t,this.session={},this.path="/",this.method="GET",this.updateUrl()}function a(t,e){this.path=t,this.title=document.title,this.state=e||{}}function h(t){t=t||{};var e=this;this.map=[],this.params={},this._params=[],this.caseSensitive=t.caseSensitive,this.strict=t.strict,this.middleware=function(t,i,n){e._dispatch(t,i,n)}}function o(t,e,i){i=i||{},this.path=t,this.callbacks=e,this.regexp=v(t,this.keys=[],i.sensitive,i.strict)}function u(t,e,i){e=e||{},this.name=t,this.root=e.root,this.engine=e.engine,this.ext=d(t),this.timestamp=i||"",this.path=this.lookup(t)}function c(t){return function(e,i,n){e.app=i.app=t,e.next=n,i.locals=i.locals||g(i),n()}}function l(){return++l.id}function p(t,e,i){var n=t.length;if(!n)return-1;if(i||(i=0),i>n)return-1;for(0>i&&(i=Math.max(0,n+i));n>i;++i)if(i in t&&t[i]===e)return i;return-1}function f(t,e,i,n,r){return b.get(e,function(e){var s,a=e;"html"!==r&&(s=t.compile(e),a=s(i)),n(a)})}function d(t){return t.split(".")[1]||"html"}function g(t){function e(t){for(var i in t)e[i]=t[i];return t}return t.viewCallbacks=t.viewCallbacks||[],e}function m(t,e){var i;if(t&&e)for(i in e)t[i]=e[i];return t}function v(t,e,i,n){return t instanceof RegExp?t:(q(t)&&(t="("+t.join("|")+")"),t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,i,n,r,s,a,h){return e.push({name:r,optional:!!a}),i=i||"",""+(a?"":i)+"(?:"+(a?i:"")+(n||"")+(s||n&&"([^/.]+?)"||"([^/]+?)")+")"+(a||"")+(h?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+t+"$",i?"":"i"))}var w,y=t("emitter"),b=t("jquery")||t("zepto"),_=function(t,e){return t?function(i){return t.call(e,i)}:void 0},k=window.location,x=window.history,R="/",E=!1;b(window).on("load",function(){E=!0,setTimeout(function(){E=!1},0)}),e=i.exports=n;var S;e.version="0.0.5",S=r.prototype,S.historySupport=w=null!==(null!==x?x.pushState:void 0),b.browser&&b.browser.opera&&(S.historySupport=w=!1),S.init=function(){this.route=R,this.stack=[],this.cache={},this.settings={},this.engines={},this.viewCallbacks=[],this.defaultConfiguration()},S.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(c(this)),this._usedRouter=!1,this._router=new h(this),this.routes=this._router.map,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=g(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},S.use=function(t,e){return"string"!=typeof t&&(e=t,t=R),R!==t&&R===t[t.length-1]&&(t=t.slice(0,-1)),this.stack.push({route:t,handle:e}),this},S.engine=function(t,e){if("function"!=typeof e)throw Error("callback function required");return"."!==t[0]&&(t="."+t),this.engines[t]=e,this},S.set=function(t,e){return 1!==arguments.length?(this.settings[t]=e,this):this.settings.hasOwnProperty(t)?this.settings[t]:void 0},S.enabled=function(t){return!!this.set(t)},S.disabled=function(t){return!this.set(t)},S.enable=function(t){return this.set(t,!0)},S.disable=function(t){return this.set(t,!1)},S.configure=function(t,e){var i="all",n=[].slice.call(arguments);return e=n.pop(),n.length&&(i=n),("all"===i||~p(i,this.settings.env))&&e.call(this),this},S.render=function(t,e,i){var n,r={},s=this.cache;if(this.engine,"function"==typeof e&&(i=e,e={}),m(r,this.locals),e.locals&&m(r,e.locals),m(r,e),r.cache=null===r.cache?this.enabled("view cache"):r.cache,r.cache&&(n=s[t]),!n){if(n=new u(t,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp")),!n.path){var a=Error('Failed to lookup view "'+t+'"');return a.view=n,i(a)}r.cache&&(s[t]=n)}try{n.render(r,i)}catch(a){i(a)}},S.path=function(){return this.route},S.param=function(t,e){var i,n=[].slice.call(arguments,1),r=0;if(q(t))for(i=t.length;i>r;++r)for(var s=0,a=n.length;a>s;++s)this.param(t[r],n[s]);else if("function"==typeof t)this._router.param(t);else for(":"===t[0]&&(t=t.substr(1)),i=n.length;i>r;++r)this._router.param(t,e);return this},S.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},S.get=function(){var t=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,t)},S.handle=function(t,e){function i(h){var o,u=n[a++];if(s&&(t.url=t.url.substr(1),s=!1),t.url=r+t.url,u)try{if(o=t.url,0!==o.indexOf(u.route))return i(h);var c=u.handle.length;r=u.route,t.url=t.url.substr(r.length),"/"!==t.url[0]&&(t.url="/"+t.url,s=!0),h?4===c?u.handle(h,t,e,i):i(h):4>c?u.handle(t,e,i):i()}catch(l){i(l)}}if(t.enableFullUrlPath||t.fullpath===t.path){var n=this.stack,r="",s=!1,a=0;i()}},S.run=function(t){this.emit("launch"),t=t||{};var e=this.request,i=this.response;this.running||(this.running=!0,!1===t.dispatch&&this.disable("dispatch"),!1!==t.popstate&&(this.historySupport?window.addEventListener("popstate",_(this.change,this),!1):window.addEventListener("hashchange",_(this.change,this),!1)),this.disabled("dispatch")||(this.handle(e,i),this.emit("launched")))},S.change=function(t){if(E)return E=!1;var e=this,i=e.request,n=e.response,r=i.url;return i.updateUrl(),r!==i.url?(e.handle(i,n),t.stopPropagation(),t.preventDefault(),!1):void 0},S.error=function(t,e){var i=Error(e);return i.status=t,i},S=s.prototype,S.updateUrl=function(){this.host=k.hostname,this.port=k.port||80,this.fullpath=k.pathname,this.enableFullUrlPath&&(this.path=this.fullpath),this.hash=decodeURIComponent(k.hash),this.querystring=decodeURIComponent(k.search),this.url=this.path+this.querystring+this.hash},S.param=function(t,e){var i=this.params||{},n=this.query||{};return null!=i[t]&&i.hasOwnProperty(t)?i[t]:null!=n[t]?n[t]:e},S.getPath=function(){return this.path},S.getHost=function(){return this.host},S=a.prototype,S.location=function(t){window.setTimeout(function(){k.href=t},16)},S.redirect=function(t){var e,i;return arguments.length,t=arguments[0],"back"===t||"forward"===t?(x[t](),void 0):w?(e=arguments[1],i=arguments[2]||{},this.path=t,this.title=e||"EXFE.COM",document.title=this.title,this.state=i,this.state.id=l(),this.pushState(),this.app.change(),void 0):(this.location(t),void 0)},S.save=function(){x.replaceState(this.state,this.title,this.path)},S.pushState=function(){x.pushState(this.state,this.title,this.path)},S.render=function(t,e,i){var n=this,e=e||{},r=this.app;"function"==typeof e&&(i=e,e={}),e.locals=n.locals,r.render(t,e,i)},S=h.prototype,S.param=function(t,e){if("function"==typeof t)return this._params.push(t),void 0;var i,n,r=this._params,s=r.length;for(n=0;s>n;++n)(i=r[n](t,e))&&(e=i);if("function"!=typeof e)throw Error("invalid param() call for "+t+", got "+e);return(this.params[t]=this.params[t]||[]).push(e),this},S._dispatch=function(t,e,i){var n=this.params,r=this;(function s(a,h){function o(e){s(t._route_index+1,e)}function u(e){v=0,m=g[a++],f=m&&t.params[m.name],p=m&&n[m.name];try{"route"===e?o():e?(a=0,l(e)):p&&void 0!==f?c():m?u():(a=0,l())}catch(e){u(e)}}function c(i){var n=p[v++];return i||!n?u(i):(n(t,e,c,f,m.name),void 0)}function l(i){var n=d.callbacks[a++];try{if("route"===i)o();else if(i&&n){if(4>n.length)return l(i);n(i,t,e,l)}else n?n(t,e,l):o(i)}catch(i){l(i)}}var p,f,d,g,m,v=0;return t.route=d=r.matchRequest(t,a),d?(t.params=d.params,g=d.keys,a=0,u(h),void 0):i(h)})(0)},S.matchRequest=function(t,e){var i,n=t.url,r=this.map,s=r.length;for(e=e||0;s>e;++e)if(i=r[e],i.match(n))return t._route_index=e,i},S.route=function(t){t||Error("Router#get() requires a path");var e=[].slice.call(arguments,1),i=new o(t,e,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(i),this},S=o.prototype,S.match=function(t){this.regexp.lastIndex=0;var e,i,n,r,s=this.keys,a=this.params=[],h=this.regexp.exec(t);if(!h)return!1;for(e=1,i=h.length;i>e;++e)n=s[e-1],r="string"==typeof h[e]?decodeURIComponent(h[e]):h[e],n?a[n.name]=r:a.push(r);return!0},S=u.prototype,S.lookup=function(t){return this.root+"/"+t+"?t="+this.timestamp},S.render=function(t,e){return f(this.engine,this.path,t,e,this.ext)},l.id=0;var q=Array.isArray;q||(q=function(t){return t instanceof Array})});