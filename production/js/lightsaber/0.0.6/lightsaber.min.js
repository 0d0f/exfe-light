define("lightsaber",function(t,e,i){"use strict";function n(){var t=new s;return v(t,y.prototype),t.request=new r,t.response=new a,t.init(),t}function s(){}function r(t){this.enableFullUrlPath=!!t,this.session={},this.path="/",this.method="GET",this.updateUrl()}function a(t,e){this.path=t,this.title=document.title,this.state=e||{}}function o(t){t=t||{};var e=this;this.map=[],this.params={},this._params=[],this.caseSensitive=t.caseSensitive,this.strict=t.strict,this.middleware=function(t,i,n){e._dispatch(t,i,n)}}function u(t,e,i){i=i||{},this.path=t,this.callbacks=e,this.regexp=m(t,this.keys=[],i.sensitive,i.strict)}function h(t,e,i){e=e||{},this.name=t,this.root=e.root,this.engine=e.engine,this.ext=f(t),this.timestamp=i||"",this.path=this.lookup(t)}function l(t){return function(e,i,n){e.app=i.app=t,e.next=n,i.locals=i.locals||g(i),n()}}function p(){return++p.id}function d(t,e,i){var n=t.length;if(!n)return-1;if(i||(i=0),i>n)return-1;for(0>i&&(i=Math.max(0,n+i));n>i;++i)if(i in t&&t[i]===e)return i;return-1}function c(t,e,i,n,s){return _.get(e,function(e){var r,a=e;"html"!==s&&(r=t.compile(e),a=r(i)),n(a)})}function f(t){return t.split(".")[1]||"html"}function g(t){function e(t){for(var i in t)e[i]=t[i];return t}return t.viewCallbacks=t.viewCallbacks||[],e}function v(t,e){var i;if(t&&e)for(i in e)t[i]=e[i];return t}function m(t,e,i,n){return t instanceof RegExp?t:(q(t)&&(t="("+t.join("|")+")"),t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,i,n,s,r,a,o){return e.push({name:s,optional:!!a}),i=i||"",""+(a?"":i)+"(?:"+(a?i:"")+(n||"")+(r||n&&"([^/.]+?)"||"([^/]+?)")+")"+(a||"")+(o?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+t+"$",i?"":"i"))}var w,y=t("emitter"),b=/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),_=t("jquery")||t("zepto"),x=function(t,e){return t?function(i){return t.call(e,i)}:void 0},k=window.location,E=window.history,C="/",S=!1;_(window).on("load",function(){S=!0,setTimeout(function(){S=!1},0)}),e=i.exports=n;var U;e.version="0.0.5",U=s.prototype,U.historySupport=w=null!==(null!==E?E.pushState:void 0),_.browser&&_.browser.opera&&(U.historySupport=w=!1),U.init=function(){this.route=C,this.stack=[],this.cache={},this.settings={},this.engines={},this.viewCallbacks=[],this.defaultConfiguration()},U.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(l(this)),this._usedRouter=!1,this._router=new o(this),this.routes=this._router.map,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=g(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},U.use=function(t,e){return"string"!=typeof t&&(e=t,t=C),C!==t&&C===t[t.length-1]&&(t=t.slice(0,-1)),this.stack.push({route:t,handle:e}),this},U.engine=function(t,e){if("function"!=typeof e)throw Error("callback function required");return"."!==t[0]&&(t="."+t),this.engines[t]=e,this},U.set=function(t,e){return 1!==arguments.length?(this.settings[t]=e,this):this.settings.hasOwnProperty(t)?this.settings[t]:void 0},U.enabled=function(t){return!!this.set(t)},U.disabled=function(t){return!this.set(t)},U.enable=function(t){return this.set(t,!0)},U.disable=function(t){return this.set(t,!1)},U.configure=function(t,e){var i="all",n=[].slice.call(arguments);return e=n.pop(),n.length&&(i=n),("all"===i||~d(i,this.settings.env))&&e.call(this),this},U.render=function(t,e,i){var n,s={},r=this.cache;if(this.engine,"function"==typeof e&&(i=e,e={}),v(s,this.locals),e.locals&&v(s,e.locals),v(s,e),s.cache=null===s.cache?this.enabled("view cache"):s.cache,s.cache&&(n=r[t]),!n){if(n=new h(t,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp")),!n.path){var a=Error('Failed to lookup view "'+t+'"');return a.view=n,i(a)}s.cache&&(r[t]=n)}try{n.render(s,i)}catch(a){i(a)}},U.path=function(){return this.route},U.param=function(t,e){var i,n=[].slice.call(arguments,1),s=0;if(q(t))for(i=t.length;i>s;++s)for(var r=0,a=n.length;a>r;++r)this.param(t[s],n[r]);else if("function"==typeof t)this._router.param(t);else for(":"===t[0]&&(t=t.substr(1)),i=n.length;i>s;++s)this._router.param(t,e);return this},U.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},U.get=function(){var t=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,t)},U.handle=function(t,e){function i(o){var u,h=n[a++];if(r&&(t.url=t.url.substr(1),r=!1),t.url=s+t.url,h)try{if(u=t.url,0!==u.indexOf(h.route))return i(o);var l=h.handle.length;s=h.route,t.url=t.url.substr(s.length),"/"!==t.url[0]&&(t.url="/"+t.url,r=!0),o?4===l?h.handle(o,t,e,i):i(o):4>l?h.handle(t,e,i):i()}catch(p){i(p)}}if(t.enableFullUrlPath||t.fullpath===t.path){var n=this.stack,s="",r=!1,a=0;i()}},U.run=function(t){this.emit("launch"),t=t||{};var e=this.request,i=this.response;this.running||(this.running=!0,!1===t.dispatch&&this.disable("dispatch"),!1!==t.popstate&&(this.historySupport&&!b?window.addEventListener("popstate",x(this.change,this),!1):window.addEventListener("hashchange",x(this.change,this),!1)),this.disabled("dispatch")||(this.handle(e,i),this.emit("launched")))},U.change=function(t){if(S)return S=!1;var e=this,i=e.request,n=e.response,s=i.url;return i.updateUrl(),s!==i.url?(e.handle(i,n),t&&(t.stopPropagation(),t.preventDefault()),!1):void 0},U.error=function(t,e){var i=Error(e);return i.status=t,i},U=r.prototype,U.updateUrl=function(){this.host=k.hostname,this.port=k.port||80,this.fullpath=k.pathname,this.enableFullUrlPath&&(this.path=this.fullpath),this.hash=decodeURIComponent(k.hash),this.querystring=decodeURIComponent(k.search),this.url=this.path+this.querystring+this.hash},U.param=function(t,e){var i=this.params||{},n=this.query||{};return null!=i[t]&&i.hasOwnProperty(t)?i[t]:null!=n[t]?n[t]:e},U.getPath=function(){return this.path},U.getHost=function(){return this.host},U=a.prototype,U.location=function(t){window.setTimeout(function(){k.href=t},16)},U.redirect=function(t){var e,i;return arguments.length,t=arguments[0],"back"===t||"forward"===t?(E[t](),void 0):w?(e=arguments[1],i=arguments[2]||{},this.path=t,this.title=e||"EXFE.COM",document.title=this.title,this.state=i,this.state.id=p(),this.pushState(),this.app.change(),void 0):(this.location(t),void 0)},U.save=function(){E.replaceState(this.state,this.title,this.path)},U.pushState=function(){E.pushState(this.state,this.title,this.path)},U.render=function(t,e,i){var n=this,e=e||{},s=this.app;"function"==typeof e&&(i=e,e={}),e.locals=n.locals,s.render(t,e,i)},U=o.prototype,U.param=function(t,e){if("function"==typeof t)return this._params.push(t),void 0;var i,n,s=this._params,r=s.length;for(n=0;r>n;++n)(i=s[n](t,e))&&(e=i);if("function"!=typeof e)throw Error("invalid param() call for "+t+", got "+e);return(this.params[t]=this.params[t]||[]).push(e),this},U._dispatch=function(t,e,i){var n=this.params,s=this;(function r(a,o){function u(e){r(t._route_index+1,e)}function h(e){m=0,v=g[a++],c=v&&t.params[v.name],d=v&&n[v.name];try{"route"===e?u():e?(a=0,p(e)):d&&void 0!==c?l():v?h():(a=0,p())}catch(e){h(e)}}function l(i){var n=d[m++];return i||!n?h(i):(n(t,e,l,c,v.name),void 0)}function p(i){var n=f.callbacks[a++];try{if("route"===i)u();else if(i&&n){if(4>n.length)return p(i);n(i,t,e,p)}else n?n(t,e,p):u(i)}catch(i){p(i)}}var d,c,f,g,v,m=0;return t.route=f=s.matchRequest(t,a),f?(t.params=f.params,g=f.keys,a=0,h(o),void 0):i(o)})(0)},U.matchRequest=function(t,e){var i,n=t.url,s=this.map,r=s.length;for(e=e||0;r>e;++e)if(i=s[e],i.match(n))return t._route_index=e,i},U.route=function(t){t||Error("Router#get() requires a path");var e=[].slice.call(arguments,1),i=new u(t,e,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(i),this},U=u.prototype,U.match=function(t){this.regexp.lastIndex=0;var e,i,n,s,r=this.keys,a=this.params=[],o=this.regexp.exec(t);if(!o)return!1;for(e=1,i=o.length;i>e;++e)n=r[e-1],s="string"==typeof o[e]?decodeURIComponent(o[e]):o[e],n?a[n.name]=s:a.push(s);return!0},U=h.prototype,U.lookup=function(t){return this.root+"/"+t+"?t="+this.timestamp},U.render=function(t,e){return c(this.engine,this.path,t,e,this.ext)},p.id=0;var q=Array.isArray;q||(q=function(t){return t instanceof Array})});