define("lightsaber",function(e,t,i){"use strict";function n(){var e=new r;return g(e,_.prototype),e.request=new a,e.response=new s,e.init(),e}function r(){}function a(e){this.enableFullUrlPath=!!e,this.session={},this.path="/",this.method="GET",this.updateUrl()}function s(e,t){this.path=e,this.title=document.title,this.state=t||{}}function o(e){e=e||{};var t=this;this.map=[],this.params={},this._params=[],this.caseSensitive=e.caseSensitive,this.strict=e.strict,this.middleware=function(e,i,n){t._dispatch(e,i,n)}}function l(e,t,i){i=i||{},this.path=e,this.callbacks=t,this.regexp=v(e,this.keys=[],i.sensitive,i.strict)}function c(e,t,i){t=t||{},this.name=e,this.root=t.root,this.engine=t.engine,this.ext=f(e),this.timestamp=i||"",this.path=this.lookup(e)}function u(e){return function(t,i,n){t.app=i.app=e,t.next=n,i.locals=i.locals||m(i),n()}}function d(){return++d.id}function h(e,t,i){var n=e.length;if(!n)return-1;if(i||(i=0),i>n)return-1;for(0>i&&(i=Math.max(0,n+i));n>i;++i)if(i in e&&e[i]===t)return i;return-1}function p(e,t,i,n,r){return x.get(t,function(t){var a,s=t;"html"!==r&&(a=e.compile(t),s=a(i)),n(s)})}function f(e){return e.split(".")[1]||"html"}function m(e){function t(e){for(var i in e)t[i]=e[i];return e}return e.viewCallbacks=e.viewCallbacks||[],t}function g(e,t){var i;if(e&&t)for(i in t)e[i]=t[i];return e}function v(e,t,i,n){return e instanceof RegExp?e:(M(e)&&(e="("+e.join("|")+")"),e=e.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,i,n,r,a,s,o){return t.push({name:r,optional:!!s}),i=i||"",""+(s?"":i)+"(?:"+(s?i:"")+(n||"")+(a||n&&"([^/.]+?)"||"([^/]+?)")+")"+(s||"")+(o?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+e+"$",i?"":"i"))}var y,_=e("emitter"),b=/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),x=e("jquery")||e("zepto"),w=function(e,t){return e?function(i){return e.call(t,i)}:void 0},k=window.location,C=window.history,E="/",T=!1;x(window).on("load",function(){T=!0,setTimeout(function(){T=!1},0)}),t=i.exports=n;var S;t.version="0.0.5",S=r.prototype,S.historySupport=y=null!==(null!==C?C.pushState:void 0),x.browser&&x.browser.opera&&(S.historySupport=y=!1),S.init=function(){this.route=E,this.stack=[],this.cache={},this.settings={},this.engines={},this.viewCallbacks=[],this.defaultConfiguration()},S.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(u(this)),this._usedRouter=!1,this._router=new o(this),this.routes=this._router.map,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=m(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},S.use=function(e,t){return"string"!=typeof e&&(t=e,e=E),E!==e&&E===e[e.length-1]&&(e=e.slice(0,-1)),this.stack.push({route:e,handle:t}),this},S.engine=function(e,t){if("function"!=typeof t)throw Error("callback function required");return"."!==e[0]&&(e="."+e),this.engines[e]=t,this},S.set=function(e,t){return 1!==arguments.length?(this.settings[e]=t,this):this.settings.hasOwnProperty(e)?this.settings[e]:void 0},S.enabled=function(e){return!!this.set(e)},S.disabled=function(e){return!this.set(e)},S.enable=function(e){return this.set(e,!0)},S.disable=function(e){return this.set(e,!1)},S.configure=function(e,t){var i="all",n=[].slice.call(arguments);return t=n.pop(),n.length&&(i=n),("all"===i||~h(i,this.settings.env))&&t.call(this),this},S.render=function(e,t,i){var n,r={},a=this.cache;if(this.engine,"function"==typeof t&&(i=t,t={}),g(r,this.locals),t.locals&&g(r,t.locals),g(r,t),r.cache=null===r.cache?this.enabled("view cache"):r.cache,r.cache&&(n=a[e]),!n){if(n=new c(e,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp")),!n.path){var s=Error('Failed to lookup view "'+e+'"');return s.view=n,i(s)}r.cache&&(a[e]=n)}try{n.render(r,i)}catch(s){i(s)}},S.path=function(){return this.route},S.param=function(e,t){var i,n=[].slice.call(arguments,1),r=0;if(M(e))for(i=e.length;i>r;++r)for(var a=0,s=n.length;s>a;++a)this.param(e[r],n[a]);else if("function"==typeof e)this._router.param(e);else for(":"===e[0]&&(e=e.substr(1)),i=n.length;i>r;++r)this._router.param(e,t);return this},S.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},S.get=function(){var e=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,e)},S.handle=function(e,t){function i(o){var l,c=n[s++];if(a&&(e.url=e.url.substr(1),a=!1),e.url=r+e.url,c)try{if(l=e.url,0!==l.indexOf(c.route))return i(o);var u=c.handle.length;r=c.route,e.url=e.url.substr(r.length),"/"!==e.url[0]&&(e.url="/"+e.url,a=!0),o?4===u?c.handle(o,e,t,i):i(o):4>u?c.handle(e,t,i):i()}catch(d){i(d)}}if(e.enableFullUrlPath||e.fullpath===e.path){var n=this.stack,r="",a=!1,s=0;i()}},S.run=function(e){this.emit("launch"),e=e||{};var t=this.request,i=this.response;this.running||(this.running=!0,!1===e.dispatch&&this.disable("dispatch"),!1!==e.popstate&&(this.historySupport&&!b?x(window).on("popstate",w(this.change,this)):x(window).on("hashchange",w(this.change,this))),this.disabled("dispatch")||(this.handle(t,i),this.emit("launched")))},S.change=function(e){if(T)return T=!1;var t=this,i=t.request,n=t.response,r=i.url;return i.updateUrl(),r!==i.url?(t.handle(i,n),e&&(e.stopPropagation(),e.preventDefault()),!1):void 0},S.error=function(e,t){var i=Error(t);return i.status=e,i},S=a.prototype,S.updateUrl=function(){this.host=k.hostname,this.port=k.port||80,this.fullpath=k.pathname,this.enableFullUrlPath&&(this.path=this.fullpath),this.hash=decodeURIComponent(k.hash),this.querystring=decodeURIComponent(k.search),this.url=this.path+this.querystring+this.hash},S.param=function(e,t){var i=this.params||{},n=this.query||{};return null!=i[e]&&i.hasOwnProperty(e)?i[e]:null!=n[e]?n[e]:t},S.getPath=function(){return this.path},S.getHost=function(){return this.host},S=s.prototype,S.location=function(e){window.setTimeout(function(){k.href=e},16)},S.redirect=function(e){var t,i;return arguments.length,e=arguments[0],"back"===e||"forward"===e?(C[e](),void 0):y?(t=arguments[1],i=arguments[2]||{},this.path=e,this.title=t||"EXFE.COM",document.title=this.title,this.state=i,this.state.id=d(),this.pushState(),this.app.change(),void 0):(this.location(e),void 0)},S.save=function(){C.replaceState(this.state,this.title,this.path)},S.pushState=function(){C.pushState(this.state,this.title,this.path)},S.render=function(e,t,i){var n=this,t=t||{},r=this.app;"function"==typeof t&&(i=t,t={}),t.locals=n.locals,r.render(e,t,i)},S=o.prototype,S.param=function(e,t){if("function"==typeof e)return this._params.push(e),void 0;var i,n,r=this._params,a=r.length;for(n=0;a>n;++n)(i=r[n](e,t))&&(t=i);if("function"!=typeof t)throw Error("invalid param() call for "+e+", got "+t);return(this.params[e]=this.params[e]||[]).push(t),this},S._dispatch=function(e,t,i){var n=this.params,r=this;(function a(s,o){function l(t){a(e._route_index+1,t)}function c(t){v=0,g=m[s++],p=g&&e.params[g.name],h=g&&n[g.name];try{"route"===t?l():t?(s=0,d(t)):h&&void 0!==p?u():g?c():(s=0,d())}catch(t){c(t)}}function u(i){var n=h[v++];return i||!n?c(i):(n(e,t,u,p,g.name),void 0)}function d(i){var n=f.callbacks[s++];try{if("route"===i)l();else if(i&&n){if(4>n.length)return d(i);n(i,e,t,d)}else n?n(e,t,d):l(i)}catch(i){d(i)}}var h,p,f,m,g,v=0;return e.route=f=r.matchRequest(e,s),f?(e.params=f.params,m=f.keys,s=0,c(o),void 0):i(o)})(0)},S.matchRequest=function(e,t){var i,n=e.url,r=this.map,a=r.length;for(t=t||0;a>t;++t)if(i=r[t],i.match(n))return e._route_index=t,i},S.route=function(e){e||Error("Router#get() requires a path");var t=[].slice.call(arguments,1),i=new l(e,t,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(i),this},S=l.prototype,S.match=function(e){this.regexp.lastIndex=0;var t,i,n,r,a=this.keys,s=this.params=[],o=this.regexp.exec(e);if(!o)return!1;for(t=1,i=o.length;i>t;++t)n=a[t-1],r="string"==typeof o[t]?decodeURIComponent(o[t]):o[t],n?s[n.name]=r:s.push(r);return!0},S=c.prototype,S.lookup=function(e){return this.root+"/"+e+"?t="+this.timestamp},S.render=function(e,t){return p(this.engine,this.path,e,t,this.ext)},d.id=0;var M=Array.isArray;M||(M=function(e){return e instanceof Array})});