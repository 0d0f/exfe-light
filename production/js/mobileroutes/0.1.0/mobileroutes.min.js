<<<<<<< HEAD
define("mobileroutes",function(e,t,i){"use strict";var n=window._ENV_,r=e("store"),a=e("handlebars"),s=e("humantime"),o=function(e){var t=s.printEFTime(e,"X");return t},l=e("mobilecontroller"),c=l.HomeController,u=l.SetPasswordController,d=l.VerifyController,h=l.CrossController,p=l.LiveController,f=function(e,t,i,n,s,l){n||(n={});var c=i.response,u=c.cross,d={id:u.id,title:u.title,description:u.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!c.read_only,change_name:!1},p=u.time;p&&p.begin_at&&p.begin_at.timezone?d.time=o(p):d.time.tobe="tobe";var f=u.place;f&&f.title&&(d.place={title:f.title,description:f.description.replace(/\r\n|\r|\n/g,"<br />")});var m=f.lat,g=f.lng;if(m&&g){var v=window.devicePixelRatio>=2?2:1;d.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+m+","+g+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+m+","+g+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+v,d.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(d.place.title)+"@"+m+","+g}else d.place.tobe="tobe";var y,_=u.widget;if(_&&(y=_.length))for(var b=0;y>b;++b)if("Background"===_[b].type){d.background=_[b].image;break}var x=0,w=0,k=c.authorization;k?(x=k.user_id,c.browsing_identity&&(w=c.browsing_identity.id)):c.browsing_identity&&c.browsing_identity.connected_user_id&&(x=c.browsing_identity.connected_user_id,w=c.browsing_identity.id),c.cross_access_token&&(l=n[s]=c.cross_access_token,r.set("cats",n));for(var C=u.exfee.invitations,E=[],T={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},S=!1,M=0,A=C.length;A>M;++M){var N=C[M],I=x&&x===N.identity.connected_user_id||w===N.identity.id,P=x&&x===N.identity.connected_user_id&&w===N.identity.id,D="pending",O=N.rsvp_status;(P||"NOTIFICATION"!==O)&&("ACCEPTED"===O?D="accepted":"DECLINED"===O&&(D="declined"),N.rsvp_style=D,I?(S="pending"===D,N.is_me=!0,w=N.identity.id,w!==N.invited_by.id&&(d.inviter=N.invited_by),w!==N.by_identity.id&&(S=!0),N.identity.isphone="phone"===N.identity.provider,d.identity=N.identity,T.ACCEPTED.unshift(N)):N.rsvp_status in T&&T[N.rsvp_status].push(N))}d.hide_rsvp=!S,E=[].concat(T.ACCEPTED,T.INTERESTED,T.NORESPONSE,T.IGNORED,T.DECLINED),d.invitations=[],A=E.length;for(var H=0;A>H;)d.invitations.push(E.splice(0,5)),H+=5;A=d.invitations.length;var L=d.invitations[A-1],z=L.length;if(z&&5>z)for(;5-z++;)L.push(void 0);var R="";x&&(k?(R=d.id+"?user_id="+x+"&token="+k.token+"&identity_id="+w,l=k.token,r.set("authorization",k)):(k=r.get("authorization"),k&&k.user_id===x&&(R=d.id+"?user_id="+x+"&token="+k.token+"&identity_id="+w,l=k.token))),l&&d.identity.isphone&&(d.change_name=!0);var j=e.app,F=j.controllers,q=F.cross;q&&q.destory();var B=a.compile($("#cross-tmpl").html());q=j.controllers.cross=new h({options:{template:B(d)},cross:d,exfee_id:u.exfee.id,token:l}),q.emit("show"),j.controllers.footer.emit("show-from-cross",u.exfee.id,l,d.read_only,R)},m=i.exports={index:function(e){var t=e.error,i=e.app,n=i.controllers,r=n.home,a=n.footer,s=i.screen;r||(r=i.controllers.home=new c({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",s,t),a.emit("show",s,!1,!1,t===!0),delete e.error,i.currPageName="HOME"},verify:function(e,t){var i=e.session,n=i.resolveToken,r=e.app;$("#app-header").removeClass("hide");var a=new d({options:{template:$("#verify-tmpl").html()},resolveToken:n});a.emit("show",e,t),r.currPageName="VERIFY"},setPassword:function(e,t){var i=e.session,n=i.resolveToken,r=e.app;$("#app-header").removeClass("hide");var a=new u({options:{template:$("#setpassword-tmpl").html()},resolveToken:n,token:n.origin_token});a.emit("show",e,t),r.currPageName="SET_PASSWORD"},resolveToken:function(e,t){var i=e.app,r=e.params[0],a=e._data_=n._data_,s=e.session;s.resolveToken=a;var o=s.resolveToken.action;"VERIFIED"===o?m.verify(e,t):"INPUT_NEW_PASSWORD"===o&&(s.resolveToken.origin_token=r,m.setPassword(e,t)),i.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(e,t){var i=e.app,a=e.params,s=a[2],o=r.get("cats"),l=o&&o[s],c=e._data_=n._data_;f(e,t,c,o,s,l),i.currPageName="CROSS"},crossToken:function(e,t){var i=e.app,a=e.params[1],s=r.get("cats"),o=e._data_=n._data_,l=s&&s[a];f(e,t,o,s,a,l),i.currPageName="CROSS"},live:function(e){var t=e.app,i=t.controllers,n=i.live;n&&n.destory(),n=t.controllers.live=new p({options:{template:$("#live-tmpl").html()}}),n.emit("show",t.screen,t.ios),t.currPageName="LIVE"}}});
=======
define("mobileroutes",function(t,e,i){"use strict";var n=window._ENV_,r=t("store"),o=t("handlebars"),s=t("humantime"),a=function(t){var e=s.printEFTime(t,"X");return e},l=t("mobilecontroller"),c=l.HomeController,u=l.SetPasswordController,h=l.VerifyController,d=l.CrossController,p=l.LiveController,f=l.RouteXController,m=function(t,e,i,n,s,l){n||(n={});var c=i.response,u=c.cross,h={id:u.id,title:u.title,description:u.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!c.read_only,change_name:!1},p=u.time;p&&p.begin_at&&p.begin_at.timezone?h.time=a(p):h.time.tobe="tobe";var f=u.place;f&&f.title&&(h.place={title:f.title,description:f.description.replace(/\r\n|\r|\n/g,"<br />")});var m=f.lat,v=f.lng;if(m&&v){var g=window.devicePixelRatio>=2?2:1;h.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+m+","+v+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+m+","+v+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+g,h.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(h.place.title)+"@"+m+","+v}else h.place.tobe="tobe";var y,b=u.widget;if(b&&(y=b.length))for(var _=0;y>_;++_)if("Background"===b[_].type){h.background=b[_].image;break}var w=0,x=0,k=c.authorization;k?(w=k.user_id,c.browsing_identity&&(x=c.browsing_identity.id)):c.browsing_identity&&c.browsing_identity.connected_user_id&&(w=c.browsing_identity.connected_user_id,x=c.browsing_identity.id),c.cross_access_token&&(l=n[s]=c.cross_access_token,r.set("cats",n));for(var C=u.exfee.invitations,S=[],E={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},T=!1,P=0,I=C.length;I>P;++P){var L=C[P],A=w&&w===L.identity.connected_user_id||x===L.identity.id,N=w&&w===L.identity.connected_user_id&&x===L.identity.id,O="pending",M=L.rsvp_status;(N||"NOTIFICATION"!==M)&&("ACCEPTED"===M?O="accepted":"DECLINED"===M&&(O="declined"),L.rsvp_style=O,A?(T="pending"===O,L.is_me=!0,x=L.identity.id,x!==L.invited_by.id&&(h.inviter=L.invited_by),x!==L.by_identity.id&&(T=!0),L.identity.isphone="phone"===L.identity.provider,h.identity=L.identity,E.ACCEPTED.unshift(L)):L.rsvp_status in E&&E[L.rsvp_status].push(L))}h.hide_rsvp=!T,S=[].concat(E.ACCEPTED,E.INTERESTED,E.NORESPONSE,E.IGNORED,E.DECLINED),h.invitations=[],I=S.length;for(var H=0;I>H;)h.invitations.push(S.splice(0,5)),H+=5;I=h.invitations.length;var D=h.invitations[I-1],B=D.length;if(B&&5>B)for(;5-B++;)D.push(void 0);var j="";w&&(k?(j=h.id+"?user_id="+w+"&token="+k.token+"&identity_id="+x,l=k.token,r.set("authorization",k)):(k=r.get("authorization"),k&&k.user_id===w&&(j=h.id+"?user_id="+w+"&token="+k.token+"&identity_id="+x,l=k.token))),l&&h.identity.isphone&&(h.change_name=!0);var R=t.app,z=R.controllers,F=z.cross;F&&F.destory();var W=o.compile($("#cross-tmpl").html());F=R.controllers.cross=new d({options:{template:W(h)},cross:h,exfee_id:u.exfee.id,token:l}),F.emit("show"),R.controllers.footer.emit("show-from-cross",u.exfee.id,l,h.read_only,j)},v=i.exports={index:function(t){var e=t.error,i=t.app,n=i.controllers,r=n.home,o=n.footer,s=i.screen;r||(r=i.controllers.home=new c({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",s,e),o.emit("show",s,!1,!1,e===!0),delete t.error,i.currPageName="HOME"},verify:function(t,e){var i=t.session,n=i.resolveToken,r=t.app;$("#app-header").removeClass("hide");var o=new h({options:{template:$("#verify-tmpl").html()},resolveToken:n});o.emit("show",t,e),r.currPageName="VERIFY"},setPassword:function(t,e){var i=t.session,n=i.resolveToken,r=t.app;$("#app-header").removeClass("hide");var o=new u({options:{template:$("#setpassword-tmpl").html()},resolveToken:n,token:n.origin_token});o.emit("show",t,e),r.currPageName="SET_PASSWORD"},resolveToken:function(t,e){var i=t.app,r=t.params[0],o=t._data_=n._data_,s=t.session;s.resolveToken=o;var a=s.resolveToken.action;"VERIFIED"===a?v.verify(t,e):"INPUT_NEW_PASSWORD"===a&&(s.resolveToken.origin_token=r,v.setPassword(t,e)),i.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(t,e){var i=t.app,o=t.params,s=o[2],a=r.get("cats"),l=a&&a[s],c=t._data_=n._data_;m(t,e,c,a,s,l),i.currPageName="CROSS"},crossToken:function(t,e){var i=t.app,o=t.params[1],s=r.get("cats"),a=t._data_=n._data_,l=s&&s[o];m(t,e,a,s,o,l),i.currPageName="CROSS"},live:function(t){var e=t.app,i=e.controllers,n=i.live;n&&n.destory(),n=e.controllers.live=new p({options:{template:$("#live-tmpl").html()}}),n.emit("show",e.screen,e.ios),e.currPageName="LIVE"},routex:function(t){var e=t.app;window.title="活点地图";var i=e.controllers.routex=new f({options:{template:$("#routex-tmpl").html()},cross:n._data_.cross,token:n._data_.token,cross_id:n._data_.cross_id});i.emit("show",e.screen)}}});
>>>>>>> 592a4b8... remove old files
