define("mobileroutes",function(e,t,i){"use strict";var n=window._ENV_,r=e("store"),a=e("handlebars"),s=e("humantime"),o=function(e){var t=s.printEFTime(e,"X");return t},l=e("mobilecontroller"),c=l.HomeController,d=l.SetPasswordController,u=l.VerifyController,h=l.CrossController,p=l.LiveController,f=function(e,t,i,n,s,l){n||(n={});var c=i.response,d=c.cross,u={id:d.id,title:d.title,description:d.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!c.read_only,change_name:!1},p=d.time;p&&p.begin_at&&p.begin_at.timezone?u.time=o(p):u.time.tobe="tobe";var f=d.place;f&&f.title&&(u.place={title:f.title,description:f.description.replace(/\r\n|\r|\n/g,"<br />")});var m=f.lat,g=f.lng;if(m&&g){var v=window.devicePixelRatio>=2?2:1;u.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+m+","+g+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+m+","+g+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+v,u.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(u.place.title)+"@"+m+","+g}else u.place.tobe="tobe";var y,_=d.widget;if(_&&(y=_.length))for(var b=0;y>b;++b)if("Background"===_[b].type){u.background=_[b].image;break}var x=0,w=0,k=c.authorization;k?(x=k.user_id,c.browsing_identity&&(w=c.browsing_identity.id)):c.browsing_identity&&c.browsing_identity.connected_user_id&&(x=c.browsing_identity.connected_user_id,w=c.browsing_identity.id),c.cross_access_token&&(l=n[s]=c.cross_access_token,r.set("cats",n));for(var C=d.exfee.invitations,E=[],T={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},S=0,M=C.length;M>S;++S){var I=C[S],N="pending",A=I.rsvp_status;"NOTIFICATION"!==A&&("ACCEPTED"===A?N="accepted":"DECLINED"===A&&(N="declined"),I.rsvp_style=N,x&&x===I.identity.connected_user_id||w===I.identity.id?(I.is_me=!0,w=I.identity.id,w!==I.invited_by.id&&(u.inviter=I.invited_by),I.identity.isphone="phone"===I.identity.provider,u.identity=I.identity,T.ACCEPTED.unshift(I)):I.rsvp_status in T&&T[I.rsvp_status].push(I))}E=[].concat(T.ACCEPTED,T.INTERESTED,T.NORESPONSE,T.IGNORED,T.DECLINED),u.invitations=[],M=E.length;for(var P=0;M>P;)u.invitations.push(E.splice(0,5)),P+=5;M=u.invitations.length;var D=u.invitations[M-1],O=D.length;if(O&&5>O)for(;5-O++;)D.push(void 0);var z="";x&&(k?(z=u.id+"?user_id="+x+"&token="+k.token+"&identity_id="+w,l=k.token,r.set("authorization",k)):(k=r.get("authorization"),k&&k.user_id===x&&(z=u.id+"?user_id="+x+"&token="+k.token+"&identity_id="+w,l=k.token))),u.identity.isphone&&l&&(u.change_name=!0);var L=e.app,H=L.controllers,R=H.cross;R&&R.destory();var F=a.compile($("#cross-tmpl").html());R=L.controllers.cross=new h({options:{template:F(u)},cross:u,exfee_id:d.exfee.id,token:l}),R.emit("show"),L.controllers.footer.emit("show-from-cross",d.exfee.id,l,u.identity.isphone,u.read_only,z)},m=i.exports={index:function(e){var t=e.error,i=e.app,n=i.controllers,r=n.home,a=n.footer,s=i.screen;r||(r=i.controllers.home=new c({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",s,t),a.emit("show",s,!1,!1,t===!0),delete e.error,i.currPageName="HOME"},verify:function(e,t){var i=e.session,n=i.resolveToken,r=e.app;$("#app-header").removeClass("hide");var a=new u({options:{template:$("#verify-tmpl").html()},resolveToken:n});a.emit("show",e,t),r.currPageName="VERIFY"},setPassword:function(e,t){var i=e.session,n=i.resolveToken,r=e.app;$("#app-header").removeClass("hide");var a=new d({options:{template:$("#setpassword-tmpl").html()},resolveToken:n,token:n.origin_token});a.emit("show",e,t),r.currPageName="SET_PASSWORD"},resolveToken:function(e,t){var i=e.app,r=e.params[0],a=e._data_=n._data_,s=e.session;s.resolveToken=a.response;var o=s.resolveToken.action;"VERIFIED"===o?m.verify(e,t):"INPUT_NEW_PASSWORD"===o&&(s.resolveToken.origin_token=r,m.setPassword(e,t)),i.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(e,t){var i=e.app,a=e.params,s=a[1],o=r.get("cats"),l=o&&o[s],c=e._data_=n._data_;f(e,t,c,o,s,l),i.currPageName="CROSS"},crossToken:function(e,t){var i=e.app,a=e.params[0],s=r.get("cats"),o=e._data_=n._data_,l=s&&s[a];f(e,t,o,s,a,l),i.currPageName="CROSS"},live:function(e){var t=e.app,i=t.controllers,n=i.live;n&&n.destory(),n=t.controllers.live=new p({options:{template:$("#live-tmpl").html()}}),n.emit("show",t.screen,t.ios),t.currPageName="LIVE"}}});