define("mobileroutes",function(e,t,i){"use strict";var o=window._ENV_,n=e("store"),r=e("handlebars"),s=e("humantime"),a=function(e){var t=s.printEFTime(e,"X");return t},d=e("mobilecontroller"),l=d.HomeController,c=d.SetPasswordController,p=d.VerifyController,m=d.CrossController,_=d.LiveController,v=function(e,t,i,o,s,d){o||(o={});var l=i.response,c=l.cross,p={id:c.id,title:c.title,description:c.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!l.read_only,change_name:!1},_=c.time;_&&_.begin_at&&_.begin_at.timezone?p.time=a(_):p.time.tobe="tobe";var v=c.place;v&&v.title&&(p.place={title:v.title,description:v.description.replace(/\r\n|\r|\n/g,"<br />")});var h=v.lat,u=v.lng;if(h&&u){var g=window.devicePixelRatio>=2?2:1;p.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+h+","+u+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+h+","+u+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+g,p.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(p.place.title)+"@"+h+","+u}else p.place.tobe="tobe";var E,f=c.widget;if(f&&(E=f.length))for(var y=0;E>y;++y)if("Background"===f[y].type){p.background=f[y].image;break}var w=0,T=0,b=l.authorization;b?(w=b.user_id,l.browsing_identity&&(T=l.browsing_identity.id)):l.browsing_identity&&l.browsing_identity.connected_user_id&&(w=l.browsing_identity.connected_user_id,T=l.browsing_identity.id),l.cross_access_token&&(d=o[s]=l.cross_access_token,n.set("cats",o));for(var k=c.exfee.invitations,C=[],N={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},P=!0,S=0,D=k.length;D>S;++S){var I=k[S],R=w&&w===I.identity.connected_user_id||T===I.identity.id,O=w&&w===I.identity.connected_user_id&&T===I.identity.id,x="pending",A=I.rsvp_status;(O||"NOTIFICATION"!==A)&&("ACCEPTED"===A?x="accepted":"DECLINED"===A&&(x="declined"),I.rsvp_style=x,R?(P="ACCEPTED"===A,I.is_me=!0,T=I.identity.id,T!==I.invited_by.id&&(p.inviter=I.invited_by),T!==I.by_identity.id&&(P=!1),I.identity.isphone="phone"===I.identity.provider,p.identity=I.identity,N.ACCEPTED.unshift(I)):I.rsvp_status in N&&N[I.rsvp_status].push(I))}p.hide_rsvp=P,C=[].concat(N.ACCEPTED,N.INTERESTED,N.NORESPONSE,N.IGNORED,N.DECLINED),p.invitations=[],D=C.length;for(var z=0;D>z;)p.invitations.push(C.splice(0,5)),z+=5;D=p.invitations.length;var L=p.invitations[D-1],V=L.length;if(V&&5>V)for(;5-V++;)L.push(void 0);var F="";w&&(b?(F=p.id+"?user_id="+w+"&token="+b.token+"&identity_id="+T,d=b.token,n.set("authorization",b)):(b=n.get("authorization"),b&&b.user_id===w&&(F=p.id+"?user_id="+w+"&token="+b.token+"&identity_id="+T,d=b.token))),d&&p.identity.isphone&&(p.change_name=!0);var U=e.app,W=U.controllers,G=W.cross;G&&G.destory();var H=r.compile($("#cross-tmpl").html());G=U.controllers.cross=new m({options:{template:H(p)},cross:p,exfee_id:c.exfee.id,token:d}),G.emit("show"),U.controllers.footer.emit("show-from-cross",c.exfee.id,d,p.read_only,F)},h=i.exports={index:function(e){var t=e.error,i=e.app,o=i.controllers,n=o.home,r=o.footer,s=i.screen;n||(n=i.controllers.home=new l({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",n.emit("show",s,t),r.emit("show",s,!1,!1,t===!0),delete e.error,i.currPageName="HOME"},verify:function(e,t){var i=e.session,o=i.resolveToken,n=e.app;$("#app-header").removeClass("hide");var r=new p({options:{template:$("#verify-tmpl").html()},resolveToken:o});r.emit("show",e,t),n.currPageName="VERIFY"},setPassword:function(e,t){var i=e.session,o=i.resolveToken,n=e.app;$("#app-header").removeClass("hide");var r=new c({options:{template:$("#setpassword-tmpl").html()},resolveToken:o,token:o.origin_token});r.emit("show",e,t),n.currPageName="SET_PASSWORD"},resolveToken:function(e,t){var i=e.app,n=e.params[0],r=e._data_=o._data_,s=e.session;s.resolveToken=r.response;var a=s.resolveToken.action;"VERIFIED"===a?h.verify(e,t):"INPUT_NEW_PASSWORD"===a&&(s.resolveToken.origin_token=n,h.setPassword(e,t)),i.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(e,t){var i=e.app,r=e.params,s=r[1],a=n.get("cats"),d=a&&a[s],l=e._data_=o._data_;v(e,t,l,a,s,d),i.currPageName="CROSS"},crossToken:function(e,t){var i=e.app,r=e.params[0],s=n.get("cats"),a=e._data_=o._data_,d=s&&s[r];v(e,t,a,s,r,d),i.currPageName="CROSS"},live:function(e){var t=e.app,i=t.controllers,o=i.live;o&&o.destory(),o=t.controllers.live=new _({options:{template:$("#live-tmpl").html()}}),o.emit("show",t.screen,t.ios),t.currPageName="LIVE"}}});