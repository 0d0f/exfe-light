define("mobileroutes",function(t,e,n){"use strict";var i=window._ENV_,r=t("store"),s=t("handlebars"),a=t("humantime"),o=function(t){var e=a.printEFTime(t,"X");return e},c=t("mobilecontroller"),u=c.HomeController,l=c.SetPasswordController,h=c.VerifyController,d=c.CrossController,p=c.LiveController,f=function(t,e,n,i,a,c){i||(i={});var u=n.meta,l=u&&u.code;if(l&&200===l){var h=n.response,p=h.cross,f={id:p.id,title:p.title,description:p.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!h.read_only},m=p.time;m&&m.begin_at&&m.begin_at.timezone?f.time=o(m):f.time.tobe="tobe";var v=p.place;v&&v.title&&(f.place={title:v.title,description:v.description.replace(/\r\n|\r|\n/g,"<br />")});var g=v.lat,y=v.lng;if(g&&y){var b=window.devicePixelRatio>=2?2:1;f.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+g+","+y+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+g+","+y+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+b,f.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(f.place.title)+"@"+g+","+y}else f.place.tobe="tobe";var w,k=p.widget;if(k&&(w=k.length))for(var x=0;w>x;++x)if("Background"===k[x].type){f.background=k[x].image;break}var _=0,E=0,C=h.authorization;C?(_=C.user_id,h.browsing_identity&&(E=h.browsing_identity.id)):h.browsing_identity&&h.browsing_identity.connected_user_id&&(_=h.browsing_identity.connected_user_id,E=h.browsing_identity.id),h.cross_access_token&&(c=i[a]=h.cross_access_token,r.set("cats",i));for(var S=p.exfee.invitations,T=[],N={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},P=0,A=S.length;A>P;++P){var I=S[P],O="pending",M=I.rsvp_status;"ACCEPTED"===M?O="accepted":"DECLINED"===M&&(O="declined"),I.rsvp_style=O,_&&_===I.identity.connected_user_id||E===I.identity.id?(I.is_me=!0,E=I.identity.id,E!==I.invited_by.id&&(f.inviter=I.invited_by),I.identity.isphone="phone"===I.identity.provider,f.identity=I.identity,N.ACCEPTED.unshift(I)):I.rsvp_status in N&&N[I.rsvp_status].push(I)}T=[].concat(N.ACCEPTED,N.INTERESTED,N.NORESPONSE,N.IGNORED,N.DECLINED),f.invitations=[],A=T.length;for(var H=0;A>H;)f.invitations.push(T.splice(0,5)),H+=5;A=f.invitations.length;var D=f.invitations[A-1],j=D.length;if(j&&5>j)for(;5-j++;)D.push(void 0);var L="";_&&(C?(L=f.id+"?user_id="+_+"&token="+C.token+"&identity_id="+E,c=C.token,r.set("authorization",C)):(C=r.get("authorization"),C&&C.user_id===_&&(L=f.id+"?user_id="+_+"&token="+C.token+"&identity_id="+E,c=C.token)));var R=t.app,F=R.controllers,z=F.cross;z&&z.destory();var B=s.compile($("#cross-tmpl").html());z=R.controllers.cross=new d({options:{template:B(f)},cross:f,exfee_id:p.exfee.id,token:c}),z.emit("show"),R.controllers.footer.emit("show-from-cross",p.exfee.id,c,f.identity.isphone,L)}else t.error={code:404},e.redirect("/")},m=n.exports={index:function(t){var e=t.error,n=t.app,i=n.controllers,r=i.home,s=i.footer,a=n.screen;r||(r=n.controllers.home=new u({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",a,e),s.emit("show",a,!1,!1,e===!0),delete t.error,n.currPageName="HOME"},verify:function(t,e){var n=t.session,i=n.resolveToken,r=t.app;if(i){$("#app-header").removeClass("hide");var s=new h({options:{template:$("#verify-tmpl").html()},resolveToken:i});s.emit("show",t,e)}else t.error=!0,e.redirect("/");r.currPageName="VERIFY"},setPassword:function(t,e){var n=t.session,i=n.resolveToken,r=t.app;if(i){$("#app-header").removeClass("hide");var s=new l({options:{template:$("#setpassword-tmpl").html()},resolveToken:i,token:i.origin_token});s.emit("show",t,e)}else t.error=!0,e.redirect("/");r.currPageName="SET_PASSWORD"},resolveToken:function(t,e){var n=t.app,r=t.params[0],s=t._data_=i._data_,a=function(t,e){t.error={code:404},e.redirect("/")};if(r)if(s&&s.meta&&200===s.meta.code){var o=t.session;o.resolveToken=s.response;var c=o.resolveToken.action;"VERIFIED"===c?m.verify(t,e):"INPUT_NEW_PASSWORD"===c&&(o.resolveToken.origin_token=r,m.setPassword(t,e))}else a(t,e);else a(t,e);n.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(t,e){var n=t.app,s=t.params,a=s[1],o=r.get("cats"),c=o&&o[a],u=t._data_=i._data_;f(t,e,u,o,a,c),n.currPageName="CROSS"},crossToken:function(t,e){var n=t.app,s=t.params[0],a=r.get("cats"),o=t._data_=i._data_,c=a&&a[s];f(t,e,o,a,s,c),n.currPageName="CROSS"},live:function(t){var e=t.app,n=e.controllers,i=n.live;i&&i.destory(),i=e.controllers.live=new p({options:{template:$("#live-tmpl").html()}}),i.emit("show",e.screen,e.ios),e.currPageName="LIVE"}}});