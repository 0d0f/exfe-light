define("mobileroutes",function(t,e,n){"use strict";var i=window._ENV_,r=t("store"),s=t("handlebars"),a=t("humantime"),o=function(t){var e=a.printEFTime(t,"X");return e},c=t("mobilecontroller"),u=c.HomeController,l=c.SetPasswordController,h=c.VerifyController,p=c.CrossController,d=c.LiveController,f=function(t,e,n,i,a,c){i||(i={});var u=n.response,l=u.cross,h={id:l.id,title:l.title,description:l.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!u.read_only,change_name:!1},d=l.time;d&&d.begin_at&&d.begin_at.timezone?h.time=o(d):h.time.tobe="tobe";var f=l.place;f&&f.title&&(h.place={title:f.title,description:f.description.replace(/\r\n|\r|\n/g,"<br />")});var m=f.lat,v=f.lng;if(m&&v){var g=window.devicePixelRatio>=2?2:1;h.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+m+","+v+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+m+","+v+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+g,h.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(h.place.title)+"@"+m+","+v}else h.place.tobe="tobe";var y,b=l.widget;if(b&&(y=b.length))for(var w=0;y>w;++w)if("Background"===b[w].type){h.background=b[w].image;break}var k=0,x=0,_=u.authorization;_?(k=_.user_id,u.browsing_identity&&(x=u.browsing_identity.id)):u.browsing_identity&&u.browsing_identity.connected_user_id&&(k=u.browsing_identity.connected_user_id,x=u.browsing_identity.id),u.cross_access_token&&(c=i[a]=u.cross_access_token,r.set("cats",i));for(var E=l.exfee.invitations,C=[],S={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},T=0,N=E.length;N>T;++T){var P=E[T],A="pending",I=P.rsvp_status;"NOTIFICATION"!==I&&("ACCEPTED"===I?A="accepted":"DECLINED"===I&&(A="declined"),P.rsvp_style=A,k&&k===P.identity.connected_user_id||x===P.identity.id?(P.is_me=!0,x=P.identity.id,x!==P.invited_by.id&&(h.inviter=P.invited_by),P.identity.isphone="phone"===P.identity.provider,h.identity=P.identity,S.ACCEPTED.unshift(P)):P.rsvp_status in S&&S[P.rsvp_status].push(P))}C=[].concat(S.ACCEPTED,S.INTERESTED,S.NORESPONSE,S.IGNORED,S.DECLINED),h.invitations=[],N=C.length;for(var O=0;N>O;)h.invitations.push(C.splice(0,5)),O+=5;N=h.invitations.length;var M=h.invitations[N-1],H=M.length;if(H&&5>H)for(;5-H++;)M.push(void 0);var D="";k&&(_?(D=h.id+"?user_id="+k+"&token="+_.token+"&identity_id="+x,c=_.token,r.set("authorization",_)):(_=r.get("authorization"),_&&_.user_id===k&&(D=h.id+"?user_id="+k+"&token="+_.token+"&identity_id="+x,c=_.token))),h.identity.isphone&&c&&(h.change_name=!0);var j=t.app,L=j.controllers,R=L.cross;R&&R.destory();var F=s.compile($("#cross-tmpl").html());R=j.controllers.cross=new p({options:{template:F(h)},cross:h,exfee_id:l.exfee.id,token:c}),R.emit("show"),j.controllers.footer.emit("show-from-cross",l.exfee.id,c,h.identity.isphone,h.read_only,D)},m=n.exports={index:function(t){var e=t.error,n=t.app,i=n.controllers,r=i.home,s=i.footer,a=n.screen;r||(r=n.controllers.home=new u({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",a,e),s.emit("show",a,!1,!1,e===!0),delete t.error,n.currPageName="HOME"},verify:function(t,e){var n=t.session,i=n.resolveToken,r=t.app;$("#app-header").removeClass("hide");var s=new h({options:{template:$("#verify-tmpl").html()},resolveToken:i});s.emit("show",t,e),r.currPageName="VERIFY"},setPassword:function(t,e){var n=t.session,i=n.resolveToken,r=t.app;$("#app-header").removeClass("hide");var s=new l({options:{template:$("#setpassword-tmpl").html()},resolveToken:i,token:i.origin_token});s.emit("show",t,e),r.currPageName="SET_PASSWORD"},resolveToken:function(t,e){var n=t.app,r=t.params[0],s=t._data_=i._data_,a=t.session;a.resolveToken=s.response;var o=a.resolveToken.action;"VERIFIED"===o?m.verify(t,e):"INPUT_NEW_PASSWORD"===o&&(a.resolveToken.origin_token=r,m.setPassword(t,e)),n.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(t,e){var n=t.app,s=t.params,a=s[1],o=r.get("cats"),c=o&&o[a],u=t._data_=i._data_;f(t,e,u,o,a,c),n.currPageName="CROSS"},crossToken:function(t,e){var n=t.app,s=t.params[0],a=r.get("cats"),o=t._data_=i._data_,c=a&&a[s];f(t,e,o,a,s,c),n.currPageName="CROSS"},live:function(t){var e=t.app,n=e.controllers,i=n.live;i&&i.destory(),i=e.controllers.live=new d({options:{template:$("#live-tmpl").html()}}),i.emit("show",e.screen,e.ios),e.currPageName="LIVE"}}});