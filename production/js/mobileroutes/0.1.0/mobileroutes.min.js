define("mobileroutes",function(e,t,o){"use strict";var i=window._ENV_,r=e("store"),n=e("handlebars"),s=e("humantime"),a=function(e){var t=s.printEFTime(e,"X");return t},d=e("mobilecontroller"),l=d.HomeController,c=d.SetPasswordController,p=d.VerifyController,m=d.CrossController,v=d.LiveController,_=function(e,t,o,i,s,d){i||(i={});var l=o.meta,c=l&&l.code;if(c&&200===c){var p=o.response,v=p.cross,_={id:v.id,title:v.title,description:v.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!p.read_only,change_name:!1},h=v.time;h&&h.begin_at&&h.begin_at.timezone?_.time=a(h):_.time.tobe="tobe";var u=v.place;u&&u.title&&(_.place={title:u.title,description:u.description.replace(/\r\n|\r|\n/g,"<br />")});var g=u.lat,f=u.lng;if(g&&f){var E=window.devicePixelRatio>=2?2:1;_.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+g+","+f+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+g+","+f+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+E,_.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(_.place.title)+"@"+g+","+f}else _.place.tobe="tobe";var y,w=v.widget;if(w&&(y=w.length))for(var k=0;y>k;++k)if("Background"===w[k].type){_.background=w[k].image;break}var b=0,T=0,C=p.authorization;C?(b=C.user_id,p.browsing_identity&&(T=p.browsing_identity.id)):p.browsing_identity&&p.browsing_identity.connected_user_id&&(b=p.browsing_identity.connected_user_id,T=p.browsing_identity.id),p.cross_access_token&&(d=i[s]=p.cross_access_token,r.set("cats",i));for(var N=v.exfee.invitations,P=[],S={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},D=0,R=N.length;R>D;++D){var I=N[D],O="pending",x=I.rsvp_status;"ACCEPTED"===x?O="accepted":"DECLINED"===x&&(O="declined"),I.rsvp_style=O,b&&b===I.identity.connected_user_id||T===I.identity.id?(I.is_me=!0,T=I.identity.id,T!==I.invited_by.id&&(_.inviter=I.invited_by),I.identity.isphone="phone"===I.identity.provider,_.identity=I.identity,S.ACCEPTED.unshift(I)):I.rsvp_status in S&&S[I.rsvp_status].push(I)}P=[].concat(S.ACCEPTED,S.INTERESTED,S.NORESPONSE,S.IGNORED,S.DECLINED),_.invitations=[],R=P.length;for(var z=0;R>z;)_.invitations.push(P.splice(0,5)),z+=5;R=_.invitations.length;var A=_.invitations[R-1],L=A.length;if(L&&5>L)for(;5-L++;)A.push(void 0);var V="";b&&(C?(V=_.id+"?user_id="+b+"&token="+C.token+"&identity_id="+T,d=C.token,r.set("authorization",C)):(C=r.get("authorization"),C&&C.user_id===b&&(V=_.id+"?user_id="+b+"&token="+C.token+"&identity_id="+T,d=C.token))),_.identity.isphone&&d&&(_.change_name=!0);var F=e.app,U=F.controllers,W=U.cross;W&&W.destory();var G=n.compile($("#cross-tmpl").html());W=F.controllers.cross=new m({options:{template:G(_)},cross:_,exfee_id:v.exfee.id,token:d}),W.emit("show"),F.controllers.footer.emit("show-from-cross",v.exfee.id,d,_.identity.isphone,_.read_only,V)}else e.error={code:404},t.redirect("/")},h=o.exports={index:function(e){var t=e.error,o=e.app,i=o.controllers,r=i.home,n=i.footer,s=o.screen;r||(r=o.controllers.home=new l({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",s,t),n.emit("show",s,!1,!1,t===!0),delete e.error,o.currPageName="HOME"},verify:function(e,t){var o=e.session,i=o.resolveToken,r=e.app;if(i){$("#app-header").removeClass("hide");var n=new p({options:{template:$("#verify-tmpl").html()},resolveToken:i});n.emit("show",e,t)}else e.error=!0,t.redirect("/");r.currPageName="VERIFY"},setPassword:function(e,t){var o=e.session,i=o.resolveToken,r=e.app;if(i){$("#app-header").removeClass("hide");var n=new c({options:{template:$("#setpassword-tmpl").html()},resolveToken:i,token:i.origin_token});n.emit("show",e,t)}else e.error=!0,t.redirect("/");r.currPageName="SET_PASSWORD"},resolveToken:function(e,t){var o=e.app,r=e.params[0],n=e._data_=i._data_,s=function(e,t){e.error={code:404},t.redirect("/")};if(r)if(n&&n.meta&&200===n.meta.code){var a=e.session;a.resolveToken=n.response;var d=a.resolveToken.action;"VERIFIED"===d?h.verify(e,t):"INPUT_NEW_PASSWORD"===d&&(a.resolveToken.origin_token=r,h.setPassword(e,t))}else s(e,t);else s(e,t);o.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(e,t){var o=e.app,n=e.params,s=n[1],a=r.get("cats"),d=a&&a[s],l=e._data_=i._data_;_(e,t,l,a,s,d),o.currPageName="CROSS"},crossToken:function(e,t){var o=e.app,n=e.params[0],s=r.get("cats"),a=e._data_=i._data_,d=s&&s[n];_(e,t,a,s,n,d),o.currPageName="CROSS"},live:function(e){var t=e.app,o=t.controllers,i=o.live;i&&i.destory(),i=t.controllers.live=new v({options:{template:$("#live-tmpl").html()}}),i.emit("show",t.screen,t.ios),t.currPageName="LIVE"}}});