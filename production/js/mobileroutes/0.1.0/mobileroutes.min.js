define("mobileroutes",function(e,t,o){"use strict";var i=window._ENV_,r=e("store"),n=e("handlebars"),s=e("humantime"),a=function(e){var t=s.printEFTime(e,"X");return t},l=e("mobilecontroller"),d=l.HomeController,p=l.SetPasswordController,c=l.VerifyController,m=l.CrossController,v=l.LiveController,_=function(e,t,o,i,s,l){i||(i={});var d=o.response,p=d.cross,c={id:p.id,title:p.title,description:p.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!d.read_only,change_name:!1},v=p.time;v&&v.begin_at&&v.begin_at.timezone?c.time=a(v):c.time.tobe="tobe";var _=p.place;_&&_.title&&(c.place={title:_.title,description:_.description.replace(/\r\n|\r|\n/g,"<br />")});var h=_.lat,g=_.lng;if(h&&g){var u=window.devicePixelRatio>=2?2:1;c.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+h+","+g+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+h+","+g+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+u,c.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(c.place.title)+"@"+h+","+g}else c.place.tobe="tobe";var E,f=p.widget;if(f&&(E=f.length))for(var y=0;E>y;++y)if("Background"===f[y].type){c.background=f[y].image;break}var w=0,k=0,T=d.authorization;T?(w=T.user_id,d.browsing_identity&&(k=d.browsing_identity.id)):d.browsing_identity&&d.browsing_identity.connected_user_id&&(w=d.browsing_identity.connected_user_id,k=d.browsing_identity.id),d.cross_access_token&&(l=i[s]=d.cross_access_token,r.set("cats",i));for(var b=p.exfee.invitations,C=[],N={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},P=0,S=b.length;S>P;++P){var D=b[P],I="pending",R=D.rsvp_status;"NOTIFICATION"!==R&&("ACCEPTED"===R?I="accepted":"DECLINED"===R&&(I="declined"),D.rsvp_style=I,w&&w===D.identity.connected_user_id||k===D.identity.id?(D.is_me=!0,k=D.identity.id,k!==D.invited_by.id&&(c.inviter=D.invited_by),D.identity.isphone="phone"===D.identity.provider,c.identity=D.identity,N.ACCEPTED.unshift(D)):D.rsvp_status in N&&N[D.rsvp_status].push(D))}C=[].concat(N.ACCEPTED,N.INTERESTED,N.NORESPONSE,N.IGNORED,N.DECLINED),c.invitations=[],S=C.length;for(var O=0;S>O;)c.invitations.push(C.splice(0,5)),O+=5;S=c.invitations.length;var x=c.invitations[S-1],A=x.length;if(A&&5>A)for(;5-A++;)x.push(void 0);var z="";w&&(T?(z=c.id+"?user_id="+w+"&token="+T.token+"&identity_id="+k,l=T.token,r.set("authorization",T)):(T=r.get("authorization"),T&&T.user_id===w&&(z=c.id+"?user_id="+w+"&token="+T.token+"&identity_id="+k,l=T.token))),c.identity.isphone&&l&&(c.change_name=!0);var L=e.app,V=L.controllers,F=V.cross;F&&F.destory();var U=n.compile($("#cross-tmpl").html());F=L.controllers.cross=new m({options:{template:U(c)},cross:c,exfee_id:p.exfee.id,token:l}),F.emit("show"),L.controllers.footer.emit("show-from-cross",p.exfee.id,l,c.identity.isphone,c.read_only,z)},h=o.exports={index:function(e){var t=e.error,o=e.app,i=o.controllers,r=i.home,n=i.footer,s=o.screen;r||(r=o.controllers.home=new d({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",r.emit("show",s,t),n.emit("show",s,!1,!1,t===!0),delete e.error,o.currPageName="HOME"},verify:function(e,t){var o=e.session,i=o.resolveToken,r=e.app;$("#app-header").removeClass("hide");var n=new c({options:{template:$("#verify-tmpl").html()},resolveToken:i});n.emit("show",e,t),r.currPageName="VERIFY"},setPassword:function(e,t){var o=e.session,i=o.resolveToken,r=e.app;$("#app-header").removeClass("hide");var n=new p({options:{template:$("#setpassword-tmpl").html()},resolveToken:i,token:i.origin_token});n.emit("show",e,t),r.currPageName="SET_PASSWORD"},resolveToken:function(e,t){var o=e.app,r=e.params[0],n=e._data_=i._data_,s=e.session;s.resolveToken=n.response;var a=s.resolveToken.action;"VERIFIED"===a?h.verify(e,t):"INPUT_NEW_PASSWORD"===a&&(s.resolveToken.origin_token=r,h.setPassword(e,t)),o.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(e,t){var o=e.app,n=e.params,s=n[1],a=r.get("cats"),l=a&&a[s],d=e._data_=i._data_;_(e,t,d,a,s,l),o.currPageName="CROSS"},crossToken:function(e,t){var o=e.app,n=e.params[0],s=r.get("cats"),a=e._data_=i._data_,l=s&&s[n];_(e,t,a,s,n,l),o.currPageName="CROSS"},live:function(e){var t=e.app,o=t.controllers,i=o.live;i&&i.destory(),i=t.controllers.live=new v({options:{template:$("#live-tmpl").html()}}),i.emit("show",t.screen,t.ios),t.currPageName="LIVE"}}});