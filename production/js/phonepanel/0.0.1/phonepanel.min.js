define("phonepanel",function(e){"use strict";var t=e("jquery"),n=t.proxy,r=t.extend,i=e("config"),s=/[\r\n]+/g,o="\r",u=t(window),a=t.browser.msie,f="",l=0,c={country_code:"",phone_number:""},h=e("countrycodes"),p=e("panel"),d=p.extend({options:{template:'<div class="panel phone-panel" tabindex="-1" data-widget="panel" id="phone-panel"><div class="panel-body"><div class="main-info">Please complete contact info:</div><div class="input-area"><input class="countrycode" type="text" /><input class="phonenumber" type="text" /></div><div class="tips-area"><div class="ta-countrycode"></div><div class="ta-phonenumber">Area code and local number</div></div><ol class="complete-list"></ol><div class="name-area"><input class="name" type="text" placeholder="Enter contact name" /><button class="xbtn-blue add" disabled="disabled">Add</button></div></div></div>',parentNode:null,srcNode:null},init:function(){var e=this.options,t;this.render(),t=this.element;for(var n=0;n<h.length;n++)h[n].regular=new RegExp(h[n].regular),h[n].short_name==="US"&&(l=n);this.listen()},listen:function(){var e=this,n=this.element;n.on("keyup.phonepanel",".countrycode",function(e){switch(e.keyCode){case 38:case 40:return;case 13:var r=t(".complete-list li.selected"),i=~~r.attr("country-code");typeof h[i]&&(l=i,t("#phone-panel .countrycode").val("+"+h[i].country_code),t(".tips-area .ta-countrycode").html(h[i].short_name),n.find(".tips-area").show(),n.find(".complete-list").slideUp());return}var s="",o=t(this).val().toLowerCase().replace(/^\+/,"");if(o)for(var u=0;u<h.length;u++)h[u].country_code===o?(s='<li country-code="'+u+'">'+'<div class="li-countrycode">+'+h[u].country_code+"</div>"+'<div class="li-countryname">'+h[u].country_name+"</div>"+'<div class="li-tips">'+h[u].support.join(" and ")+" supported</div>"+"</li>"+s,l=u):h[u].search_index.indexOf(o)!==-1&&(s+='<li country-code="'+u+'">'+'<div class="li-countrycode">+'+h[u].country_code+"</div>"+'<div class="li-countryname">'+h[u].country_name+"</div>"+'<div class="li-tips">'+h[u].support.join(" and ")+" supported</div>"+"</li>");n.find(".complete-list").html(s),s?(n.find(".tips-area").hide(),n.find(".complete-list").slideDown()):(n.find(".tips-area").show(),n.find(".complete-list").slideUp())}),n.on("keydown.phonepanel",".countrycode",function(e){if(!n.find(".complete-list").html())return;var t=n.find(".complete-list li.selected"),r=n.find(".complete-list"),i=~~t.index(),s=44,o=s*3,u=n.find(".complete-list li").length-1,a=r.scrollTop();switch(e.keyCode){case 38:event.preventDefault(),--i<0&&(i=u);break;case 40:event.preventDefault(),++i>u&&(i=0)}t.toggleClass("selected",!1),n.find(".complete-list li").eq(i).toggleClass("selected",!0);var f=i*s,l=f-a;l<0?r.scrollTop(f):l+s>o&&r.scrollTop(f+s-o+1)}),n.on("mouseover.phonepanel",".complete-list li",function(e){t(this).siblings().filter(".selected").toggleClass("selected",!1),t(this).toggleClass("selected",!0)}),n.on("click.phonepanel",".complete-list li",function(e){var r=t(this),i=~~r.attr("country-code");typeof h[i]&&(l=i,t("#phone-panel .countrycode").val("+"+h[i].country_code),t(".tips-area .ta-countrycode").html(h[i].short_name),n.find(".tips-area").show(),n.find(".complete-list").slideUp())}),n.on("keyup.phonepanel",".name",function(r){if(t(this).val()){n.find(".add").prop("disabled",!1);if(r.keyCode===13){var i="+"+h[l].country_code+f,s=n.find(".name").val();e.add({provider:"phone",external_id:i,external_username:i,name:s,avatar_filename:ExfeeWidget.api_url+"/avatar/default?name="+s}),e.hide()}}else n.find(".add").prop("disabled",!0)}),n.on("click.phonepanel",".add",function(t){var r="+"+h[l].country_code+f,i=n.find(".name").val();e.add({provider:"phone",external_id:r,external_username:r,name:i,avatar_filename:ExfeeWidget.api_url+"/avatar/default?name="+i}),e.hide()})},save:function(){this.$(".place-submit").trigger("click.mappanel")},showAfter:function(){var e=this,n=e.srcNode;if(n){var r=n.offset(),i=e.element,s=i.outerWidth(),o=n.outerHeight();i.css({left:this.oleft=r.left,top:this.otop=r.top+o}),f=n.val().replace(/\-|\(|\)|\ /g,"");if(/^\+.*$/.test(f))for(var u=0;u<h.length;u++)if(h[u].regular.test(f)){l=u,f=f.replace(h[u].regular,"");break}t("#phone-panel .countrycode").val("+"+h[l].country_code),t(".tips-area .ta-countrycode").html(h[l].short_name),t("#phone-panel .phonenumber").val(f)}},destory:function(){this.element.off(),this.element.remove(),this._destory()}});return d});