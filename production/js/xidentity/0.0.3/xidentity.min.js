define("xidentity",function(e){"use strict";var t=e("jquery"),n=e("util"),r=e("api"),i=e("typeahead"),s=e("handlebars");return i.extend({itemRender:function(e){var n=s.compile(this.options.viewData.item);return t(n(e))},matcher:function(e){var t=e.external_id;return~t.toLowerCase().indexOf(this.query.toLowerCase())},focus:function(){var e=this.query=n.trim(this.target.val());e?this.emit("search",e):this.emit("nothing",e)},select:function(){var e=this.$(".active"),t=e.data("value");return t?(this.target.val(this.updater(t)).change(),this.emit("select",t),this.selecting=!1,1===this.element.find("li").length&&this.hide(),void 0):!1},mouseenter:function(e){return this.selecting=!0,e.stopPropagation(),e.preventDefault(),this.$(".active").removeClass("active"),t(e.currentTarget).addClass("active"),this.select(),!1},tab:function(){return this.hide()},keypress:function(e,t){if(this.isShown){switch(t=e.keyCode){case 9:this.tab();break;case 38:if("keydown"!==e.type)break;e.preventDefault(),this.selecting=!0,this.prev(),this.select();break;case 40:if("keydown"!==e.type)break;e.preventDefault(),this.selecting=!0,this.next(),this.select()}e.stopPropagation()}},options:{url:null,useCache:!1,delay:200,extraParams:{},autoClearResults:!1,dataType:"JSON",minLength:1,viewData:{item:'<li data-value="{{external_id}}"><i class="icon16-identity-{{provider}}"></i><span class="pull-left">{{external_id}}</span></li>'},onSelect:function(e){this.emit("search",e)},onClearCache:function(){delete this.cache},onSearch:function(e){var i,s,o=this,a=o.options;if(o.cache||(o.cache={}),!o.selecting&&o.source&&o.source.length&&(s=t.grep(o.source,function(e){return o.matcher(e)}),0===s.length?o.isShown?o.hide():o:(s.length>1||e!==s[0].external_id)&&o.render(s.slice(0)).show()),o.timer&&(clearTimeout(o.timer),o.target.next().addClass("hide")),(i=n.parseId(e)).provider){var l={provider:i.provider,external_username:i.external_username};o.timer=setTimeout(function(){clearTimeout(o.timer),c(e)},a.delay);var u=function(e){o.ajaxDefer&&4>o.ajaxDefer.readyState&&o.ajaxDefer.abort(),o.emit("autocomplete:beforesend",l),a.useCache&&o.cache[e]?o.emit("autocomplete:finish",o.cache[e]):o.ajaxDefer=r.request("getRegistrationFlag",{data:l,beforesend:function(){o.target.next().removeClass("hide")},complete:function(){o.target.next().addClass("hide")}},function(t){e===o.target.val()&&(a.useCache&&(o.cache[e]=t),t.identity||(t.identity=l),o.emit("autocomplete:finish",t))})},c=function(e){e.length>=o.options.minLength?(u(e),o.searchValue=e):o.emit("autocomplete:clear")}}else o.emit("autocomplete:finish",null)}}})});