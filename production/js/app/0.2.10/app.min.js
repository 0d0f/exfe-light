define(function(e){"use strict";var t=window._ENV_,i=e("handlebars"),n=e("middleware"),a=e("routes"),r=e("lightsaber"),s=window.App=r(),o=e("widget");s.widgetCaches=o.caches,s.use(n.fixedFaceBookURL),s.use(n.basicAuth),s.use(n.cleanupAppTmp),s.initRouter(),s.use(n.errorHandler),s.set("timestamp",t.timestamp),s.set("view cache",!0),s.set("view engine",i),s.set("views","/static/views"),s.get(/^\/+(?:\?)?(?:ipad)?#{0,}$/,a.index),s.get(/^\/+\?t=([a-zA-Z0-9]{3,})$/,function(e,t,i){var n=function(){var e=document.getElementsByTagName("head")[0],t=document.getElementsByName("sms-token")[0],i=null;return t&&(i=JSON.parse(t.content),e.removeChild(t)),i},r=n(),s=e.params[0];r?a.inspectResolveToken(e,t,i,r,s):t.redirect("/#invalid/token="+s)},a.resolveShow),s.get(/^\/+(?:\?)?(?:ipad)?#gather\/?$/,a.refreshAuthUser,a.gather),s.get(/^\/+(?:\?)?(?:ipad)?#token=([a-zA-Z0-9]{64})\/?$/,a.resolveToken,a.resolveRequest,a.resolveShow),s.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/?$/,a.refreshAuthUser,a.cross),s.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{3})\/?$/,a.refreshAuthUser,a.crossInvitation),s.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{4})(?:\/(accept|mute))?\/?$/,a.refreshAuthUser,a.crossPhoneToken),s.get(/^\/+(?:\?)?(?:ipad)?#!token=([a-zA-Z0-9]{32})\/?$/,a.refreshAuthUser,a.crossToken),s.get(/^\/+(?:\?)?(?:ipad)?#!token=([a-zA-Z0-9]{32})\/(accept|mute)\/?$/,a.refreshAuthUser,a.crossToken),s.get(/^\/+(?:\?)?(?:ipad)?#([^@\/\s\!=]+)?@([^@\/\s]+)(?:\/?(.*))\/?$/,a.refreshAuthUser,a.profile),s.get(/^\/+(?:\?)?(?:ipad)?#(\+)(1\d{10}|86\d{11})(?:\/?(.*))\/?$/,a.refreshAuthUser,a.profile),s.get(/^\/+(?:\?)?(?:ipad)?#invalid\/token=([a-zA-Z0-9]{64})\/?$/,a.invalid),s.get(/^\/+(?:\?)?(?:ipad)?#signout\/?$/,a.signout),s.run()});