define(function(e){"use strict";var t=window._ENV_,s=e("handlebars"),r=e("middleware"),i=e("routes"),a=e("lightsaber"),n=window.App=a(),o=e("widget");n.widgetCaches=o.caches,n.use(r.fixedFaceBookURL),n.use(r.basicAuth),n.use(r.cleanupAppTmp),n.initRouter(),n.use(r.errorHandler),n.set("timestamp",t.timestamp),n.set("view cache",!0),n.set("view engine",s),n.set("views","/static/views"),n.get(/^\/+(?:\?)?(?:ipad)?#{0,}$/,i.index),n.get(/^\/+\?t=([a-zA-Z0-9]{3,})$/,function(e,t,s){var r=function(){var e=document.getElementsByTagName("head")[0],t=document.getElementsByName("sms-token")[0],s=null;return t&&(s=JSON.parse(t.content),e.removeChild(t)),s},a=r(),n=e.params[0];a?i.inspectResolveToken(e,t,s,a,n):t.redirect("/#invalid/token="+n)},i.resolveShow),n.get(/^\/+(?:\?)?(?:ipad)?#gather\/?$/,i.refreshAuthUser,i.gather),n.get(/^\/+(?:\?)?(?:ipad)?#token=([a-zA-Z0-9]{64})\/?$/,i.resolveToken,i.resolveRequest,i.resolveShow),n.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/?$/,i.refreshAuthUser,i.cross),n.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{3})\/?$/,i.refreshAuthUser,i.crossInvitation),n.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{4})(?:\/(accept|mute|decline))?\/?$/,i.refreshAuthUser,i.crossPhoneToken),n.get(/^\/+(?:\?)?(?:ipad)?#!token=([a-zA-Z0-9]{32})\/?$/,i.refreshAuthUser,i.crossToken),n.get(/^\/+(?:\?)?(?:ipad)?#!token=([a-zA-Z0-9]{32})\/(accept|mute|decline)\/?$/,i.refreshAuthUser,i.crossToken),n.get(/^\/+(?:\?)?(?:ipad)?#(?:@?([^\/\s\!=]+))?@([^@\/\s]+)(?:\/?(.*))\/?$/,i.refreshAuthUser,i.profile),n.get(/^\/+(?:\?)?(?:ipad)?#(\+)(1\d{10}|86\d{11})(?:\/?(.*))\/?$/,i.refreshAuthUser,i.profile),n.get(/^\/+(?:\?)?(?:ipad)?#invalid\/token=([a-zA-Z0-9]{64})\/?$/,i.invalid),n.get(/^\/+(?:\?)?(?:ipad)?#signout\/?$/,i.signout),n.run()});