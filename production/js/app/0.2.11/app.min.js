define(function(e){"use strict";var t=window._ENV_,i=e("handlebars"),n=e("middleware"),r=e("routes"),a=e("lightsaber"),s=window.App=a(),o=e("widget");s.widgetCaches=o.caches,s.use(n.fixedFaceBookURL),s.use(n.basicAuth),s.use(n.cleanupAppTmp),s.initRouter(),s.use(n.errorHandler),s.set("timestamp",t.timestamp),s.set("view cache",!0),s.set("view engine",i),s.set("views","/static/views"),s.get(/^\/+(?:\?)?(?:ipad)?#{0,}$/,r.index),s.get(/^\/+\?t=([a-zA-Z0-9]{3,})$/,function(e,t,i){var n=function(){var e=document.getElementsByTagName("head")[0],t=document.getElementsByName("sms-token")[0],i=null;return t&&(i=JSON.parse(t.content),e.removeChild(t)),i},a=n(),s=e.params[0];a?r.inspectResolveToken(e,t,i,a,s):t.redirect("/#invalid/token="+s)},r.resolveShow),s.get(/^\/+(?:\?)?(?:ipad)?#gather\/?$/,r.refreshAuthUser,r.gather),s.get(/^\/+(?:\?)?(?:ipad)?#token=([a-zA-Z0-9]{64})\/?$/,r.resolveToken,r.resolveRequest,r.resolveShow),s.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/?$/,r.refreshAuthUser,r.cross),s.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{3})\/?$/,r.refreshAuthUser,r.crossInvitation),s.get(/^\/+(?:\?)?(?:ipad)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{4})(?:\/(accept|mute|decline))?\/?$/,r.refreshAuthUser,r.crossPhoneToken),s.get(/^\/+(?:\?)?(?:ipad)?#!token=([a-zA-Z0-9]{32})\/?$/,r.refreshAuthUser,r.crossToken),s.get(/^\/+(?:\?)?(?:ipad)?#!token=([a-zA-Z0-9]{32})\/(accept|mute|decline)\/?$/,r.refreshAuthUser,r.crossToken),s.get(/^\/+(?:\?)?(?:ipad)?#([^@\/\s\!=]+)?@([^@\/\s]+)(?:\/?(.*))\/?$/,r.refreshAuthUser,r.profile),s.get(/^\/+(?:\?)?(?:ipad)?#(\+)(1\d{10}|86\d{11})(?:\/?(.*))\/?$/,r.refreshAuthUser,r.profile),s.get(/^\/+(?:\?)?(?:ipad)?#invalid\/token=([a-zA-Z0-9]{64})\/?$/,r.invalid),s.get(/^\/+(?:\?)?(?:ipad)?#signout\/?$/,r.signout),s.run()});