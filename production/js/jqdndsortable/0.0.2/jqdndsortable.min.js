define(function(e){"use strict";function t(e,t,n){return e=i(e),n=i.fn.dndsortable.defaults.dragenterData,1===arguments.length?e.data(n)||0:(t?e.data(n,Math.max(0,t)):e.data(n,null),void 0)}function n(e,t){var n=i(e).next();n[0]===t?i(e).before(t):(i(t).before(e),n.before(t))}function r(e,t,n,r,i){if(r){var o=e.data("drag-timer");o&&(clearTimeout(o),o=null,e.removeData("drag-timer")),o=setTimeout(function(){i(t,n)},r),e.data("drag-timer",o)}else i(t,n)}var i=e("jquery");i.fn.dndsortable=function(e){return e=i.extend({},i.fn.dndsortable.defaults,e),this.each(function(){var o,a,s=i(this),u=e.list+e.items,l=s.find(e.items);l.addClass(e.childClass).prop("draggable",e.draggable),s.on("dragstart.ui",u,function(t){return t.stopPropagation(),t.originalEvent.dataTransfer&&(t.originalEvent.dataTransfer.effectAllowed="moving",t.originalEvent.dataTransfer.setData("Text",e.setData(this))),o=i(a=this).addClass(e.draggingClass).index(),e.start&&e.start.call(this,o),!0}).on("dragend.ui",u,function(n){return n.stopPropagation(),i(this).removeClass(e.draggingClass),e.end&&e.end.call(this,o),o=void 0,a=null,t(this,!1),!1}).on("dragenter.ui",u,function(){if(!a||a===this)return!0;var n=this,o=i(n),u=t(this);return t(this,u+1),0===u&&(o.addClass(e.overClass),e.wrap||r(s,a,this,e.delay,function(t,n){e.enter&&e.enter.call(n),o[i(t).index()<o.index()?"after":"before"](t)})),!1}).on("dragleave.ui",u,function(){var n=t(this);return t(this,n-1),t(this)||(i(this).removeClass(e.overClass),t(this,!1),e.leave&&e.leave.call(this)),!1}).on("drop.ui",u,function(t){return t.stopPropagation(),t.preventDefault(),this!==a?(e.wrap&&r(s,a,this,e.delay,function(r,i){e.sort?e.sort.call(s,r,i):n.call(s,r,i);var o;t.originalEvent.dataTransfer&&(o=t.originalEvent.dataTransfer.getData("Text")),e.change&&e.change.call(i,o)}),!1):void 0}).on("dragover.ui",u,function(e){return a?(e.stopPropagation(),e.preventDefault(),!1):!0})})},i.fn.dndsortable.defaults={delay:0,wrap:!1,list:"ul",items:"> li",overClass:"sortable-over",placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",childClass:"sortable-child",dragenterData:"child-dragenter",setData:function(){}}});