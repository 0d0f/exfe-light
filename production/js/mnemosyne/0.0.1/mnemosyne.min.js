define("mnemosyne",function(e){"use strict";var t=0,n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[n[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[r]+"CancelAnimationFrame"]||window[n[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),s=window.setTimeout(function(){e(r+i)},i);return t=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var i=void 0,s,o,u=function(e,t,n,r,i,s){return(e>=0&&e<=i||n>=0&&n<=i)&&(r>=0&&r<=s||t>=0&&t<=s)},a=function(e){var t=e.getBoundingClientRect();return u(t.top,t.right,t.bottom,t.left,o,s)},f=function(e,t){var n=e.length,r=[];for(;t<n;++t)r.push(e[t]);return t},l=Math.cos,c=Math.sin,h=Math.tan,p=Math.abs,d=Math.asin,v=Math.sqrt,m=Math.atan,g=Math.atan2,y=Math.min,b=Math.PI,w=1e-6,E={precision:w,identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiply:function J(e,t){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];return n[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8],n[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9],n[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10],n[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8],n[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9],n[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10],n[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8],n[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9],n[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10],n[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+t[12],n[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+t[13],n[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+t[14],2>=arguments.length?n:J([n].concat(f(arguments,2)))},move:function(e,t){return t[2]||(t[2]=0),[e[0],e[1],e[2],0,e[4],e[5],e[6],0,e[8],e[9],e[10],0,e[12]+t[0],e[13]+t[1],e[14]+t[2],1]},translate:function(e,t,n){return"number"!=typeof n&&(n=0),[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1]},scale:function(e,t,n){return"number"!=typeof n&&(n=1),[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1]},rotateX:function(e,t){return t=l(e),e=c(e),[1,0,0,0,0,t,e,0,0,-e,t,0,0,0,0,1]},rotateY:function(e,t){return t=l(e),e=c(e),[t,0,-e,0,0,1,0,0,e,0,t,0,0,0,0,1]},rotateZ:function(e,t){return t=l(e),e=c(e),[t,e,0,0,-e,t,0,0,0,0,1,0,0,0,0,1]},rotate:function(e,t,n,r,i,s,o){return r=l(e),e=c(e),i=l(t),t=c(t),s=l(n),n=c(n),o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],o[0]=i*s,o[1]=r*n+e*t*s,o[2]=e*n-r*t*s,o[4]=-i*n,o[5]=r*s-e*t*n,o[6]=e*s+r*t*n,o[8]=t,o[9]=-e*i,o[10]=r*i,o},skew:function(e,t,n){return[1,0,0,0,h(n),1,0,0,h(t),h(e),1,0,0,0,0,1]},equal:function(e,t){if(!e||!t)return!1;if(e==t)return!0;for(var n=0,r=e.length;n<r;++n)if(p(e[n]-t[n])>=w)return!1;return!0},random:function(e){e=e.slice(0);if(e[0]==b/2||e[0]==-b/2)e[0]=-e[0],e[1]=b-e[1],e[2]-=b;e[0]>b/2&&(e[0]-=b,e[1]=b-e[1],e[2]-=b),e[0]<-b/2&&(e[0]+=b,e[1]=-b-e[1],e[2]-=b);for(;e[1]<-b;)e[1]+=2*b;for(;e[1]>=b;)e[1]-=2*b;for(;e[2]<-b;)e[2]+=2*b;for(;e[2]>=b;)e[2]-=2*b;return e},inverse:function(e,t,n,r,i,s,o,u,a,f,l,c){return t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],n=e[5]*e[10]-e[6]*e[9],r=e[4]*e[10]-e[6]*e[8],i=e[4]*e[9]-e[5]*e[8],s=e[1]*e[10]-e[2]*e[9],o=e[0]*e[10]-e[2]*e[8],u=e[0]*e[9]-e[1]*e[8],a=e[1]*e[6]-e[2]*e[5],f=e[0]*e[6]-e[2]*e[4],l=e[0]*e[5]-e[1]*e[4],c=1/(e[0]*n-e[1]*r+e[2]*i),t[0]=c*n,t[1]=-c*s,t[2]=c*a,t[4]=-c*r,t[5]=c*o,t[6]=-c*f,t[8]=c*i,t[9]=-c*u,t[10]=c*l,t[12]=-e[12]*t[0]-e[13]*t[4]-e[14]*t[8],t[13]=-e[12]*t[1]-e[13]*t[5]-e[14]*t[9],t[14]=-e[12]*t[2]-e[13]*t[6]-e[14]*t[10],t},translateValues:function(e){return[e[12],e[13],e[14]]},create:function(e){var t=function(e,t,r){return n||(n=0),v(e*e+t*t+r*r)},n=e[0]+t(e[0],e[1],e[2]),r=2/(n*n+e[1]*e[1]+e[2]*e[2]),i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];i[0]=1-r*n*n,i[1]=-r*n*e[1],i[2]=-r*n*e[2],i[5]=1-r*e[1]*e[1],i[6]=-r*e[1]*e[2],i[10]=1-r*e[2]*e[2],i[4]=i[1],i[8]=i[2],i[9]=i[6],n=E.multiply(e,i),r=t(n[5],n[6]),0<n[5]&&n[5]!=r&&(r*=-1),r=n[5]+r;var s=2/(r*r+n[6]*n[6]),o=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];return o[5]=1-s*r*r,o[6]=-s*r*n[6],o[9]=o[6],o[10]=1-s*n[6]*n[6],i=E.multiply(i,o),n=E.multiply(e,i),r=E.scale(0>n[0]?-1:1,0>n[5]?-1:1,0>n[10]?-1:1),n=E.multiply(r,n),i=E.multiply(i,r),r={},r.translate=E.translateValues(e),r.rotate=[g(-i[6],i[10]),d(i[2]),g(-i[1],i[0])],r.rotate[0]||(r.rotate[0]=0,r.rotate[2]=g(i[4],i[5])),r.scale=[n[0],n[5],n[10]],r.skew=[m(n[9]/r.scale[2]),m(n[8]/r.scale[2]),m(n[4]/r.scale[0])],r},translateTo:function(e){var t=E.scale(e.scale[0],e.scale[1],e.scale[2]),n=E.skew(e.skew[0],e.skew[1],e.skew[2]),r=E.rotate(e.rotate[0],e.rotate[1],e.rotate[2]);return E.move(E.multiply(t,n,r),e.translate)},toCSSMatrix3d:function(e,t,n){e=e.slice(0),t=0,n=e.length;for(;t<n;++t)p(e[t])<w&&(e[t]=0);return"matrix3d("+e.join()+")"}},S=e("jquery"),x=e("tween"),T=e("handlebars"),N=e("panel"),C=e("api").request,k=function(e,t,n,r){return C("photox_getPhotoX",{resources:{photox_id:e},beforeSend:t},n,r)},L=Math.random,A,O=function(e,t,n,r){var i=new Image,s=function(t){t.onload=t.onerror=t=e=undefined};i.onload=function(){n&&n(i,e),s(i)},i.onerror=function(){r&&r(i,e),s(i)},i.src=t},M=0,_=function(e,t,n){for(n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e},D=function(e){return parseInt(e*L())+1},P=function(e,t){return e*t},H=function(e,t,n,r){var i=n/r,s=n/e,o=r/t,n=y(e,n),r=y(t,r);return s<o?n=r*i:r=n/i,[n,r]},B=function(e,t,n,r){var i=n/r,s=e/t;return s>i?(n=e,r=n/i):(r=t,n=r*i),[n,r]},j=function(e){return _({id:M++},e)},F=function(e,t,n,r,i,s,o,u){e.setAttribute("data-gid",t),e.style.opacity=1,e.style.width=s+"px",e.style.height=i+"px";var a=E.translate(u,o,w);e.style.webkitTransform=E.toCSSMatrix3d(a),e.style.transform=E.toCSSMatrix3d(a),e._m4=a;if(e.getAttribute("data-lazy")==="-1")e.setAttribute("data-whlt",[r,n,(s-r)/2,(i-n)/2].join(","));else{var f=e.querySelector("img").style;f.width=r+"px",f.height=n+"px",f.top=(i-n)/2+"px",f.left=(s-r)/2+"px"}},I=[[{type:"G",name:"1",aspect_ratio:0,cells:[{type:"Rect",x:0,y:0,width:1,height:1,margin:{top:6,right:6,bottom:6,left:6}}]}],[{type:"G",name:"2A1",aspect_ratio:.5,cells:[{type:"Rect",x:0,y:0,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.5,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}}]},{type:"G",name:"2A2",aspect_ratio:.75,cells:[{type:"Rect",x:0,y:0,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.5,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}}]},{type:"G",name:"2B1",aspect_ratio:4/3,cells:[{type:"Rect",x:0,y:0,width:.5,height:1,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:.5,y:0,width:.5,height:1,margin:{top:6,right:6,bottom:6,left:6}}]}],[{type:"G",name:"3A1",aspect_ratio:2/3,cells:[{type:"Rect",x:0,y:0,width:1,height:.666666,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.666666,width:.5,height:.333333,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:.5,y:.666666,width:.5,height:.333333,margin:{top:6,right:6,bottom:6,left:6}}]},{type:"G",name:"3B1",aspect_ratio:1,cells:[{type:"Rect",x:0,y:0,width:.382,height:.382,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:.382,y:0,width:.618,height:.382,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.382,width:1,height:.618,margin:{top:6,right:6,bottom:6,left:6}}]}]],q={},R='<figure class="surface" data-lazy="-1" data-id="{{id}}" data-preview-url="{{images.preview.url}}" data-preview-height="{{images.preview.height}}" data-preview-width="{{images.preview.width}}" data-fullsize-url="{{images.fullsize.url}}" data-fullsize-height="{{images.fullsize.height}}" data-fullsize-width="{{images.fullsize.width}}" ><div class="photo"></div><div class="mask"></div><div class="btn-like">Like</div><div class="meta"><div class="avatar"><img width="24" height="24" src="{{by_identity.avatar_filename}}" alt="" /></div><div class="title">{{caption}}</div><time>{{updated_at}}</time><div class="place"></div></div></figure>',U=q.Rect=function(e){this.html=T.compile(R)(e)};U.prototype.toString=function(){return this.html};var z=function(e,t){return new q[e](t)},W=function(e,t){var n=0,r="",i,s,o;for(;i=e[n];n++)s=t[n],o=z(s.type,i),r+=o.toString();return r},X=function(){};A=X.prototype,A.defaultLayouts=I,A.genLayouts=function(e){var t=I.slice(0),n=t.length,r=[],i,s,o;while(e)i=D(e<n?e:n),e-=i,s=t[i-1],o=s[D(s.length)-1],r.push(j(o));return r};var V=function(e,t){this.component=e,this.$element=t,this.animate=!0};V.prototype.show=function(e){var t=this.$element,n=t[0].style;n.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+S("#app-tmp").scrollLeft()+", 0, 1, 1)",n.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+S("#app-tmp").scrollLeft()+", 0, 1, 1)",this.$element.attr("tabindex","-1").focus(),this.clone(e)},V.prototype.exit=function(){var e=this.$element,t=e[0].style;e.attr("tabindex","none"),(new x.Tween({o:1})).to({o:0},400).interpolation(x.Interpolation.Bezier).easing(x.Easing.Exponential.Out).onUpdate(function(){t.opacity=this.o}).onComplete(function(){e.empty()}).start(),this.img=this.curr=i,this.lockup=!1},V.prototype._clone_0=function(e){this.$element.empty(),this.lockup=!0;var t=this,n=e.getBoundingClientRect(),r=e.clientWidth,i=e.clientHeight,s=n.left,o=n.top,u=this.$element[0].style,a=e.getAttribute("data-preview-url"),f=e.getAttribute("data-fullsize-url"),l=+e.getAttribute("data-fullsize-width"),c=+e.getAttribute("data-fullsize-height"),h=r/l,p=i/c,d=new Image;d.setAttribute("class","pic"),d.src=a,d.width=l,d.height=c;var v=E.move(E.multiply(E.scale(h,p),E.identity()),[s,o,1]);d.style.webkitTransform=v,d.style.transform=v,O(null,f,function(e){e.src=f}),this.$element.append(d),this.curr=e;var m=this.cal(l,c),g=d.style;return d._m4=m,(new x.Tween(v)).to(m,400).interpolation(x.Interpolation.Bezier).easing(x.Easing.Exponential.Out).onUpdate(function(e){var t=E.toCSSMatrix3d(this);g.webkitTransform=t,g.transform=t,u.opacity=e}).onComplete(function(){t.lockup=!1,x.remove(this)}).start(),d},V.prototype.prev=function(){if(this.lockup)return;var e=this.img,t=S(this.curr),n=t.prev(".surface"),r;this.curr=(n.length?n:t.parent().find(".surface").last())[0],r=this.clone(this.curr),this.effect(e,r,-1)},V.prototype.next=function(){if(this.lockup)return;var e=this.img,t=S(this.curr),n=t.next(".surface"),r;this.curr=(n.length?n:t.parent().find(".surface").first())[0],r=this.clone(this.curr),this.effect(e,r,1)},V.prototype.effect=function(e,t,n){this.lookup=!0;var r=this,i=e._m4,s=t._m4,o=e.style,u=t.style,a=50*n;s=E.move(s,[-a,0,0]),u.webkitTransform=u.transform=E.toCSSMatrix3d(s),(new x.Tween({x:0})).to({x:a},400).easing(x.Easing.Quadratic.InOut).onStart(function(){r.lockup=!0,S(e).prevAll().remove()}).onUpdate(function(e){o.opacity=1-e,o.webkitTransform=o.transform=E.toCSSMatrix3d(E.move(i,[this.x,0,1-e])),u.opacity=e,u.webkitTransform=u.transform=E.toCSSMatrix3d(E.move(s,[this.x,0,e]))}).onComplete(function(){u.opacity=1,r.lockup=!1,x.remove(this)}).start()},V.prototype.update=function(){var e=this.img,t=e.style,n=e._m4,r=this.curr,i=+r.getAttribute("data-fullsize-width"),s=+r.getAttribute("data-fullsize-height"),o=this.cal(i,s),u=E.toCSSMatrix3d;(new x.Tween(n)).to(o,233).easing(x.Easing.Quadratic.InOut).onUpdate(function(){t.webkitTransform=t.transform=u(f(this))}).onComplete(function(){x.remove(this)}).start()},V.prototype.cal=function(e,t){var n=this.vw,r=this.vh,i=H(n,r,e,t),s=i[0],o=i[1],u=s/e,a=o/t,f=(n-s)/2,l=(r-o)/2;return E.move(E.multiply(E.scale(u,a),E.identity()),[f,l,1])},V.prototype._clone_1=function(e){var t=e.getAttribute("data-preview-url"),n=e.getAttribute("data-fullsize-url"),r=+e.getAttribute("data-fullsize-width"),s=+e.getAttribute("data-fullsize-height"),o=this.cal(r,s),u=new Image;return u.setAttribute("class","pic"),u.src=t,u.width=r,u.height=s,u._m4=o,o=E.toCSSMatrix3d(o),u.style.webkitTransform=o,u.style.transform=o,u.style.opacity=0,O(null,n,function(e){e.src=n,e=i}),this.$element.append(u),u},V.prototype.resize=function(e,t){this.vw=e,this.vh=t,this.img&&this.update()},V.prototype.clone=function(e){var t=!!this.curr;return this.curr=e,this.img=this["_clone_"+(t?1:0)](e)};var $=N.extend({options:{template:'<div class="panel mnemosyne-panel perspective" tabindex="-1"><div class="panel-body perspective"><div class="gallery perspective group"></div></div></div><div class="slideshow-panel perspective group"></div>'},init:function(){var e=this.options,t;this.crossId=e.crossId,delete e.crossId,this.render(),t=this.element,this.$appTmp=S("#app-tmp"),this.$mnemosyne=t.eq(0),this.$gallery=this.$mnemosyne.find(".gallery"),this.$slideshow=t.eq(1),this.typesetting=new X,this.slideshow=new V(this,this.$slideshow),this.i=0,this.n=0,this.offsetTop=0,this.offsetLeft=24,this.paddingRight=30,this.listen()},listen:function(){function f(){e.frame=requestAnimationFrame(f),x.update()}var e=this,t=e.typesetting,n=e.slideshow,r=e.$mnemosyne,i=e.$gallery,s=e.$slideshow,o=e.$appTmp,u=S(window);f(),r.on("click.mnemosyne",".gallery .surface",function(e){e.preventDefault(),e.stopPropagation()}),r.on("mouseenter.mnemosyne mouseleave.mnemosyne",".gallery .surface",function(e){e.preventDefault();var t=this,n=t.style,r=S(t),i=this._m4,s=e.type==="mouseenter",o=r.data("tween"),u=t.querySelector(".mask").style,a=t.querySelector(".btn-like").style,f=t.querySelector(".meta").style,l=E.multiply,c=E.scale,h=E.toCSSMatrix3d;o||(o=(new x.Tween({v:1})).easing(x.Easing.Cubic.InOut),r.data("tween",o)),o.stop(),s?o.delay(233).to({v:1.01},150).onUpdate(function(){u.opacity=(this.v-1)*4,a.opacity=f.opacity=this.v*.99,n.transform=n.webkitTransform=h(l(c(this.v,this.v),i))}):o.delay(0).to({v:1},150).onUpdate(function(){u.opacity=(this.v-1)*4,a.opacity=f.opacity=(this.v-1)*.99,t.style.transform=n.webkitTransform=h(l(c(this.v,this.v),i))}).onComplete(function(){r.data("tween",null),x.remove(this)}),o.start()}).on("click.mnemosyne",".gallery .surface",function(t){t.preventDefault(),o.addClass("show-slideshow"),e.emit("launch-slideshow",this)}).on("click.mnemosyne",".surface .btn-like",function(e){e.preventDefault(),e.stopPropagation()}),s.on("keydown.mnemosyne",function(t){t.preventDefault();var r=t.keyCode;switch(r){case 39:case 40:n.next();break;case 38:case 37:n.prev();break;case 27:t.stopPropagation(),e.emit("exit-slideshow")}}),o.on("scroll.mnemosyne",function(e){e.preventDefault(),e.stopPropagation();var t=i.find('[data-lazy="-1"]'),n;if(0===t.length)return;var r=function(e,t){if(t){var n=t.getAttribute("data-whlt").split(","),r=e.style;t.setAttribute("data-lazy","1"),e.setAttribute("class","pic"),r.width=n[0]+"px",r.height=n[1]+"px",r.left=n[2]+"px",r.top=n[3]+"px",r.opacity=0,t.querySelector(".photo").appendChild(e),(new x.Tween({v:0})).to({v:1}).easing(x.Easing.Cubic.InOut).onUpdate(function(){r.opacity=this.v}).onComplete(function(){x.remove(this)}).start()}},s=function(e,t){t&&t.setAttribute("data-lazy","-1")};while(n=t.splice(0,1)[0]){if(!a(n))break;n.setAttribute("data-lazy","0"),O(n,n.getAttribute("data-fullsize-url"),r,s)}}),u.on("throttledresize.mnemosyne",function(){e.getViewport(),e.getGallery(),e.updateViewport(),e.update(),o.trigger("scroll.mnemosyne")}),e.on("load-photos",function(e){var t=e.photox.photos,n=t.length;n&&this.emit("draw",t,n)}),e.on("launch-slideshow",function(t){var n=r[0].style;(new x.Tween({z:1})).to({z:-610},400).easing(x.Easing.Exponential.Out).onUpdate(function(e){n.transform=n.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, "+this.z+", 1)",n.opacity=.1*e}).onComplete(function(){x.remove(this)}).start(),e.slideshow.show(t)}),e.on("exit-slideshow",function(){r.focus(),e.slideshow.exit();var t=r[0].style;(new x.Tween({z:-144})).to({z:1.0000099999999748},400).interpolation(x.Interpolation.Bezier).easing(x.Easing.Exponential.Out).onUpdate(function(e){t.transform=t.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, "+this.z+", 1)",t.opacity=.5*(e+1)}).onComplete(function(){o.removeClass("show-slideshow"),x.remove(this)}).start()}),e.on("draw",function(e,n){var r=t.genLayouts(n);this.drawPhotos(e,r,n),u.trigger("throttledresize.mnemosyne")}),S(document).one("click.mnemosyne",".mnemosyne-exit",function(t){t.preventDefault(),t.stopPropagation(),e.hide()})},updateViewport:function(){var e=window.scrollX,t=window.scrollY,n="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 0.000001, 1)",r="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 0.010000, 1)",i="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 0.010000, 1)",s=S(".mnemosyne-bg")[0].style;s.transform=s.webkitTransform=n;var o=this.$appTmp[0].style;o.transform=o.webkitTransform=r;var u=S(".mnemosyne-exit")[0].style;u.transform=u.webkitTransform=i},addMBG:function(){var e="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 0.000001, 1)",t="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 1.000001, 1)";t="-webkit-transform:"+t+";transform:"+t+";",S('<div class="mnemosyne-exit" style="'+t+'"></div><div class="mnemosyne-bg perspective" style="-webkit-transform: '+e+"; transform: "+e+';"><div class="mnemosyne-bg-in"></div></div>').prependTo(S("body"))},delMBG:function(){S(".mnemosyne-exit").remove(),S(".mnemosyne-bg").remove()},drawPhotos:function(e,t,n){var r=this.$gallery,i=0,s=0,o,u,a;this.layouts||(this.layouts=[]),this.gid=this.layouts.length;while(o=t[i++])u=o.cells,a=W(e.slice(s,s+=u.length),u),r.append(a);this.layouts=this.layouts.concat(t),this.i=this.n,this.n+=n},update:function(){var e=this.$gallery,t=e.find("figure").slice(this.i,this.n),n=this.gvw,r=this.gvh,i=this.gid,s=this.layouts.slice(i),o=this.offsetTop,u=this.offsetLeft,a=0,f=r,l=n,c,h,p,d,v,m,g,y,b,w,E,S,x;while(c=s.shift()){i=c.id,v=c.aspect_ratio,h=c.cells.slice(),p=h.length,v&&(l=P(r,v));while(d=h.shift()){m=t.eq(a),y=+m.data("preview-height"),g=+m.data("preview-width"),1===p&&(l=P(r,g/y)),b=d.margin,E=d.height*f-b.top-b.bottom,w=d.width*l-b.left-b.right,x=o+d.y*f+b.top+(r-f)/2,S=u+d.x*l+b.left;var T=B(w,E,g,y);g=T[0],y=T[1],F(m[0],i,y,g,E,w,x,S),a++}u+=l}this.addPaddingRight(0,u)},addPaddingRight:function(e,t){var n=this.$gallery,r=n.find(".photos-padding-right");r.size()||(r=S('<div class="photos-padding-right"></div>').css({width:this.paddingRight})),r.css({"-webkit-transform":"translate3d("+t+"px, "+e+"px, 0)","-moz-transform":"translate3d("+t+"px, "+e+"px, 0)","-ms-transform":"translate3d("+t+"px, "+e+"px, 0)","-o-transform":"translate3d("+t+"px, "+e+"px, 0)",transform:"translate3d("+t+"px, "+e+"px, 0)"}),n.append(r)},getPhotos:function(){var e=this;k(e.crossId,function(){},function(t){e.emit("load-photos",t)})},getViewport:function(){var e=this.element;this.vw=s=e.width(),this.vh=o=e.height(),this.slideshow.resize(this.vw,this.vh)},getGallery:function(){this.gvw=this.vw,this.gvh=this.vh-80-40},showBefore:function(){S("body").addClass("mnemosyne-start"),S("#app-tmp").css("-webkit-transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 1.000001, 1)"),S("#app-tmp").css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 1.000001, 1)"),this.getPhotos()},showAfter:function(){var e=S(".mnemosyne-bg"),t=e[0].style,n=e.find(".mnemosyne-bg-in")[0].style,r=this.$appTmp,i=this.$mnemosyne[0].style;i.transform=i.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 2584, 1)";var s=(new x.Tween({v:0})).to({v:1},1600).delay(200).interpolation(x.Interpolation.Bezier).easing(x.Easing.Cubic.In).onUpdate(function(){t.opacity=n.opacity=this.v}).onComplete(function(){x.remove(this)}),o=(new x.Tween({v:2584})).to({v:1.000001},1600).delay(500).interpolation(x.Interpolation.Bezier).easing(x.Easing.Cubic.In).onUpdate(function(e){i.opacity=e,i.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, "+this.v+", 1)"}).onComplete(function(){r.trigger("scroll.mnemosyne"),x.remove(this)});s.start(),o.start()},show:function(){return this.emit("showBefore"),this.escapable(),this.element.prependTo(this.parentNode),this.addMBG(),this.emit("showAfter"),this},hide:function(){x.removeAll();var e=this,t=S(".mnemosyne-bg")[0].style,n=e.$mnemosyne[0].style,r=e.$slideshow[0].style;S(document).off("keydown.panel"),this.element.off(),(new x.Tween({o:1})).to({o:0},610).easing(x.Easing.Cubic.In).onUpdate(function(){t.opacity=n.opacity=r.opacity=this.o}).onComplete(function(){e.destory(),x.removeAll()}).start()},destory:function(){this.delMBG(),S("body").removeClass("mnemosyne-start"),this.$appTmp.removeClass(".show-mnemosyne").off(".mnemosyne").css({"-webkit-transform":"none",transform:"none"}),S(window).off("throttledresize.mnemosyne"),cancelAnimationFrame(this.frame),this.element.off(),this.element.remove(),this._destory()}});return $});