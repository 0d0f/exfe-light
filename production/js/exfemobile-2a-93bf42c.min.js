/*! EXFE.COM QXdlc29tZSEgV2UncmUgaHVudGluZyB0YWxlbnRzIGxpa2UgeW91LiBQbGVhc2UgZHJvcCB1cyB5b3VyIENWIHRvIHdvcmtAZXhmZS5jb20uCg== */
/*
// mobile@2a 2013-08-22 05:08:49
//# sourceMappingURL=exfemobile-2a-93bf42c.min.map
*/
(function(t){"use strict";function e(t,e,n){var o=arguments.length;1===o?(n=t,t=void 0):2===o&&(n=e,e=void 0);var a=new s(t,e,n);t?r[t]=a:n.call(a,i,a.exports,a)}function i(t){var e=r[t];return e?(e.exports||n(e),e.exports):null}function n(t){var e,n=t.factory;delete t.factory,e=n(i,t.exports={},t),e&&(t.exports=e)}function s(t,e,i){this.id=t,this.uri=void 0,this.deps=e,"string"==typeof i&&(i=Function("require","exports","module",i)),this.factory=i,this.exports=void 0,this.filename=null,this.parent=void 0,this.loaded=!1}e.amd={jQuery:!0},t.define=e,s.prototype.constructor=s;var r=s.__cache={}})(this),define("class",function(){"use strict";function t(i){return this instanceof t||!o(i)?void 0:e(i)}function e(e){return e.extend=t.extend,e.implement=s,e}function i(i,n,s,o,l){function c(){i.apply(this,arguments),this.constructor===c&&this.initialize&&(this.initialize.apply(this,arguments),this.initialized=!0)}return o=i.prototype,i!==t&&r(c,i),c.Extends=i,l=a(o),n&&r(l,n),c.prototype=l,s&&r(c,s),c.superclass=o,c.prototype.constructor=c,e(c)}function n(){}function s(t){var e,i=this.prototype;for(e in t)i[e]=t[e]}function r(t,e){var i;for(i in e)t[i]=e[i]}function o(t){return"[object Function]"===l.call(t)}t.create=function(e,n){return o(e)||(n=e,e=null),n||(n={}),e||(e=n.Extends||t),i(e,n)},t.extend=function(t,e){return i(this,t,e)};var a=Object.__proto__?function(t){return{__proto__:t}}:function(t){return n.prototype=t,new n},l=Object.prototype.toString;return t}),define("emitter",function(){"use strict";function t(){}var e=/\s+/,i=Object.keys;return i||(i=function(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&(i[i.length]=e);return i}),t.prototype.on=function(t,i,n){var s,r,o;if(!i)return this;for(t=t.split(e),s=this.__callbacks||(this.__callbacks={});r=t.shift();)o=s[r]||(s[r]=[]),i.__context=n,o[o.length]=i;return this},t.prototype.once=function(t,i,n){var s,r,o;if(!i)return this;for(t=t.split(e),s=this.__callbacks||(this.__callbacks={});r=t.shift();)o=s[r]||(s[r]=[]),i.__once=!0,i.__context=n,o[o.length]=i;return this},t.prototype.off=function(t,n,s){var r,o,a,l,c;if(!(r=this.__callbacks))return this;if(!(t||n||s))return delete this.__callbacks,this;for(t=t.split(e)||i(r);o=t.shift();)if(a=r[o])if(n||s)for(l=a.length-1;l;--l)c=a[l],n&&c!==n||s&&c.__context!==s||a.splice(l,1);else delete r[o];return this},t.prototype.emit=function(t){var i,n,s,r,o,a,l,c,u=[];if(!(i=this.__callbacks))return this;for(t=t.split(e),o=arguments.length-1;o;--o)u[o-1]=arguments[o];for((s=i.call)&&(l=[0].concat(u));n=t.shift();){if(r=i[n])for(o=0,a=r.length;a>o;++o)c=r[o],c.apply(c.__context||this,u),c.__once&&(r.splice(o--,1),a--);if(r&&s)for(l[0]=n,o=0,a=s.length;a>o;++o)c=s[o],c.apply(c.__context||this,l)}return this},t}),define("base",function(t){"use strict";function e(t){return"[object Function]"===a.call(t)}function i(t){return t&&"[object Object]"===a.call(t)&&"isPrototypeOf"in t}function n(t,e){var s,r;for(s in e)r=e[s],l(r)?r=r.slice():i(r)&&(r=n(t[s]||{},r)),t[s]=r;return t}function s(t){return t[2].toLowerCase()+t.substring(3)}var r=/^on[A-Z]/,o=Object.__proto__,a=Object.prototype.toString,l=Array.isArray;l||(l=function(t){return"[object Array]"===a.call(t)});var c=t("class"),u=t("emitter");return c.create(u,{setOptions:function(t){var i,o,a;if(this.hasOwnProperty("options")||(this.options={}),a=this.options,this.constructor.superclass.options&&n(a,this.constructor.superclass.options),this.constructor.prototype.options&&n(a,this.constructor.prototype.options),t&&t.options&&n(a,t.options),this.on)for(i in a)o=a[i],e(o)&&r.test(i)&&(this.on(s(i),o),delete a[i])},destory:function(){var t;for(t in this)this.hasOwnProperty(t)&&delete this[t];o&&(this.__proto__=o)}})});var Zepto=function(){function t(t){return null==t?t+"":Z[J.call(t)]||"object"}function e(e){return"function"==t(e)}function i(t){return null!=t&&t==t.window}function n(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function s(e){return"object"==t(e)}function r(t){return s(t)&&!i(t)&&t.__proto__==Object.prototype}function o(t){return t instanceof Array}function a(t){return"number"==typeof t.length}function l(t){return L.call(t,function(t){return null!=t})}function c(t){return t.length>0?C.fn.concat.apply([],t):t}function u(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function h(t){return t in N?N[t]:N[t]=RegExp("(^|\\s)"+t+"(\\s|$)")}function d(t,e){return"number"!=typeof e||$[u(t)]?e:e+"px"}function p(t){var e,i;return O[t]||(e=M.createElement(t),M.body.appendChild(e),i=A(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==i&&(i="block"),O[t]=i),O[t]}function f(t){return"children"in t?I.call(t.children):C.map(t.childNodes,function(t){return 1==t.nodeType?t:x})}function m(t,e,i){for(k in e)i&&(r(e[k])||o(e[k]))?(r(e[k])&&!r(t[k])&&(t[k]={}),o(e[k])&&!o(t[k])&&(t[k]=[]),m(t[k],e[k],i)):e[k]!==x&&(t[k]=e[k])}function v(t,e){return e===x?C(t):C(t).filter(e)}function g(t,i,n,s){return e(i)?i.call(t,n,s):i}function y(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}function b(t,e){var i=t.className,n=i&&i.baseVal!==x;return e===x?n?i.baseVal:i:(n?i.baseVal=e:t.className=e,x)}function w(t){var e;try{return t?"true"==t||("false"==t?!1:"null"==t?null:isNaN(e=Number(t))?/^[\[\{]/.test(t)?C.parseJSON(t):t:e):t}catch(i){return t}}function _(t,e){e(t);for(var i in t.childNodes)_(t.childNodes[i],e)}var x,k,C,S,E,T,P=[],I=P.slice,L=P.filter,M=window.document,O={},N={},A=M.defaultView.getComputedStyle,$={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},D=/^\s*<(\w+|!)[^>]*>/,H=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,B=/^(?:body|html)$/i,R=["val","css","html","text","data","width","height","offset"],z=["after","prepend","before","append"],j=M.createElement("table"),F=M.createElement("tr"),U={tr:M.createElement("tbody"),tbody:j,thead:j,tfoot:j,td:F,th:F,"*":M.createElement("div")},W=/complete|loaded|interactive/,q=/^\.([\w-]+)$/,V=/^#([\w-]*)$/,G=/^[\w-]+$/,Z={},J=Z.toString,Y={},X=M.createElement("div");return Y.matches=function(t,e){if(!t||1!==t.nodeType)return!1;var i=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(i)return i.call(t,e);var n,s=t.parentNode,r=!s;return r&&(s=X).appendChild(t),n=~Y.qsa(s,e).indexOf(t),r&&X.removeChild(t),n},E=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},T=function(t){return L.call(t,function(e,i){return t.indexOf(e)==i})},Y.fragment=function(t,e,i){t.replace&&(t=t.replace(H,"<$1></$2>")),e===x&&(e=D.test(t)&&RegExp.$1),e in U||(e="*");var n,s,o=U[e];return o.innerHTML=""+t,s=C.each(I.call(o.childNodes),function(){o.removeChild(this)}),r(i)&&(n=C(s),C.each(i,function(t,e){R.indexOf(t)>-1?n[t](e):n.attr(t,e)})),s},Y.Z=function(t,e){return t=t||[],t.__proto__=C.fn,t.selector=e||"",t},Y.isZ=function(t){return t instanceof Y.Z},Y.init=function(t,i){if(t){if(e(t))return C(M).ready(t);if(Y.isZ(t))return t;var n;if(o(t))n=l(t);else if(s(t))n=[r(t)?C.extend({},t):t],t=null;else if(D.test(t))n=Y.fragment(t.trim(),RegExp.$1,i),t=null;else{if(i!==x)return C(i).find(t);n=Y.qsa(M,t)}return Y.Z(n,t)}return Y.Z()},C=function(t,e){return Y.init(t,e)},C.extend=function(t){var e,i=I.call(arguments,1);return"boolean"==typeof t&&(e=t,t=i.shift()),i.forEach(function(i){m(t,i,e)}),t},Y.qsa=function(t,e){var i;return n(t)&&V.test(e)?(i=t.getElementById(RegExp.$1))?[i]:[]:1!==t.nodeType&&9!==t.nodeType?[]:I.call(q.test(e)?t.getElementsByClassName(RegExp.$1):G.test(e)?t.getElementsByTagName(e):t.querySelectorAll(e))},C.contains=function(t,e){return t!==e&&t.contains(e)},C.type=t,C.isFunction=e,C.isWindow=i,C.isArray=o,C.isPlainObject=r,C.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},C.inArray=function(t,e,i){return P.indexOf.call(e,t,i)},C.camelCase=E,C.trim=function(t){return t.trim()},C.uuid=0,C.support={},C.expr={},C.map=function(t,e){var i,n,s,r=[];if(a(t))for(n=0;t.length>n;n++)i=e(t[n],n),null!=i&&r.push(i);else for(s in t)i=e(t[s],s),null!=i&&r.push(i);return c(r)},C.each=function(t,e){var i,n;if(a(t)){for(i=0;t.length>i;i++)if(e.call(t[i],i,t[i])===!1)return t}else for(n in t)if(e.call(t[n],n,t[n])===!1)return t;return t},C.grep=function(t,e){return L.call(t,e)},window.JSON&&(C.parseJSON=JSON.parse),C.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){Z["[object "+e+"]"]=e.toLowerCase()}),C.fn={forEach:P.forEach,reduce:P.reduce,push:P.push,sort:P.sort,indexOf:P.indexOf,concat:P.concat,map:function(t){return C(C.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return C(I.apply(this,arguments))},ready:function(t){return W.test(M.readyState)?t(C):M.addEventListener("DOMContentLoaded",function(){t(C)},!1),this},get:function(t){return t===x?I.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return P.every.call(this,function(e,i){return t.call(e,i,e)!==!1}),this},filter:function(t){return e(t)?this.not(this.not(t)):C(L.call(this,function(e){return Y.matches(e,t)}))},add:function(t,e){return C(T(this.concat(C(t,e))))},is:function(t){return this.length>0&&Y.matches(this[0],t)},not:function(t){var i=[];if(e(t)&&t.call!==x)this.each(function(e){t.call(this,e)||i.push(this)});else{var n="string"==typeof t?this.filter(t):a(t)&&e(t.item)?I.call(t):C(t);this.forEach(function(t){0>n.indexOf(t)&&i.push(t)})}return C(i)},has:function(t){return this.filter(function(){return s(t)?C.contains(this,t):C(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!s(t)?t:C(t)},last:function(){var t=this[this.length-1];return t&&!s(t)?t:C(t)},find:function(t){var e,i=this;return e="object"==typeof t?C(t).filter(function(){var t=this;return P.some.call(i,function(e){return C.contains(e,t)})}):1==this.length?C(Y.qsa(this[0],t)):this.map(function(){return Y.qsa(this,t)})},closest:function(t,e){var i=this[0],s=!1;for("object"==typeof t&&(s=C(t));i&&!(s?s.indexOf(i)>=0:Y.matches(i,t));)i=i!==e&&!n(i)&&i.parentNode;return C(i)},parents:function(t){for(var e=[],i=this;i.length>0;)i=C.map(i,function(t){return(t=t.parentNode)&&!n(t)&&0>e.indexOf(t)?(e.push(t),t):x});return v(e,t)},parent:function(t){return v(T(this.pluck("parentNode")),t)},children:function(t){return v(this.map(function(){return f(this)}),t)},contents:function(){return this.map(function(){return I.call(this.childNodes)})},siblings:function(t){return v(this.map(function(t,e){return L.call(f(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return C.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=null),"none"==A(this,"").getPropertyValue("display")&&(this.style.display=p(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var i=e(t);if(this[0]&&!i)var n=C(t).get(0),s=n.parentNode||this.length>1;return this.each(function(e){C(this).wrapAll(i?t.call(this,e):s?n.cloneNode(!0):n)})},wrapAll:function(t){if(this[0]){C(this[0]).before(t=C(t));for(var e;(e=t.children()).length;)t=e.first();C(t).append(this)}return this},wrapInner:function(t){var i=e(t);return this.each(function(e){var n=C(this),s=n.contents(),r=i?t.call(this,e):t;s.length?s.wrapAll(r):n.append(r)})},unwrap:function(){return this.parent().each(function(){C(this).replaceWith(C(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var e=C(this);(t===x?"none"==e.css("display"):t)?e.show():e.hide()})},prev:function(t){return C(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return C(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return t===x?this.length>0?this[0].innerHTML:null:this.each(function(e){var i=this.innerHTML;C(this).empty().append(g(this,t,e,i))})},text:function(t){return t===x?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(t,e){var i;return"string"==typeof t&&e===x?0==this.length||1!==this[0].nodeType?x:"value"==t&&"INPUT"==this[0].nodeName?this.val():!(i=this[0].getAttribute(t))&&t in this[0]?this[0][t]:i:this.each(function(i){if(1===this.nodeType)if(s(t))for(k in t)y(this,k,t[k]);else y(this,t,g(this,e,i,this.getAttribute(t)))})},removeAttr:function(t){return this.each(function(){1===this.nodeType&&y(this,t)})},prop:function(t,e){return e===x?this[0]&&this[0][t]:this.each(function(i){this[t]=g(this,e,i,this[t])})},data:function(t,e){var i=this.attr("data-"+u(t),e);return null!==i?w(i):x},val:function(t){return t===x?this[0]&&(this[0].multiple?C(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(e){this.value=g(this,t,e,this.value)})},offset:function(t){if(t)return this.each(function(e){var i=C(this),n=g(this,t,e,i.offset()),s=i.offsetParent().offset(),r={top:n.top-s.top,left:n.left-s.left};"static"==i.css("position")&&(r.position="relative"),i.css(r)});if(0==this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(e,i){if(2>arguments.length&&"string"==typeof e)return this[0]&&(this[0].style[E(e)]||A(this[0],"").getPropertyValue(e));var n="";if("string"==t(e))i||0===i?n=u(e)+":"+d(e,i):this.each(function(){this.style.removeProperty(u(e))});else for(k in e)e[k]||0===e[k]?n+=u(k)+":"+d(k,e[k])+";":this.each(function(){this.style.removeProperty(u(k))});return this.each(function(){this.style.cssText+=";"+n})},index:function(t){return t?this.indexOf(C(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return P.some.call(this,function(t){return this.test(b(t))},h(t))},addClass:function(t){return this.each(function(e){S=[];var i=b(this),n=g(this,t,e,i);n.split(/\s+/g).forEach(function(t){C(this).hasClass(t)||S.push(t)},this),S.length&&b(this,i+(i?" ":"")+S.join(" "))})},removeClass:function(t){return this.each(function(e){return t===x?b(this,""):(S=b(this),g(this,t,e,S).split(/\s+/g).forEach(function(t){S=S.replace(h(t)," ")}),b(this,S.trim()),x)})},toggleClass:function(t,e){return this.each(function(i){var n=C(this),s=g(this,t,i,b(this));s.split(/\s+/g).forEach(function(t){(e===x?!n.hasClass(t):e)?n.addClass(t):n.removeClass(t)})})},scrollTop:function(){return this.length?"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY:x},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),i=this.offset(),n=B.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(C(t).css("margin-top"))||0,i.left-=parseFloat(C(t).css("margin-left"))||0,n.top+=parseFloat(C(e[0]).css("border-top-width"))||0,n.left+=parseFloat(C(e[0]).css("border-left-width"))||0,{top:i.top-n.top,left:i.left-n.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||M.body;t&&!B.test(t.nodeName)&&"static"==C(t).css("position");)t=t.offsetParent;return t})}},C.fn.detach=C.fn.remove,["width","height"].forEach(function(t){C.fn[t]=function(e){var s,r=this[0],o=t.replace(/./,function(t){return t[0].toUpperCase()});return e===x?i(r)?r["inner"+o]:n(r)?r.documentElement["offset"+o]:(s=this.offset())&&s[t]:this.each(function(i){r=C(this),r.css(t,g(this,e,i,r[t]()))})}}),z.forEach(function(e,i){var n=i%2;C.fn[e]=function(){var e,s,r=C.map(arguments,function(i){return e=t(i),"object"==e||"array"==e||null==i?i:Y.fragment(i)}),o=this.length>1;return 1>r.length?this:this.each(function(t,e){s=n?e:e.parentNode,e=0==i?e.nextSibling:1==i?e.firstChild:2==i?e:null,r.forEach(function(t){if(o)t=t.cloneNode(!0);else if(!s)return C(t).remove();_(s.insertBefore(t,e),function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},C.fn[n?e+"To":"insert"+(i?"Before":"After")]=function(t){return C(t)[e](this),this}}),Y.Z.prototype=C.fn,Y.uniq=T,Y.deserializeValue=w,C.zepto=Y,C}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(t){String.prototype.trim===t&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.reduce===t&&(Array.prototype.reduce=function(e){if(this===void 0||null===this)throw new TypeError;var i,n=Object(this),s=n.length>>>0,r=0;if("function"!=typeof e)throw new TypeError;if(0==s&&1==arguments.length)throw new TypeError;if(arguments.length>=2)i=arguments[1];else for(;;){if(r in n){i=n[r++];break}if(++r>=s)throw new TypeError}for(;s>r;)r in n&&(i=e.call(t,i,n[r],r,n)),r++;return i})}(),function(t){function e(t){return t._zid||(t._zid=p++)}function i(t,i,r,o){if(i=n(i),i.ns)var a=s(i.ns);return(d[e(t)]||[]).filter(function(t){return!(!t||i.e&&t.e!=i.e||i.ns&&!a.test(t.ns)||r&&e(t.fn)!==e(r)||o&&t.sel!=o)})}function n(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function s(t){return RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function r(e,i,n){"string"!=t.type(e)?t.each(e,n):e.split(/\s/).forEach(function(t){n(t,i)})}function o(t,e){return t.del&&("focus"==t.e||"blur"==t.e)||!!e}function a(t){return m[t]||t}function l(i,s,l,c,u,h){var p=e(i),f=d[p]||(d[p]=[]);r(s,l,function(e,s){var r=n(e);r.fn=s,r.sel=c,r.e in m&&(s=function(e){var i=e.relatedTarget;return!i||i!==this&&!t.contains(this,i)?r.fn.apply(this,arguments):void 0}),r.del=u&&u(s,e);var l=r.del||s;r.proxy=function(t){var e=l.apply(i,[t].concat(t.data));return e===!1&&(t.preventDefault(),t.stopPropagation()),e},r.i=f.length,f.push(r),i.addEventListener(a(r.e),r.proxy,o(r,h))})}function c(t,n,s,l,c){var u=e(t);r(n||"",s,function(e,n){i(t,e,n,l).forEach(function(e){delete d[u][e.i],t.removeEventListener(a(e.e),e.proxy,o(e,c))})})}function u(e){var i,n={originalEvent:e};for(i in e)y.test(i)||void 0===e[i]||(n[i]=e[i]);return t.each(b,function(t,i){n[t]=function(){return this[i]=v,e[t].apply(e,arguments)},n[i]=g}),n}function h(t){if(!("defaultPrevented"in t)){t.defaultPrevented=!1;var e=t.preventDefault;t.preventDefault=function(){this.defaultPrevented=!0,e.call(this)}}}var d=(t.zepto.qsa,{}),p=1,f={},m={mouseenter:"mouseover",mouseleave:"mouseout"};f.click=f.mousedown=f.mouseup=f.mousemove="MouseEvents",t.event={add:l,remove:c},t.proxy=function(i,n){if(t.isFunction(i)){var s=function(){return i.apply(n,arguments)};return s._zid=e(i),s}if("string"==typeof n)return t.proxy(i[n],i);throw new TypeError("expected function")},t.fn.bind=function(t,e){return this.each(function(){l(this,t,e)})},t.fn.unbind=function(t,e){return this.each(function(){c(this,t,e)})},t.fn.one=function(t,e){return this.each(function(i,n){l(this,t,e,null,function(t,e){return function(){var i=t.apply(n,arguments);return c(n,e,t),i}})})};var v=function(){return!0},g=function(){return!1},y=/^([A-Z]|layer[XY]$)/,b={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};t.fn.delegate=function(e,i,n){return this.each(function(s,r){l(r,i,n,e,function(i){return function(n){var s,o=t(n.target).closest(e,r).get(0);return o?(s=t.extend(u(n),{currentTarget:o,liveFired:r}),i.apply(o,[s].concat([].slice.call(arguments,1)))):void 0}})})},t.fn.undelegate=function(t,e,i){return this.each(function(){c(this,e,i,t)})},t.fn.live=function(e,i){return t(document.body).delegate(this.selector,e,i),this},t.fn.die=function(e,i){return t(document.body).undelegate(this.selector,e,i),this},t.fn.on=function(e,i,n){return!i||t.isFunction(i)?this.bind(e,i||n):this.delegate(i,e,n)},t.fn.off=function(e,i,n){return!i||t.isFunction(i)?this.unbind(e,i||n):this.undelegate(i,e,n)},t.fn.trigger=function(e,i){return("string"==typeof e||t.isPlainObject(e))&&(e=t.Event(e)),h(e),e.data=i,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(e)})},t.fn.triggerHandler=function(e,n){var s,r;return this.each(function(o,a){s=u("string"==typeof e?t.Event(e):e),s.data=n,s.target=a,t.each(i(a,e.type||e),function(t,e){return r=e.proxy(s),s.isImmediatePropagationStopped()?!1:void 0})}),r},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){t.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)}}),["focus","blur"].forEach(function(e){t.fn[e]=function(t){return t?this.bind(e,t):this.each(function(){try{this[e]()}catch(t){}}),this}}),t.Event=function(t,e){"string"!=typeof t&&(e=t,t=e.type);var i=document.createEvent(f[t]||"Events"),n=!0;if(e)for(var s in e)"bubbles"==s?n=!!e[s]:i[s]=e[s];return i.initEvent(t,n,!0,null,null,null,null,null,null,null,null,null,null,null,null),i.isDefaultPrevented=function(){return this.defaultPrevented},i}}(Zepto),function(t){function e(e,i,n){var s=t.Event(i);return t(e).trigger(s,n),!s.defaultPrevented}function i(t,i,n,s){return t.global?e(i||y,n,s):void 0}function n(e){e.global&&0===t.active++&&i(e,null,"ajaxStart")}function s(e){e.global&&!--t.active&&i(e,null,"ajaxStop")}function r(t,e){var n=e.context;return e.beforeSend.call(n,t,e)===!1||i(e,n,"ajaxBeforeSend",[t,e])===!1?!1:(i(e,n,"ajaxSend",[t,e]),void 0)}function o(t,e,n){var s=n.context,r="success";n.success.call(s,t,r,e),i(n,s,"ajaxSuccess",[e,n,t]),l(r,e,n)}function a(t,e,n,s){var r=s.context;s.error.call(r,n,e,t),i(s,r,"ajaxError",[n,s,t]),l(e,n,s)}function l(t,e,n){var r=n.context;n.complete.call(r,e,t),i(n,r,"ajaxComplete",[e,n]),s(n)}function c(){}function u(t){return t&&(t=t.split(";",2)[0]),t&&(t==k?"html":t==x?"json":w.test(t)?"script":_.test(t)&&"xml")||"text"}function h(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")}function d(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=h(e.url,e.data))}function p(e,i,n,s){var r=!t.isFunction(i);return{url:e,data:r?i:void 0,success:r?t.isFunction(n)?n:void 0:i,dataType:r?s||n:n}}function f(e,i,n,s){var r,o=t.isArray(i);t.each(i,function(i,a){r=t.type(a),s&&(i=n?s:s+"["+(o?"":i)+"]"),!s&&o?e.add(a.name,a.value):"array"==r||!n&&"object"==r?f(e,a,n,i):e.add(i,a)})}var m,v,g=0,y=window.document,b=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,w=/^(?:text|application)\/javascript/i,_=/^(?:text|application)\/xml/i,x="application/json",k="text/html",C=/^\s*$/;t.active=0,t.ajaxJSONP=function(e){if(!("type"in e))return t.ajax(e);var i,n="jsonp"+ ++g,s=y.createElement("script"),l=function(){clearTimeout(i),t(s).remove(),delete window[n]},u=function(t){l(),t&&"timeout"!=t||(window[n]=c),a(null,t||"abort",h,e)},h={abort:u};return r(h,e)===!1?(u("abort"),!1):(window[n]=function(t){l(),o(t,h,e)},s.onerror=function(){u("error")},s.src=e.url.replace(/=\?/,"="+n),t("head").append(s),e.timeout>0&&(i=setTimeout(function(){u("timeout")},e.timeout)),h)},t.ajaxSettings={type:"GET",beforeSend:c,success:c,error:c,complete:c,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:x,xml:"application/xml, text/xml",html:k,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},t.ajax=function(e){var i=t.extend({},e||{});for(m in t.ajaxSettings)void 0===i[m]&&(i[m]=t.ajaxSettings[m]);n(i),i.crossDomain||(i.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(i.url)&&RegExp.$2!=window.location.host),i.url||(i.url=""+window.location),d(i),i.cache===!1&&(i.url=h(i.url,"_="+Date.now()));var s=i.dataType,l=/=\?/.test(i.url);if("jsonp"==s||l)return l||(i.url=h(i.url,"callback=?")),t.ajaxJSONP(i);var p,f=i.accepts[s],g={},y=/^([\w-]+:)\/\//.test(i.url)?RegExp.$1:window.location.protocol,b=i.xhr();i.crossDomain||(g["X-Requested-With"]="XMLHttpRequest"),f&&(g.Accept=f,f.indexOf(",")>-1&&(f=f.split(",",2)[0]),b.overrideMimeType&&b.overrideMimeType(f)),(i.contentType||i.contentType!==!1&&i.data&&"GET"!=i.type.toUpperCase())&&(g["Content-Type"]=i.contentType||"application/x-www-form-urlencoded"),i.headers=t.extend(g,i.headers||{}),b.onreadystatechange=function(){if(4==b.readyState){b.onreadystatechange=c,clearTimeout(p);var e,n=!1;if(b.status>=200&&300>b.status||304==b.status||0==b.status&&"file:"==y){s=s||u(b.getResponseHeader("content-type")),e=b.responseText;try{"script"==s?(1,eval)(e):"xml"==s?e=b.responseXML:"json"==s&&(e=C.test(e)?null:t.parseJSON(e))}catch(r){n=r}n?a(n,"parsererror",b,i):o(e,b,i)}else a(null,b.status?"error":"abort",b,i)}};var w="async"in i?i.async:!0;b.open(i.type,i.url,w);for(v in i.headers)b.setRequestHeader(v,i.headers[v]);return r(b,i)===!1?(b.abort(),!1):(i.timeout>0&&(p=setTimeout(function(){b.onreadystatechange=c,b.abort(),a(null,"timeout",b,i)},i.timeout)),b.send(i.data?i.data:null),b)},t.get=function(){return t.ajax(p.apply(null,arguments))},t.post=function(){var e=p.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=p.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,i,n){if(!this.length)return this;var s,r=this,o=e.split(/\s/),a=p(e,i,n),l=a.success;return o.length>1&&(a.url=o[0],s=o[1]),a.success=function(e){r.html(s?t("<div>").html(e.replace(b,"")).find(s):e),l&&l.apply(r,arguments)},t.ajax(a),this};var S=encodeURIComponent;t.param=function(t,e){var i=[];return i.add=function(t,e){this.push(S(t)+"="+S(e))},f(i,t,e),i.join("&").replace(/%20/g,"+")}}(Zepto),function(t){t.fn.serializeArray=function(){var e,i=[];return t(Array.prototype.slice.call(this.get(0).elements)).each(function(){e=t(this);var n=e.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&("radio"!=n&&"checkbox"!=n||this.checked)&&i.push({name:e.attr("name"),value:e.val()})}),i},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(e)this.bind("submit",e);else if(this.length){var i=t.Event("submit");this.eq(0).trigger(i),i.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(t){function e(e,n){var l=e[a],c=l&&s[l];if(void 0===n)return c||i(e);if(c){if(n in c)return c[n];var u=o(n);if(u in c)return c[u]}return r.call(t(e),n)}function i(e,i,r){var l=e[a]||(e[a]=++t.uuid),c=s[l]||(s[l]=n(e));return void 0!==i&&(c[o(i)]=r),c}function n(e){var i={};return t.each(e.attributes,function(e,n){0==n.name.indexOf("data-")&&(i[o(n.name.replace("data-",""))]=t.zepto.deserializeValue(n.value))}),i}var s={},r=t.fn.data,o=t.camelCase,a=t.expando="Zepto"+ +new Date;t.fn.data=function(n,s){return void 0===s?t.isPlainObject(n)?this.each(function(e,s){t.each(n,function(t,e){i(s,t,e)})}):0==this.length?void 0:e(this[0],n):this.each(function(){i(this,n,s)})},t.fn.removeData=function(e){return"string"==typeof e&&(e=e.split(/\s+/)),this.each(function(){var i=this[a],n=i&&s[i];n&&t.each(e,function(){delete n[o(this)]})})}}(Zepto),function(t){function e(t){return"tagName"in t?t:t.parentNode}function i(t,e,i,n){var s=Math.abs(t-e),r=Math.abs(i-n);return s>=r?t-e>0?"Left":"Right":i-n>0?"Up":"Down"}function n(){c=null,u.last&&(u.el.trigger("longTap"),u={})}function s(){c&&clearTimeout(c),c=null}function r(){o&&clearTimeout(o),a&&clearTimeout(a),l&&clearTimeout(l),c&&clearTimeout(c),o=a=l=c=null,u={}}var o,a,l,c,u={},h=750;t(document).ready(function(){var d,p;t(document.body).bind("touchstart",function(i){d=Date.now(),p=d-(u.last||d),u.el=t(e(i.touches[0].target)),o&&clearTimeout(o),u.x1=i.touches[0].pageX,u.y1=i.touches[0].pageY,p>0&&250>=p&&(u.isDoubleTap=!0),u.last=d,c=setTimeout(n,h)}).bind("touchmove",function(t){s(),u.x2=t.touches[0].pageX,u.y2=t.touches[0].pageY,Math.abs(u.x1-u.x2)>10&&t.preventDefault()}).bind("touchend",function(){s(),u.x2&&Math.abs(u.x1-u.x2)>30||u.y2&&Math.abs(u.y1-u.y2)>30?l=setTimeout(function(){u.el.trigger("swipe"),u.el.trigger("swipe"+i(u.x1,u.x2,u.y1,u.y2)),u={}},0):"last"in u&&(a=setTimeout(function(){var e=t.Event("tap");e.cancelTouch=r,u.el.trigger(e),u.isDoubleTap?(u.el.trigger("doubleTap"),u={}):o=setTimeout(function(){o=null,u.el.trigger("singleTap"),u={}},250)},0))}).bind("touchcancel",r),t(window).bind("scroll",r)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(e){t.fn[e]=function(t){return this.bind(e,t)}})}(Zepto),"function"==typeof define&&define("zepto",function(){return Zepto}),define("handlebars",function(t,e,i){this.Handlebars={},function(t){t.VERSION="1.0.rc.1",t.helpers={},t.partials={},t.registerHelper=function(t,e,i){i&&(e.not=i),this.helpers[t]=e},t.registerPartial=function(t,e){this.partials[t]=e},t.registerHelper("helperMissing",function(t){if(2===arguments.length)return void 0;throw Error("Could not find property '"+t+"'")});var e=Object.prototype.toString,i="[object Function]";t.registerHelper("blockHelperMissing",function(n,s){var r=s.inverse||function(){},o=s.fn,a=e.call(n);return a===i&&(n=n.call(this)),n===!0?o(this):n===!1||null==n?r(this):"[object Array]"===a?n.length>0?t.helpers.each(n,s):r(this):o(n)}),t.K=function(){},t.createFrame=Object.create||function(e){t.K.prototype=e;var i=new t.K;return t.K.prototype=null,i},t.registerHelper("each",function(e,i){var n,s=i.fn,r=i.inverse,o="";if(i.data&&(n=t.createFrame(i.data)),e&&e.length>0)for(var a=0,l=e.length;l>a;a++)n&&(n.index=a),o+=s(e[a],{data:n});else o=r(this);return o}),t.registerHelper("if",function(n,s){var r=e.call(n);return r===i&&(n=n.call(this)),!n||t.Utils.isEmpty(n)?s.inverse(this):s.fn(this)}),t.registerHelper("unless",function(e,i){var n=i.fn,s=i.inverse;return i.fn=s,i.inverse=n,t.helpers["if"].call(this,e,i)}),t.registerHelper("with",function(t,e){return e.fn(t)}),t.registerHelper("log",function(e){t.log(e)})}(this.Handlebars);var n=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,DATA:27,param:28,STRING:29,INTEGER:30,BOOLEAN:31,hashSegments:32,hashSegment:33,ID:34,EQUALS:35,pathSegments:36,SEP:37,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",27:"DATA",29:"STRING",30:"INTEGER",31:"BOOLEAN",34:"ID",35:"EQUALS",37:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[17,1],[25,2],[25,1],[28,1],[28,1],[28,1],[28,1],[28,1],[26,1],[32,2],[32,1],[33,3],[33,3],[33,3],[33,3],[33,3],[21,1],[36,3],[36,1]],performAction:function(t,e,i,n,s,r){var o=r.length-1;switch(s){case 1:return r[o-1];case 2:this.$=new n.ProgramNode(r[o-2],r[o]);break;case 3:this.$=new n.ProgramNode(r[o]);break;case 4:this.$=new n.ProgramNode([]);break;case 5:this.$=[r[o]];break;case 6:r[o-1].push(r[o]),this.$=r[o-1];break;case 7:this.$=new n.BlockNode(r[o-2],r[o-1].inverse,r[o-1],r[o]);break;case 8:this.$=new n.BlockNode(r[o-2],r[o-1],r[o-1].inverse,r[o]);break;case 9:this.$=r[o];break;case 10:this.$=r[o];break;case 11:this.$=new n.ContentNode(r[o]);break;case 12:this.$=new n.CommentNode(r[o]);break;case 13:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1]);break;case 14:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1]);break;case 15:this.$=r[o-1];break;case 16:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1]);
break;case 17:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1],!0);break;case 18:this.$=new n.PartialNode(r[o-1]);break;case 19:this.$=new n.PartialNode(r[o-2],r[o-1]);break;case 20:break;case 21:this.$=[[r[o-2]].concat(r[o-1]),r[o]];break;case 22:this.$=[[r[o-1]].concat(r[o]),null];break;case 23:this.$=[[r[o-1]],r[o]];break;case 24:this.$=[[r[o]],null];break;case 25:this.$=[[new n.DataNode(r[o])],null];break;case 26:r[o-1].push(r[o]),this.$=r[o-1];break;case 27:this.$=[r[o]];break;case 28:this.$=r[o];break;case 29:this.$=new n.StringNode(r[o]);break;case 30:this.$=new n.IntegerNode(r[o]);break;case 31:this.$=new n.BooleanNode(r[o]);break;case 32:this.$=new n.DataNode(r[o]);break;case 33:this.$=new n.HashNode(r[o]);break;case 34:r[o-1].push(r[o]),this.$=r[o-1];break;case 35:this.$=[r[o]];break;case 36:this.$=[r[o-2],r[o]];break;case 37:this.$=[r[o-2],new n.StringNode(r[o])];break;case 38:this.$=[r[o-2],new n.IntegerNode(r[o])];break;case 39:this.$=[r[o-2],new n.BooleanNode(r[o])];break;case 40:this.$=[r[o-2],new n.DataNode(r[o])];break;case 41:this.$=new n.IdNode(r[o]);break;case 42:r[o-2].push(r[o]),this.$=r[o-2];break;case 43:this.$=[r[o]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,27:[1,24],34:[1,26],36:25},{17:27,21:23,27:[1,24],34:[1,26],36:25},{17:28,21:23,27:[1,24],34:[1,26],36:25},{17:29,21:23,27:[1,24],34:[1,26],36:25},{21:30,34:[1,26],36:25},{1:[2,1]},{6:31,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,32],21:23,27:[1,24],34:[1,26],36:25},{10:33,20:[1,34]},{10:35,20:[1,34]},{18:[1,36]},{18:[2,24],21:41,25:37,26:38,27:[1,45],28:39,29:[1,42],30:[1,43],31:[1,44],32:40,33:46,34:[1,47],36:25},{18:[2,25]},{18:[2,41],27:[2,41],29:[2,41],30:[2,41],31:[2,41],34:[2,41],37:[1,48]},{18:[2,43],27:[2,43],29:[2,43],30:[2,43],31:[2,43],34:[2,43],37:[2,43]},{18:[1,49]},{18:[1,50]},{18:[1,51]},{18:[1,52],21:53,34:[1,26],36:25},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:54,34:[1,26],36:25},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:41,26:55,27:[1,45],28:56,29:[1,42],30:[1,43],31:[1,44],32:40,33:46,34:[1,47],36:25},{18:[2,23]},{18:[2,27],27:[2,27],29:[2,27],30:[2,27],31:[2,27],34:[2,27]},{18:[2,33],33:57,34:[1,58]},{18:[2,28],27:[2,28],29:[2,28],30:[2,28],31:[2,28],34:[2,28]},{18:[2,29],27:[2,29],29:[2,29],30:[2,29],31:[2,29],34:[2,29]},{18:[2,30],27:[2,30],29:[2,30],30:[2,30],31:[2,30],34:[2,30]},{18:[2,31],27:[2,31],29:[2,31],30:[2,31],31:[2,31],34:[2,31]},{18:[2,32],27:[2,32],29:[2,32],30:[2,32],31:[2,32],34:[2,32]},{18:[2,35],34:[2,35]},{18:[2,43],27:[2,43],29:[2,43],30:[2,43],31:[2,43],34:[2,43],35:[1,59],37:[2,43]},{34:[1,60]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,61]},{18:[1,62]},{18:[2,21]},{18:[2,26],27:[2,26],29:[2,26],30:[2,26],31:[2,26],34:[2,26]},{18:[2,34],34:[2,34]},{35:[1,59]},{21:63,27:[1,67],29:[1,64],30:[1,65],31:[1,66],34:[1,26],36:25},{18:[2,42],27:[2,42],29:[2,42],30:[2,42],31:[2,42],34:[2,42],37:[2,42]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,36],34:[2,36]},{18:[2,37],34:[2,37]},{18:[2,38],34:[2,38]},{18:[2,39],34:[2,39]},{18:[2,40],34:[2,40]}],defaultActions:{16:[2,1],24:[2,25],38:[2,23],55:[2,21]},parseError:function(t){throw Error(t)},parse:function(t){function e(){var t;return t=i.lexer.lex()||1,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,n=[0],s=[null],r=[],o=this.table,a="",l=0,c=0,u=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var h=this.lexer.yylloc;r.push(h);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,f,m,v,g,y,b,w,_,x={};;){if(m=n[n.length-1],this.defaultActions[m]?v=this.defaultActions[m]:((null===p||void 0===p)&&(p=e()),v=o[m]&&o[m][p]),void 0===v||!v.length||!v[0]){var k="";if(!u){_=[];for(y in o[m])this.terminals_[y]&&y>2&&_.push("'"+this.terminals_[y]+"'");k=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:h,expected:_})}}if(v[0]instanceof Array&&v.length>1)throw Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(v[0]){case 1:n.push(p),s.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(v[1]),p=null,f?(p=f,f=null):(c=this.lexer.yyleng,a=this.lexer.yytext,l=this.lexer.yylineno,h=this.lexer.yylloc,u>0&&u--);break;case 2:if(b=this.productions_[v[1]][1],x.$=s[s.length-b],x._$={first_line:r[r.length-(b||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(b||1)].first_column,last_column:r[r.length-1].last_column},d&&(x._$.range=[r[r.length-(b||1)].range[0],r[r.length-1].range[1]]),g=this.performAction.call(x,a,c,l,this.yy,v[1],s,r),void 0!==g)return g;b&&(n=n.slice(0,-2*b),s=s.slice(0,-1*b),r=r.slice(0,-1*b)),n.push(this.productions_[v[1]][0]),s.push(x.$),r.push(x._$),w=o[n[n.length-2]][n[n.length-1]],n.push(w);break;case 3:return!0}}return!0}},i=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var s=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-e]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return 20>t.length&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,n,s;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;r.length>o&&(i=this._input.match(this.rules[r[o]]),!i||e&&!(i[0].length>e[0].length)||(e=i,n=o,this.options.flex));o++);return e?(s=e[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,r[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return void 0!==t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,i){switch(i){case 0:if("\\"!==e.yytext.slice(-1)&&this.begin("mu"),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1),this.begin("emu")),e.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==e.yytext.slice(-1)&&this.popState(),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1)),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return e.yytext=e.yytext.substr(3,e.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 35;case 13:return 34;case 14:return 34;case 15:return 37;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),29;case 20:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),29;case 21:return e.yytext=e.yytext.substr(1),27;case 22:return 31;case 23:return 31;case 24:return 30;case 25:return 34;case 26:return e.yytext=e.yytext.substr(1,e.yyleng-2),34;case 27:return"INVALID";case 28:return 5}},t.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],t.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,28],inclusive:!0}},t}();return e.lexer=i,t.prototype=e,e.Parser=t,new t}();return void 0!==t&&void 0!==e&&(e.parser=n,e.Parser=n.Parser,e.parse=function(){return n.parse.apply(n,arguments)},e.main=function(i){if(!i[1])throw Error("Usage: "+i[0]+" FILE");var n;return n="undefined"!=typeof process?t("fs").readFileSync(t("path").resolve(i[1]),"utf8"):t("file").path(t("file").cwd()).join(i[1]).read({charset:"utf-8"}),e.parser.parse(n)},void 0!==i&&t.main===i&&e.main("undefined"!=typeof process?process.argv.slice(1):t("system").args)),Handlebars.Parser=n,Handlebars.parse=function(t){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(t)},Handlebars.print=function(t){return(new Handlebars.PrintVisitor).accept(t)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(){}},Handlebars.log=function(t,e){Handlebars.logger.log(t,e)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(t,e){this.type="program",this.statements=t,e&&(this.inverse=new Handlebars.AST.ProgramNode(e))},Handlebars.AST.MustacheNode=function(t,e,i){this.type="mustache",this.escaped=!i,this.hash=e;var n=this.id=t[0],s=this.params=t.slice(1),r=this.eligibleHelper=n.isSimple;this.isHelper=r&&(s.length||e)},Handlebars.AST.PartialNode=function(t,e){this.type="partial",this.id=t,this.context=e};var t=function(t,e){if(t.original!==e.original)throw new Handlebars.Exception(t.original+" doesn't match "+e.original)};Handlebars.AST.BlockNode=function(e,i,n,s){t(e.id,s),this.type="block",this.mustache=e,this.program=i,this.inverse=n,this.inverse&&!this.program&&(this.isInverse=!0)},Handlebars.AST.ContentNode=function(t){this.type="content",this.string=t},Handlebars.AST.HashNode=function(t){this.type="hash",this.pairs=t},Handlebars.AST.IdNode=function(t){this.type="ID",this.original=t.join(".");for(var e=[],i=0,n=0,s=t.length;s>n;n++){var r=t[n];".."===r?i++:"."===r||"this"===r?this.isScoped=!0:e.push(r)}this.parts=e,this.string=e.join("."),this.depth=i,this.isSimple=1===t.length&&!this.isScoped&&0===i},Handlebars.AST.DataNode=function(t){this.type="DATA",this.id=t},Handlebars.AST.StringNode=function(t){this.type="STRING",this.string=t},Handlebars.AST.IntegerNode=function(t){this.type="INTEGER",this.integer=t},Handlebars.AST.BooleanNode=function(t){this.type="BOOLEAN",this.bool=t},Handlebars.AST.CommentNode=function(t){this.type="comment",this.comment=t}}(),Handlebars.Exception=function(){var t=Error.prototype.constructor.apply(this,arguments);for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.message=t.message},Handlebars.Exception.prototype=Error(),Handlebars.SafeString=function(t){this.string=t},Handlebars.SafeString.prototype.toString=function(){return""+this.string},function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=/[&<>"'`]/g,i=/[&<>"'`]/,n=function(e){return t[e]||"&amp;"};Handlebars.Utils={escapeExpression:function(t){return t instanceof Handlebars.SafeString?""+t:null==t||t===!1?"":i.test(t)?t.replace(e,n):t},isEmpty:function(t){return void 0===t?!0:null===t?!0:t===!1?!0:"[object Array]"===Object.prototype.toString.call(t)&&0===t.length?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(t,e){t.prototype={compiler:t,disassemble:function(){for(var t,e,i,n=this.opcodes,s=[],r=0,o=n.length;o>r;r++)if(t=n[r],"DECLARE"===t.opcode)s.push("DECLARE "+t.name+"="+t.value);else{e=[];for(var a=0;t.args.length>a;a++)i=t.args[a],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),e.push(i);s.push(t.opcode+" "+e.join(" "))}return s.join("\n")},guid:0,compile:function(t,e){this.children=[],this.depths={list:[]},this.options=e;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var n in i)this.options.knownHelpers[n]=i[n];return this.program(t)},accept:function(t){return this[t.type](t)},program:function(t){var e,i=t.statements;this.opcodes=[];for(var n=0,s=i.length;s>n;n++)e=i[n],this[e.type](e);return this.isSimple=1===s,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e,i=(new this.compiler).compile(t,this.options),n=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[n]=i;for(var s=0,r=i.depths.list.length;r>s;s++)e=i.depths.list[s],2>e||this.addDepth(e-1);return n},block:function(t){var e=t.mustache,i=t.program,n=t.inverse;i&&(i=this.compileProgram(i)),n&&(n=this.compileProgram(n));var s=this.classifyMustache(e);"helper"===s?this.helperMustache(e,i,n):"simple"===s?(this.simpleMustache(e),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("pushLiteral","{}"),this.opcode("blockValue")):(this.ambiguousMustache(e,i,n),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("pushLiteral","{}"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(t){var e,i,n=t.pairs;this.opcode("push","{}");for(var s=0,r=n.length;r>s;s++)e=n[s],i=e[1],this.accept(i),this.opcode("assignToHash",e[0])},partial:function(t){var e=t.id;this.usePartial=!0,t.context?this.ID(t.context):this.opcode("push","depth0"),this.opcode("invokePartial",e.original),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},mustache:function(t){var e=this.options,i=this.classifyMustache(t);"simple"===i?this.simpleMustache(t):"helper"===i?this.helperMustache(t):this.ambiguousMustache(t),t.escaped&&!e.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(t,e,i){var n=t.id,s=n.parts[0];this.opcode("getContext",n.depth),this.opcode("pushProgram",e),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",s)},simpleMustache:function(t){var e=t.id;"DATA"===e.type?this.DATA(e):e.parts.length?this.ID(e):(this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(t,e,i){var n=this.setupFullMustacheParams(t,e,i),s=t.id.parts[0];if(this.options.knownHelpers[s])this.opcode("invokeKnownHelper",n.length,s);else{if(this.knownHelpersOnly)throw Error("You specified knownHelpersOnly, but used the unknown helper "+s);this.opcode("invokeHelper",n.length,s)}},ID:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);var e=t.parts[0];e?this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");for(var i=1,n=t.parts.length;n>i;i++)this.opcode("lookup",t.parts[i])},DATA:function(t){this.options.data=!0,this.opcode("lookupData",t.id)},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("pushLiteral",t.integer)},BOOLEAN:function(t){this.opcode("pushLiteral",t.bool)},comment:function(){},opcode:function(t){this.opcodes.push({opcode:t,args:[].slice.call(arguments,1)})},declare:function(t,e){this.opcodes.push({opcode:"DECLARE",name:t,value:e})},addDepth:function(t){if(isNaN(t))throw Error("EWOT");0!==t&&(this.depths[t]||(this.depths[t]=!0,this.depths.list.push(t)))},classifyMustache:function(t){var e=t.isHelper,i=t.eligibleHelper,n=this.options;if(i&&!e){var s=t.id.parts[0];n.knownHelpers[s]?e=!0:n.knownHelpersOnly&&(i=!1)}return e?"helper":i?"ambiguous":"simple"},pushParams:function(t){for(var e,i=t.length;i--;)e=t[i],this.options.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.string)):this[e.type](e)},setupMustacheParams:function(t){var e=t.params;return this.pushParams(e),t.hash?this.hash(t.hash):this.opcode("pushLiteral","{}"),e},setupFullMustacheParams:function(t,e,i){var n=t.params;return this.pushParams(n),this.opcode("pushProgram",e),this.opcode("pushProgram",i),t.hash?this.hash(t.hash):this.opcode("pushLiteral","{}"),n}};var i=function(t){this.value=t};e.prototype={nameLookup:function(t,i){return/^[0-9]+$/.test(i)?t+"["+i+"]":e.isValidJavaScriptVariableName(i)?t+"."+i:t+"['"+i+"']"},appendToBuffer:function(t){return this.environment.isSimple?"return "+t+";":"buffer += "+t+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,e,i,n){this.environment=t,this.options=e||{},Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!i,this.context=i||{programs:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.compileChildren(t,e);var s,r=t.opcodes;for(this.i=0,o=r.length;o>this.i;this.i++)s=r[this.i],"DECLARE"===s.opcode?this[s.name]=s.value:this[s.opcode].apply(this,s.args);return this.createFunctionContext(n)},nextOpcode:function(){var t=this.environment.opcodes;return t[this.i+1],t[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var t=[];if(this.isChild)t.push("");else{var e=this.namespace,i="helpers = helpers || "+e+".helpers;";this.environment.usePartial&&(i=i+" partials = partials || "+e+".partials;"),this.options.data&&(i+=" data = data || {};"),t.push(i)}this.environment.isSimple?t.push(""):t.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(t){var e=this.stackVars.concat(this.registers.list);if(e.length>0&&(this.source[1]=this.source[1]+", "+e.join(", ")),!this.isChild)for(var i in this.context.aliases)this.source[1]=this.source[1]+", "+i+"="+this.context.aliases[i];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var n=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],s=0,r=this.environment.depths.list.length;r>s;s++)n.push("depth"+this.environment.depths.list[s]);if(t)return n.push(this.source.join("\n  ")),Function.apply(this,n);var o="function "+(this.name||"")+"("+n.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,o+"\n\n"),o},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t),this.replaceStack(function(e){return t.splice(1,0,e),e+" = blockHelperMissing.call("+t.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t);var e=this.topStack();t.splice(1,0,e),this.source.push("if (!"+this.lastHelper+") { "+e+" = blockHelperMissing.call("+t.join(", ")+"); }")},appendContent:function(t){this.source.push(this.appendToBuffer(this.quotedString(t)))},append:function(){var t=this.popStack();this.source.push("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var t=this.nextOpcode(),e="";this.context.aliases.escapeExpression="this.escapeExpression",t&&"appendContent"===t.opcode&&(e=" + "+this.quotedString(t.args[0]),this.eat(t)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+e))},getContext:function(t){this.lastContext!==t&&(this.lastContext=t)},lookupOnContext:function(t){this.pushStack(this.nameLookup("depth"+this.lastContext,t,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(t){return"typeof "+t+" === functionType ? "+t+"() : "+t})},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},lookupData:function(t){this.pushStack(this.nameLookup("data",t,"data"))},pushStringParam:function(t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t)},pushString:function(t){this.pushStackLiteral(this.quotedString(t))},push:function(t){this.pushStack(t)},pushLiteral:function(t){this.pushStackLiteral(t)},pushProgram:function(t){null!=t?this.pushStackLiteral(this.programExpression(t)):this.pushStackLiteral(null)},invokeHelper:function(t,e){this.context.aliases.helperMissing="helpers.helperMissing";var i=this.lastHelper=this.setupHelper(t,e);this.register("foundHelper",i.name),this.pushStack("foundHelper ? foundHelper.call("+i.callParams+") "+": helperMissing.call("+i.helperMissingParams+")")},invokeKnownHelper:function(t,e){var i=this.setupHelper(t,e);this.pushStack(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var e=this.setupHelper(0,t),i=this.lastHelper=this.nameLookup("helpers",t,"helper");this.register("foundHelper",i);var n=this.nameLookup("depth"+this.lastContext,t,"context"),s=this.nextStack();this.source.push("if (foundHelper) { "+s+" = foundHelper.call("+e.callParams+"); }"),this.source.push("else { "+s+" = "+n+"; "+s+" = typeof "+s+" === functionType ? "+s+"() : "+s+"; }")},invokePartial:function(t){var e=[this.nameLookup("partials",t,"partial"),"'"+t+"'",this.popStack(),"helpers","partials"];this.options.data&&e.push("data"),this.context.aliases.self="this",this.pushStack("self.invokePartial("+e.join(", ")+");")},assignToHash:function(t){var e=this.popStack(),i=this.topStack();this.source.push(i+"['"+t+"'] = "+e+";")},compiler:e,compileChildren:function(t,e){for(var i,n,s=t.children,r=0,o=s.length;o>r;r++){i=s[r],n=new this.compiler,this.context.programs.push("");var a=this.context.programs.length;i.index=a,i.name="program"+a,this.context.programs[a]=n.compile(i,e,this.context)}},programExpression:function(t){if(this.context.aliases.self="this",null==t)return"self.noop";for(var e,i=this.environment.children[t],n=i.depths.list,s=[i.index,i.name,"data"],r=0,o=n.length;o>r;r++)e=n[r],1===e?s.push("depth0"):s.push("depth"+(e-1));return 0===n.length?"self.program("+s.join(", ")+")":(s.shift(),"self.programWithDepth("+s.join(", ")+")")},register:function(t,e){this.useRegister(t),this.source.push(t+" = "+e+";")},useRegister:function(t){this.registers[t]||(this.registers[t]=!0,this.registers.list.push(t))},pushStackLiteral:function(t){return this.compileStack.push(new i(t)),t},pushStack:function(t){return this.source.push(this.incrStack()+" = "+t+";"),this.compileStack.push("stack"+this.stackSlot),"stack"+this.stackSlot},replaceStack:function(t){var e=t.call(this,this.topStack());return this.source.push(this.topStack()+" = "+e+";"),"stack"+this.stackSlot},nextStack:function(){var t=this.incrStack();return this.compileStack.push("stack"+this.stackSlot),t},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){var t=this.compileStack.pop();return t instanceof i?t.value:(this.stackSlot--,t)},topStack:function(){var t=this.compileStack[this.compileStack.length-1];return t instanceof i?t.value:t},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(t,e){var i=[];this.setupParams(t,i);var n=this.nameLookup("helpers",e,"helper");return{params:i,name:n,callParams:["depth0"].concat(i).join(", "),helperMissingParams:["depth0",this.quotedString(e)].concat(i).join(", ")}},setupParams:function(t,e){var i,n,s,r=[],o=[];r.push("hash:"+this.popStack()),n=this.popStack(),s=this.popStack(),(s||n)&&(s||(this.context.aliases.self="this",s="self.noop"),n||(this.context.aliases.self="this",n="self.noop"),r.push("inverse:"+n),r.push("fn:"+s));for(var a=0;t>a;a++)i=this.popStack(),e.push(i),this.options.stringParams&&o.push(this.popStack());return this.options.stringParams&&r.push("contexts:["+o.join(",")+"]"),this.options.data&&r.push("data:data"),e.push("{"+r.join(",")+"}"),e.join(", ")}};for(var n="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),s=e.RESERVED_WORDS={},r=0,o=n.length;o>r;r++)s[n[r]]=!0;e.isValidJavaScriptVariableName=function(t){return!e.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(t)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(t,e){e=e||{};var i=Handlebars.parse(t),n=(new Handlebars.Compiler).compile(i,e);return(new Handlebars.JavaScriptCompiler).compile(n,e)},Handlebars.compile=function(t,e){function i(){var i=Handlebars.parse(t),n=(new Handlebars.Compiler).compile(i,e),s=(new Handlebars.JavaScriptCompiler).compile(n,e,void 0,!0);return Handlebars.template(s)}e=e||{};var n;return function(t,e){return n||(n=i()),n.call(this,t,e)}},Handlebars.VM={template:function(t){var e={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(t,e,i){var n=this.programs[t];return i?Handlebars.VM.program(e,i):n?n:n=this.programs[t]=Handlebars.VM.program(e)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(i,n){return n=n||{},t.call(e,Handlebars,i,n.helpers,n.partials,n.data)}},programWithDepth:function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(n,s){return s=s||{},t.apply(this,[n,s.data||e].concat(i))}},program:function(t,e){return function(i,n){return n=n||{},t(i,n.data||e)}},noop:function(){return""},invokePartial:function(t,e,i,n,s,r){var o={helpers:n,partials:s,data:r};if(void 0===t)throw new Handlebars.Exception("The partial "+e+" could not be found");if(t instanceof Function)return t(i,o);if(Handlebars.compile)return s[e]=Handlebars.compile(t,{data:void 0!==r}),s[e](i,o);throw new Handlebars.Exception("The partial "+e+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template,Handlebars}),define("store",function(t,e,i){(function(){function t(){try{return c in a&&a[c]}catch(t){return!1}}function e(){try{return u in a&&a[u]&&a[u][a.location.hostname]}catch(t){return!1}}function n(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(r),d.appendChild(r),r.addBehavior("#default#userData"),r.load(c);var i=t.apply(o,e);return d.removeChild(r),i}}function s(t){return t.replace(m,"___")}var r,o={},a=window,l=a.document,c="localStorage",u="globalStorage",h="__storejs__";if(o.disabled=!1,o.set=function(){},o.get=function(){},o.remove=function(){},o.clear=function(){},o.transact=function(t,e,i){var n=o.get(t);null==i&&(i=e,e=null),void 0===n&&(n=e||{}),i(n),o.set(t,n)},o.getAll=function(){},o.serialize=function(t){return JSON.stringify(t)},o.deserialize=function(t){if("string"!=typeof t)return void 0;try{return JSON.parse(t)}catch(e){return t||void 0}},t())r=a[c],o.set=function(t,e){return void 0===e?o.remove(t):(r.setItem(t,o.serialize(e)),e)},o.get=function(t){return o.deserialize(r.getItem(t))},o.remove=function(t){r.removeItem(t)},o.clear=function(){r.clear()},o.getAll=function(){for(var t={},e=0;r.length>e;++e){var i=r.key(e);t[i]=o.get(i)}return t};else if(e())r=a[u][a.location.hostname],o.set=function(t,e){return void 0===e?o.remove(t):(r[t]=o.serialize(e),e)},o.get=function(t){return o.deserialize(r[t]&&r[t].value)},o.remove=function(t){delete r[t]},o.clear=function(){for(var t in r)delete r[t]},o.getAll=function(){for(var t={},e=0;r.length>e;++e){var i=r.key(e);t[i]=o.get(i)}return t};else if(l.documentElement.addBehavior){var d,p;try{p=new ActiveXObject("htmlfile"),p.open(),p.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),p.close(),d=p.w.frames[0].document,r=d.createElement("div")
}catch(f){r=l.createElement("div"),d=l.body}var m=RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");o.set=n(function(t,e,i){return e=s(e),void 0===i?o.remove(e):(t.setAttribute(e,o.serialize(i)),t.save(c),i)}),o.get=n(function(t,e){return e=s(e),o.deserialize(t.getAttribute(e))}),o.remove=n(function(t,e){e=s(e),t.removeAttribute(e),t.save(c)}),o.clear=n(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(c);for(var i,n=0;i=e[n];n++)t.removeAttribute(i.name);t.save(c)}),o.getAll=n(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(c);for(var i,n={},s=0;i=e[s];++s)n[i]=o.get(i);return n})}try{o.set(h,h),o.get(h)!=h&&(o.disabled=!0),o.remove(h)}catch(f){o.disabled=!0}o.enabled=!o.disabled,void 0!==i&&"function"!=typeof i?i.exports=o:"function"==typeof define&&define.amd?define(o):this.store=o})()});var TWEEN=TWEEN||function(){var t=[];return{REVISION:"10",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e){var i=t.length;if(0===i)return!1;var n,s=0;for(e=void 0!==e?e:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();i>s;)n=t[s],n&&n.update(e)?s++:(t.splice(s,1),i--);return!0}}}();TWEEN.Tween=function(t){var e=t,i={},n={},s={},r=1e3,o=0,a=0,l=null,c=TWEEN.Easing.Linear.None,u=TWEEN.Interpolation.Linear,h=[],d=null,p=!1,f=null,m=null;for(var v in t)i[v]=parseFloat(t[v],10);this.to=function(t,e){return void 0!==e&&(r=e),n=t,this},this.start=function(t){TWEEN.add(this),p=!1,l=void 0!==t?t:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),l+=a;for(var r in n){if(n[r]instanceof Array){if(0===n[r].length)continue;n[r]=[e[r]].concat(n[r])}i[r]=e[r],i[r]instanceof Array==!1&&(i[r]*=1),s[r]=i[r]||0}return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(t){return a=t,this},this.repeat=function(t){return o=t,this},this.easing=function(t){return c=t,this},this.interpolation=function(t){return u=t,this},this.chain=function(){return h=arguments,this},this.onStart=function(t){return d=t,this},this.onUpdate=function(t){return f=t,this},this.onComplete=function(t){return m=t,this},this.update=function(t){if(l>t)return!0;p===!1&&(null!==d&&d.call(e),p=!0);var v=(t-l)/r;v=v>1?1:v;var g=c(v);for(var y in n){var b=i[y]||0,w=n[y];w instanceof Array?e[y]=u(w,g):("string"==typeof w&&(w=b+parseFloat(w,10)),e[y]=b+(w-b)*g)}if(null!==f&&f.call(e,g),1==v){if(o>0){isFinite(o)&&o--;for(var y in s)"string"==typeof n[y]&&(s[y]=s[y]+parseFloat(n[y],10)),i[y]=s[y];return l=t+a,!0}null!==m&&m.call(e);for(var _=0,x=h.length;x>_;_++)h[_].start(t);return!1}return!0}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),1>(t*=2)?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):.5*i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return 1>(t*=2)?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),r=TWEEN.Interpolation.Utils.Linear;return 0>e?r(t[0],t[1],n):e>1?r(t[i],t[i-1],i-n):r(t[s],t[s+1>i?i:s+1],n-s)},Bezier:function(t,e){var i,n=0,s=t.length-1,r=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein;for(i=0;s>=i;i++)n+=r(1-e,s-i)*r(e,i)*t[i]*o(s,i);return n},CatmullRom:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),r=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(0>e&&(s=Math.floor(n=i*(1+e))),r(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],n-s)):0>e?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):r(t[s?s-1:0],t[s],t[s+1>i?i:s+1],t[s+2>i?i:s+2],n-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=TWEEN.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,n=1;if(t[e])return t[e];for(i=e;i>1;i--)n*=i;return t[e]=n}}(),CatmullRom:function(t,e,i,n,s){var r=.5*(i-t),o=.5*(n-e),a=s*s,l=s*a;return(2*e-2*i+r+o)*l+(-3*e+3*i-2*r-o)*a+r*s+e}}},"function"==typeof define&&define("tween",function(){return TWEEN}),define("af",function(){"use strict";var t=window.performance&&window.performance.now,e=t?function(){return window.performance.now()}:Date.now||function(){return(new Date).getTime()},i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,n=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;if(!i){var s=0;i=function(t){var i=e(),n=Math.max(0,16-(i-s)),r=setTimeout(function(){t(i+n)},n);return s=i+n,r}}return n||(n=function(t){clearTimeout(t)}),{request:i,cancel:n}}),define("util",function(){"use strict";var t=/^\s+/,e=/\s+$/,i=/[^0-9a-zA-Z_\u4e00-\u9fa5\ \'\.]+/g,n=String.prototype.trim,s={zh_CN:i,cut30length:function(t,e){if(!t)return"";for(t=t.replace(i," "),e||(e=30);s.utf8length(t)>e;)t=t.substring(0,t.length-1);return t},utf8length:function(t){for(var e,i=t.length,n=0,s=0;i>s;s++)if(e=t.charCodeAt(s),127>e)n++;else if(2047>=e)n+=2;else if(55295>=e||e>=57344)n+=3;else{if(!(56319>=e))throw"Error: Invalid UTF-16 sequence. Missing high-surrogate code.";if(e=t.charCodeAt(++s),56320>e||e>57343)throw"Error: Invalid UTF-16 sequence. Missing low-surrogate code.";n+=4}return n},trim:n?function(t){return null==t?"":n.call(t)}:function(i){return null==i?"":(""+i).replace(t,"").replace(e,"")},parseId:function(){var t=/^([a-z0-9_\.]{1,})@facebook$/i,e=/^@([a-z0-9_]{1,15})$|^@?([a-z0-9_]{1,15})@twitter$/i,i=/^([a-z0-9_\.]{1,})@instagram$/i,n=/^(.*)@dropbox$/i,r=/^(.*)@flickr$/i,o=/^[a-z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,a=/^[^@]*<[a-z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?>$/i,l=/^(\+)?((?:(86)?(1(?:3\d|4[57]|5\d|8\d)\d{8}))|(?:(1)?(\d{5,15})))$/;return function(c){var u,h={};if(c=s.trim(c),(u=c.match(n))&&o.test(u[1]))h.name=u[1],h.external_username=u[1],h.provider="dropbox";else if(u=c.match(r))h.name=u[1],h.external_username=u[1],h.provider="flickr";else if(u=c.match(i))h.name=u[1],h.external_username=u[1],h.provider="instagram";else if(u=c.match(t))h.name=u[1],h.external_username=u[1],h.provider="facebook";else if(u=c.match(e))h.name=u[1]||u[2],h.external_username=h.name,h.provider="twitter";else if(o.test(c))h.name=s.cut30length(c.split("@")[0]),h.external_username=c,h.provider="email";else if(a.test(c)){var d=c.indexOf("<");h.name=s.cut30length(c.substring(0,d).replace(/^"|^'|"$|'$/g,"")),h.external_username=h.name,h.provider="email"}else if(u=c.replace(/[\s\-\(\)\_]/g,"").match(l)){var p,f,m=u[1];h.provider="phone",m?u[3]&&u[4]?(p=u[3],f=u[4],h.name=h.external_username=m+p+f):u[5]&&u[6]?(p=u[5],f=u[6],h.name=h.external_username=m+p+f):(h.name=c,h.provider=null):(m="+",u[4]?(p="86",f=u[4]):(p="1",f=u[2]),h.name=h.external_username=m+p+f)}else h.name=c,h.provider=null;return h}}(),tokenRegExp:/token=([a-zA-Z0-9]{32})/,printExtUserName:function(t,e){var i=t.external_username,n=t.provider;switch(n){case"twitter":i="@"+i+"@"+n;break;case"facebook":case"instagram":case"flickr":case"dropbox":i+="@"+n;break;case"phone":e&&(/^\+1\d{10}$/.test(i)?i=i.replace(/^(\+1)(\d{3})(\d{3})(\d{4})$/,"$1 ($2) $3-$4"):/^\+86\d{11}$/.test(i)&&(i=i.replace(/^(\+86)(\d{3})(\d{4})(\d{4})$/,"$1 $2 $3 $4")))}return i}};return s}),function(){"use strict";var t=/(?:\{\{|%\{)(\w*?)(?:\}\}?)/gm,e=/[\+\-][0-9]{4}$/,i=/^\d{4}-\d{2}-\d{2}$/,n=/^\d{2}:\d{2}:\d{2}$/,s=.2,r=6e4,o=864e5,a={monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),months:"January February March April May June July August September October November December".split(" "),weekdaysShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),"-1":function(){return"Today"},0:function(t){var e="",i=t.years,n=t.months;return i&&(e="{{years}} year"+(1===i?"":"s")),n&&(e+=(e?" ":"")+"{{months}} month"+(1===n?"":"s")),e+" ago"},1:function(t){var e="",i=t.days;return e=1===i?"Yesterday":2===i?"Two days ago":"{{days}} days ago"},2:function(t){var e="",i=t.isToday,n=t.hours;return e=!i&&n>=12?"Yesterday":"{{hours}} hours ago"},3:function(){return"1.5 hours ago"},4:function(){return"An hour ago"},5:function(t,e){return"X"===e?"Just now":"{{minutes}} minutes ago"},6:function(t,e){return"X"===e?"Now":"{{minutes}} minutes ago"},7:function(t,e){return"X"===e?"Now":"Seconds ago"},8:function(){return"In {{minutes}} minutes"},9:function(){return"In one hour"},10:function(){return"In 1.5 hours"},11:function(t){var e="",i=t.isToday,n=t.hours;return e=!i&&n>=12?"Tomorrow":"In {{hours}} hours"},12:function(t){var e="",i=t.days,n=t.day;return e=1===i?"Tomorrow":2===i?"In two days":a.weekdaysShort[n]+". in {{days}} days"},13:function(t){var e="",i=t.years,n=t.months;return i&&(e="{{years}} year"+(1===i?"":"s")),n&&(e+=(e?" ":"")+"{{months}} month"+(1===n?"":"s")),"In "+e}},l=function(t,e,i,n){var s,r=l.locales[l.locale],o=l.distanceOfTime(t,e),a=l.diff(o);return a.type=i,s=l.inWords(a,r),"function"==typeof n&&(s=n(s.data)),s},c=l.parseISO=function(t){return new Date(Date.parse(t))},u=l.toISO=function(t){return t.replace(/\s/,"T").replace(/\s/,"").replace(/([+\-]\d\d)(?::?)(\d\d)/,"$1:$2")};l.locale="en",l.locales={en:a},l.inWords=function(t,e){var i,n=e[t.token],s=t.type,r=t.date;return i="function"==typeof n?n(r,s):n,g(i,r)},l.diff=function(t){var e,i,n,o,a,l,c=t.target,u=t.distance,h=y(u/r),d={date:{}},p=d.date,f=t.days;return p.isToday=t.isToday,c._isToday?d.token=-1:-43199>h?(d.token=0,n=y(-h/525949),i=y(-h%525949/43829+s)):-1439>h?(d.token=1,e=3>-f?-f:y((-h+1439)/1440)):-107>h?(d.token=2,o=y(-h/60+s)):-81>h?d.token=3:-59>h?d.token=4:-29>h?(d.token=5,a=-h):0>h?(d.token=6,a=-h):0===h?d.token=7:60>h?(d.token=8,a=h):82>h?d.token=9:108>h?d.token=10:1440>h?(d.token=11,o=y(h/60+s)):43200>h?(d.token=12,e=3>f?f:y((h+1439)/1440),l=c.getDay()):(d.token=13,n=y(h/525949),i=y(h%525949/43829+s),12===i&&(i=0,n++)),n&&(p.years=n),i&&(p.months=i),e&&(p.days=e),o&&(p.hours=o),a&&(p.minutes=a),void 0!==l&&(p.day=l),d},l.distanceOfTime=function(t,e){t?"number"==typeof t?t=new Date(t):"string"==typeof t&&(t=c(u(t))):t=new Date,e?"number"==typeof e?e=new Date(e):"string"==typeof e&&(e=c(u(e))):e=new Date,t._reTime&&(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0));var i=t.getFullYear(),n=t.getMonth(),s=t.getDate(),r=e.getFullYear(),a=e.getMonth(),l=e.getDate();return{target:t,source:e,distance:+t-+e,days:(+new Date(i,n,s)-+new Date(r,a,l))/o,isToday:i===r&&n===a&&s===l}},l.toLocaleDate=function(t){var i,n,s,r=t.outputformat,o=new Date,a=o.getFullYear()+"-"+f(o.getMonth()+1)+"-"+f(o.getDate()),l=!1,u=!1;if(r)i=o,s=a,l=!0;else{var h=t.begin_at,d=h.date,p=h.time.replace(/\s/g,""),g=p&&p.replace(e,""),y=p&&(e.exec(p)||"Z"),b=y&&y[0],w="";d?(w=m(d),g?w+="T"+v(g):(u=!0,l=w===a)):(w=a,g&&(w+="T"+v(g))),d&&g&&b&&(w+=b),i=c(w),u&&(i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0)),n=s=i.getFullYear()+"-"+f(i.getMonth()+1)+"-"+f(i.getDate()),s+=g?" "+f(i.getHours())+":"+f(i.getMinutes())+":"+f(i.getSeconds()):""}return i._isToday=l,i._reTime=u,{date:i,text:s}};var h={date:function(t,e,i,n){var s=l.locales[l.locale];return s.weekdaysShort[n]+", "+s.monthsShort[e]+" "+i},time:function(t,e){var i=t>12?t-12:t,n=i+":"+f(e);return n+=t>=12?"PM":"AM"}};l.printEFTime=function(t,e,i){var n,s,r,o,a,c=t.outputformat,u=t.begin_at,f="X"===e,m={title:"",content:""},v=new Date;if(c)n=t.origin.replace(/^['"]+/,"").replace(/['"]+$/,""),m.title=n,f||(m.content=n,u.date&&(t.outputformat=0,s=l.toLocaleDate(t),m.content=l(s.date,v),t.outputformat=1));else if(i||(i=h),u&&(u.date||u.time?(s=l.toLocaleDate(t),r=s.date,u.date?(m.title=l(s.date,v,"X"),m.content=u.time_word+(u.time_word&&u.time?" ":"")+(u.time?i.time(r.getHours(),r.getMinutes()):"")+(u.time||u.time_word?u.time?" ":", ":"")+i.date(r.getFullYear(),r.getMonth(),r.getDate(),r.getDay())+(u.date_word?" ":"")+u.date_word):u.time&&(m.content=m.title=u.time_word+(u.time_word?" ":"")+i.time(r.getHours(),r.getMinutes())+(u.date_word?", ":"")+u.date_word),r.getFullYear()!==v.getFullYear()&&(m.content+=" "+r.getFullYear())):(u.date_word||u.time_word)&&(m.content=m.title=u.time_word+(u.time_word?", ":"")+u.date_word),u.timezone&&(o=u.timezone.replace(/^([+\-]\d\d:\d\d)[\w\W]*$/,"$1"),a=d(v),o!==a))){var g=p(v);m.content+=" ("+a+(g&&" "+g)+")"}return m},l.printTime=function(t,e){t||(t=new Date),e||(e=h);var i=new Date,n="";return n+=e.date(t.getFullYear(),t.getMonth(),t.getDate(),t.getDay())+" "+e.time(t.getHours(),t.getMinutes()),t.getFullYear()!==i.getFullYear()&&(n+=" "+t.getFullYear()),n};var d=l.getTimezone=function(t){var e,i,n,s;return t||(t=new Date),e=t.getTimezoneOffset(),s=0>=e?"+":"-",e=Math.abs(e),i=y(e/60),n=e-60*i,s+f(i)+":"+f(n)},p=function(t){var e;return t||(t=new Date),e=(""+t).replace(/^.*:\d\d( GMT[+-]\d+)? \(?([A-Za-z ]+)\)?\d*$/,"$2").replace(/[a-z ]/g,""),3===e.length?e:""};l.createEFTime=function(){return{begin_at:{date_word:"",date:"",time_word:"",time:"",timezone:"",id:0,type:"EFTime"},origin:"",outputformat:1,id:0,type:"CrossTime"}};var f=l.lead0=function(t,e){for(t=""+t,e||(e=2);e>t.length;)t="0"+t;return t},m=l.formatDate=function(t){var e;return i.test(t)?e=t:(e=t.split("-"),e[1]=f(e[1]),e[2]=f(e[2]),e=e.join("-")),e},v=l.formatTime=function(t){var e;return n.test(t)?e=t:(e=t.split(":"),e[0]=f(e[0]),e[1]=f(e[1]),e[2]=f(e[2]),e=e.join(":")),e},g=function(e,i){var n,s,r,o,a=e.match(t),l=0;if(a)for(;o=a[l];++l)s=o.replace(t,"$1"),r=i[s],n=RegExp(o.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(n,r);return e},y=function(t){return t-t%1};"function"==typeof define&&define("humantime",function(){return l})}(),define("lightsaber",function(t,e,i){"use strict";function n(){var t=new s,e=new r,i=new o;return v(t,b.prototype),t.request=e,t.response=i,e.app=i.app=t,t.init(),t}function s(){}function r(t){this.enableFullUrlPath=!!t,this.session={},this.path="/",this.method="GET",this.updateUrl()}function o(t,e){this.path=t,this.title=document.title,this.state=e||{}}function a(t){t=t||{};var e=this;this.map=[],this.params={},this._params=[],this.caseSensitive=t.caseSensitive,this.strict=t.strict,this.middleware=function(t,i,n){e._dispatch(t,i,n)}}function l(t,e,i){i=i||{},this.path=t,this.callbacks=e,this.regexp=g(t,this.keys=[],i.sensitive,i.strict)}function c(t,e,i){e=e||{},this.name=t,this.root=e.root,this.engine=e.engine,this.ext=f(t),this.timestamp=i||"",this.path=this.lookup(t)}function u(){return function(t,e,i){t.next=i,e.locals=e.locals||m(e),i()}}function h(){return++h.id}function d(t,e,i){var n=t.length;if(!n)return-1;if(i||(i=0),i>n)return-1;for(0>i&&(i=Math.max(0,n+i));n>i;++i)if(i in t&&t[i]===e)return i;return-1}function p(t,e,i,n,s){return _.get(e,function(e){var r,o=e;"html"!==s&&(r=t.compile(e),o=r(i)),n(o)})}function f(t){return t.split(".")[1]||"html"}function m(t){function e(t){for(var i in t)e[i]=t[i];return t}return t.viewCallbacks=t.viewCallbacks||[],e}function v(t,e){var i;if(t&&e)for(i in e)t[i]=e[i];return t}function g(t,e,i,n){return t instanceof RegExp?t:(P(t)&&(t="("+t.join("|")+")"),t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,i,n,s,r,o,a){return e.push({name:s,optional:!!o}),i=i||"",""+(o?"":i)+"(?:"+(o?i:"")+(n||"")+(r||n&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+t+"$",i?"":"i"))}var y,b=t("emitter"),w=/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),_=t("jquery")||t("zepto"),x=function(t,e){return t?function(i){return t.call(e,i)}:void 0},k=window.location,C=window.history,S="/",E=!1;_(window).on("load",function(){E=!0,setTimeout(function(){E=!1},0)}),e=i.exports=n;var T;e.version="0.0.5",T=s.prototype,T.historySupport=y=null!==(null!==C?C.pushState:void 0),_.browser&&_.browser.opera&&(T.historySupport=y=!1),T.init=function(){this.cache={},this.settings={},this.engines={},this.route=S,this.stack=[],this.viewCallbacks=[],this.defaultConfiguration()},T.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(u(this)),this._router=new a(this),this.routes=this._router.map,this._usedRouter=!1,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=m(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},T.use=function(t,e){return"string"!=typeof t&&(e=t,t=S),S!==t&&S===t[t.length-1]&&(t=t.slice(0,-1)),this.stack.push({route:t,handle:e}),this},T.engine=function(t,e){if("function"!=typeof e)throw Error("callback function required");return"."!==t[0]&&(t="."+t),this.engines[t]=e,this},T.set=function(t,e){return 1!==arguments.length?(this.settings[t]=e,this):this.settings.hasOwnProperty(t)?this.settings[t]:void 0},T.enabled=function(t){return!!this.set(t)},T.disabled=function(t){return!this.set(t)},T.enable=function(t){return this.set(t,!0)},T.disable=function(t){return this.set(t,!1)},T.configure=function(t,e){var i="all",n=[].slice.call(arguments);return e=n.pop(),n.length&&(i=n),("all"===i||~d(i,this.settings.env))&&e.call(this),this},T.render=function(t,e,i){var n,s={},r=this.cache;if(this.engine,"function"==typeof e&&(i=e,e={}),v(s,this.locals),e.locals&&v(s,e.locals),v(s,e),s.cache=null===s.cache?this.enabled("view cache"):s.cache,s.cache&&(n=r[t]),!n){if(n=new c(t,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp")),!n.path){var o=Error('Failed to lookup view "'+t+'"');return o.view=n,i(o)}s.cache&&(r[t]=n)}try{n.render(s,i)}catch(o){i(o)}},T.path=function(){return this.route},T.param=function(t,e){var i,n=[].slice.call(arguments,1),s=0;if(P(t))for(i=t.length;i>s;++s)for(var r=0,o=n.length;o>r;++r)this.param(t[s],n[r]);else if("function"==typeof t)this._router.param(t);else for(":"===t[0]&&(t=t.substr(1)),i=n.length;i>s;++s)this._router.param(t,e);return this},T.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},T.get=function(){var t=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,t)},T.handle=function(t,e){function i(a){var l,c=n[o++];if(r&&(t.url=t.url.substr(1),r=!1),t.url=s+t.url,c)try{if(l=t.url,0!==l.indexOf(c.route))return i(a);var u=c.handle.length;s=c.route,t.url=t.url.substr(s.length),"/"!==t.url[0]&&(t.url="/"+t.url,r=!0),a?4===u?c.handle(a,t,e,i):i(a):4>u?c.handle(t,e,i):i()}catch(h){i(h)}}if(t.enableFullUrlPath||t.fullpath===t.path){var n=this.stack,s="",r=!1,o=0;i()}},T.run=function(t){this.emit("launch"),t=t||{};var e=this.request,i=this.response;this.running||(this.running=!0,!1===t.dispatch&&this.disable("dispatch"),!1!==t.popstate&&(this.historySupport&&!w?_(window).on("popstate",x(this.change,this)):_(window).on("hashchange",x(this.change,this))),this.disabled("dispatch")||(this.handle(e,i),this.emit("launched")))},T.change=function(t){if(E)return E=!1;var e=this,i=e.request,n=e.response,s=i.url;return i.updateUrl(),s!==i.url?(e.handle(i,n),t&&(t.stopPropagation(),t.preventDefault()),!1):void 0},T.error=function(t,e){var i=Error(e);return i.status=t,i},T=r.prototype,T.updateUrl=function(){this.host=k.hostname,this.port=k.port||80,this.fullpath=k.pathname,this.enableFullUrlPath&&(this.path=this.fullpath),this.hash=decodeURIComponent(k.hash),this.querystring=decodeURIComponent(k.search),this.url=this.path+this.querystring+this.hash},T.param=function(t,e){var i=this.params||{},n=this.query||{};return null!=i[t]&&i.hasOwnProperty(t)?i[t]:null!=n[t]?n[t]:e},T.getPath=function(){return this.path},T.getHost=function(){return this.host},T=o.prototype,T.location=function(t){window.setTimeout(function(){k.href=t},16)},T.redirect=function(t){var e,i;return arguments.length,t=arguments[0],"back"===t||"forward"===t?(C[t](),void 0):y?(e=arguments[1],i=arguments[2]||{},this.path=t,this.title=e||"EXFE.COM",document.title=this.title,this.state=i,this.state.id=h(),this.pushState(),this.app.change(),void 0):(this.location(t),void 0)},T.save=function(){C.replaceState(this.state,this.title,this.path)},T.pushState=function(){C.pushState(this.state,this.title,this.path)},T.render=function(t,e,i){var n=this,e=e||{},s=this.app;"function"==typeof e&&(i=e,e={}),e.locals=n.locals,s.render(t,e,i)},T=a.prototype,T.param=function(t,e){if("function"==typeof t)return this._params.push(t),void 0;var i,n,s=this._params,r=s.length;for(n=0;r>n;++n)(i=s[n](t,e))&&(e=i);if("function"!=typeof e)throw Error("invalid param() call for "+t+", got "+e);return(this.params[t]=this.params[t]||[]).push(e),this},T._dispatch=function(t,e,i){var n=this.params,s=this;(function r(o,a){function l(e){r(t._route_index+1,e)}function c(e){g=0,v=m[o++],p=v&&t.params[v.name],d=v&&n[v.name];try{"route"===e?l():e?(o=0,h(e)):d&&void 0!==p?u():v?c():(o=0,h())}catch(e){c(e)}}function u(i){var n=d[g++];return i||!n?c(i):(n(t,e,u,p,v.name),void 0)}function h(i){var n=f.callbacks[o++];try{if("route"===i)l();else if(i&&n){if(4>n.length)return h(i);n(i,t,e,h)}else n?n(t,e,h):l(i)}catch(i){h(i)}}var d,p,f,m,v,g=0;return t.route=f=s.matchRequest(t,o),f?(t.params=f.params,m=f.keys,o=0,c(a),void 0):i(a)})(0)},T.matchRequest=function(t,e){var i,n=t.url,s=this.map,r=s.length;for(e=e||0;r>e;++e)if(i=s[e],i.match(n))return t._route_index=e,i},T.route=function(t){t||Error("Router#get() requires a path");var e=[].slice.call(arguments,1),i=new l(t,e,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(i),this},T=l.prototype,T.match=function(t){this.regexp.lastIndex=0;var e,i,n,s,r=this.keys,o=this.params=[],a=this.regexp.exec(t);if(!a)return!1;for(e=1,i=a.length;i>e;++e)n=r[e-1],s="string"==typeof a[e]?decodeURIComponent(a[e]):a[e],n?o[n.name]=s:o.push(s);return!0},T=c.prototype,T.lookup=function(t){return this.root+"/"+t+"?t="+this.timestamp},T.render=function(t,e){return p(this.engine,this.path,t,e,this.ext)},h.id=0;var P=Array.isArray;P||(P=function(t){return t instanceof Array})}),define("live",function(t){"use strict";function e(){navigator.geolocation.clearWatch(P)}function i(){P=navigator.geolocation.watchPosition(function(t){t&&t.coords&&t.coords.latitude&&t.coords.longitude&&t.coords.accuracy&&(d.latitude=""+t.coords.latitude,d.longitude=""+t.coords.longitude,d.accuracy=""+t.coords.accuracy,l=a-5,g("Location update: lat = "+d.latitude+", "+"lng = "+d.longitude+", "+"acu = "+d.accuracy))})}var n=window._ENV_,s=n.streaming_api_url,r=n.api_url;t("store");var o="",a=30,l=a,c=!1,u=null,h="",d={card:{id:"",name:"",avatar:"",bio:"",identities:[],timestamp:0},latitude:"",longitude:"",accuracy:"",traits:[]},p=Date.now||function(){return(new Date).getTime()},s=s,f=null,m=null,v=null,g=function(t,e){if(c){var i=Object.prototype.toString.call(t),n=""+new Date;"[object String]"!==i&&"[object Number]"!==i&&(t=JSON.stringify(t)),console.log(n.replace(/^.*(\d{2}:\d{2}:\d{2}).*$/,"$1")+" - "+t),e&&console.table&&console.table(e)}},y=function(){l=0,g("Breathe with"+(o?" token: "+o:"out token")),f&&f.abort(),f=$.ajax({type:"post",url:s+"/v3/live/cards"+(o?"?token="+o:""),data:JSON.stringify(d),success:function(t){var e=t;e&&e.length&&(l=0,o!==e[0]&&(g("Got new token: "+e[0]+", id: "+e[1]),x.live&&(x.kill(),g("Close current stream")),l=a),o=e[0],d.card.id=e[1])},error:function(t){t.status&&t.status>=400&&499>=t.status?(o&&g("Repeal token: "+o),o="",l=a):(l=a-5,g("Network error"))}}),!x.live&&o&&(x.init(s+"/v3/live/streaming?token="+o,b,w),g("Streaming with token: "+o))},b=function(t){var e=JSON.parse(t);if(e&&e.length){var i={};for(var n in e)e[n].id&&(e[n].id===d.card.id?(d.card.name=e[n].name,d.card.avatar=e[n].avatar,d.card.bio=e[n].bio,d.card.identities=e[n].identities,d.card.timestamp=e[n].timestamp):(e[n].avatar||(e[n].avatar=encodeURI(r+"/avatar/default?name="+e[n].name)),i[e[n].id]=e[n]));var s={me:E(d.card),others:i},o=JSON.stringify(s);g("Streaming pops: "+o,i),u&&h!==o&&(g("Callback"),u(s),h=o)}else g("Data error")},w=function(){g("Streaming is dead")},_=function(){S(d.card)&&++l>=a&&y()},x={prvLen:null,nxtIdx:null,timer:null,http:null,pop:null,dead:null,live:!1,init:function(t,e,i){this.prvLen=0,this.nxtIdx=0,this.live=!0,this.pop=e,this.dead=i,this.http=new XMLHttpRequest,this.http.open("post",t),this.http.onreadystatechange=this.listen,this.http.send(),this.timer=setInterval(this.listen,1e3)},listen:function(){if(!(4!==x.http.readyState&&3!==x.http.readyState||3===x.http.readyState&&200!==x.http.status||null===x.http.responseText)){for(4===x.http.readyState&&200!==x.http.status&&x.kill();x.prvLen!==x.http.responseText.length&&(4!==x.http.readyState||x.prvLen!==x.http.responseText.length);){x.prvLen=x.http.responseText.length;var t=x.http.responseText.substring(x.nxtIdx),e=t.split("\n");if(x.nxtIdx+=t.lastIndexOf("\n")+1,"\n"===t[t.length-1]&&e[e.length]||e.pop(),x.pop&&e&&e.length)for(var i;(i=e.shift())&&i.length;)x.pop(i)}4===x.http.readyState&&x.prvLen===x.http.responseText.length&&x.kill()}},kill:function(){clearInterval(this.timer),this.http&&this.http.abort(),this.dead&&this.dead(),this.live=!1}},k=function(){if(void 0===window.DeviceMotionEvent)return null;var t=50,e=0,i=0,n=0,s=0,r=0,o=0;window.addEventListener("devicemotion",function(t){e=t.accelerationIncludingGravity.x,i=t.accelerationIncludingGravity.y,n=t.accelerationIncludingGravity.z},!1),setInterval(function(){var a=Math.abs(e-s+i-r+n-o);a>t&&(m&&m(),v&&setTimeout(v,1e3)),s=e,r=i,o=n},100)},C=function(t){return t&&t.external_username&&t.provider?!0:!1},S=function(t){if(t&&t.name&&t.identities&&t.identities.length){for(var e in t.identities)if(C(t.identities[e])===!1)return!1;return!0}},E=function(t){switch(Object.prototype.toString.call(t)){case"[object Object]":var e={};for(var i in t)e[i]=E(t[i]);break;case"[object Array]":e=[];for(i in t)e.push(E(t[i]));break;default:e=t}return e},T={init:function(t,e){S(t)?(x.kill(),d.card.name=t.name,d.card.avatar=t.avatar,d.card.bio=t.bio,d.card.identities=E(t.identities),d.card.timestamp=p(),g("Set my card: "+JSON.stringify(d.card))):g("Card error"),e&&(u=e,g("Set callback function")),l=a},shake:function(t,e){m=t,v=e},startGeo:i,stopGeo:e};setInterval(_,1e3),k(m,v);var P;return window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),T}),define("routexstream",function(){"use strict";var t=window._ENV_,e=t.apiv3_url,i=0,n="",s=10,r=s,o=null,a=null,l=!!0,c={t:0,gps:[0,0,0]},u=null,h=null,d=null,p=null,f=null,m=function(){return r=0,n?(v("Breathe with token: "+n),u&&u.abort(),u=$.ajax({type:"POST",url:e+"/routex/breadcrumbs?coordinate=earth&token="+n,data:JSON.stringify([c]),success:function(t){t&&(localStorage.setItem("offset-latlng",JSON.stringify(t)),f&&f(t))},error:function(t){var e=t.status;e&&e>=400&&499>=e?(v("Unauthorized."),a&&(y.kill(),a())):(r=s-5,v("Network error"))}}),void 0):(v("No token!"),void 0)},v=function(t,e){if(l){var i=Object.prototype.toString.call(t),n=""+new Date;"[object String]"!==i&&"[object Number]"!==i&&(t=JSON.stringify(t)),console.log(n.replace(/^.*(\d{2}:\d{2}:\d{2}).*$/,"$1")+" - "+t),e&&console.table&&console.table(e)}},g=function(){if(void 0===window.DeviceMotionEvent)return null;var t=50,e=0,i=0,n=0,s=0,r=0,o=0;window.addEventListener("devicemotion",function(t){e=t.accelerationIncludingGravity.x,i=t.accelerationIncludingGravity.y,n=t.accelerationIncludingGravity.z},!1),setInterval(function(){var a=Math.abs(e-s+i-r+n-o);a>t&&(h&&h(),d&&setTimeout(d,1e3)),s=e,r=i,o=n},100)},y={prvLen:null,nxtIdx:null,timer:null,http:null,pop:null,dead:null,live:!1,init:function(t,e,i){console.log(t),this.prvLen=0,this.nxtIdx=0,this.live=!0,this.pop=e,this.dead=i;var n=this.http=new XMLHttpRequest;n.open("post",t),n.onreadystatechange=this.listen,n.send(),this.timer=setInterval(this.listen,1e3)},listen:function(){var t=y.http;if(!(4!==t.readyState&&3!==t.readyState||3===t.readyState&&200!==t.status||null===t.responseText)){for(4===t.readyState&&200!==t.status&&y.kill();y.prvLen!==t.responseText.length&&(4!==t.readyState||y.prvLen!==t.responseText.length);){y.prvLen=t.responseText.length;var e=t.responseText.substring(y.nxtIdx),i=e.split("\n");if(y.nxtIdx+=e.lastIndexOf("\n")+1,"\n"===e[e.length-1]&&i[i.length]||i.pop(),y.pop&&i&&i.length)for(var n;(n=i.shift())&&n.length;)y.pop(n)}4===t.readyState&&y.prvLen===t.responseText.length&&y.kill()}},kill:function(){clearInterval(this.timer),this.http&&this.http.abort(),this.dead&&this.dead(),this.live=!1}},b=function(){v("Streaming is dead")},w=function(){_(c)&&++r>=s&&m(),!y.live&&n&&(y.init(e+"/routex/crosses/"+i+"?_method=WATCH&coordinate=mars&token="+n,E,b),v("Streaming with token: "+n))},_=function(t){return t&&t.t&&t.gps&&t.gps[0]&&t.gps[1]&&t.gps[2]},x=function(){S.stopWatch(p)},k=function(t,e){S.get(function(e){c.t=e.timestamp,c.gps[0]=e.latitude,c.gps[1]=e.longitude,c.gps[2]=e.accuracy,t&&t(e),v("Location update: time = "+c.t+", "+"lat  = "+c.gps[0]+", "+"lng  = "+c.gps[1]+", "+"acu  = "+c.gps[2])},function(t){e&&e(t)})},C=function(t,e){p=S.watch(function(e){c.t=e.timestamp,c.gps[0]=e.latitude,c.gps[1]=e.longitude,c.gps[2]=e.accuracy,t&&t(e),v("Location update: time = "+c.t+", "+"lat  = "+c.gps[0]+", "+"lng  = "+c.gps[1]+", "+"acu  = "+c.gps[2])},function(t){e&&e(t)})},S={options:{enableHighAccuracy:!0,maximumAge:0,timeout:29999.999999},cachedOptions:{enableHighAccuracy:!1,maximumAge:72e5,timeout:5e3},STATUS:0,freshness_threshold:4999.999999,accuracy_threshold:500,_success:function(t){var e=this,i=this.freshness_threshold,n=this.accuracy_threshold,s=Date.now();return function r(o){var a=o.coords,l=a,c=Date.now(),u=!1;
0===e.STATUS&&(u=!0),c-s>i&&(u=!0),u&&(s=c+i,l.status="success",l.timestamp=Math.round(o.timestamp/1e3),l.accuracy=parseInt(a.accuracy||n),t&&t(l),0===e.STATUS&&(e.STATUS=1),r=null)}},_error:function(t){return function e(i){var n={status:"fail",code:i.code,message:i.message};t&&t(n),e=null}},get:function(t,e,i){i=i||this.options,navigator.geolocation.getCurrentPosition(this._success(t),this._error(e),i)},watch:function(t,e){return navigator.geolocation.watchPosition(this._success(t),this._error(e),this.STATUS?this.options:this.cachedOptions)},stopWatch:function(t){t&&navigator.geolocation.clearWatch(t)}},E=function(t){var e=JSON.parse(t);e&&e.type&&(v("Streaming pops: "+e.type),o(e))},T={init:function(t,e,l,c,u){return t?e?l?c?(i=t,v("Set cross_id: "+t),n=e,v("Set token: "+e),o=l,v("Set callback function"),a=c,v("Set unauthorized callback function"),r=s,f=u,void 0):(v("Error unauthorized callback!"),void 0):(v("Error callback!"),void 0):(v("Error token!"),void 0):(v("Error cross id!"),void 0)},shake:function(t,e){h=t,d=e},getGeo:k,startGeo:C,stopGeo:x,geoService:S};return setInterval(w,1e3),g(h,d),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),T}),define("routexmaps",function(t){"use strict";function e(e){e=this.options=e||{},this.svgLayer=this.options.svg,delete this.options.svg,this.latOffset=0,this.lngOffset=0,this.routes={},this.places={},this.tiplines={},this.breadcrumbs={},this.geoMarkers={},this.icons={},this.updated={},this._breadcrumbs={},this.boundsOffset={left:50,top:0},this.labels=[],window._loadmaps_=function(e,n,s,r){return function o(){var a=google.maps,l=a.event;a.InfoBox=t("infobox"),a.TextLabel=t("maplabel");var c=e.icons;c.dotGrey=new a.MarkerImage(i+"/static/img/map_dot_grey@2x.png",new a.Size(36,36),new a.Point(0,0),new a.Point(9,9),new a.Size(18,18)),c.dotRed=new a.MarkerImage(i+"/static/img/map_dot_red@2x.png",new a.Size(36,36),new a.Point(0,0),new a.Point(9,9),new a.Size(18,18)),c.arrowBlue=new a.MarkerImage(i+"/static/img/map_arrow_22blue@2x.png",new a.Size(44,44),new a.Point(0,0),new a.Point(11,11),new a.Size(22,22)),c.arrowGrey=new a.MarkerImage(i+"/static/img/map_arrow_22g5@2x.png",new a.Size(44,44),new a.Point(0,0),new a.Point(11,11),new a.Size(22,22)),a.visualRefresh=!0,s.center=e.toLatLng(35.86166,104.195397),s.mapTypeId=a.MapTypeId.ROADMAP,s.disableDefaultUI=!0,s.minZoom=1;var u=e.map=new a.Map(n,s),h=e.overlay=new a.OverlayView;h.draw=function(){},h.setMap(u);var d=l.addListener(u,"tilesloaded",function(){function t(t){clearTimeout(t),t=null}l.addListener(u,"bounds_changed",function(){l.trigger(u,"zoom_changed")}),l.addListener(u,"zoom_changed",function(){e.contains()}),l.addListener(u,"mousedown",function(t){t.stop(),e.hideIdentityPanel()});var i,s,r=377;l.addDomListener(n,"touchstart",function(o){console.dir(o),e.hideMyPanel(),e.hideNearBy(),s=Date.now(),t(i),i=setTimeout(function(){o.preventDefault();var t=o.touches[0],i={x:t.pageX,y:t.pageY};e.showNearBy(i)},r),l.clearListeners(n,"touchmove"),l.addDomListenerOnce(n,"touchmove",function(){t(i),e.hideTiplines()})}),l.addDomListener(n,"touchend",function(){377>Date.now()-s&&t(i)}),l.removeListener(d)});r(u),o=null}}(this,e.mapDiv,e.mapOptions,e.callback)}var i=window._ENV_.site_url,n=6378137,s=function(t,e,i,s){var r=n,o=(i-t)*Math.PI/180,a=(s-e)*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),u=r*c;return u},r=function(t){return t*Math.PI/180},o=function(t){return 180*t/Math.PI},a=function(t,e,i,n){t=r(t),e=r(e),i=r(i),n=r(n);var s=n-e,a=Math.sin(s)*Math.cos(i),l=Math.cos(t)*Math.sin(i)-Math.sin(t)*Math.cos(i)*Math.cos(s),c=Math.atan2(a,l);return 0>c&&(c+=2*Math.PI),o(c)},l=function(t,e,i,n,s){return n='<span class="unit">{{u}}</span>',t=Math.floor(t),s={text:"",status:0,distance:t},30>t&&!e?(s.status=4,s.text=""):s.text=1e3>t?t+n.replace("{{u}}",""):9e3>t?(t/1e3+"").slice(0,3)+n.replace("{{u}}",""):"9+"+n.replace("{{u}}",""),s},c=function(t){return(1*t).toString(16)},u=function(t){return t+="",t+(t.length>1?"":"0")},h=610,d="route",p="location",f="destination",m="breadcrumbs",v=[0,1,3,5,10,15],g=e.prototype;g.load=function(t){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.onload=e.onerror=e.onreadystatechange=function(){/^(?:loaded|complete|undefined)$/.test(e.readyState)&&(e=e.onload=e.onerror=e.onreadystatechange=null,t&&t())},e.src=this.options.url,document.body.appendChild(e)},g.fromContainerPixelToLatLng=function(t){return this.overlay.getProjection().fromContainerPixelToLatLng(t)},g.fromLatLngToContainerPixel=function(t){return this.overlay.getProjection().fromLatLngToContainerPixel(t)},g.showIdentityPanel=function(t){this.hideNearBy();var e,i,n=this.geoMarkers[t],r=this.geoLocation,o=this.destinationPlace,a=$('#identities-overlay .identity[data-uid="'+t+'"]').data("identity"),c=$("#other-info"),u=Math.round(Date.now()/1e3);if(n){if(e=n.getPosition(),i=Math.floor((u-n.data.positions[0].t)/60),c.find(".name").text(a.name),i>1?(c.find(".update").removeClass("hide").find(".time").text(i),c.find(".please-update").attr("data-external-username",a.external_username).attr("data-provider",a.provider).removeClass("hide")):(c.find(".update").addClass("hide"),c.find(".please-update").addClass("hide")),o){var h=o.getPosition(),d=s(h.lat(),h.lng(),e.lat(),e.lng()),p=l(d,!0);c.find(".dest").removeClass("hide").find(".m").html(p.text)}else c.find(".dest").addClass("hide");if(r){var h=r.getPosition(),d=s(h.lat(),h.lng(),e.lat(),e.lng()),p=l(d,!0);c.find(".dest-me").removeClass("hide").find(".m").html(p.text)}else c.find(".dest-me").removeClass("hide");c.removeClass("hide");var f=$(window).width(),m=$(window).height(),v=c.height(),g=c.width(),y=this.fromLatLngToContainerPixel(e),b=y.x-g/2,w=y.y-v/2;0>b&&(b=50),b+g>f&&(b=f-g),0>w&&(w=20),w+v>m&&(w=m-v),c.css({left:b,top:w})}},g.setOffset=function(t){this.latOffset=1*t.earth_to_mars_latitude,this.lngOffset=1*t.earth_to_mars_longitude},g.hideMyPanel=function(){$("#my-info").addClass("hide")},g.hideIdentityPanel=function(){$("#other-info").addClass("hide")};var y='<div id="nearby" class="info-windown"></div>',b='<div class="place-marker"><h4 class="title"></h4><div class="description"></div></div>',w='<div class="geo-marker clearfix"><img width="30" height="30" src="" alt="" /><div class="detial"><div class="name"></div><div class="status"></div></div></div>';return g.hideNearBy=function(){$("#nearby").remove()},g.distance100px=function(t,e){var i=this.fromLatLngToContainerPixel(t),n=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return 100>=n},g.showNearBy=function(t){if(t){var e,i,n=t,r=!1,o=(this.myUserId,this.places),a=this.geoMarkers,c=this.geoLocation,u=c&&c.getPosition(),h=this.destinationPlace,d=h&&h.getPosition(),p=Date.now()/1e3;console.log("-----------------------",u,d);var f=$(y);for(var m in o)if(i=o[m],e=i.getPosition(),this.distance100px(e,n)){r||(r=!0);var v=$(b);v.find(".title").text(i.data.title),v.find(".description").text(i.data.description),f.append($("<div></div>").append(v))}for(var m in a)if(i=a[m],e=i.getPosition(),this.distance100px(e,n)){r||(r=!0),i.data.id.split("@")[0];var g=$('#identities-overlay .identity[data-uid="'+m+'"]').data("identity"),v=$(w);v.find("img").attr("src",g.avatar_filename),v.find(".name").text(g.name),v.attr("data-uid",m);var _=i.data.positions[0],x=Math.floor((p-_.t)/60),k="",C="",S="";if(u){var E=l(s(e.lat(),e.lng(),u.lat(),u.lng()),!0);k=E.text}if(d){var E=l(s(e.lat(),e.lng(),d.lat(),d.lng()),!0);C=E.text}1>=x?(C&&(S+="<span>"+C+"</span>"),k&&(S+="<span>"+k+"</span>")):(S+="<span>"+x+"</span>",C&&(S+="<span>"+C+"</span>")),S&&v.find(".status").html(S),f.append($("<div></div>").append(v))}if(r){var T=$(window).width(),P=$(window).height();f.css({left:(T-200+50)/2,top:(P-132)/2}),$("#routex").append(f)}}},g.draw=function(t){var e,i=t.type,n=t.action,s=n&&"delete"===n,r=t.tags,o=r&&t.tags.slice(0);switch(console.log(i,n,s,o,t),i){case p:var a;if(r)for(;e=o.shift();)if(e===f){a=!0;break}s?this.removePlace(t):this.drawPlace(t,a);break;case d:var l;if(r)for(;e=o.shift();)if(e===m){l=!0;break}l?this.drawGeoMarker(t):s?this.removeRoute(t):this.drawRoute(t)}},g.removePlace=function(t){var e=this.places,i=t.id,n=e[i];n&&(n.setMap(null),n=null,delete e[i])},g.drawRoute=function(t){var e,i,n,s,r=this.routes,o=t.id,a=t.positions.slice(0),l=[];if(!r.hasOwnProperty(o)||(e=r[o],i=e.data,i.updated_at!==t.updated_at)){for(e||(e=r[o]=this.addPolyline(t));n=a.shift();)s=n.gps,l.push(this.toLatLng(s[0],s[1]));e.setPath(l),e.data=t}},g.removeRoute=function(t){var e=this.routes,i=t.id,n=e[i];n&&(n.setMap(null),n=null,delete e[i])},g.addPolyline=function(t){var e=t.color&&t.color.split(",")||[],i="#"+(e.length?u(c(e[0]))+u(c(e[1]))+u(c(e[2])):"007BFF"),n=e[3]||1,s=new google.maps.Polyline({map:this.map,index:h-5,geodesic:!0,strokeColor:i,strokeWeight:4,strokeOpacity:n});return s},g.drawPlace=function(t,e){var i,n,s,r=this.places,o=t.id;if((!r.hasOwnProperty(o)||(i=r[o],n=i.data,n.updated_at!==t.updated_at))&&(i||(i=r[o]=this.addPoint(t,e)),s=this.toLatLng(t.lat,t.lng),i.setPosition(s),i.data=t,e)){var a=this.geoLocation;(!a||a&&0==a._status)&&this.panToDestination(s),this.destinationPlace=i,i.setZIndex(h)}},g.monit=function(){var t,e,i,n,s,r,o,a,l=this.updated,c=this.breadcrumbs,u=this.icons,h=this.geoMarkers,d=this.tiplines,p=this.destinationPlace,f=this.geoLocation,m=this.myUserId,v=this.uid,g=Math.round(Date.now()/1e3);for(t in l)if(l.hasOwnProperty(t))if(i=l[t],e=m==t,a=Math.floor((g-i.t)/60),n=e?f:h[t],this.distanceMatrix(t,n,p,a),s=c[t],o=d[t],r=$('#identities-overlay .identity[data-uid="'+t+'"]').find(".icon"),v&&v==t&&this._breadcrumbs[v]&&this.showTextLabels(v,this._breadcrumbs[v].positions.slice(0),1>=a),1>=a){if(r.length&&(r.hasClass("icon-arrow-grey")||r.hasClass("icon-arrow-red")?r.attr("class","icon icon-arrow-red"):r.attr("class","icon icon-dot-red")),s&&s.setOptions({strokeOpacity:0,icons:[{icon:{path:"M0,0 a8,8 0 1,0 16,0 a8,8 0 1,0 -16,0 z",fillColor:"#FF7E98",fillOpacity:.8,strokeColor:"#fff",strokeOpacity:.8,strokeWeight:1,scale:.5},repeat:"50px",offset:"0"}]}),e)continue;o&&o.setAttribute("stroke","#FF7E98"),n&&n.setIcon(u.dotRed)}else{if(r.length&&(r.hasClass("icon-arrow-grey")||r.hasClass("icon-arrow-red")?r.attr("class","icon icon-arrow-grey"):r.attr("class","icon icon-dot-grey")),s&&s.setOptions({strokeOpacity:0,icons:[{icon:{path:"M0,0 a8,8 0 1,0 16,0 a8,8 0 1,0 -16,0 z",fillColor:"#b2b2b2",fillOpacity:.8,strokeColor:"#fff",strokeOpacity:.8,strokeWeight:1,scale:.5},repeat:"50px",offset:"0"}]}),e)continue;o&&o.setAttribute("stroke","#b2b2b2"),n&&n.setIcon(u.dotGrey)}},g.toLatLng=function(t,e){return new google.maps.LatLng(1*t,1*e)},g.drawBreadcrumbs=function(t){this.breadcrumbs,t.uid},g.drawGeoMarker=function(t){var e,i,n,s,r=this.geoMarkers,o=t.id.split("@")[0];if(this.updatePositions(t),o!=this.myUserId){if(r.hasOwnProperty(o)&&(e=r[o],i=e.data,i.updated_at===t.updated_at))return;e||(e=r[o]=this.addGeoMarker()),s=t.positions[0].gps,n=this.toLatLng(s[0],s[1]),e.setPosition(n),e.uid=o,e.data=t,this.updateTipline(o,n)}},g.updatePositions=function(t){var e=t.id.split("@")[0];this._breadcrumbs[e]?this._breadcrumbs[e].positions.unshift(t.positions[0]):this._breadcrumbs[e]=t,this.updated[e]=this._breadcrumbs[e].positions[0]},g.addGeoMarker=function(){var t=this,e=new google.maps.Marker({map:this.map,animation:2,zIndex:h-2,icon:this.icons.dotGrey,shape:{type:"circle",circle:[9,9,9]},optimized:!1});return google.maps.event.addListener(e,"mousedown",function(){t.showIdentityPanel(this.uid)}),e},g.distanceMatrix=function(t,e,i,n){n=n||0;var r=$('#identities-overlay .identity[data-uid="'+t+'"]'),o=r.find(".detial"),c=o.find(".icon"),u=o.find(".distance");if(e&&i){var h=e.getPosition(),d=i.getPosition(),p=h.lat(),f=h.lng(),m=d.lat(),v=d.lng(),g=s(m,v,p,f),y=a(m,v,p,f),b=l(g);b.rotate=y,u.html(b.text),c.css("-webkit-transform","rotate("+y+"deg)"),c.attr("class","icon icon-arrow-"+(1>=n?"red":"grey")),o.css("visibility","visible")}else e?(c.hasClass("icon-dot-red")||c.hasClass("icon-dot-red")||c.attr("class","icon icon-dot"+(1>=n?"red":"grey")),u.html(1>=n?"":(n>=9?"9+":n)+'<span class="unit"></span>'),o.css("visibility","visible")):o.css("visibility","hidden")},g.fitBoundsWithDestination=function(t){var e=this.destinationPlace,i=this.myUserId==t,n=i?this.geoLocation:this.geoMarkers[t];if(n){var s=n.getPosition(),r=this.map;if(e){var o,a=e.getPosition(),l=this.fromLatLngToContainerPixel(a);i?o=this.calculateBoundsByCenter(s,[a]):(o=new google.maps.LatLngBounds,50>l.x&&(l=this.fromContainerPixelToLatLng(new google.maps.Point(l.x-50,l.y)),o.extend(l)),o.extend(s),o.extend(a)),r.fitBounds(o)}else(i||!r.getBounds().contains(s))&&(7>r.getZoom()&&r.setZoom(15),r.panTo(s))}},g.panToDestination=function(t){var e=this.map;7>e.getZoom()&&e.setZoom(15),e.panTo(t||this.destinationPlace.getPosition())},g.calculateBoundsByCenter=function(t,e){for(var i,n,s,r=new google.maps.LatLngBounds,o=[];n=e.shift();)i=this.fromLatLngToContainerPixel(n),o.push(i);for(var a,l,s=this.fromLatLngToContainerPixel(t),c=0;l=o.shift();)a=Math.sqrt(Math.pow(l.x-s.x,2)+Math.pow(l.y-s.y,2)),a>c&&(c=a);var u=this.fromContainerPixelToLatLng(new google.maps.Point(s.x-c-50,s.y-c-50)),h=this.fromContainerPixelToLatLng(new google.maps.Point(s.x+c+50,s.y+c+50));return r.extend(u),r.extend(t),r.extend(h),r},g.addBreadcrumbs=function(){var t="#b2b2b2",e=.8,i=new google.maps.Polyline({map:this.map,visible:!1,index:h-5,strokeOpacity:0,icons:[{icon:{path:"M0,0 a8,8 0 1,0 16,0 a8,8 0 1,0 -16,0 z",fillColor:t,fillOpacity:e,strokeColor:"#fff",strokeOpacity:.8,strokeWeight:1,scale:.5},fixedRotation:!0,repeat:"50px",offset:"0"}]});return i},g.MIN_PIXL=50,g.distanceMatrixPixl=function(t,e,i){i=i||50;var n=this.fromLatLngToContainerPixel(new google.maps.LatLng(t[0],t[1])),s=this.fromLatLngToContainerPixel(new google.maps.LatLng(e[0],e[1])),r=Math.sqrt(Math.pow(n.x-s.x,2)+Math.pow(n.y-s.y,2));return r>=i},g.showTextLabels=function(t,e,i){if(t){for(var n,s,r,o,a,l=Math.round(Date.now()/1e3),c=this.labels,u=this.map,d=e.slice(0),p=!0,f=0,m=120,g=0,y=0;r=d.shift();)if(o=10*Math.floor((l-r.t)/600),y!==o){if(y=o,o>m)break;a&&(p=this.distanceMatrixPixl(r.gps,a.gps)),o>f&&p&&(-1!=v.indexOf(o)||o>15)&&(f=o,n=c[g],n?s=n.marker:(s=new google.maps.Marker({map:u,zIndex:h-4,optimized:!1}),n=c[g]=new google.maps.TextLabel({map:u,zIndex:h-3}),n.marker=s),s&&(s.setPosition(this.toLatLng(r.gps[0],r.gps[1])),s.setIcon({path:"M0,0 a8,8 0 1,0 16,0 a8,8 0 1,0 -16,0 z",fillColor:i?"#FF7E98":"#b2b2b2",fillOpacity:.8,strokeColor:"#fff",strokeOpacity:.8,strokeWeight:1,scale:.5})),n.set("text",o+""),a=r,g++)}for(var b=c.length-1;b>g;b--)n=c[b],n&&n.setMap(null),c.splice(b,1)}},g.removeTextLabels=function(){for(var t,e=this.labels;t=e.shift();)t.setMap(null);e.length=0},g.updateBreadcrumbs=function(t){var e,i,n,s,r=[];if(e=this._breadcrumbs[t]){var o=e.positions.slice(0),a=o.slice(0);if(this.showTextLabels(t,o),i=this.breadcrumbs[t]){for(;n=a.pop();)s=n.gps,r.push(this.toLatLng(s[0],s[1]));i.setPath(r)}}},g.showBreadcrumbs=function(t){if(this._breadcrumbs[t]){var e,i=this.breadcrumbs,n=this.uid,s=i[t];if(delete this.uid,s||(s=i[t]=this.addBreadcrumbs()),s&&this.updateBreadcrumbs(t),t!==n)e=i[n],e&&(e.setMap(null),delete i[n],e=null,this.removeTextLabels()),s&&(s.setVisible(!0),this.uid=t);else if(s){var r=!s.getVisible();s.setVisible(r),r?this.uid=t:(s.setMap(null),delete i[t],s=null,this.removeTextLabels())}console.log("current breadcrumbs",t)}},g.addPoint=function(t,e){var i=this,n=google.maps,s=this.map,r=this.myIdentity,o=new n.Marker({map:s,animation:2,zIndex:h-5,icon:new n.MarkerImage(t.icon,new n.Size(48,68),new n.Point(0,0),new n.Point(12,34),new n.Size(24,34))}),a=n.event;return o.isDestination=e,a.addListener(o,"mousedown",function(e){if(e&&e.stop(),i.removeInfobox(this))return!1;var o=i.infobox=new n.InfoBox({content:i.infoWindowTemplate.replace("{{title}}",t.title).replace("{{description}}",t.description),maxWidth:200,pixelOffset:new n.Size(-100,-38),boxClass:"park",closeBoxMargin:"",closeBoxURL:"",alignBottom:!0,enableEventPropagation:!1,leftBoundary:60,zIndex:610,boxId:"place-editor",events:function(){var t=this;t.editing=!1,a.addDomListener(this.div_,"touchstart",function(){if(!t.editing){var e=this.querySelector(".info-windown"),i=this.querySelector(".title").innerHTML,n=this.querySelector(".description").innerHTML,s=document.createElement("input");s.type="text",s.value=i;var r=document.createElement("textarea");r.value=n,e.appendChild(s),e.appendChild(r),this.querySelector(".title").className="title hide",this.querySelector(".description").className="description hide",t.editing=!0}})}});o._marker=this,o.open(s,this),a.addListenerOnce(this,"mouseout",function(){if(o.editing){var t=o._marker.data,e=$("#place-editor input").val().trim(),n=$("#place-editor textarea").val().trim();t.title=e,t.description=n,t.updated_at=Math.round(Date.now()/1e3),t.updated_by=r.external_username+"@"+r.provider,$("#place-editor input, #place-editor textarea").remove(),$("#place-editor .title").text(e).removeClass("hide"),$("#place-editor .description").text(n).removeClass("hide"),i.controller.editPlace(t)}o.close(),delete o._marker,o=i.infobox=null})}),o},g.removeInfobox=function(t){var e,i=this.infobox;return i&&(e=i._marker,i.close(),delete i._marker,i=this.infobox=null,e===t)?!0:void 0},g.infoWindowTemplate='<div class="info-windown"><h2 class="title">{{title}}</h2><div class="description">{{description}}</div></div>',g.contains=function(){var t,e,i,n=this.map.getBounds(),s=google.maps,r=n.getSouthWest(),o=n.getNorthEast(),a=new s.LatLngBounds,l=this.geoMarkers,c=document.getElementById("identities")._ids||{};r=this.fromLatLngToContainerPixel(r),r=this.fromContainerPixelToLatLng(new s.Point(r.x+50,r.y)),a.extend(r),a.extend(o);for(t in l)e=l[t],i=e.getPosition(),this.containsOne(t,i,a,c);console.log("map zoom",this.map.getZoom())},g.containsOne=function(t,e,i,n,s){i||(i=this.map.getBounds()),n||(n=document.getElementById("identities")._ids||{}),i.contains(e)&&(s=n[t])?this.showTipline(t,s):this.hideTipline(t)},g.hideTiplines=function(){var t,e=this.tiplines;for(t in e)this.hideTipline(t)},g.updateTipline=function(t,e){var i=this.tiplines[t];i||(i=this.tiplines[t]=this.addTipline(t)),e&&this.containsOne(t,i._lastlatlng=e)},g.addTipline=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","polyline");return t.setAttribute("fill","none"),t.setAttribute("stroke","#b2b2b2"),t.setAttribute("stroke-width",1),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.setAttribute("style","-webkit-filter: drop-shadow(12px 12px 7px rgba(0,0,0,0.5));"),t.setAttributeNS(null,"display","none"),this.svgLayer.appendChild(t),t},g.showTipline=function(t,e){var i,n=this.tiplines[t];if(n){var s=[e[1],e[2]],r=[s[0]+13,s[1]],o=[s.join(","),r.join(",")].join(" "),i=this.fromLatLngToContainerPixel(n._lastlatlng);n.setAttribute("points",o+" "+i.x+","+i.y),n.setAttributeNS(null,"display","block")}},g.hideTipline=function(t){var e=this.tiplines[t];e&&e.setAttributeNS(null,"display","none")},g.updateGeoLocation=function(t,e){var i,n,s=this.geoLocation;if(!s){s=this.geoLocation=new google.maps.Marker({map:this.map,zIndex:h-1,visible:!0,animation:2,icon:this.icons.arrowGrey,shape:{type:"rect",rect:[0,0,22,22]},optimized:!1}),s._status=0;var r=JSON.parse(window.localStorage.getItem("position"));r&&(n=r.gps,s._status=1,i=this.toLatLng(1*n[0]+this.latOffset,1*n[1]+this.lngOffset),s.setPosition(i),this.map.setZoom(15),this.map.panTo(i))}e&&(n=e.gps,i=this.toLatLng(1*n[0]+this.latOffset,1*n[1]+this.lngOffset),s.setIcon(this.icons.arrowBlue),s.setPosition(i),2!==s._status&&(this.map.setZoom(15),this.map.panTo(i)),s._status=2,t&&e&&this.updatePositions({id:t+"",positions:[e]})),t&&(this.updated[t]=e||r),s._uid=t},g.switchGEOStyle=function(t){var e=this.geoLocation;e&&e.setIcon(this.icons["arrow"+(t?"Blue":"Grey")])},e}),define("maplabel",function(){function t(t){this.setValues(t);var e=this.span_=document.createElement("span");e.className="text-label",e.style.cssText="position: relative; left: -46%; top: -23px;white-space: nowrap;padding: 2px;";var i=this.div_=document.createElement("div");i.appendChild(e),i.style.cssText="position: absolute; display: none"}return t.prototype=new google.maps.OverlayView,t.prototype.onAdd=function(){var t=this.getPanes().overlayImage;t.appendChild(this.div_);var e=this;this.listeners_=[google.maps.event.addListener(this,"position_changed",function(){e.draw()}),google.maps.event.addListener(this,"text_changed",function(){e.draw()}),google.maps.event.addListener(this,"zindex_changed",function(){e.draw()})]},t.prototype.onRemove=function(){var t=this.marker;t&&(t.setMap(null),delete this.marker),this.div_.parentNode.removeChild(this.div_);for(var e=0,i=this.listeners_.length;i>e;++e)google.maps.event.removeListener(this.listeners_[e])},t.prototype.draw=function(){var t=this.getProjection(),e=this.marker?this.marker.getPosition():this.get("position"),i=t.fromLatLngToDivPixel(e),n=this.div_;n.style.left=i.x+"px",n.style.top=i.y+"px",n.style.display="block",n.style.zIndex=this.get("zIndex"),this.span_.innerHTML=""+this.get("text")},t}),define("infobox",function(){function t(t){t=t||{},google.maps.OverlayView.apply(this,arguments),this.content_=t.content||"",this.disableAutoPan_=t.disableAutoPan||!1,this.maxWidth_=t.maxWidth||0,this.pixelOffset_=t.pixelOffset||new google.maps.Size(0,0),this.position_=t.position||new google.maps.LatLng(0,0),this.zIndex_=t.zIndex||null,this.leftBoundary=t.leftBoundary||0,this.events=t.events||function(){},this.boxClass_=t.boxClass||"infoBox",this.boxId_=t.boxId||"infobox",this.boxStyle_=t.boxStyle||{},this.closeBoxMargin_=t.closeBoxMargin||"2px",this.closeBoxURL_=t.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",""===t.closeBoxURL&&(this.closeBoxURL_=""),this.infoBoxClearance_=t.infoBoxClearance||new google.maps.Size(1,1),void 0===t.visible&&(t.visible=void 0===t.isHidden?!0:!t.isHidden),this.isHidden_=!t.visible,this.alignBottom_=t.alignBottom||!1,this.pane_=t.pane||"floatPane",this.enableEventPropagation_=t.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null}return t.prototype=new google.maps.OverlayView,t.prototype.createInfoBoxDiv_=function(){var t,e,i,n=this,s=function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()},r=function(t){t.returnValue=!1,t.preventDefault&&t.preventDefault(),n.enableEventPropagation_||s(t)};if(!this.div_){if(this.div_=document.createElement("div"),this.setBoxStyle_(),void 0===this.content_.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:0!==this.maxWidth_&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(i=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-i.left-i.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_),!this.enableEventPropagation_){for(this.eventListeners_=[],e=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],t=0;e.length>t;t++)this.eventListeners_.push(google.maps.event.addDomListener(this.div_,e[t],s));this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",r),google.maps.event.trigger(this,"domready")}},t.prototype.getCloseBoxImg_=function(){var t="";return""!==this.closeBoxURL_&&(t="<img",t+=" src='"+this.closeBoxURL_+"'",t+=" align=right",t+=" style='",t+=" position: relative;",t+=" cursor: pointer;",t+=" margin: "+this.closeBoxMargin_+";",t+="'>"),t},t.prototype.addClickHandler_=function(){var t;""!==this.closeBoxURL_?(t=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(t,"click",this.getCloseClickHandler_())):this.closeListener_=null},t.prototype.getCloseClickHandler_=function(){var t=this;return function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),google.maps.event.trigger(t,"closeclick"),t.close()}},t.prototype.panBox_=function(t){var e,i,n=0,s=0;if(!t&&(e=this.getMap(),e instanceof google.maps.Map)){i=e.getBounds(),i.contains(this.position_)||e.setCenter(this.position_);var r=e.getDiv(),o=r.offsetWidth,a=r.offsetHeight,l=this.pixelOffset_.width,c=this.pixelOffset_.height,u=this.div_.offsetWidth,h=this.div_.offsetHeight,d=this.infoBoxClearance_.width,p=this.infoBoxClearance_.height,f=this.getProjection().fromLatLngToContainerPixel(this.position_),m=this.leftBoundary;-l+d+m>f.x?n=f.x+l-d-m:f.x+u+l+d>o&&(n=f.x+u+l+d-o+10),this.alignBottom_?-c+p+h>f.y?s=f.y+c-p-h:f.y+c+p>a&&(s=f.y+c+p-a):-c+p>f.y?s=f.y+c-p:f.y+h+c+p>a&&(s=f.y+h+c+p-a),(0!==n||0!==s)&&(e.getCenter(),e.panBy(n,s))}},t.prototype.setBoxStyle_=function(){var t,e;if(this.div_){this.div_.className=this.boxClass_,this.div_.id=this.boxId_,this.div_.style.cssText="",e=this.boxStyle_;for(t in e)e.hasOwnProperty(t)&&(this.div_.style[t]=e[t]);void 0!==this.div_.style.opacity&&""!==this.div_.style.opacity&&(this.div_.style.filter="alpha(opacity="+100*this.div_.style.opacity+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",null!==this.zIndex_&&(this.div_.style.zIndex=this.zIndex_)}},t.prototype.getBoxWidths_=function(){var t,e={top:0,bottom:0,left:0,right:0},i=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(t=i.ownerDocument.defaultView.getComputedStyle(i,""),t&&(e.top=parseInt(t.borderTopWidth,10)||0,e.bottom=parseInt(t.borderBottomWidth,10)||0,e.left=parseInt(t.borderLeftWidth,10)||0,e.right=parseInt(t.borderRightWidth,10)||0)):document.documentElement.currentStyle&&i.currentStyle&&(e.top=parseInt(i.currentStyle.borderTopWidth,10)||0,e.bottom=parseInt(i.currentStyle.borderBottomWidth,10)||0,e.left=parseInt(i.currentStyle.borderLeftWidth,10)||0,e.right=parseInt(i.currentStyle.borderRightWidth,10)||0),e},t.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},t.prototype.draw=function(){this.createInfoBoxDiv_();var t=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=t.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(t.y+this.pixelOffset_.height)+"px":this.div_.style.top=t.y+this.pixelOffset_.height+"px",this.div_.style.visibility=this.isHidden_?"hidden":"visible",this.events&&this.events()},t.prototype.setOptions=function(t){void 0!==t.boxClass&&(this.boxClass_=t.boxClass,this.setBoxStyle_()),void 0!==t.boxStyle&&(this.boxStyle_=t.boxStyle,this.setBoxStyle_()),void 0!==t.content&&this.setContent(t.content),void 0!==t.disableAutoPan&&(this.disableAutoPan_=t.disableAutoPan),void 0!==t.maxWidth&&(this.maxWidth_=t.maxWidth),void 0!==t.pixelOffset&&(this.pixelOffset_=t.pixelOffset),void 0!==t.alignBottom&&(this.alignBottom_=t.alignBottom),void 0!==t.position&&this.setPosition(t.position),void 0!==t.zIndex&&this.setZIndex(t.zIndex),void 0!==t.closeBoxMargin&&(this.closeBoxMargin_=t.closeBoxMargin),void 0!==t.closeBoxURL&&(this.closeBoxURL_=t.closeBoxURL),void 0!==t.infoBoxClearance&&(this.infoBoxClearance_=t.infoBoxClearance),void 0!==t.isHidden&&(this.isHidden_=t.isHidden),void 0!==t.visible&&(this.isHidden_=!t.visible),void 0!==t.enableEventPropagation&&(this.enableEventPropagation_=t.enableEventPropagation),this.div_&&this.draw()},t.prototype.setContent=function(t){this.content_=t,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),void 0===t.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+t:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(t)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px",void 0===t.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+t:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(t))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},t.prototype.setPosition=function(t){this.position_=t,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},t.prototype.setZIndex=function(t){this.zIndex_=t,this.div_&&(this.div_.style.zIndex=t),google.maps.event.trigger(this,"zindex_changed")},t.prototype.setVisible=function(t){this.isHidden_=!t,this.div_&&(this.div_.style.visibility=this.isHidden_?"hidden":"visible")},t.prototype.getContent=function(){return this.content_},t.prototype.getPosition=function(){return this.position_},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.getVisible=function(){var t;return t=void 0===this.getMap()||null===this.getMap()?!1:!this.isHidden_},t.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible")},t.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},t.prototype.open=function(t,e){var i=this;e&&(this.position_=e.getPosition(),this.moveListener_=google.maps.event.addListener(e,"position_changed",function(){i.setPosition(this.getPosition())})),this.setMap(t),this.div_&&this.panBox_()},t.prototype.close=function(){var t;if(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.eventListeners_){for(t=0;this.eventListeners_.length>t;t++)google.maps.event.removeListener(this.eventListeners_[t]);this.eventListeners_=null}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)},t}),define("mobilemiddleware",function(t,e,i){"use strict";var n=navigator.userAgent.match(/iPhone/);i.exports={setHtmlHeight:function(t,e,i){setTimeout(function(){window.scrollTo(0,0)},0),n||$("#app-main").addClass("app-box");var s=document.documentElement,r=window.innerHeight,o=t.app;r>=444?r=508:356>=r&&(r=420),o.screen={width:320,height:r,ios:420>=r?"iphone4":""},s.style.minHeight=r+"px",i()},checkStorageSupported:function(t,e,i){try{var n=window.localStorage;n&&(n.setItem("storage",0),n.removeItem("storage"))}catch(s){alert("EXFE cannot be used in private browsing mode.")}i()},cleanup:function(t,e,i){delete t._data_,delete t.smsToken,$("#app-body").css("height","auto"),$("#app-header").addClass("hide"),$("#app-footer").removeClass("ft-bg");var n=t.switchPageCallback;n?n():$("#app-body .page").addClass("hide"),delete t.switchPageCallback,i()},errorHandler:function(t,e){t.error={code:404},e.redirect("/")}}}),define("mobilecontroller",function(t,e,i){"use strict";var n=t("base"),s=t("store"),r=t("tween"),o=window._ENV_,a=o.api_url,l=o.apiv3_url,c=o.app_scheme,u=c+"://crosses/",h=(o.AMAP_KEY,window.openExfe),d=t("handlebars"),p=t("zepto"),f=t("util"),m=f.trim,v=f.parseId,g=navigator.userAgent.match(/iPad/),y=t("live"),b=function(t,e){return t.replace(e?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},w=Date.now||function(){return(new Date).getTime()},_="webkitTransform"in document.body.style,x=function(t,e){var i=6===e.length?"":"3d";t.style[_?"webkitTransform":"transform"]="matrix"+i+"("+e.join(",")+")"},k=function(){var t=s.get("livecard");if(!t){var e={id:"",name:"",avatar:"",bio:"",identities:[]};t={card:e,latitude:"",longitude:"",accuracy:"",traits:[]};var i=s.get("user");i&&(e.name=i.name,e.avatar=i.avatar_filename,e.bio=i.bio,e.identities=i.identities),s.set("livecard",t)
}return t.card.id="",t},C=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],S=[1,0,0,0,0,1,0,0,0,0,1,0,128,28,0,1],E=[1,0,0,0,0,1,0,0,0,0,1,0,128,0,0,1],T=0,P=function(){return"Controller-"+T++};e=i.exports={};var I=n.extend({initialize:function(t){this.cid=P(),this.initOptions(t),this.parseElement(),this.init(),I.caches[this.cid]=this},parseElement:function(){var t=this.element,e=this.options.template;if(t?this.element=t instanceof p?t:p(t):e&&(this.element=p(e)),!this.element)throw"element is invalid";this.element.attr("data-page-id",this.cid)},initOptions:function(t){this.setOptions(t);for(var e in t)"options"!==e&&(this[e]=t[e])},init:function(){},destory:function(){this.element.off(),this._destory()},_destory:function(){delete I.caches[this.cid],I.superclass.destory.call(this)},$:function(t){return this.element.find(t)}});I.caches=[],e.FooterController=I.extend({element:p("#app-footer"),init:function(){this.listen()},enableTimer:!0,listen:function(){var t=this,e=t.element;e.on("click.footer",".web-version",function(){window.location.href="/?ipad"+location.hash}).on("click.footer",".get-button button",function(t){return t.preventDefault(),h(),!1}).on("keydown.footer","#email",function(e){if(13===e.keyCode){var i=t.$("#email").val();t.addNotificationIdentity(i)}}).on("click.footer",".subscribe .btn_mail",function(){var e=m(t.$("#email").val());t.addNotificationIdentity(e)}),this.on("show",function(t,e,i,n){var s=t.height-96-(e?60:0);this.element.removeClass("hide"),this.element.css({position:"relative",top:s+"px"}),this.$(".action").addClass("hide"),this.$(".get-button").removeClass("hide"),g&&this.$(".web-version").removeClass("hide"),this.$(".error-info").toggleClass("hide",!n)}),this.on("reset-position",function(){var t=App.screen.height-96;this.element.removeClass("hide"),this.element.css({position:"absolute",top:t+"px"}),this.$(".action").addClass("hide"),this.$(".get-button").removeClass("hide"),g&&this.$(".web-version").removeClass("hide")}),this.on("show-from-cross",function(t,e,i){this.element.css({position:"relative",top:0}),this.element.addClass("ft-bg"),this.cross={exfee_id:t,token:e},this.$(".actions").addClass("action-cross"),this.$(".action").addClass("hide"),i||this.$(".subscribe").removeClass("hide"),this.element.removeClass("hide"),p("#app-footer").addClass("ft-bg"),this.$(".get-button").removeClass("hide"),g&&this.$(".web-version").removeClass("hide")}),this.on("redirect",function(t,e){window.launchApp(u+t,e)})},addNotificationIdentity:function(t,e,i){e=this.cross.exfee_id,i=this.cross.token;var n=v(t);return n&&"email"!==n.provider?(p("#email.email").attr("placeholder","Bad email Address."),void 0):(p.ajax({type:"POST",url:a+"/Exfee/"+e+"/AddNotificationIdentity"+"?token="+i,data:{provider:n.provider,external_username:n.external_username},success:function(t){t&&t.meta&&200===t.meta.code&&p(".subscribe").hide()},error:function(){alert("Failed, please retry later.")}}),void 0)}}),e.VerifyController=I.extend({init:function(){this.render(),this.listen()},render:function(){p("#app-verify").remove(),this.element.appendTo(p("#app-body"))},listen:function(){var t=this,e=this.resolveToken;this.on("show",function(i,n){setTimeout(function(){window.scrollTo(0,0)},14);var r=function(){i.error=!0,n.redirect("/")};this.element.removeClass("hide"),p("#app-body").css("height","100%");var o=s.get("tmp-user");if(o){for(var l=o.identities,c=0,u=l.length;u>c;++c){var h=l[c];if(h.id===e.identity_id){t.showIdentity(h),t.$(".done-info").removeClass("hide");break}}return s.remove("tmp-user"),s.remove("tmp-token"),App.controllers.footer.emit("reset-position"),void 0}var d=function(t){App.controllers.footer.emit("redirect",t,function(){var t=window.search.substr(1);t&&(t="&"+t),window.location="/?redirect"+t+window.location.hash})},f=e.user_id,m=e.token;p.ajax({type:"POST",url:a+"/Users/"+f+"?token="+m,data:{token:m},success:function(i){var n=i.meta;if(n&&200===n.code)for(var o=i.response.user,a=o.identities,l=0,c=a.length;c>l;++l){var u=a[l];if(u.id===e.identity_id){if(t.showIdentity(u),t.$(".done-info").removeClass("hide"),s.set("tmp-user",o),App.controllers.footer.emit("reset-position"),f&&m){var h="?token="+m+"&user_id="+f+"&identity_id="+u.id;d(h)}break}}else r()},error:function(){r()}})})},showIdentity:function(t){var e=this.$(".identity");e.find(".name").text(t.name),e.find(".avatar").attr("src",t.avatar_filename)}}),e.SetPasswordController=I.extend({init:function(){this.render(),this.listen()},render:function(){p("#app-setpassword").remove(),this.element.appendTo(p("#app-body"))},submitPassword:function(){var t=this,e=this.token,i=this.$(".set-button button"),n=this.$(".error-info"),s=this.$("#name"),r=this.$("#password"),o=m(s.val()),l=r.val();l.length>=4?(i.addClass("disabled").prop("disabled",!0),p.ajax({type:"POST",url:a+"/Users/ResetPassword",data:{token:e,name:o,password:l},success:function(e){var o=e.meta;if(o&&200===o.code){s.blur(),r.blur(),t.$(".password").addClass("hide"),t.$(".done-info").removeClass("hide"),n.html("").addClass("hide"),i.parent().addClass("hide");var a=e.response.authorization;a&&App.controllers.footer.emit("redirect","?token="+a.token+"&user_id="+a.user_id,function(){var t=window.location.search.substr(1);t&&(t="&"+t),window.location="/?redirect"+t+window.location.hash})}else 401===o.code&&(n.html('<span class="t">Token expired.</span> Please request to reset password again.').removeClass("hide"),r.prop("disabled",!0),i.parent().addClass("hide"));i.prop("disabled",!0)},error:function(){n.html("Failed to set password. Please try later.").removeClass("hide"),i.prop("disabled",!1)}})):n.html("Password must be longer than four!").removeClass("hide")},listen:function(){var t,e,i=this,n=this.element,r=this.resolveToken;n.on("touchstart.setpassword",".pass",function(){e&&(clearTimeout(e),e=void 0),t=w();var i=p(this).prev();i.prop("type","password")}).on("touchend.setpassword",".pass",function(i){if(w()-t>300){var n=p(this).prev();n.prop("type","text"),e=setTimeout(function(){n.prop("type","password")},500)}return i.preventDefault(),i.stopPropagation(),!1}).on("keydown.setpassword","#password",function(t){13===t.keyCode?i.submitPassword():i.$(".error-info").html("")}).on("touchstart.setpassword",".set-button button",function(){i.submitPassword()}),this.on("show",function(t,e){setTimeout(function(){window.scrollTo(0,0)},0);var i=function(){t.error=!0,e.redirect("/")};n.removeClass("hide"),p("#app-body").css("height","100%");var o=s.get("tmp-user");return o?(p(".identity .avatar").attr("src",o.avatar_filename),p(".identity .name").html(o.name),window.noExfeApp&&(p(".password").addClass("hide"),p(".set-button").addClass("hide"),p(".done-info").removeClass("hide")),App.controllers.footer.emit("reset-position"),s.remove("tmp-user"),s.remove("tmp-token"),void 0):(p.ajax({type:"POST",url:a+"/Users/"+r.user_id+"?token="+r.token,data:{token:r.token},success:function(t){var e=t.response.user;return t&&t.meta&&200===t.meta.code?(p(".identity .avatar").attr("src",e.avatar_filename),p(".identity .name").html(e.name),s.set("tmp-user",e),App.controllers.footer.emit("reset-position"),void 0):(i(),void 0)},error:function(){i()}}),void 0)})}}),e.HomeController=I.extend({init:function(){this.render(),this.listen()},render:function(){p("#app-home").length||this.element.appendTo(p("#app-body"))},listen:function(){var t=this,e=this.element;e.on("touchstart.home","#home-card",function(){t.stopAnimate(),t.emit("goto-live")}),this.on("goto-live",function(){App.request.switchPageCallback=function(){e.addClass("hide")},App.response.redirect("/#live")}),this.on("show",function(t,i){var n=t.height;this.$(".logo-box .inner").css("top",(n-300)/2+"px"),e.removeClass("hide"),E[13]=(n-64)/2,this.setHomeCard(E),i=!(!i||404!==i.code);var s=this.$(".title");s.find(".normal").removeClass("hide"),i&&setTimeout(function(){alert("Sorry. Your link is invalid or expired. Requested page was not found.")},14),this.$("#home-card").css("display","none")})},setHomeCard:function(t){var e=k(),i=e.card,n=i.name,s=i.avatar,r=this.$("#home-card");x(r[0],t),i&&(n||s)?(s||(s=n?a+"/avatar/default?name="+n:"/static/img/portrait_default.png"),s="url("+s+")"):s="",r.find(".avatar").css("background-image",s)},aopts:{o:1},createAnimate:function(){var t=this.aopts,e=document.getElementById("big-logo"),i=document.getElementById("home-card"),n=function(){e.style.opacity=t.o,i.style.opacity=1-t.o};this._a=new r.Tween(t).delay(1377).to({o:0},1377).easing(r.Easing.Cubic.InOut).onUpdate(n),this._b=new r.Tween(t).delay(1377).to({o:1},1377).easing(r.Easing.Cubic.InOut).onUpdate(n)},startAnimate:function(){this._a||this._b||this.createAnimate(),this._a.chain(this._b),this._b.chain(this._a),this._a.start()},stopAnimate:function(){var t=this.aopts,e=document.getElementById("big-logo"),i=document.getElementById("home-card");this._a.chain(),this._b.chain(),this._b.stop(),this._a.stop(),t.o=e.style.opacity=1,i.style.opacity=0}}),e.CrossController=I.extend({init:function(){this.render(),this.listen()},render:function(){p("#app-cross").remove(),this.element.appendTo(p("#app-body"))},listen:function(){var t=this,e=this.element,i=this.token,n=this.cross,s=t.$(".rsvp_toolbar");e.on("touchstart.cross",".portrait.me",function(){s.toggleClass("rsvp_toolbar_off",!s.hasClass("rsvp_toolbar_off"))}).on("touchstart.cross",".changename",function(){var e=prompt("Change my display name:");e?p.ajax({type:"POST",url:a+"/Identities/"+n.identity.id+"/Update"+"?token="+i,data:{name:e},success:function(e){e&&e.meta&&200===e.meta.code&&t.$(".name_me").html(b(e.response.identity.name))},error:function(){alert("Failed, please retry later.")}}):alert("Display name cannot be empty.")}).on("touchstart.cross",".rsvp.accepted, .rsvp.unavailable",function(){var e=p(this).hasClass("accepted")?"ACCEPTED":"DECLINED";t.rsvp(e)}).on("touchstart.cross",".inf_area .description",function(){var t=p(this),e=t.hasClass("clickable");if(e){var i=t.hasClass("limit");t.toggleClass("limit",!i),t.find(".xbtn-more .rb").toggleClass("hidden",i),t.find(".xbtn-more .lt").toggleClass("hidden",!i)}}),this.on("show",function(){e.removeClass("hide");var t=this.$(".inf_area .description");t.height()>130&&(t.addClass("limit clickable"),t.find(".xbtn-more").removeClass("hide"),t.find(".xbtn-more .rb").removeClass("hidden"))})},rsvp:function(t){var e=this.cross.identity.id,i=this.exfee_id,n=this.token,s=[{rsvp_status:t,identity_id:e,by_identity_id:e}];this.$(".rsvp_toolbar").addClass("rsvp_toolbar_off");var r=this.$(".portrait_rsvp_me").removeClass("accepted declined pending");switch(t){case"ACCEPTED":r.addClass("accepted");break;case"DECLINED":r.addClass("declined");break;default:r.addClass("pending")}p.ajax({type:"post",url:a+"/Exfee/"+i+"/Rsvp?token="+n,data:{rsvp:JSON.stringify(s)},success:function(){},error:function(){alert("RSVP failed!")}})}}),e.LiveController=I.extend({init:function(){this.render(),this.listen()},render:function(){p("#app-live").length?this.element=p("#app-live"):this.element.appendTo(p("#app-body"))},listen:function(){var t,e,i=this,n=this.element;n.on("touchstart.live","#card-name",function(t){t.stopPropagation(),setTimeout(function(){window.scrollTo(0,0)},0),this.focus()}).on("touchend.live",".live-form",function(t){t.stopPropagation(),p(t.target).hasClass("live-form")&&(n.find(".input-item").blur(),App.response.redirect("/"))}).on("keydown.live","#card-name",function(t){var e=t.keyCode,n=m(this.value);n&&13===e&&i.addEmailOrPhone(this,n)}).on("blur.live","#card-name",function(){var t=m(this.value);t?i.addEmailOrPhone(this,t):i.setCardName(this)}).on("keydown.live blur.live","#add-identity",function(t){var e=t.keyCode,n=m(this.value);(n&&13===e||"blur"===t.type)&&(i.addEmailOrPhone(this,n,!0),this.value="")}).on("keydown.live blur.live","#facebook-identity",function(t){var e=t.keyCode,n=m(this.value);(n&&13===e||"blur"===t.type)&&(n+="@facebook",i.addFacebook(this,n)&&p("#add-identity-facebook").addClass("hide"),this.value="")}).on("touchstart.live",".list .input-item",function(){p(this).next().removeClass("hidden")}).on("blur.live",".list .input-item",function(){p(this).next().addClass("hidden"),i.updateIdentityLi(this)}).on("touchstart.live",".list .delete",function(){var t,e=p(this).prev()[0],n=m(e.value),s=e.getAttribute("data-provider"),r="facebook"===s;r&&(n+="@facebook"),t=v(n),p(this).parent().remove(),t&&t.provider&&i.removeIdentity(t),r&&i.emit("show-add-facebook")}).on("touchstart.live",".btn-start",function(){var t=p(".list .input-item");t.each(function(){i.updateIdentityLi(this)});var e=document.getElementById("card-name");e.blur();var n=m(e.value);n?i.liveCard.card.name=n:i.setCardName(e),setTimeout(function(){i.inspectFields()&&(i.emit("post-card"),i.emit("live-gather"))},23)}).on("hold:live",".live-gather .card .avatar",function(){var t=this,e=t.parentNode,i=p(e).data("card"),n=e.style.transform||e.style.webkitTransform,s=n.match(/([\-\d\.]+)/g).slice(1),r=document.getElementById("card-tip"),o="";if(i&&i.identities){for(var a=0,l=i.identities.length;l>a;++a){var c=i.identities[a],u=c.provider,h=c.external_username,d="";"email"!==u&&"phone"!==u&&(u=u.substr(0,1).toUpperCase()+u.substr(1),d='<span class="provider">'+u+"</span>"),o+='<li><span class="external-username'+(d?"":" normal")+'">'+h+"</span>"+d+"</li>"}r.querySelector("ul").innerHTML=o;var f=r.clientHeight,m=~~s[12]-68,v=~~s[13]-(6+f),g=93;0>m?m=10:m+200>=320&&(m=110),(10===m||110===m)&&(g=~~s[12]+32-7-m),s[12]=m,s[13]=v-5,s[14]=7,x(r,s),r.querySelector(".ang").style.left=g+"px",r.querySelector(".bio").innerText=i.bio,r.className="card-tip"}}).on("touchstart.live",".live-gather .card .avatar",function(i){var n=p(this),s=250,r=i.touches.length;e=w(),t&&(clearTimeout(t),t=void 0),1===r&&r>=1&&(t=setTimeout(function(){n.trigger("hold:live")},s))}).on("touchend.live",".live-gather .card .avatar",function(){if(t&&(clearTimeout(t),t=void 0),250>w()-e){var i=p(this).parent();i.hasClass("card-me")||i.toggleClass("selected")}document.getElementById("card-tip").className="card-tip hidden"}).on("touchstart.live",".back",function(){i.$(".live-gather").addClass("hide"),App.response.redirect("/")}).on("touchstart.live",".live-gather",function(t){var e=t.target,i=p(".live-title h2"),n=i[0],s=i.hasClass("clicked");s&&(p(".wave").css("opacity",1),i.data("clicked",e===n||p.contains(n,e)).removeClass("clicked"),p(".live-tip").addClass("live-tip-close"))}).on("touchstart.live",".live-title h2",function(){var t=p(this),e=t.hasClass("clicked"),i=t.data("clicked");e||i||(p(this).addClass("clicked"),p(".wave").css("opacity",0),p(".live-tip").removeClass("live-tip-close")),t.data("clicked",!1)}).on("touchstart.live",".btn-confirm",function(){i.postContacts()}),this.on("show-add-email",function(){this.$("#add-identity").removeClass("hide")}),this.on("show-add-facebook",function(){this.$('.list input[data-provider="facebook"]').length||this.$("#add-identity-facebook").removeClass("hide")}),this.on("show",function(t){y.startGeo(),this.screen=t,p("#app-footer").addClass("hide"),this.element.removeClass("hide");var e=t.height;E[13]=(e-64)/2,x(this.$("#icard")[0],E),this.$(".live-form, .live-gahter").css("min-height",e),this.$(".live-form").removeClass("hide"),this.$("#live-discover").css("opacity",0),this.$("#card-form").css({opacity:0,"min-height":100*((e-100)/e)+"%"}),this.measurePositions(t.width,t.height-10,32,32),this.MAPS=this._MAPS.slice(0),this.$(".identities .list").empty(),this.liveCard=k(),this.updateMyCardForm(),this.startAnimate()}),this.on("post-card",function(){this.postMyCard()}),this.on("disabled-live-btn",function(t){this.$(".btn-start").toggleClass("disabled",t)}),this.on("live-gather",function(){this.$(".live-form").addClass("hide"),this.$(".live-gather").removeClass("hide"),this.$(".wave").addClass("start"),this.$(".live-gather").find(".card").remove();var t=this.liveCard.card,e=this.genCard(t,this.coords[0][0],0,0,!0,this.screen.ios).appendTo(this.$(".live-gather"));this.updateCard(e[0],t),this._others&&this.updateOthers()})},updateIdentityLi:function(t){var e,i=t.getAttribute("data-external-username"),n=t.getAttribute("data-provider"),s=t.getAttribute("data-name"),r="",o=m(t.value),a=!1,l=!1,c=!1;if(o)if("facebook"===n&&(o+="@facebook"),e=v(o),e&&e.provider){var u=this.findIdentity(e),h=e.provider===n&&e.external_username===i;u&&!h&&(t.value=r),u||h||(c=!0,a=!0)}else l=!0,a=!0;else l=!0,a=!0;l&&(t.setAttribute("data-name",r),t.setAttribute("data-external-username",r),t.setAttribute("data-provider",r),setTimeout(function(){alert("Invalid contact.")},14)),c&&(t.setAttribute("data-name",e.name),t.setAttribute("data-external-username",e.external_username),t.setAttribute("data-provider",e.provider),t.value=e.external_username,p(t).prev().text(this.aliasProvider(e.provider)),this.updateLiveCard(e,"+")),a&&this.updateLiveCard({name:s,external_username:i,provider:n},"-",!0),(a||c)&&this.emit("post-card")},postContacts:function(){},inspectFields:function(){var t=this.liveCard.card;return t.name&&t.identities.length},updateCardName:function(t){t.name&&(this.liveCard.card.name=document.getElementById("card-name").value=t.name,s.set("livecard",this.liveCard))},updateMe:function(t){var e,i=document.getElementById("icard"),n=i.getAttribute("data-url");n!==t.avatar&&(e=t.avatar,e||(e=t.name?a+"/avatar/default?name="+t.name:"/static/img/portrait_default.png"),n!==e&&(i.querySelector(".avatar").style.backgroundImage="url("+e+")",i.setAttribute("data-url",e)));var s=document.getElementById("card-bio");t.bio&&(s.innerText=t.bio),s.className=t.bio?"":"hide"},postMyCard:function(){s.set("livecard",this.liveCard);var t=this.liveCard.card;t.name&&t.identities.length&&y.init(t,p.proxy(this.liveCallback,this))},state:1,liveCallback:function(t){var e=this.liveCard,i=t.me;1===this.state&&i&&i.name&&i.identities.length&&(w()-i.timestamp>6e4&&this.updateCardName(i),this.updateMe(e.card=i),s.set("livecard",e)),this._others=t.others,this.updateOthers()},updateMyCardForm:function(){var t,e=this.liveCard,i=e.card,n=i.identities;if(n&&(t=n.length)){this.updateCardName(i),this.updateMe(i),this.postMyCard(),n=n.slice(0);for(var s,r;s=n.shift();)r=s.provider,("email"===r||"phone"===r||"facebook"===r)&&this.addIdentity(s,!0);this.emit("show-add-email"),this.emit("show-add-facebook")}else this.emit("disabled-live-btn",!0)},resetLiveCard:function(){this.emit("disabled-live-btn",!0),s.clear("livecard"),this.liveCard=k()},findIdentity:function(t){var e=this.liveCard.card,i=e.identities,n=i.length;if(n)for(var s=0;n>s;++s){var r=i[s];if(r.provider===t.provider&&r.external_username===t.external_username)return!0}return!1},updateLiveCard:function(t,e,i){var n=this.liveCard.card,r=n.identities;if("+"===e)r.push(t);else{for(var o=0,a=r.length;a>o;++o){var l=r[o];if(l.provider===t.provider&&l.external_username===t.external_username){r.splice(o,1);break}}i||0!==r.length||this.resetLiveCard()}s.set("livecard",this.liveCard)},setCardName:function(t){var e=this.packedIdentities();if(e.length){var i=e[0],n="",s=i.external_username,r=i.provider;n="phone"===r?"Anonym_"+s.slice(s.length-4):s.split("@")[0],this.liveCard.card.name=t.value=n,t.setAttribute("placeholder","Name"),p(t).addClass("normal")}},addFacebook:function(t,e){var i=v(e),n=i.provider;return n&&"facebook"===n&&!this.existsByIdentity(i)?(this.addIdentity(i),!0):!1},addEmailOrPhone:function(t,e,i){i=!i;var n=v(e),s=n.provider;!s||"email"!==s&&"phone"!==s||this.existsByIdentity(n)||(this.addIdentity(n),i&&this.setCardName(t)),i&&(this.emit("show-add-email"),this.emit("show-add-facebook")),this.emit("post-card")},aliasProvider:function(t){return"email"===t?t="Email":"phone"===t?t="Mobile":"facebook"===t&&(t="Facebook"),t},genIdentity:function(t){var e=d.compile(p("#live-li-identity-tmpl").html()),i=t.provider;i=this.aliasProvider(i);var n=p(e({provider_alias:i,identity:t}));return n},resetCard:function(){this.state=0,this.$("#icard").removeAttr("data-url").find(".avatar").css("background",""),this.$("#card-name").attr("placeholder","Your email or mobile no.").removeClass("normal").val(""),this.$("#add-identity").addClass("hide"),this.$("#add-identity-facebook").addClass("hide")},removeIdentity:function(t){var e=this.$(".identities .list li");0===e.length?(this.resetCard(),this.emit("disabled-live-btn",!0)):"facebook"===t.provider&&this.emit("show-add-facebook"),this.updateLiveCard(t,"-"),this.emit("post-card")},addIdentity:function(t,e){e=!e,this.state=1;var i=this.$(".identities .list"),n=this.genIdentity(t);i.append(n),this.emit("disabled-live-btn",!1),e&&(this.updateLiveCard(t,"+"),this.emit("post-card"))},packedIdentities:function(){for(var t,e,i,n,s,r=this.$(".identities .list").find("input"),o=0,a=r.length,l=[];a>o;++o)t=r.eq(o),e=t.attr("data-provider"),i=m(r.eq(o).val()),i&&("facebook"===e&&(i+="@facebook"),n=v(i),s=n.provider,!s||"email"!==s&&"phone"!==s&&"facebook"!==s||l.push(n));return l},existsByIdentity:function(t){var e,i=this.packedIdentities(),n=t.external_username,s=t.provider;if(0===i.length)return!1;for(;e=i.shift();)if(e.external_username===n&&e.provider===s)return!0;return!1},coords:"".split(),_MAPS:[[1,0],[1,1],[1,2],[2,0],[2,1],[2,2],[2,3],[3,0],[3,1],[3,2],[3,3]],MAPS:"".split(),measurePositions:function(t,e,i,n){var s=this.coords;s[0]=[[.5*t-i,.88*e-n]],s[1]=Array(3),s[1][0]=[.25*t-5-i,.66*e+30-n],s[1][1]=[.5*t-i,.66*e-n],s[1][2]=[.75*t+5-i,.66*e+30-n],s[2]=Array(4),s[2][0]=[.125*t+5-i,.44*e+40-n],s[2][1]=[.375*t-i,.44*e-n],s[2][2]=[.625*t-i,.44*e-n],s[2][3]=[.875*t-5-i,.44*e+40-n],s[3]=Array(4),s[3][0]=[.125*t-i,.22*e+40-n],s[3][1]=[.375*t-i,.22*e-n],s[3][2]=[.625*t-i,.22*e-n],s[3][3]=[.875*t-i,.22*e+40-n]},genCard:function(t,e,i,n,s,r){var o=d.compile(p("#live-card-tmpl").html()),a=C.slice(0);a[12]=e[0],a[13]=e[1];var l=p(o({g:i,i:n,matrix:a.join(","),"class":(s?"card-me":"card-other hide")+("iphone4"===r?" card-iphone4":""),card:t}));return l.data("card",t),l},addCard:function(t){var e=this.MAPS;if(!e||0===e.length)return!1;var i=e.shift(),n=i[0],s=i[1],o=this.coords[n][s],a=this.genCard(t,o,n,s,!1,this.screen.ios),l=a[0],c=l.style,u=C.slice(0);u[0]=u[5]=0,u[12]=o[0],u[13]=o[1],a.data("card",t),this.$(".live-gather").append(a),new r.Tween({o:0}).to({o:1},250).easing(r.Easing.Bounce.In).onStart(function(){x(l,u),a.removeClass("hide")}).onUpdate(function(){c.opacity=this.o,u[0]=u[5]=this.o,x(l,u)}).onComplete(function(){r.remove(this)}).start()},delCard:function(t){var e=this.MAPS,i=t.getAttribute("data-g"),n=t.getAttribute("data-i"),s=C.slice(0),o=this.coords[i][n],a=t.style;s[12]=o[0],s[13]=o[1],new r.Tween({o:1}).to({o:0},250).easing(r.Easing.Bounce.Out).onUpdate(function(){a.opacity=this.o,x(t,s)}).onComplete(function(){e.unshift([i,n]),t.parentNode.removeChild(t),r.remove(this)}).start()},updateCard:function(t,e){var i=t.getAttribute("data-url"),n="";i&&i===e.avatar||(n=e.avatar,n||(n=e.name?a+"/avatar/default?name="+e.name:"/static/img/portrait_default.png"),i!==n&&(t.querySelector(".avatar").style.backgroundImage="url("+n+")",t.setAttribute("data-url",n))),t.querySelector(".name").innerText=e.name,p(t).data("card",e)},updateOthers:function(){for(var t,e,i,n,s=this._others,r=document.querySelectorAll(".card-other"),o=r.length,a=0;o>a;++a)t=r[a],e=t.getAttribute("id"),e in s||this.delCard(t);for(i in s)n=s[i],t=document.getElementById(n.id),t?this.updateCard(t,n):this.addCard(n)},createAnimate:function(){var t=this.$("#icard")[0],e=this.$("#card-form")[0],i=this.$("#live-discover")[0],n=E[13],s=S[13],o=E.slice(0);this.a=new r.Tween({o:0}).to({o:1},500).easing(r.Easing.Cubic.In).onUpdate(function(){i.style.opacity=this.o,o[13]=(n-s)*(1-this.o)+s,x(t,o)}),this.b=new r.Tween({o:0}).delay(250).to({o:1},500).onUpdate(function(){e.style.opacity=this.o})},startAnimate:function(){this.a||this.b||this.createAnimate(),this.a.start(),this.b.start()},stopAnimate:function(){this.a.stop(),this.b.stop()}});var L=t("routexstream");L.geoService,e.RouteXController=I.extend({init:function(){this.render(),this.listen()},render:function(){p("#app-routex").remove(),this.element.appendTo(p("#app-container")),this.loadMaps()},listen:function(){var t=this,e=t.element,i=p(window),n=t.$("#my-info"),r=t.$("#open-exfe"),o=t.$("#locate"),a=!1;i.on("orientationchange",function(){var t=i.height();i.width(),o.css("-webkit-transform","translate3d(0, 0, 0)"),r.css("-webkit-transform","translate3d(0, 0, 0)"),p("#identities").css("max-height",60*Math.round(t/60)-60-100+5)});var c=function(e,i){var n=t.checkGPSStyle();if(t.mapReadyStatus){var s=t.mapController.myUserId;i&&t.mapController.showBreadcrumbs(s),t.mapController.fitBoundsWithDestination(s)}2===n||1===n&&t.startStream()};e.on("tap.maps",function(e){t.tapElement&&e.target!==t.tapElement&&!p.contains(n[0],e.target)&&(n.addClass("hide"),t.tapElement=null)}),e.on("tap.maps","#locate",c),e.on("touchstart.maps","#isme .avatar",function(e){return c(e,!0),t.tapElement===this?(n.addClass("hide"),t.tapElement=null,!1):(n.hasClass("hide")&&n.removeClass("hide"),n.css("-webkit-transform","translate3d(50px, 6px, 233px)"),t.tapElement=this,void 0)}),e.on("touchstart.maps","#nearby .geo-marker",function(e){if(e.preventDefault(),t.mapReadyStatus){var i=p(this).data("uid");t.mapController.showIdentityPanel(i)}}),e.on("touchstart.maps","#other-info .please-update",function(){var e=p(this),i=e.data("status");if(!i){var n=e.data("external-username"),s=e.data("provider");e.data("status",!0),p.ajax({type:"POST",url:l+"/routex/notification/crosses/"+t.cross_id+"/"+n+"@"+s+"?token="+t.token,success:function(){},error:function(){},complete:function(){e.data("status",!1)}})}}),e.on("touchstart.maps","#my-info .discover",function(){n.addClass("hide"),t.tapElement=null,p("#shuidi-dialog").removeClass("hide")}),e.on("touchstart.maps","#shuidi-dialog",function(t){"shuidi-dialog"===t.target.id&&(t.stopPropagation(),p("#shuidi-dialog").addClass("hide"))}),e.on("touchstart.maps","#shuidi-dialog .app-btn",function(e){e.preventDefault();var i="",n=[];return t.cross&&(i+=t.cross.id),t.myUserId&&t.token&&(n.push("user_id="+t.myUserId),n.push("token="+t.token)),t.myIdentityId&&n.push("identity_id="+t.myIdentityId),n.length&&(i+="?"+n.join("&")),console.log(u+i),h(u+i),!1}),e.on("touchstart.maps","#shuidi-dialog .notify-ok",function(e){e.preventDefault();var i=p("#notify-provider").val();return t.addNotificationIdentity(i),!1}),e.on("tap.maps","#identities .avatar",function(){if(!a){var e=p(this),i=e.parent().parent(),n=i.data("uid");t.mapReadyStatus&&(t.mapController.showBreadcrumbs(n),t.mapController.fitBoundsWithDestination(n))}}),e.on("tap.maps","#open-exfe",function(){console.log("remove cats..."),s.remove("cats"),s.remove("offset-latlng"),s.remove("authorization")});var d=e.find("#identities");d.on("scroll.maps",function(){n.hasClass("hide")||n.addClass("hide");var e=p(this).find(".avatar"),i=this.getBoundingClientRect(),s=i.height,r=(this.scrollTop,i.top),o=s+r,a=this._ids={};e.each(function(t){var e=this.getBoundingClientRect(),i=p(this).parents(".identity").data("uid"),n=e.height/2+e.top;n>=r&&o>=n&&(a[i]=[t,46,n])}),t.mapReadyStatus&&t.mapController&&t.mapController.contains(),console.log(i,a)}),e.on("touchmove.maps","#identities-overlay",function(t){t.stopPropagation(),t.preventDefault()}),e.on("touchmove",".info-windown",function(t){t.preventDefault()});var f,m=0,v=0;d.on("touchstart.maps",function(t){a=!1,m=t.pageY,v=this.scrollTop}),d.on("touchend.maps",function(){f&&clearTimeout(f),f=setTimeout(function(){a=!1},233)}),d.on("touchmove.maps",function(t){a=!0,t.preventDefault(),this.scrollTop=m-t.pageY+v}),t.on("show",function(){p("html, body").css({"min-height":i.height()}),console.log("This is Smith-Token.",t.isSmithToken),i.trigger("orientationchange"),t.createIdentitiesList(),t.streaming()})},updateExfeeName:function(){this.element.find("#exfee-name").text(this.cross.exfee.name)},createFreeIdentitiesList:function(t){var e,i='<li data-identity-id="{{id}}" data-free="{{free}}" data-uid="{{external_username}}@{{provider}}"><img src="{{avatar_filename}}" alt="" class="avatar{{is_free}}" /><div class="name">{{external_username}}</div></li>',n=this.element.find("#free-identities .identities");for(t=t.slice(0);e=t.shift();)n.append(i.replace("{{id}}",e.id).replace("{{avatar_filename}}",e.avatar_filename).replace(/\{\{external_username\}\}/g,e.external_username).replace("{{provider}}",e.provider).replace("{{is_free}}",(e.free?" ":" no-")+"free").replace("{{free}}",e.free))},loadMaps:function(){var e=this,i=t("routexmaps"),n=this.mapController=new i({url:"//maps.googleapis.com/maps/api/js?sensor=false&language=zh_CN&v=3&callback=_loadmaps_",mapDiv:this.$("#map")[0],mapOptions:{zoom:5},svg:this.$("#svg")[0],callback:function(){e.mapReadyStatus=!0,e.mapController.updateGeoLocation(n.myUserId,e.position)}});n.myUserId=this.myUserId,n.myIdentity=this.myIdentity,this.setLatLngOffset(),n.tracking=!0,n.load(),n.controller=e,this.token&&this.cross_id&&p.ajax({url:l+"/routex/breadcrumbs/crosses/"+this.cross_id+"?coordinate=mars&token="+this.token,type:"GET",dataType:"json",success:function(t){var e=t&&t.length;if(e){var i,s,r;for(r=0;e>r;++r)i=t[r],s=i.id.split("@")[0],n._breadcrumbs[s]?n._breadcrumbs[s].positions=[].contact(i.positions,n._breadcrumbs[s].positions):n._breadcrumbs[s]=i}}})},mapReadyStatus:!1,editPlace:function(t){t&&p.ajax({type:"POST",url:l+"/routex/geomarks/crosses/"+this.cross_id+"/location/"+t.id+"?coordinate=mars&token="+this.token+"&_method=PUT",data:JSON.stringify(t),success:function(t){console.log(t)},error:function(t){console.log(t)}})},setLatLngOffset:function(){var t=s.get("offset-latlng");t&&this.mapController.setOffset(t)},streaming:function(){if(this.cross_id&&this.token){var t={save_breadcrumbs:!0,after_in_seconds:7200};p.ajax({type:"POST",url:l+"/routex/users/crosses/"+this.cross_id+"?token="+this.token,data:JSON.stringify(t),success:function(t){console.log("success",t)},error:function(t){console.log("error",t)}})}var e=this;this.initStream(),this.startStream(),console.log("start streaming"),console.log("start monit"),this.timer=setInterval(function(){e.mapReadyStatus&&(console.log(new Date),e.mapController.monit())},1e3)},_cache:[],initStream:function(){var t=this,e=this._cache;L.init(t.cross.id,t.token,function(i){if(t.mapReadyStatus&&t.mapController){if(t.mapController.myUserId||(t.mapController.myUserId=t.myUserId),e.length)for(var n;n=e.shift();)t.mapController.draw(n);t.mapController.draw(i)}else e.push(i)},function(t){console.log(t)},function(){t.trackGeoLocation()})},addNotificationIdentity:function(t,e,i){e=this.cross.exfee.id,i=this.token;var n=v(t);return n&&"email"!==n.provider&&"phone"!==n.provider?(p("#notify-provider.email").attr("placeholder",""),void 0):(p.ajax({type:"POST",url:a+"/Exfee/"+e+"/AddNotificationIdentity"+"?token="+i,data:{provider:n.provider,external_username:n.external_username},success:function(t){t&&t.meta&&200===t.meta.code&&p("#shuidi-dialog").addClass("hide")},error:function(){alert("Failed, please retry later.")}}),void 0)},startStream:function(){var t=this;t.switchGPSStyle(0),L.stopGeo(),L.startGeo(function(e){t.position={gps:[e.latitude+"",e.longitude+"",e.accuracy],t:e.timestamp},s.set("position",t.position),t.switchGPSStyle(2),t.trackGeoLocation()},function(e){t.switchGPSStyle(1),console.log(e.status,e),L.stopGeo(),t.mapController&&t.mapController.switchGEOStyle(0)})},checkGPSStyle:function(){return~~this.$("#locate").attr("data-status")},switchGPSStyle:function(t,e){0===t?e="load":1===t?e="grey":(t=2,e="blue"),this.$("#locate").removeClass().addClass(e).attr("data-status",t)},trackGeoLocation:function(){var t=this.mapController,e=this.position,i=this.mapReadyStatus;i&&t&&(console.log("tracking"),this.setLatLngOffset(),t.updateGeoLocation(this.myUserId,e))},updateMe:function(t){this.myIdentity=t,console.log("my identity",this.myIdentity);var e=this.$("#isme");e.attr("data-uid",t.connected_user_id),e.attr("data-name",t.name),e.find("img").attr("src",t.avatar_filename),e.data("identity",t)},updateNotifyProvider:function(t){if(t.length)for(var e,i;e=t.shift();)if(i=v(e),i&&("phone"===i.provider||"email"===i.provider)){p("#notify-provider").val(i.external_username);
break}},createIdentitiesList:function(){for(var t,e,i=this.cross.exfee,n=this.$("#identities"),s=this.myUserId,r=(this.myIdentityId,this.smith_id),o=i.invitations.slice(0);t=o.shift();)if(e=t.identity,r!==e.id)if(s!==e.connected_user_id){var a=p('<div class="identity"><div class="abg"><img src="" alt="" class="avatar"></div><div class="detial"><i class="icon icon-dot-grey"></i><span class="distance"></span></div></div>');a.attr("data-uid",e.connected_user_id),a.attr("data-name",e.name),a.find("img").attr("src",e.avatar_filename),n.append(a),a.data("identity",e)}else this.myUserId=e.connected_user_id,this.updateMe(e),this.updateNotifyProvider(t.notification_identities.slice(0));window.getComputedStyle(n[0]).webkitTransform,n.parent().css("-webkit-transform","translate3d(0, 0, 0)"),console.log("trigger handler scroll.maps"),p("#identities").triggerHandler("scroll")}})}),define("mobileroutes",function(t,e,i){"use strict";var n=window._ENV_,s=t("store"),r=t("handlebars"),o=t("humantime"),a=function(t){var e=o.printEFTime(t,"X");return e},l=t("mobilecontroller"),c=l.HomeController,u=l.SetPasswordController,h=l.VerifyController,d=l.CrossController,p=l.LiveController,f=l.RouteXController,m=function(t,e,i,n,o,l){n||(n={});var c=i.response,u=c.cross,h={id:u.id,title:u.title,description:u.description.replace(/\r\n|\r|\n/g,"<br />"),time:{title:"Sometime",content:"To be decided"},place:{title:"Somewhere",description:"To be decided"},background:"default.jpg",read_only:!!c.read_only,change_name:!1},p=u.time;p&&p.begin_at&&p.begin_at.timezone?h.time=a(p):h.time.tobe="tobe";var f=u.place;f&&f.title&&(h.place={title:f.title,description:f.description.replace(/\r\n|\r|\n/g,"<br />")});var m=f.lat,v=f.lng;if(m&&v){var g=window.devicePixelRatio>=2?2:1;h.place.map="https://maps.googleapis.com/maps/api/staticmap?center="+m+","+v+"&markers=icon%3a"+encodeURIComponent("http://img.exfe.com/web/map_pin_blue.png")+"%7C"+m+","+v+"&zoom=13&size=290x100&maptype=road&sensor=false&scale="+g,h.place.href="http://maps.google.com/maps?daddr="+encodeURIComponent(h.place.title)+"@"+m+","+v}else h.place.tobe="tobe";var y,b=u.widget;if(b&&(y=b.length))for(var w=0;y>w;++w)if("Background"===b[w].type){h.background=b[w].image;break}var _=0,x=0,k=c.authorization;k?(_=k.user_id,c.browsing_identity&&(x=c.browsing_identity.id)):c.browsing_identity&&c.browsing_identity.connected_user_id&&(_=c.browsing_identity.connected_user_id,x=c.browsing_identity.id),c.cross_access_token&&(l=n[o]=c.cross_access_token,s.set("cats",n));for(var C=u.exfee.invitations,S=[],E={ACCEPTED:[],INTERESTED:[],NORESPONSE:[],IGNORED:[],DECLINED:[]},T=!1,P=0,I=C.length;I>P;++P){var L=C[P],M=_&&_===L.identity.connected_user_id||x===L.identity.id,O=_&&_===L.identity.connected_user_id&&x===L.identity.id,N="pending",A=L.rsvp_status;(O||"NOTIFICATION"!==A)&&("ACCEPTED"===A?N="accepted":"DECLINED"===A&&(N="declined"),L.rsvp_style=N,M?(T="pending"===N,L.is_me=!0,x=L.identity.id,x!==L.invited_by.id&&(h.inviter=L.invited_by),x!==L.by_identity.id&&(T=!0),L.identity.isphone="phone"===L.identity.provider,h.identity=L.identity,E.ACCEPTED.unshift(L)):L.rsvp_status in E&&E[L.rsvp_status].push(L))}h.hide_rsvp=!T,S=[].concat(E.ACCEPTED,E.INTERESTED,E.NORESPONSE,E.IGNORED,E.DECLINED),h.invitations=[],I=S.length;for(var D=0;I>D;)h.invitations.push(S.splice(0,5)),D+=5;I=h.invitations.length;var H=h.invitations[I-1],B=H.length;if(B&&5>B)for(;5-B++;)H.push(void 0);var R="";_&&(k?(R=h.id+"?user_id="+_+"&token="+k.token+"&identity_id="+x,l=k.token,s.set("authorization",k)):(k=s.get("authorization"),k&&k.user_id===_&&(R=h.id+"?user_id="+_+"&token="+k.token+"&identity_id="+x,l=k.token))),l&&h.identity.isphone&&(h.change_name=!0);var z=t.app,j=z.controllers,F=j.cross;F&&F.destory();var U=r.compile($("#cross-tmpl").html());F=z.controllers.cross=new d({options:{template:U(h)},cross:h,exfee_id:u.exfee.id,token:l}),F.emit("show"),z.controllers.footer.emit("show-from-cross",u.exfee.id,l,h.read_only,R)},v=i.exports={index:function(t){var e=t.error,i=t.app,n=i.controllers,s=n.home,r=n.footer,o=i.screen;s||(s=i.controllers.home=new c({options:{template:$("#home-tmpl").html()}})),document.title="EXFE - The group utility for gathering.",s.emit("show",o,e),r.emit("show",o,!1,!1,e===!0),delete t.error,i.currPageName="HOME"},verify:function(t,e){var i=t.session,n=i.resolveToken,s=t.app;$("#app-header").removeClass("hide");var r=new h({options:{template:$("#verify-tmpl").html()},resolveToken:n});r.emit("show",t,e),s.currPageName="VERIFY"},setPassword:function(t,e){var i=t.session,n=i.resolveToken,s=t.app;$("#app-header").removeClass("hide");var r=new u({options:{template:$("#setpassword-tmpl").html()},resolveToken:n,token:n.origin_token});r.emit("show",t,e),s.currPageName="SET_PASSWORD"},resolveToken:function(t,e){var i=t.app,s=t.params[0],r=t._data_=n._data_,o=t.session;o.resolveToken=r;var a=o.resolveToken.action;"VERIFIED"===a?v.verify(t,e):"INPUT_NEW_PASSWORD"===a&&(o.resolveToken.origin_token=s,v.setPassword(t,e)),i.currPageName="RESOLVE_TOKEN"},crossPhoneToken:function(t,e){var i=t.app,r=t.params,o=r[2],a=s.get("cats"),l=a&&a[o],c=t._data_=n._data_;m(t,e,c,a,o,l),i.currPageName="CROSS"},crossToken:function(t,e){var i=t.app,r=t.params[1],o=s.get("cats"),a=t._data_=n._data_,l=o&&o[r];m(t,e,a,o,r,l),i.currPageName="CROSS"},live:function(t){var e=t.app,i=e.controllers,n=i.live;n&&n.destory(),n=e.controllers.live=new p({options:{template:$("#live-tmpl").html()}}),n.emit("show",e.screen,e.ios),e.currPageName="LIVE"},routex:function(t){document.title="";var e=t.app,i=t.params[0],r=n._data_.response,o=n._data_.tokenInfos,a=r.cross,l=(r.action,r.cross_access_token),c=r.browsing_identity,u=s.get("cats")||{},h=u&&u[i];l&&(h=u[i]=l,s.set("cats",u));var d=e.controllers.routex=new f({options:{template:$("#routex-tmpl").html()},lastGPS:s.get("position"),cross:a,cross_id:a&&a.id,ctoken:i,token:h||o[0]||i,myIdentityId:c&&c.id||o[1]||0,myUserId:c&&c.connected_user_id||0,smith_id:window._ENV_.smith_id,isSmithToken:!!window._ENV_.smith_id});d.emit("show")}}}),define(function(t){"use strict";var e=t("tween"),i=t("af"),n=i.request,s=t("mobilemiddleware"),r=t("mobilecontroller").FooterController,o=t("mobileroutes"),a=t("lightsaber"),l=window.App=a();l.use(s.setHtmlHeight),l.use(s.cleanup),l.initRouter(),l.use(s.errorHandler),l.request.enableFullUrlPath=!0,l.controllers={},l.controllers.footer=new r({App:l}),l.get(/^\/+(?:\?)?#{0,}$/,o.index),l.get(/^\/+(?:\?)?#live\/?$/,o.live),l.get(/^\/+\?(?:(?:redirect)&)?t=([a-zA-Z0-9]{3,})$/,function(t,e){var i=window._ENV_._data_,n=i.action;t.session.resolveToken=i,"VERIFIED"===n?o.verify(t,e):"INPUT_NEW_PASSWORD"===n&&o.setPassword(t,e)}),l.get(/^\/+(?:\?(?:redirect)?)?#token=([a-zA-Z0-9]{64})\/?$/,o.resolveToken),l.get(/^\/+(?:\?(?:redirect)?)?#!([1-9][0-9]*)\/([a-zA-Z0-9]{4})\/?$/,o.crossPhoneToken),l.get(/^\/+(?:\?(?:redirect)?)?#!token=([a-zA-Z0-9]{32})\/?$/,o.crossToken),l.get(/^\/+(?:\?(?:redirect)?)?#!token=([a-zA-Z0-9]{4,})\/routex\/?$/,o.routex),l.get(/^\/+!token=([a-zA-Z0-9]{4,})\/routex\/?$/,o.routex),l.get(/^\/+!\d+\/routex\/?\?.*$/,o.routex),l.on("launched",function(){function t(){n(t),e.update()}t()})});