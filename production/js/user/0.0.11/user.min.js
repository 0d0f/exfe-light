<<<<<<< HEAD
define("user",function(e){"use strict";function i(e){var i,t=r("#app-user-menu"),a=r("#app-user-name"),n=a.find("span"),s=t.find(".dropdown-wrapper"),d=s.find(".user-panel"),o="/#"+l.printExtUserName(e.identities[0]);r("#app-browsing-identity").remove(),a.attr("href",o),n.text(e.name||e.nickname).removeClass("browsing-identity"),i=g.compile(m.normal),d.length&&d.remove(),e.profileLink=o,e.verifying=1===e.identities.length&&"VERIFYING"===e.identities[0].status,s.append(i(e)),delete e.profileLink,delete e.verifying}function t(e){var i,t=r("#app-user-menu"),a=r("#app-user-name"),n=a.find("span"),s=t.find(".dropdown-wrapper"),d=s.find(".user-panel"),o=e.browsing;o.isBrowsing=!0,r("#app-browsing-identity").remove(),r("#app-tmp").append(r('<div id="app-browsing-identity">').data("settings",e).attr("data-widget","dialog").attr("data-dialog-type","browsing_identity")),a.attr("href",location.href),n.html("Browsing as: <em>"+(o.name||o.nickname)+"</em>").addClass("browsing-identity"),i=g.compile(m.browsing_identity),d.length&&d.remove(),s.append(i(e)),r("#app-user-menu").find(".setup").data("source",{browsing:o,originToken:e.invitation_token,tokenType:e.tokenType,forward:e.forward,page:e.page})}function a(e,i){e=!!e;var t=r(document.body),a=r("#app-menubar"),n=r("#app-main");i||n.empty(),t.toggleClass("hbg",e),a.toggleClass("hide",e)}function n(e){e=!!e;var i=r("#app-user-menu"),t=r("#app-signin");i.toggleClass("hide",!e),t.toggleClass("hide",e)}function s(e){for(var i,t,a,n,s=u.get("identities")||[],r=e.slice(0);n=s.shift();){for(i=!1,t=0;(a=e[t++])&&!(i=n.external_username===a.external_username););i||r.push(n)}u.set("identities",r)}var r=e("jquery"),d=e("rex"),o=e("api"),p=e("bus"),l=e("util"),u=e("store"),g=e("handlebars"),c=function(e,i,t,a){v(e,i,function(n){var o,g=u.get("last_external_username"),c=n.user;if(g&&(o=d.find(c.identities,function(e){var i=l.printExtUserName(e);return g===i?!0:void 0})),o||(o=c.identities[0],u.set("last_external_username",l.printExtUserName(o))),u.set("authorization",{token:e,user_id:i}),u.set("user",c),u.set("lastIdentity",o),s(c.identities),a=!r(".modal-su").size()){var v=r("#forbidden"),m=r("#invite");if(v.size()||m.size())return window.location.reload(),void 0;var f=r("#app-browsing-identity");if(f.size()&&"profile"===f.attr("data-page"))return f.remove(),window.location.href="/",void 0;var h=decodeURIComponent(window.location.hash);if(t||(""===h||/^#?(invalid)?/.test(h))&&!/^#gather/.test(h)&&!/^#!/.test(h))return setTimeout(function(){window.location.hash=l.printExtUserName(c.identities[0])},44.5),void 0}p.emit("app:page:usermenu",!0),p.emit("app:usermenu:updatenormal",c),p.emit("app:usermenu:crosslist",e,i),p.emit("app:user:signin:after",c)},function(){u.remove("cats"),u.remove("user"),u.remove("authorization"),window.location.href="/"})};p.on("app:user:signin",c);var v=function(e,i,t,a){o.request("getUser",{params:{token:e},resources:{user_id:i}},t||function(){},a||function(){})};p.on("app:api:getuser",v),p.on("app:usermenu:updatenormal",i),p.on("app:usermenu:updatebrowsing",t);var m={normal:'<div class="dropdown-menu user-panel"><div class="header"><div class="meta"><a class="pull-right avatar" href="{{profileLink}}" data-link><img width="40" height="40" alt="" src="{{avatar_filename}}" /></a><a class="attended" href="{{profileLink}}" data-link><span class="attended-nums">{{cross_quantity}}</span><span class="attended-x"><em class="x">·X·</em> attended</span></a></div></div><div class="body">{{#unless password}}<div class="merge setup" data-widget="dialog" data-dialog-type="setpassword"><a href="#">Set Up</a> your <span class="x-sign">EXFE</span> password</div>{{/unless}}{{#if verifying}}<div class="merge verify" data-dialog-type="verification_{{identities.[0].provider}}" data-widget="dialog" data-identity-id="{{identities.[0].id}}"><strong>Verify</strong> your identity</div>{{/if}}<div class="list"></div></div><div class="footer"><a href="/#gather" class="xbtn xbtn-gather" id="js-gatherax" data-link>Gather a <span class="x">·X·</span></a><div class="spliterline"></div><div class="actions"><a href="#" class="pull-right" id="app-signout">Sign out</a></div></div></div>',browsing_identity:'<div class="dropdown-menu user-panel"><div class="header"><h2>Browsing Identity</h2></div><div class="body">{{#with browsing}}<div>You are browsing this page as {{capitalize identities.[0].provider}} identity:</div><div class="identity"><span class="pull-right avatar alt40"><img src="{{identities.[0].avatar_filename}}" width="20" height="20" alt="" /></span><i class="icon16-identity-{{identities.[0].provider}}"></i><span class="oblique">{{identities.[0].external_username}}</span></div>{{#if ../setup}}<div class="merge setup" data-user-action="SETUP" data-widget="dialog" data-dialog-type="setup_{{identities.[0].provider}}"><h5>Start</h5>new account with this identity</div>{{/if}}{{/with}}{{#unless setup}}<div class="orspliter hide">or</div><div class="merge signin" data-user-action="SIGNIN" data-source="{{browsing.identities.[0].external_username}}" data-widget="dialog" data-dialog-type="identification" data-dialog-tab="d00"><h5>Authenticate</h5>to continue with this identity</div>{{/unless}}</div><div class="footer"></div></div>'};g.registerHelper("ifConnected",function(e,i){return g.helpers["if"].call(this,"CONNECTED"===e,i)}),p.on("app:page:home",a),p.on("app:page:usermenu",n),p.on("app:page:changeusername",function(e){r("#app-user-name").find("span").text(e)})});
=======
define("user",function(e){"use strict";function t(e){var t,i=o("#app-user-menu"),a=o("#app-user-name"),s=a.find("span"),n=i.find(".dropdown-wrapper"),d=n.find(".user-panel"),r="/#"+l.printExtUserName(e.identities[0]);o("#app-browsing-identity").remove(),a.attr("href",r),s.text(e.name||e.nickname).removeClass("browsing-identity"),t=c.compile(v.normal),d.length&&d.remove(),e.profileLink=r,e.verifying=1===e.identities.length&&"VERIFYING"===e.identities[0].status,n.append(t(e)),delete e.profileLink,delete e.verifying}function i(e){var t,i=o("#app-user-menu"),a=o("#app-user-name"),s=a.find("span"),n=i.find(".dropdown-wrapper"),d=n.find(".user-panel"),r=e.browsing;r.isBrowsing=!0,o("#app-browsing-identity").remove(),o("#app-tmp").append(o('<div id="app-browsing-identity">').data("settings",e).attr("data-widget","dialog").attr("data-dialog-type","browsing_identity")),a.attr("href",location.href),s.html("Browsing as: <em>"+(r.name||r.nickname)+"</em>").addClass("browsing-identity"),t=c.compile(v.browsing_identity),d.length&&d.remove(),n.append(t(e)),o("#app-user-menu").find(".setup").data("source",{browsing:r,originToken:e.invitation_token,tokenType:e.tokenType,forward:e.forward,page:e.page})}function a(e,t){e=!!e;var i=o(document.body),a=o("#app-menubar"),s=o("#app-main");t||s.empty(),i.toggleClass("hbg",e),a.toggleClass("hide",e)}function s(e){e=!!e;var t=o("#app-user-menu"),i=o("#app-signin");t.toggleClass("hide",!e),i.toggleClass("hide",e)}function n(e){for(var t,i,a,s,n=u.get("identities")||[],o=e.slice(0);s=n.shift();){for(t=!1,i=0;(a=e[i++])&&!(t=s.external_username===a.external_username););t||o.push(s)}u.set("identities",o)}var o=e("jquery"),d=e("rex"),r=e("api"),p=e("bus"),l=e("util"),u=e("store"),c=e("handlebars"),g=function(e,t,i,a){h(e,t,function(s){var r,c=u.get("last_external_username"),g=s.user;if(c&&(r=d.find(g.identities,function(e){var t=l.printExtUserName(e);return c===t?!0:void 0})),r||(r=g.identities[0],u.set("last_external_username",l.printExtUserName(r))),u.set("authorization",{token:e,user_id:t}),u.set("user",g),u.set("lastIdentity",r),n(g.identities),a=!o(".modal-su").size()){var h=o("#forbidden"),v=o("#invite");if(h.size()||v.size())return window.location.reload(),void 0;var m=o("#app-browsing-identity");if(m.size()&&"profile"===m.attr("data-page"))return m.remove(),window.location.href="/",void 0;var f=decodeURIComponent(window.location.hash);if(i||(""===f||/^#?(invalid)?/.test(f))&&!/^#gather/.test(f)&&!/^#!/.test(f))return setTimeout(function(){window.location.hash=l.printExtUserName(g.identities[0])},44.5),void 0}p.emit("app:page:usermenu",!0),p.emit("app:usermenu:updatenormal",g),p.emit("app:usermenu:crosslist",e,t),p.emit("app:user:signin:after",g)},function(){u.remove("cats"),u.remove("user"),u.remove("authorization"),window.location.href="/"})};p.on("app:user:signin",g);var h=function(e,t,i,a){r.request("getUser",{params:{token:e},resources:{user_id:t}},i||function(){},a||function(){})};p.on("app:api:getuser",h),p.on("app:usermenu:updatenormal",t),p.on("app:usermenu:updatebrowsing",i);var v={normal:'<div class="dropdown-menu user-panel"><div class="header"><div class="meta"><a class="pull-right avatar" href="{{profileLink}}" data-link><img width="40" height="40" alt="" src="{{avatar_filename}}" /></a><a class="attended" href="{{profileLink}}" data-link><span class="attended-nums">{{cross_quantity}}</span><span class="attended-x"><em class="x">·X·</em> attended</span></a></div></div><div class="body">{{#unless password}}<div class="merge setup" data-widget="dialog" data-dialog-type="setpassword"><a href="#">Set Up</a> your <span class="x-sign">EXFE</span> password</div>{{/unless}}{{#if verifying}}<div class="merge verify" data-dialog-type="verification_{{identities.[0].provider}}" data-widget="dialog" data-identity-id="{{identities.[0].id}}"><strong>Verify</strong> your identity</div>{{/if}}<div class="list"></div></div><div class="footer"><a href="/#gather" class="xbtn xbtn-gather" id="js-gatherax" data-link>Gather a <span class="x">·X·</span></a><div class="spliterline"></div><div class="actions"><a href="#" class="pull-right" id="app-signout">Sign out</a></div></div></div>',browsing_identity:'<div class="dropdown-menu user-panel"><div class="header"><h2>Browsing Identity</h2></div><div class="body">{{#with browsing}}<div>You are browsing this page as {{capitalize identities.[0].provider}} identity:</div><div class="identity"><span class="pull-right avatar alt40"><img src="{{identities.[0].avatar_filename}}" width="20" height="20" alt="" /></span><i class="icon16-identity-{{identities.[0].provider}}"></i><span class="oblique">{{identities.[0].external_username}}</span></div>{{#if ../setup}}<div class="merge setup" data-user-action="SETUP" data-widget="dialog" data-dialog-type="setup_{{identities.[0].provider}}"><h5>Start</h5>new account with this identity</div>{{/if}}{{/with}}{{#unless setup}}<div class="orspliter hide">or</div><div class="merge signin" data-user-action="SIGNIN" data-source="{{browsing.identities.[0].external_username}}" data-widget="dialog" data-dialog-type="identification" data-dialog-tab="d00"><h5>Authenticate</h5>to continue with this identity</div>{{/unless}}</div><div class="footer"></div></div>'};c.registerHelper("ifConnected",function(e,t){return c.helpers["if"].call(this,"CONNECTED"===e,t)}),p.on("app:page:home",a),p.on("app:page:usermenu",s),p.on("app:page:changeusername",function(e){o("#app-user-name").find("span").text(e)})});
>>>>>>> 9a98224... improved X page dialogs
