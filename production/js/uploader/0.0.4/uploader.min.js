define("uploader",function(e,t){function n(e,t){if(window.URL&&window.URL.revokeObjectURL)e.src=window.URL.createObjectURL(t);else if(window.webkitURL&&window.webkitURL.createObjectURL)e.src=window.webkitURL.createObjectURL(t);else{var n=new FileReader;n.onload=function(t){e.src=t.target.result},n.readAsDataURL(t)}}function i(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),a=0,s=t.length;s>a;++a)r[a]=t.charCodeAt(a);var o,l=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(l){var c=new l;c.append(i),o=c.getBlob(n)}else o=new Blob([i],{type:n});return o}function r(e,t){if(e.mozGetAsFile)return e.mozGetAsFile(t,"image/png");var n=e.toDataURL("image/png"),r=i(n);return r}function a(e,t){var n=r(e,t);return n}function s(e){this.originalImage=e,this.width=e.width,this.height=e.height,this.regX=e.width/2,this.regY=e.height/2,this.x=0,this.y=0,this.alpha=1,this.visible=!0,this.rotation=0,this.scaleX=1,this.scaleY=1}function o(e){this.id=++o.UID,this.canvas=e instanceof HTMLCanvasElement?e:document.getElementById(e)}function l(e){return function(t){if(t>e)return 0;if(t*=Math.PI,1e-16>Math.abs(t))return 1;var n=t/e;return Math.sin(t)*Math.sin(n)/t/n}}function c(e,t,n,i,r){this.canvas=e,e.width=t.width,e.height=t.height,e.style.display="none",this.ctx=e.getContext("2d"),this.ctx.drawImage(t,0,0),this.img=t,this.ocan=n,this.src=this.ctx.getImageData(0,0,t.width,t.height),this.dest={width:i,height:Math.round(t.height*i/t.width)},this.dest.data=Array(3*this.dest.width*this.dest.height),this.lanczos=l(r),this.ratio=t.width/i,this.rcp_ratio=2/this.ratio,this.range2=Math.ceil(this.ratio*r/2),this.cacheLanc={},this.center={},this.icenter={};var a=this;setTimeout(function(){a.process1(a,0)},0)}function d(){h(document).off("mousemove.photozone").off("mouseup.photozone")}function u(e){h(document).on("mousemove.photozone",function(t){function n(e){0===_?(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height),c.y-=c.scaleY*g.height-c.height):1===_?(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width),c.x-=c.scaleX*g.width-c.width):2===_?(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height)):(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width))}function i(e){0===_?(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width),c.x-=c.scaleX*g.width-c.width):1===_?(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height)):2===_?(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width)):(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height),c.y-=c.scaleY*g.height-c.height)}function r(e){0===_?(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width)):1===_?(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height),c.y-=c.scaleY*g.height-c.height):2===_?(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width),c.x-=c.scaleX*g.width-c.width):(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height))}function a(e){0===_?(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height)):1===_?(c.scaleX=v+e,0>c.scaleY&&(c.scaleY=x/g.height)):2===_?(c.scaleY=y+e,0>c.scaleY&&(c.scaleY=x/g.height),c.y-=c.scaleY*g.height-c.height):(c.scaleX=v+e,0>c.scaleX&&(c.scaleX=x/g.width),c.x-=c.scaleX*g.width-c.width)}t.preventDefault();var s=e;if(s&&s.dragging){var o=t.pageX-s.offset[0],l=t.pageY-s.offset[1],c=s.bitmap;switch(s.ri){case 0:c.x+=o,c.y+=l;break;case 1:c.x+=l,c.y-=o;break;case 2:c.x-=o,c.y-=l;break;case 3:c.x-=l,c.y+=o}return s.offset[0]=t.pageX,s.offset[1]=t.pageY,s.stage.update(),s.bitmap80.updateImage(s.stage.canvas),s.stage80.update(),!1}if(s&&s.resizing){var d,u,h,p,o=t.pageX-s.aoffset[0],l=t.pageY-s.aoffset[1],f=s.stage.canvas.width,m=s.stage.canvas.height,c=s.bitmap,g=c.originalImage,v=s.psx,y=s.psy,_=s.ri,b=s.aoffset,x=s.sss,w=s._canvasOffset;if(o||l){switch(s.anchor){case 0:var k=Math.sqrt(Math.pow(t.pageX-f-w.left,2)+Math.pow(t.pageY-w.top-m,2)),C=Math.sqrt(Math.pow(f,2)+Math.pow(m,2));k-=s.dr,n(k/C*x),i(k/C*x);break;case 1:u=b[1]-t.pageY,p=u/m,n(p*x),i(p*x);break;case 2:var k=Math.sqrt(Math.pow(t.pageX-w.left,2)+Math.pow(t.pageY-w.top-m,2)),C=Math.sqrt(Math.pow(f,2)+Math.pow(m,2));k-=s.dr,n(k/C*x),r(k/C*x);break;case 3:d=b[0]-t.pageX,h=d/f,i(h*x),n(h*x);break;case 4:d=t.pageX-b[0],h=d/f,r(h*x),a(h*x);break;case 5:var k=Math.sqrt(Math.pow(t.pageX-f-w.left,2)+Math.pow(t.pageY-w.top,2)),C=Math.sqrt(Math.pow(f,2)+Math.pow(m,2));k-=s.dr,i(k/C*x),a(k/C*x);break;case 6:u=t.pageY-b[1],p=u/m,r(p*x),a(p*x);break;case 7:var k=Math.sqrt(Math.pow(t.pageX-w.left,2)+Math.pow(t.pageY-w.top,2)),C=Math.sqrt(Math.pow(f,2)+Math.pow(m,2));k-=s.dr,r(k/C*x),a(k/C*x)}s.stage.update(),s.bitmap80.updateImage(s.stage.canvas),s.stage80.update()}return!1}}).on("mouseup.photozone",function(){if(e){if(e.resizing||e.dragging){var t=document.createElement("img");t.onload=function(){new c(document.getElementById("real-avatar80"),this,e.stage80.canvas,80,3)},t.src=e.stage.canvas.toDataURL("image/png")}e.resizing=!1,e.dragging=!1,e.anchor=null,e.bitmap&&(e.psx=e.bitmap.scaleX,e.psy=e.bitmap.scaleY)}})}var h=e("jquery"),p=(e("api"),e("store")),f=window._ENV_.api_url,m=e("dialog"),g=e("filehtml5"),v=m.extend({_fileInputField:null,_buttonBinding:null,queue:null,init:function(){this._fileInputField=null,this.queue=null,this._buttonBinding=null,this._fileList=[]},sync:function(){var e=this.$(".dropbox");this._fileInputField=h(v.HTML5FILEFIELD_TEMPLATE),e.after(this._fileInputField),this._bindDropArea(),this._fileInputField.on("change",h.proxy(this._updateFileList,this))},_bindSelectFile:function(){var e=this._fileInputField[0];e.click&&e.click()},_bindDropArea:function(e){var t=e||{prevVal:null};null!==t.prevVal&&(t.prevVal.detach("drop",this._ddEventhandler),t.prevVal.detach("dragenter",this._ddEventhandler),t.prevVal.detach("dragover",this._ddEventhandler),t.prevVal.detach("dragleave",this._ddEventhandler));var n=h.proxy(this._ddEventhandler,this);this.element.on("drop",".modal-main",n),this.element.on("dragenter",".modal-main",n),this.element.on("dragover",".modal-main",n),this.element.on("dragleave",".modal-main",n)},_ddEventhandler:function(e){switch(e.stopPropagation(),e.preventDefault(),e.type){case"dragenter":this.emit("dragenter",e);break;case"dragover":this.emit("dragover",e);break;case"dragleave":this.emit("dragleave",e);break;case"drop":var t=this.$(".modal-main")[0];if(!h.contains(t,e.target)&&e.target!==t)return!1;this._fileselect(e.originalEvent.dataTransfer.files),this.emit("drop",e)}return!1},_fileselect:function(e){for(var t=e,n=[],i=(this.fileFilterFunction,0),r=t.length;r>i;i++)n.push(new g(t[i]));this.options.limit&&(n=n.slice(-this.options.limit)),n.length>0&&this.emit("fileselect",{fileList:n})},_updateFileList:function(e){this._fileselect(e.target.files)},fileFilterFunction:function(e){var t=!1;return/^image\/(png|gif|bmp|jpg|jpeg)$/.test(e._type)&&(t=!0),t}},{HTML5FILEFIELD_TEMPLATE:'<input type="file" style="visibility:hidden; width:0px; height:0px;" />'}),y={errors:{server:"Failed to open, please try again.",format:"File format not supported.",size:"File is too large."},checkFile:function(e){return this.checkFileFormat(e)?!1:this.checkFileSize(e)?!1:!0},checkFileSize:function(e){var t=3145728,n=!1;return this.emit("toggleError",n=e._size>t,"size"),n},checkFileFormat:function(e){var t=!this.fileFilterFunction(e);return this.emit("toggleError",t,"format"),t},sss:1,aoffset:[0,0],psx:1,psy:1,anchor:null,resizing:!1,dragging:!1,SCALE:80/240,ri:0,R:[0,0],filehtml5Bind:function(){var e=this;this.filehtml5._xhrHeaders={Accept:"application/json, text/javascript, */*; q=0.01"},this.filehtml5.on("uploadcomplete",function(t){var n=!0;e.$(".loading").addClass("hide"),e.$(".zoom").show(),data=JSON.parse(t.data),data&&200===data.meta.code&&(n=!1,"user"===data.response.type?h(".user-avatar .avatar, .user-panel .avatar").find("img").attr("src",data.response.avatars["80_80"]):h('.identity-list li[data-identity-id="'+data.response.identity_id+'"] .avatar').find("img").attr("src",data.response.avatars["80_80"])),e.emit("toggleError",n,"server"),e.hide()}),this.filehtml5.on("uploadstart",function(){e.$(".loading").removeClass("hide")})},options:{limit:1,onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},onShowBefore:function(){u(this)},onShowAfter:function(e){if(this._data=e,this._canvasOffset=this.$("#avatar240").offset(),e.original){var t=document.createElement("input");t.type="file",this.filehtml5=new g(t.files),this.filehtml5Bind(),this.$(".overlay").addClass("hide"),this.$(".resizeable").removeClass("hide"),this.$(".upload-done").show(),this.$(".upload-clear").hide(),this.$(".zoom").show();var n=this;n.ri=0,n.R=[0,0];var i,r,a=document.getElementById("avatar240"),l=document.getElementById("avatar80"),d=(n.r,new o(a)),u=new o(l),h=document.getElementById("img-avatar");h.onload=function(){var e=Math.min(h.width,h.height);n.sss=1,e>240&&(n.sss=240/e),i=new s(h),n.psx=i.scaleX=n.sss,n.psy=i.scaleY=n.sss,i.setPosition(a.width/2-(i.regX*=i.scaleX),a.height/2-(i.regY*=i.scaleY)),i.rotation=n.ri,i.updateContext=function(e){e.translate(a.width*n.R[0],a.height*n.R[1]),e.rotate(this.rotation*o.DEG_TO_RAD),e.webkitImageSmoothingEnabled=e.mozImageSmoothingEnabled=!1},d.addChild(i),d.update(),n.bitmap=i,n.stage=d,r=new s(a),r.updateImage=function(e){r.originalImage=e},r.updateContext=function(e){e.scale(n.SCALE,n.SCALE),e.webkitImageSmoothingEnabled=e.mozImageSmoothingEnabled=!1},u.addChild(r),u.update(),n.bitmap80=r,n.stage80=u;var t=document.createElement("img");t.onload=function(){new c(document.getElementById("real-avatar80"),this,u.canvas,80,3)},t.src=a.toDataURL("image/png")},h.crossOrigin="anonymous",h.src=e.original}},onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove(),d()},onToggleError:function(e,t){e?this.$(".xalert-error").html(this.errors[t]).removeClass("hide"):this.$(".xalert-error").addClass("hide")},onDrop:function(){},onFileselect:function(e){var t,i=e.fileList;if(i.length){if(t=this.filehtml5=i[0],!this.checkFile(t))return!1;this.filehtml5Bind(),this.$(".overlay").addClass("hide"),this.$(".resizeable").removeClass("hide"),this.$(".upload-done").show(),this.$(".upload-clear").hide(),this.$(".zoom").hide();var r=this;r.ri=0,r.R=[0,0];var a,l,d=document.getElementById("avatar240"),u=document.getElementById("avatar80"),h=(r.r,new o(d)),p=new o(u),f=document.getElementById("img-avatar");f.onerror=f.onload=function(){var e=f,t=Math.min(f.width,f.height);if(r.sss=1,t>240&&(r.sss=240/t),"image/gif"===r.filehtml5._type){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width,n.height=e.height,i.drawImage(e,0,0,n.width,n.height),e=n}a=new s(e),r.psx=a.scaleX=r.sss,r.psy=a.scaleY=r.sss,a.setPosition(d.width/2-(a.regX*=a.scaleX),d.height/2-(a.regY*=a.scaleY)),a.rotation=r.ri,a.updateContext=function(e){e.translate(d.width*r.R[0],d.height*r.R[1]),e.rotate(this.rotation*o.DEG_TO_RAD),e.webkitImageSmoothingEnabled=e.mozImageSmoothingEnabled=!1},h.addChild(a),h.update(),r.bitmap=a,r.stage=h,l=new s(d),l.updateImage=function(e){l.originalImage=e},l.updateContext=function(e){e.scale(r.SCALE,r.SCALE),e.webkitImageSmoothingEnabled=e.mozImageSmoothingEnabled=!1},p.addChild(l),p.update(),r.bitmap80=l,r.stage80=p;var u=document.createElement("img");u.onload=function(){new c(document.getElementById("real-avatar80"),this,p.canvas,80,3)},u.src=d.toDataURL("image/png")},f.crossOrigin="anonymous",n(f,t._file)}},backdrop:!1,events:{"click .dropbox":function(e){e.preventDefault(),this._fileInputField[0].value=null,this._bindSelectFile()},"mousedown #avatar240":function(e){return e.preventDefault(),this.dragging=!0,this.offset=[e.pageX,e.pageY],!1},"click .upload":function(e){e.preventDefault(),this.$(".overlay").removeClass("hide"),this.$(".resizeable").addClass("hide"),this.$(".upload, .rotate, .upload-done").hide(),this.$(".back, .upload-clear").show()},"click .rotate":function(){this.ri++,1===this.ri?this.R=[1,0]:2===this.ri?this.R=[1,1]:3===this.ri?this.R=[0,1]:(this.ri=0,this.R=[0,0]),this.bitmap.rotation=90*this.ri,this.stage.update(),this.bitmap80.updateImage(this.stage.canvas),this.stage80.update();var e=this,t=document.createElement("img");return t.onload=function(){new c(document.getElementById("real-avatar80"),this,e.stage80.canvas,80,3)},t.src=e.stage.canvas.toDataURL("image/png"),!1},"hover .avatar240":function(e){"mouseenter"===e.type?this.$(".upload, .rotate").show():this.$(".upload, .rotate").hide()},"hover .overlay":function(e){if(this._data.original){var t="mouseenter"===e.type;h(e.currentTarget).hasClass("dropbox")&&this.$(".back")[t?"show":"hide"]()}},"click .back":function(){return this.$(".overlay").addClass("hide"),this.$(".resizeable").removeClass("hide"),this.$(".upload, .rotate, .upload-done").show(),this.$(".back, .upload-clear").hide(),!1},"click .smallphoto":function(e){e.preventDefault();var t="";if(!this.bitmap)return!1;if(h.browser.safari&&!/chrome/.test(navigator.userAgent.toLowerCase())){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=this.bitmap.originalImage.width,n.height=this.bitmap.originalImage.height,i.drawImage(this.bitmap.originalImage,0,0,n.width,n.height),t=n.toDataURL("image/png")}else t=this.bitmap.originalImage.src;return window.open(t)},"mousedown .resizeable":function(e){e.preventDefault();var t=h(e.target),n=this.anchor=t.data("anchor");this.resizing=!0,this.aoffset=[e.pageX,e.pageY];var i=this._canvasOffset;return 7===n?this.dr=Math.sqrt(Math.pow(e.pageX-i.left,2)+Math.pow(e.pageY-i.top,2)):5===n?this.dr=Math.sqrt(Math.pow(e.pageX-i.left-240,2)+Math.pow(e.pageY-i.top,2)):0===n?this.dr=Math.sqrt(Math.pow(e.pageX-i.left-240,2)+Math.pow(e.pageY-i.top-240,2)):2===n&&(this.dr=Math.sqrt(Math.pow(e.pageX-i.left,2)+Math.pow(e.pageY-i.top-240,2))),!1},"click .upload-clear":function(){return this.$(".help-portrait").removeClass("hide"),this.$(".xbtn-yes, .xbtn-no").removeClass("hide"),!1},"click .xbtn-no":function(){return this.$(".help-portrait").addClass("hide"),this.$(".xbtn-yes, .xbtn-no").addClass("hide"),!1},"click .xbtn-yes":function(){var e={},t=p.get("authorization"),n=t.token;return this._data.identity_id&&(e.identity_id=this._data.identity_id),this.filehtml5.startUpload(f+"/avatar/update?token="+n,e),!1},"click .upload-done":function(){var e=this,t=this.bitmap,n=t.originalImage;this.stage,this.stage80;var i=240/this.sss,r=t.x/this.sss,l=t.y/this.sss,c=document.createElement("canvas");c.width=c.height=i;var d=new o(c),u=new s(n);u.setPosition(r,l),u.rotation=90*this.ri,u.scaleX=t.scaleX/this.sss,u.scaleY=t.scaleY/this.sss,u.updateContext=function(t){t.translate(c.width*e.R[0],c.height*e.R[1]),t.rotate(this.rotation*o.DEG_TO_RAD),t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=!1},d.addChild(u),d.update();var h=a(d.canvas,"original.png"),m=a(document.getElementById("real-avatar80"),"80_80.png"),g=this;setTimeout(function(){var e={original:h,"80_80":m},t=p.get("authorization"),n=t.token;g._data.identity_id&&(e.identity_id=g._data.identity_id),g._data=e,g.filehtml5.startUpload(f+"/avatar/update?token="+n,e)},15.6)}},viewData:{cls:"mblack modal-uploader",title:"Portrait",body:'<div class="pull-right sider"><div class="pull-right smallphoto"><i class="icon20-zoom zoom"></i><div class="avatar80"><img id="img-avatar" src="" class="hide" alt="" /><canvas id="avatar80" width="80" height="80" class="hide"></canvas><canvas id="real-avatar80"></canvas></div><div class="overlay"></div><div class="loading hide"></div></div><div class="uploader-form"><div class="xalert-error hide"></div><button class="pull-right xbtn xbtn-blue upload-done hide">Save</button><button class="pull-right xbtn xbtn-white upload-clear hide">Clear</button></div></div><div class="photozone"><div class="anchor-n resizeable hide" data-anchor="1"></div><div class="anchor-w resizeable hide" data-anchor="3"></div><div class="anchor-e resizeable hide" data-anchor="4"></div><div class="anchor-s resizeable hide" data-anchor="6"></div><div class="anchor-nw resizeable hide" data-anchor="0"></div><div class="anchor-ne resizeable hide" data-anchor="2"></div><div class="anchor-sw resizeable hide" data-anchor="5"></div><div class="anchor-se resizeable hide" data-anchor="7"></div><div class="avatar240"><i class="icon20-upload upload"></i><i class="icon20-rotate rotate"></i><canvas id="avatar240" width="240" height="240"></canvas></div><div class="loading hide"><img src="/static/img/loading.gif" alt="" width="36" height="39" /><p>Uploading...</p></div><div class="overlay dropbox"><i class="icon20-back back"></i><img class="bigupload" src="/static/img/upload_128.png" alt="" width="128" height="128" /><div class="droptips">Drop your photo <span class="hide">or URL</span> here.<br />Alternatively, <span class="underline">open</span> local file.</div></div></div>',footer:'<button class="pull-right xbtn xbtn-pink xbtn-yes hide">Yes</button><button class="pull-right xbtn xbtn-white xbtn-no hide">No</button>',others:'<div class="help-portrait hide"><div class="modal-body"><div class="shadow title">Use default portrait?</div><div class="modal-content"><p>You have no portrait set, thus a default one will be assigned automatically. It means you will lose your primary visual identification, consequently poor recognizability confuse your friends.</p><p>Confirm using default portrait?</p></div></div></div>'}}};s.prototype={setPosition:function(e,t){this.x=e||0,this.y=t||0},updateContext:function(){},updateRect:function(){this.width=this.originalImage.width*this.scaleX,0>this.width&&(this.width=1,this.scaleX=this.width/this.originalImage.width),this.height=this.originalImage.height*this.scaleY,0>this.height&&(this.height=1,this.scaleY=this.height/this.originalImage.height)},draw:function(e){this.updateRect(),e.drawImage(this.originalImage,this.x,this.y,this.width-1,this.height-1)}},o.UID=0,o.DEG_TO_RAD=Math.PI/180,o.prototype={toDataURL:function(){},clear:function(){var e=this.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.width,this.canvas.height)},addChild:function(e){return this._children||(this._children=[]),this.parent=this,this._children.push(e),e},draw:function(){var e,t,n,i=this._children;if(i&&(t=this._children.length))for(n=this.canvas.getContext("2d"),this.clear(),e=0;t>e;e++){var r=i[e];n.save(),r.updateContext(n),r.draw(n),n.restore()}},update:function(){this.draw()}},c.prototype.process1=function(e,t){e.center.x=(t+.5)*e.ratio,e.icenter.x=Math.floor(e.center.x);for(var n=0;e.dest.height>n;n++){e.center.y=(n+.5)*e.ratio,e.icenter.y=Math.floor(e.center.y);var i,r,a,s;i=r=a=s=0;for(var o=e.icenter.x-e.range2;e.icenter.x+e.range2>=o;o++)if(!(0>o||o>=e.src.width)){var l=Math.floor(1e3*Math.abs(o-e.center.x));e.cacheLanc[l]||(e.cacheLanc[l]={});for(var c=e.icenter.y-e.range2;e.icenter.y+e.range2>=c;c++)if(!(0>c||c>=e.src.height)){var d=Math.floor(1e3*Math.abs(c-e.center.y));void 0==e.cacheLanc[l][d]&&(e.cacheLanc[l][d]=e.lanczos(Math.sqrt(Math.pow(l*e.rcp_ratio,2)+Math.pow(d*e.rcp_ratio,2))/1e3));var u=e.cacheLanc[l][d];if(u>0){var h=4*(c*e.src.width+o);i+=u,r+=u*e.src.data[h],a+=u*e.src.data[h+1],s+=u*e.src.data[h+2]}}}var h=3*(n*e.dest.width+t);e.dest.data[h]=r/i,e.dest.data[h+1]=a/i,e.dest.data[h+2]=s/i}++t<e.dest.width?setTimeout(function(){e.process1(e,t)},0):setTimeout(function(){e.process2(e)},0)},c.prototype.process2=function(e){e.canvas.width=e.dest.width,e.canvas.height=e.dest.height,e.ctx.drawImage(e.img,0,0),e.src=e.ctx.getImageData(0,0,e.dest.width,e.dest.height);for(var t,n,i=e.ocan.getContext("2d").getImageData(0,0,e.dest.width,e.dest.height),r=0;e.dest.width>r;r++)for(var a=0;e.dest.height>a;a++)t=3*(a*e.dest.width+r),n=4*(a*e.dest.width+r),e.src.data[n]=e.dest.data[t],e.src.data[n+1]=e.dest.data[t+1],e.src.data[n+2]=e.dest.data[t+2],e.src.data[n+3]=i.data[n+3];e.ctx.putImageData(e.src,0,0),e.canvas.style.display="block"},t.Uploader=v,t.uploadSettings=y});