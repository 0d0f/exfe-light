define("uploader",function(t,e){function a(t,e){if(window.URL&&window.URL.revokeObjectURL)t.src=window.URL.createObjectURL(e);else if(window.webkitURL&&window.webkitURL.createObjectURL)t.src=window.webkitURL.createObjectURL(e);else{var a=new FileReader;a.onload=function(e){t.src=e.target.result},a.readAsDataURL(e)}}function i(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),s=new Uint8Array(i),n=0,r=e.length;r>n;++n)s[n]=e.charCodeAt(n);var o,h=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(h){var d=new h;d.append(i),o=d.getBlob(a)}else o=new Blob([i],{type:a});return o}function s(t,e){if(t.mozGetAsFile)return t.mozGetAsFile(e,"image/png");var a=t.toDataURL("image/png"),s=i(a);return s}function n(t,e){var a=s(t,e);return a}function r(t){this.originalImage=t,this.width=t.width,this.height=t.height,this.regX=t.width/2,this.regY=t.height/2,this.x=0,this.y=0,this.alpha=1,this.visible=!0,this.rotation=0,this.scaleX=1,this.scaleY=1}function o(t){this.id=++o.UID,this.canvas=t instanceof HTMLCanvasElement?t:document.getElementById(t)}function h(t){return function(e){if(e>t)return 0;if(e*=Math.PI,1e-16>Math.abs(e))return 1;var a=e/t;return Math.sin(e)*Math.sin(a)/e/a}}function d(t,e,a,i,s){this.canvas=t,t.width=e.width,t.height=e.height,t.style.display="none",this.ctx=t.getContext("2d"),this.ctx.drawImage(e,0,0),this.img=e,this.ocan=a,this.src=this.ctx.getImageData(0,0,e.width,e.height),this.dest={width:i,height:Math.round(e.height*i/e.width)},this.dest.data=Array(3*this.dest.width*this.dest.height),this.lanczos=h(s),this.ratio=e.width/i,this.rcp_ratio=2/this.ratio,this.range2=Math.ceil(this.ratio*s/2),this.cacheLanc={},this.center={},this.icenter={};var n=this;setTimeout(function(){n.process1(n,0)},0)}function l(){g(document).off("mousemove.photozone").off("mouseup.photozone")}function c(t){g(document).on("mousemove.photozone",function(e){function a(t){0===b?(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height),d.y-=d.scaleY*f.height-d.height):1===b?(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width),d.x-=d.scaleX*f.width-d.width):2===b?(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height)):(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width))}function i(t){0===b?(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width),d.x-=d.scaleX*f.width-d.width):1===b?(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height)):2===b?(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width)):(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height),d.y-=d.scaleY*f.height-d.height)}function s(t){0===b?(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width)):1===b?(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height),d.y-=d.scaleY*f.height-d.height):2===b?(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width),d.x-=d.scaleX*f.width-d.width):(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height))}function n(t){0===b?(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height)):1===b?(d.scaleX=m+t,0>d.scaleY&&(d.scaleY=_/f.height)):2===b?(d.scaleY=w+t,0>d.scaleY&&(d.scaleY=_/f.height),d.y-=d.scaleY*f.height-d.height):(d.scaleX=m+t,0>d.scaleX&&(d.scaleX=_/f.width),d.x-=d.scaleX*f.width-d.width)}e.preventDefault();var r=t;if(r&&r.dragging){var o=e.pageX-r.offset[0],h=e.pageY-r.offset[1],d=r.bitmap;switch(r.ri){case 0:d.x+=o,d.y+=h;break;case 1:d.x+=h,d.y-=o;break;case 2:d.x-=o,d.y-=h;break;case 3:d.x-=h,d.y+=o}return r.offset[0]=e.pageX,r.offset[1]=e.pageY,r.stage.update(),r.bitmap80.updateImage(r.stage.canvas),r.stage80.update(),!1}if(r&&r.resizing){var l,c,g,p,o=e.pageX-r.aoffset[0],h=e.pageY-r.aoffset[1],u=r.stage.canvas.width,v=r.stage.canvas.height,d=r.bitmap,f=d.originalImage,m=r.psx,w=r.psy,b=r.ri,y=r.aoffset,_=r.sss,x=r._canvasOffset;if(o||h){switch(r.anchor){case 0:var E=Math.sqrt(Math.pow(e.pageX-u-x.left,2)+Math.pow(e.pageY-x.top-v,2)),M=Math.sqrt(Math.pow(u,2)+Math.pow(v,2));E-=r.dr,a(E/M*_),i(E/M*_);break;case 1:c=y[1]-e.pageY,p=c/v,a(p*_),i(p*_);break;case 2:var E=Math.sqrt(Math.pow(e.pageX-x.left,2)+Math.pow(e.pageY-x.top-v,2)),M=Math.sqrt(Math.pow(u,2)+Math.pow(v,2));E-=r.dr,a(E/M*_),s(E/M*_);break;case 3:l=y[0]-e.pageX,g=l/u,i(g*_),a(g*_);break;case 4:l=e.pageX-y[0],g=l/u,s(g*_),n(g*_);break;case 5:var E=Math.sqrt(Math.pow(e.pageX-u-x.left,2)+Math.pow(e.pageY-x.top,2)),M=Math.sqrt(Math.pow(u,2)+Math.pow(v,2));E-=r.dr,i(E/M*_),n(E/M*_);break;case 6:c=e.pageY-y[1],p=c/v,s(p*_),n(p*_);break;case 7:var E=Math.sqrt(Math.pow(e.pageX-x.left,2)+Math.pow(e.pageY-x.top,2)),M=Math.sqrt(Math.pow(u,2)+Math.pow(v,2));E-=r.dr,s(E/M*_),n(E/M*_)}r.stage.update(),r.bitmap80.updateImage(r.stage.canvas),r.stage80.update()}return!1}}).on("mouseup.photozone",function(){if(t){if(t.resizing||t.dragging){var e=document.createElement("img");e.onload=function(){new d(document.getElementById("real-avatar80"),this,t.stage80.canvas,80,3)},e.src=t.stage.canvas.toDataURL("image/png")}t.resizing=!1,t.dragging=!1,t.anchor=null,t.bitmap&&(t.psx=t.bitmap.scaleX,t.psy=t.bitmap.scaleY)}})}var g=t("jquery"),p=(t("api"),t("store")),u=window._ENV_.api_url,v=t("dialog"),f=t("filehtml5"),m=v.extend({_fileInputField:null,_buttonBinding:null,queue:null,init:function(){this._fileInputField=null,this.queue=null,this._buttonBinding=null,this._fileList=[]},sync:function(){var t=this.$(".dropbox");this._fileInputField=g(m.HTML5FILEFIELD_TEMPLATE),t.after(this._fileInputField),this._bindDropArea(),this._fileInputField.on("change",g.proxy(this._updateFileList,this))},_bindSelectFile:function(){var t=this._fileInputField[0];t.click&&t.click()},_bindDropArea:function(t){var e=t||{prevVal:null};null!==e.prevVal&&(e.prevVal.detach("drop",this._ddEventhandler),e.prevVal.detach("dragenter",this._ddEventhandler),e.prevVal.detach("dragover",this._ddEventhandler),e.prevVal.detach("dragleave",this._ddEventhandler));var a=g.proxy(this._ddEventhandler,this);this.element.on("drop",".modal-main",a),this.element.on("dragenter",".modal-main",a),this.element.on("dragover",".modal-main",a),this.element.on("dragleave",".modal-main",a)},_ddEventhandler:function(t){switch(t.stopPropagation(),t.preventDefault(),t.type){case"dragenter":this.emit("dragenter",t);break;case"dragover":this.emit("dragover",t);break;case"dragleave":this.emit("dragleave",t);break;case"drop":var e=this.$(".modal-main")[0];if(!g.contains(e,t.target)&&t.target!==e)return!1;this._fileselect(t.originalEvent.dataTransfer.files),this.emit("drop",t)}return!1},_fileselect:function(t){for(var e=t,a=[],i=(this.fileFilterFunction,0),s=e.length;s>i;i++)a.push(new f(e[i]));this.options.limit&&(a=a.slice(-this.options.limit)),a.length>0&&this.emit("fileselect",{fileList:a})},_updateFileList:function(t){this._fileselect(t.target.files)},fileFilterFunction:function(t){var e=!1;return/^image\/(png|gif|bmp|jpg|jpeg)$/.test(t._type)&&(e=!0),e}},{HTML5FILEFIELD_TEMPLATE:'<input type="file" style="visibility:hidden; width:0px; height:0px;" />'}),w={errors:{server:"Failed to open, please try again.",format:"File format not supported.",size:"File is too large."},checkFile:function(t){return this.checkFileFormat(t)?!1:this.checkFileSize(t)?!1:!0},checkFileSize:function(t){var e=3145728,a=!1;return this.emit("toggleError",a=t._size>e,"size"),a},checkFileFormat:function(t){var e=!this.fileFilterFunction(t);return this.emit("toggleError",e,"format"),e},sss:1,aoffset:[0,0],psx:1,psy:1,anchor:null,resizing:!1,dragging:!1,SCALE:80/240,ri:0,R:[0,0],filehtml5Bind:function(){var t=this;this.filehtml5._xhrHeaders={Accept:"application/json, text/javascript, */*; q=0.01"},this.filehtml5.on("uploadcomplete",function(e){var a=!0;t.$(".loading").addClass("hide"),t.$(".zoom").show(),data=JSON.parse(e.data),data&&200===data.meta.code&&(a=!1,"user"===data.response.type?g(".user-avatar .avatar, .user-panel .avatar").find("img").attr("src",data.response.avatars["80_80"]):g('.identity-list li[data-identity-id="'+data.response.identity_id+'"] .avatar').find("img").attr("src",data.response.avatars["80_80"])),t.emit("toggleError",a,"server"),t.hide()}),this.filehtml5.on("uploadstart",function(){t.$(".loading").removeClass("hide")})},options:{limit:1,onHideAfter:function(){var t=this.element;this.offSrcNode(),this.destory(),t.remove()},onShowBefore:function(){c(this)},onShowAfter:function(t){if(this._data=t,this._canvasOffset=this.$("#avatar240").offset(),t.original){var e=document.createElement("input");e.type="file",this.filehtml5=new f(e.files),this.filehtml5Bind(),this.$(".overlay").addClass("hide"),this.$(".resizeable").removeClass("hide"),this.$(".upload-done").show(),this.$(".upload-clear").hide(),this.$(".zoom").show();var a=this;a.ri=0,a.R=[0,0];var i,s,n=document.getElementById("avatar240"),h=document.getElementById("avatar80"),l=(a.r,new o(n)),c=new o(h),g=document.getElementById("img-avatar");g.onload=function(){var t=Math.min(g.width,g.height);a.sss=1,t>240&&(a.sss=240/t),i=new r(g),a.psx=i.scaleX=a.sss,a.psy=i.scaleY=a.sss,i.setPosition(n.width/2-(i.regX*=i.scaleX),n.height/2-(i.regY*=i.scaleY)),i.rotation=a.ri,i.updateContext=function(t){t.translate(n.width*a.R[0],n.height*a.R[1]),t.rotate(this.rotation*o.DEG_TO_RAD),t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=!1},l.addChild(i),l.update(),a.bitmap=i,a.stage=l,s=new r(n),s.updateImage=function(t){s.originalImage=t},s.updateContext=function(t){t.scale(a.SCALE,a.SCALE),t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=!1},c.addChild(s),c.update(),a.bitmap80=s,a.stage80=c;var e=document.createElement("img");e.onload=function(){new d(document.getElementById("real-avatar80"),this,c.canvas,80,3)},e.src=n.toDataURL("image/png")},g.crossOrigin="anonymous",g.src=t.original}},onHideAfter:function(){this.filehtml5&&this.filehtml5.cancelUpload();var t=this.element;this.offSrcNode(),this.destory(),t.remove(),l()},onToggleError:function(t,e){t?this.$(".xalert-error").html(this.errors[e]).removeClass("hide"):this.$(".xalert-error").addClass("hide")},onDrop:function(){},onFileselect:function(t){var e,i=t.fileList;if(i.length){if(e=this.filehtml5=i[0],!this.checkFile(e))return!1;this.filehtml5Bind(),this.$(".overlay").addClass("hide"),this.$(".resizeable").removeClass("hide"),this.$(".upload-done").show(),this.$(".upload-clear").hide(),this.$(".zoom").hide();var s=this;s.ri=0,s.R=[0,0];var n,h,l=document.getElementById("avatar240"),c=document.getElementById("avatar80"),g=(s.r,new o(l)),p=new o(c),u=document.getElementById("img-avatar");u.onerror=u.onload=function(){var t=u,e=Math.min(u.width,u.height);if(s.sss=1,e>240&&(s.sss=240/e),"image/gif"===s.filehtml5._type){var a=document.createElement("canvas"),i=a.getContext("2d");a.width=t.width,a.height=t.height,i.drawImage(t,0,0,a.width,a.height),t=a}n=new r(t),s.psx=n.scaleX=s.sss,s.psy=n.scaleY=s.sss,n.setPosition(l.width/2-(n.regX*=n.scaleX),l.height/2-(n.regY*=n.scaleY)),n.rotation=s.ri,n.updateContext=function(t){t.translate(l.width*s.R[0],l.height*s.R[1]),t.rotate(this.rotation*o.DEG_TO_RAD),t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=!1},g.addChild(n),g.update(),s.bitmap=n,s.stage=g,h=new r(l),h.updateImage=function(t){h.originalImage=t},h.updateContext=function(t){t.scale(s.SCALE,s.SCALE),t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=!1},p.addChild(h),p.update(),s.bitmap80=h,s.stage80=p;var c=document.createElement("img");c.onload=function(){new d(document.getElementById("real-avatar80"),this,p.canvas,80,3)},c.src=l.toDataURL("image/png")},u.crossOrigin="anonymous",a(u,e._file)}},backdrop:!1,events:{"click .dropbox":function(t){t.preventDefault(),this._fileInputField[0].value=null,this._bindSelectFile()},"mousedown #avatar240":function(t){return t.preventDefault(),this.dragging=!0,this.offset=[t.pageX,t.pageY],!1},"click .upload":function(t){t.preventDefault(),this.$(".overlay").removeClass("hide"),this.$(".resizeable").addClass("hide"),this.$(".upload, .rotate, .upload-done").hide(),this.$(".back, .upload-clear").show()},"click .rotate":function(){this.ri++,1===this.ri?this.R=[1,0]:2===this.ri?this.R=[1,1]:3===this.ri?this.R=[0,1]:(this.ri=0,this.R=[0,0]),this.bitmap.rotation=90*this.ri,this.stage.update(),this.bitmap80.updateImage(this.stage.canvas),this.stage80.update();var t=this,e=document.createElement("img");return e.onload=function(){new d(document.getElementById("real-avatar80"),this,t.stage80.canvas,80,3)},e.src=t.stage.canvas.toDataURL("image/png"),!1},"hover .avatar240":function(t){"mouseenter"===t.type?this.$(".upload, .rotate").show():this.$(".upload, .rotate").hide()},"hover .overlay":function(t){if(this._data.original){var e="mouseenter"===t.type;g(t.currentTarget).hasClass("dropbox")&&this.$(".back")[e?"show":"hide"]()}},"click .back":function(){return this.$(".overlay").addClass("hide"),this.$(".resizeable").removeClass("hide"),this.$(".upload, .rotate, .upload-done").show(),this.$(".back, .upload-clear").hide(),!1},"click .smallphoto":function(t){t.preventDefault();var e="";if(!this.bitmap)return!1;if(g.browser.safari&&!/chrome/.test(navigator.userAgent.toLowerCase())){var a=document.createElement("canvas"),i=a.getContext("2d");a.width=this.bitmap.originalImage.width,a.height=this.bitmap.originalImage.height,i.drawImage(this.bitmap.originalImage,0,0,a.width,a.height),e=a.toDataURL("image/png")}else e=this.bitmap.originalImage.src;return window.open(e)},"mousedown .resizeable":function(t){t.preventDefault();var e=g(t.target),a=this.anchor=e.data("anchor");this.resizing=!0,this.aoffset=[t.pageX,t.pageY];var i=this._canvasOffset;return 7===a?this.dr=Math.sqrt(Math.pow(t.pageX-i.left,2)+Math.pow(t.pageY-i.top,2)):5===a?this.dr=Math.sqrt(Math.pow(t.pageX-i.left-240,2)+Math.pow(t.pageY-i.top,2)):0===a?this.dr=Math.sqrt(Math.pow(t.pageX-i.left-240,2)+Math.pow(t.pageY-i.top-240,2)):2===a&&(this.dr=Math.sqrt(Math.pow(t.pageX-i.left,2)+Math.pow(t.pageY-i.top-240,2))),!1},"click .upload-clear":function(){return this.$(".help-portrait").removeClass("hide"),this.$(".xbtn-yes, .xbtn-no").removeClass("hide"),!1},"click .xbtn-no":function(){return this.$(".help-portrait").addClass("hide"),this.$(".xbtn-yes, .xbtn-no").addClass("hide"),!1},"click .xbtn-yes":function(){var t={},e=p.get("authorization"),a=e.token;return this._data.identity_id&&(t.identity_id=this._data.identity_id),this.filehtml5.startUpload(u+"/avatar/update?token="+a,t),!1},"click .upload-done":function(){var t=this,e=this.bitmap,a=e.originalImage;this.stage,this.stage80;var i=240/this.sss,s=e.x/this.sss,h=e.y/this.sss,d=document.createElement("canvas");d.width=d.height=i;var l=new o(d),c=new r(a);c.setPosition(s,h),c.rotation=90*this.ri,c.scaleX=e.scaleX/this.sss,c.scaleY=e.scaleY/this.sss,c.updateContext=function(e){e.translate(d.width*t.R[0],d.height*t.R[1]),e.rotate(this.rotation*o.DEG_TO_RAD),e.webkitImageSmoothingEnabled=e.mozImageSmoothingEnabled=!1},l.addChild(c),l.update();var g=n(l.canvas,"original.png"),v=n(document.getElementById("real-avatar80"),"80_80.png"),f=this;setTimeout(function(){var t={original:g,"80_80":v},e=p.get("authorization"),a=e.token;f._data.identity_id&&(t.identity_id=f._data.identity_id),f._data=t,f.filehtml5.startUpload(u+"/avatar/update?token="+a,t)},15.6)}},viewData:{cls:"mblack modal-uploader",title:"Portrait",body:'<div class="pull-right sider"><div class="pull-right smallphoto"><i class="icon20-zoom zoom"></i><div class="avatar80"><img id="img-avatar" src="" class="hide" alt="" /><canvas id="avatar80" width="80" height="80" class="hide"></canvas><canvas id="real-avatar80"></canvas></div><div class="overlay"></div><div class="loading hide"></div></div><div class="uploader-form"><div class="xalert-error hide"></div><button class="pull-right xbtn xbtn-blue upload-done hide">Save</button><button class="pull-right xbtn xbtn-white upload-clear hide">Clear</button></div></div><div class="photozone"><div class="anchor-n resizeable hide" data-anchor="1"></div><div class="anchor-w resizeable hide" data-anchor="3"></div><div class="anchor-e resizeable hide" data-anchor="4"></div><div class="anchor-s resizeable hide" data-anchor="6"></div><div class="anchor-nw resizeable hide" data-anchor="0"></div><div class="anchor-ne resizeable hide" data-anchor="2"></div><div class="anchor-sw resizeable hide" data-anchor="5"></div><div class="anchor-se resizeable hide" data-anchor="7"></div><div class="avatar240"><i class="icon20-upload upload"></i><i class="icon20-rotate rotate"></i><canvas id="avatar240" width="240" height="240"></canvas></div><div class="loading hide"><img src="/static/img/loading.gif" alt="" width="36" height="39" /><p>Uploading...</p></div><div class="overlay dropbox"><i class="icon20-back back"></i><img class="bigupload" src="/static/img/upload_128.png" alt="" width="128" height="128" /><div class="droptips">Drop your photo <span class="hide">or URL</span> here.<br />Alternatively, <span class="underline">open</span> local file.</div></div></div>',footer:'<button class="pull-right xbtn xbtn-pink xbtn-yes hide">Yes</button><button class="pull-right xbtn xbtn-white xbtn-no hide">No</button>',others:'<div class="help-portrait hide"><div class="modal-body"><div class="shadow title">Use default portrait?</div><div class="modal-content"><p>You have no portrait set, thus a default one will be assigned automatically. It means you will lose your primary visual identification, consequently poor recognizability confuse your friends.</p><p>Confirm using default portrait?</p></div></div></div>'}}};r.prototype={setPosition:function(t,e){this.x=t||0,this.y=e||0},updateContext:function(){},updateRect:function(){this.width=this.originalImage.width*this.scaleX,0>this.width&&(this.width=1,this.scaleX=this.width/this.originalImage.width),this.height=this.originalImage.height*this.scaleY,0>this.height&&(this.height=1,this.scaleY=this.height/this.originalImage.height)},draw:function(t){this.updateRect(),t.drawImage(this.originalImage,this.x,this.y,this.width-1,this.height-1)}},o.UID=0,o.DEG_TO_RAD=Math.PI/180,o.prototype={toDataURL:function(){},clear:function(){var t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height)},addChild:function(t){return this._children||(this._children=[]),this.parent=this,this._children.push(t),t},draw:function(){var t,e,a,i=this._children;if(i&&(e=this._children.length))for(a=this.canvas.getContext("2d"),this.clear(),t=0;e>t;t++){var s=i[t];a.save(),s.updateContext(a),s.draw(a),a.restore()}},update:function(){this.draw()}},d.prototype.process1=function(t,e){t.center.x=(e+.5)*t.ratio,t.icenter.x=Math.floor(t.center.x);for(var a=0;t.dest.height>a;a++){t.center.y=(a+.5)*t.ratio,t.icenter.y=Math.floor(t.center.y);var i,s,n,r;i=s=n=r=0;for(var o=t.icenter.x-t.range2;t.icenter.x+t.range2>=o;o++)if(!(0>o||o>=t.src.width)){var h=Math.floor(1e3*Math.abs(o-t.center.x));t.cacheLanc[h]||(t.cacheLanc[h]={});for(var d=t.icenter.y-t.range2;t.icenter.y+t.range2>=d;d++)if(!(0>d||d>=t.src.height)){var l=Math.floor(1e3*Math.abs(d-t.center.y));void 0==t.cacheLanc[h][l]&&(t.cacheLanc[h][l]=t.lanczos(Math.sqrt(Math.pow(h*t.rcp_ratio,2)+Math.pow(l*t.rcp_ratio,2))/1e3));var c=t.cacheLanc[h][l];if(c>0){var g=4*(d*t.src.width+o);i+=c,s+=c*t.src.data[g],n+=c*t.src.data[g+1],r+=c*t.src.data[g+2]}}}var g=3*(a*t.dest.width+e);t.dest.data[g]=s/i,t.dest.data[g+1]=n/i,t.dest.data[g+2]=r/i}++e<t.dest.width?setTimeout(function(){t.process1(t,e)},0):setTimeout(function(){t.process2(t)},0)},d.prototype.process2=function(t){t.canvas.width=t.dest.width,t.canvas.height=t.dest.height,t.ctx.drawImage(t.img,0,0),t.src=t.ctx.getImageData(0,0,t.dest.width,t.dest.height);for(var e,a,i=t.ocan.getContext("2d").getImageData(0,0,t.dest.width,t.dest.height),s=0;t.dest.width>s;s++)for(var n=0;t.dest.height>n;n++)e=3*(n*t.dest.width+s),a=4*(n*t.dest.width+s),t.src.data[a]=t.dest.data[e],t.src.data[a+1]=t.dest.data[e+1],t.src.data[a+2]=t.dest.data[e+2],t.src.data[a+3]=i.data[a+3];t.ctx.putImageData(t.src,0,0),t.canvas.style.display="block"},e.Uploader=m,e.uploadSettings=w});