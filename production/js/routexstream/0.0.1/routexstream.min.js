define("routexstream",function(){"use strict";var t=window._ENV_,e=t.apiv3_url,n=0,i="",r=10,s=r,o=null,a=null,u=!!0,c={ts:0,lat:0,lng:0,acc:0},l="",h="",p=null,f=null,d=null,m=null,g=function(){return s=0,i?(v("Breathe with token: "+i),p&&p.abort(),p=$.ajax({type:"POST",url:e+"/routex/breadcrumbs?coordinate=earth&token="+i,data:JSON.stringify([c]),success:function(t){t&&localStorage.setItem("offset-latlng",JSON.stringify(t))},error:function(t){var e=t.status;e&&e>=400&&499>=e?(v("Unauthorized."),a&&(b.kill(),a())):(s=r-5,v("Network error"))}}),void 0):(v("No token!"),void 0)},v=function(t,e){if(u){var n=Object.prototype.toString.call(t),i=""+new Date;"[object String]"!==n&&"[object Number]"!==n&&(t=JSON.stringify(t)),console.log(i.replace(/^.*(\d{2}:\d{2}:\d{2}).*$/,"$1")+" - "+t),e&&console.table&&console.table(e)}},y=function(){if(window.DeviceMotionEvent===void 0)return null;var t=50,e=0,n=0,i=0,r=0,s=0,o=0;window.addEventListener("devicemotion",function(t){e=t.accelerationIncludingGravity.x,n=t.accelerationIncludingGravity.y,i=t.accelerationIncludingGravity.z},!1),setInterval(function(){var a=Math.abs(e-r+n-s+i-o);a>t&&(f&&f(),d&&setTimeout(d,1e3)),r=e,s=n,o=i},100)},b={prvLen:null,nxtIdx:null,timer:null,http:null,pop:null,dead:null,live:!1,init:function(t,e,n){console.log(t),this.prvLen=0,this.nxtIdx=0,this.live=!0,this.pop=e,this.dead=n;var i=this.http=new XMLHttpRequest;i.open("post",t),i.onreadystatechange=this.listen,i.send(),this.timer=setInterval(this.listen,1e3)},listen:function(){var t=b.http;if(!(4!==t.readyState&&3!==t.readyState||3===t.readyState&&200!==t.status||null===t.responseText)){for(4===t.readyState&&200!==t.status&&b.kill();b.prvLen!==t.responseText.length&&(4!==t.readyState||b.prvLen!==t.responseText.length);){b.prvLen=t.responseText.length;var e=t.responseText.substring(b.nxtIdx),n=e.split("\n");if(b.nxtIdx+=e.lastIndexOf("\n")+1,"\n"===e[e.length-1]&&n[n.length]||n.pop(),b.pop&&n&&n.length)for(var i;(i=n.shift())&&i.length;)b.pop(i)}4===t.readyState&&b.prvLen===t.responseText.length&&b.kill()}},kill:function(){clearInterval(this.timer),this.http&&this.http.abort(),this.dead&&this.dead(),this.live=!1}},w=function(){v("Streaming is dead")},x=function(){console.log(b.live,i),k(c)&&++s>=r&&g(),!b.live&&i&&(b.init(e+"/crosses/"+n+"/routex?_method=WATCH&coordinate=earth&token="+i,N,w),v("Streaming with token: "+i))},k=function(t){return t&&t.ts&&t.lat&&t.lng&&t.acc},S=function(){T.stopWatch(m)},E=function(t,e){T.get(function(e){c.ts=e.timestamp,c.lat=e.latitude,c.lng=e.longitude,c.acc=e.accuracy,t&&t(e),v("Location update: time = "+c.ts+", "+"lat  = "+c.lat+", "+"lng  = "+c.lng+", "+"acu  = "+c.acc)},function(t){e&&e(t)})},_=function(t,e){m=T.watch(function(e){c.ts=e.timestamp,c.lat=e.latitude,c.lng=e.longitude,c.acc=e.accuracy,t&&t(e),v("Location update: time = "+c.ts+", "+"lat  = "+c.lat+", "+"lng  = "+c.lng+", "+"acu  = "+c.acc)},function(t){e&&e(t)})},T={options:{enableHighAccuracy:!0,maximumAge:0,timeout:29999.999999},cachedOptions:{enableHighAccuracy:!1,maximumAge:72e5,timeout:5e3},STATUS:0,freshness_threshold:4999.999999,accuracy_threshold:500,_success:function(t){var e=this,n=this.freshness_threshold,i=this.accuracy_threshold,r=(new Date).getTime();return function s(o){var a=o.coords,u=a,c=(new Date).getTime(),l=!1;0===e.STATUS&&(l=!0),c-r>n&&(l=!0),l&&(r=c+n,u.status="success",u.timestamp=Math.round(o.timestamp/1e3),u.accuracy=parseInt(a.accuracy||i),t&&t(u),0===e.STATUS&&(e.STATUS=1),s=null)}},_error:function(t){return function e(n){var i={status:"fail",code:n.code,message:n.message};t&&t(i),e=null}},get:function(t,e,n){n=n||this.options,navigator.geolocation.getCurrentPosition(this._success(t),this._error(e),n)},watch:function(t,e){return navigator.geolocation.watchPosition(this._success(t),this._error(e),this.STATUS?this.options:this.cachedOptions)},stopWatch:function(t){t&&navigator.geolocation.clearWatch(t)}},N=function(t){var e=JSON.parse(t);if(e&&e.type&&e.data){var n=e.type.replace(/^.*\/([^\/]*)$/,"$1"),i=e.data;switch(n){case"breadcrumbs":var r=JSON.stringify(i);v("Streaming pops: "+r,i),o&&l!==r&&(v("Callback"),o(n,i),l=r);break;case"geomarks":var s=JSON.stringify(i);v("Streaming pops: "+s,i),o&&h!==s&&(v("Callback"),o(n,i),h=s)}}},O={init:function(t,e,u,c){return t?e?u?c?(n=t,v("Set cross_id: "+t),i=e,v("Set token: "+e),o=u,v("Set callback function"),a=c,v("Set unauthorized callback function"),s=r,void 0):(v("Error unauthorized callback!"),void 0):(v("Error callback!"),void 0):(v("Error token!"),void 0):(v("Error cross id!"),void 0)},shake:function(t,e){f=t,d=e},getGeo:E,startGeo:_,stopGeo:S,geoService:T};return setInterval(x,1e3),y(f,d),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),O});