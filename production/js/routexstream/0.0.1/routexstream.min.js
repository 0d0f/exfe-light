define("routexstream",function(){"use strict";var e=window._ENV_,t=e.apiv3_url,i=0,n="",r=10,a=r,s=null,o=null,l=!!0,c={t:0,gps:[0,0,0]},u=null,d=null,h=null,p=null,f=null,m=null,g=function(){return a=0,n?(v("Breathe with token: "+n),u&&u.abort(),c.t=Math.round(Date.now()/1e3),u=$.ajax({type:"POST",url:t+"/routex/breadcrumbs?coordinate=earth&token="+n,data:JSON.stringify([c]),success:function(e){e&&(localStorage.setItem("offset-latlng",JSON.stringify(e)),f&&f(e))},error:function(e){var t=e.status;t&&t>=400&&499>=t?(v("Unauthorized."),o&&(_.kill(),o())):(a=r-5,v("Network error"))}}),void 0):(v("No token!"),void 0)},v=function(e,t){if(l){var i=Object.prototype.toString.call(e),n=""+new Date;"[object String]"!==i&&"[object Number]"!==i&&(e=JSON.stringify(e)),console.log(n.replace(/^.*(\d{2}:\d{2}:\d{2}).*$/,"$1")+" - "+e),t&&console.table&&console.table(t)}},y=function(){if(window.DeviceMotionEvent===void 0)return null;var e=50,t=0,i=0,n=0,r=0,a=0,s=0;window.addEventListener("devicemotion",function(e){t=e.accelerationIncludingGravity.x,i=e.accelerationIncludingGravity.y,n=e.accelerationIncludingGravity.z},!1),setInterval(function(){var o=Math.abs(t-r+i-a+n-s);o>e&&(d&&d(),h&&setTimeout(h,1e3)),r=t,a=i,s=n},100)},_={prvLen:null,nxtIdx:null,timer:null,http:null,pop:null,dead:null,live:!1,init:function(e,t,i){m(),console.log(e),this.prvLen=0,this.nxtIdx=0,this.live=!0,this.pop=t,this.dead=i;var n=this.http=new XMLHttpRequest;n.open("post",e),n.onreadystatechange=this.listen,n.onerror=this.onError,n.send(),this.timer=setInterval(this.listen,1e3)},listen:function(){var e=_.http;if(!(4!==e.readyState&&3!==e.readyState||3===e.readyState&&200!==e.status||null===e.responseText)){for(4===e.readyState&&200!==e.status&&_.kill();_.prvLen!==e.responseText.length&&(4!==e.readyState||_.prvLen!==e.responseText.length);){_.prvLen=e.responseText.length;var t=e.responseText.substring(_.nxtIdx),i=t.split("\n");if(_.nxtIdx+=t.lastIndexOf("\n")+1,"\n"===t[t.length-1]&&i[i.length]||i.pop(),_.pop&&i&&i.length)for(var n;(n=i.shift())&&n.length;)_.pop(n)}4===e.readyState&&_.prvLen===e.responseText.length&&_.kill()}},onError:function(){_.live=!1},kill:function(){clearInterval(this.timer),this.http&&this.http.abort(),this.dead&&this.dead(),this.live=!1}},b=function(){v("Streaming is dead")},x=function(){w(c)&&++a>=r&&g(),!_.live&&n&&(_.init(t+"/routex/crosses/"+i+"?_method=WATCH&coordinate=mars&token="+n+"&force_window_open",S,b),v("Streaming with token: "+n))},w=function(e){return e&&e.t&&e.gps&&e.gps[0]&&e.gps[1]&&e.gps[2]},k=function(){T.stopWatch(p)},C=function(e,t){T.get(function(t){c.t=t.timestamp,c.gps[0]=t.latitude,c.gps[1]=t.longitude,c.gps[2]=t.accuracy,e&&e(t),v("Location update: time = "+c.t+", "+"lat  = "+c.gps[0]+", "+"lng  = "+c.gps[1]+", "+"acu  = "+c.gps[2])},function(e){t&&t(e)})},E=function(e,t){p=T.watch(function(t){c.t=t.timestamp,c.gps[0]=t.latitude,c.gps[1]=t.longitude,c.gps[2]=t.accuracy,e&&e(t),v("Location update: time = "+c.t+", "+"lat  = "+c.gps[0]+", "+"lng  = "+c.gps[1]+", "+"acu  = "+c.gps[2])},function(e){t&&t(e)})},T={options:{enableHighAccuracy:!0,maximumAge:0,timeout:29999.999999},cachedOptions:{enableHighAccuracy:!1,maximumAge:72e5,timeout:5e3},STATUS:0,freshness_threshold:4999.999999,accuracy_threshold:500,_success:function(e){var t=this,i=this.freshness_threshold,n=this.accuracy_threshold,r=Date.now();return function a(s){var o=s.coords,l=o,c=Date.now(),u=!1;0===t.STATUS&&(u=!0),c-r>i&&(u=!0),u&&(r=c+i,l.status="success",l.timestamp=Math.round(s.timestamp/1e3),l.accuracy=parseInt(o.accuracy||n),e&&e(l),0===t.STATUS&&(t.STATUS=1),a=null)}},_error:function(e){return function t(i){var n={status:"fail",code:i.code,message:i.message};e&&e(n),t=null}},get:function(e,t,i){i=i||this.options,navigator.geolocation.getCurrentPosition(this._success(e),this._error(t),i)},watch:function(e,t){return navigator.geolocation.watchPosition(this._success(e),this._error(t),this.STATUS?this.options:this.cachedOptions)},stopWatch:function(e){e&&navigator.geolocation.clearWatch(e)}},S=function(e){var t=JSON.parse(e);t&&t.type&&(v("Streaming pops: "+t.type),s(t))},M={init:function(e,t,l,c,u,d){return e?t?l?c?(i=e,v("Set cross_id: "+e),n=t,v("Set token: "+t),s=l,v("Set callback function"),o=c,v("Set unauthorized callback function"),a=r,f=u,m=d,void 0):(v("Error unauthorized callback!"),void 0):(v("Error callback!"),void 0):(v("Error token!"),void 0):(v("Error cross id!"),void 0)},shake:function(e,t){d=e,h=t},stop:function(){_.kill()},getGeo:C,startGeo:E,stopGeo:k,geoService:T};return setInterval(x,1e3),y(d,h),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),M});