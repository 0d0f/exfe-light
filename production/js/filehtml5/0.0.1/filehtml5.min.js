define("filehtml5",function(e){function t(){return"file-"+o++}function i(e,t){return function(i){return e.call(t,i)}}var n=e("class"),a=e("emitter"),r=window,s=n.create(a,{initialize:function(e){var i=null;i=s.isValidFile(e)?e:s.isValidFile(e.file)?e.file:!1,i&&s.canUpload()&&(this._file=i,this._name=i.name||i.fileName,this._size=i.size||i.fileSize,this._type=i.type,i.hasOwnProperty("lastModifiedDate")&&(this._dateModified=i.lastModifiedDate)),this._id=t()},_uploadEventHandler:function(e){var t=this._xhr,i=e.type;switch(i){case"progress":this.emit("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this._size,percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this._size)/100)}),this._bytesUploaded=e.loaded;break;case"load":if(t.status>=200&&299>=t.status){this.emit("uploadcomplete",{originEvent:e,data:e.target.responseText});var n=t.upload,a=this._boundEventHandler;n.removeEventListener("progress",a),n.removeEventListener("crror",a),n.removeEventListener("abort",a),t.removeEventListener("load",a),t.removeEventListener("error",a),t.removeEventListener("readystatechange",a),this._xhr=null}else this.emit("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"http"});break;case"error":this.emit("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"FileHTML5"});break;case"abort":this.emit("uploadcancel",{originEvent:e});break;case"readystatechange":this.emit("readystatechange",{originEvent:e,readyState:e.target.readyState})}},startUpload:function(e,t,n){this._bytesUploaded=0,this._xhr=new XMLHttpRequest,this._boundEventHandler=i(this._uploadEventHandler,this);var a,r=new FormData,s=n,o=this._xhr,l=o.upload,c=this._boundEventHandler;for(a in t)r.append(a,t[a]);if(s&&r.append(s,this._file),o.addEventListener("loadstart",c,!1),o.addEventListener("load",c,!1),o.addEventListener("error",c,!1),o.addEventListener("abort",c,!1),o.addEventListener("loadend",c,!1),o.addEventListener("readystatechange",c,!1),l.addEventListener("progress",c,!1),l.addEventListener("error",c,!1),l.addEventListener("abort",c,!1),o.open("POST",e,!0),o.withCredentials=!0,this._xhrHeaders)for(a in this._xhrHeaders)o.setRequestHeader(a,this._xhrHeaders[a]);o.send(r),this.emit("uploadstart",{xhr:o})},cancelUpload:function(){this._xhr&&this._xhr.abort()}});s.isValidFile=function(e){return r&&r.File&&e instanceof r.File},s.canUpload=function(){return r&&r.FormData&&r.XMLHttpRequest};var o=0;return s});