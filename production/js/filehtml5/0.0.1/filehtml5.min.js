define("filehtml5",function(e){function t(){return"file-"+d++}function a(e,t){return function(a){return e.call(t,a)}}var r=e("class"),i=e("emitter"),s=window,n=r.create(i,{initialize:function(e){var a=null;a=n.isValidFile(e)?e:n.isValidFile(e.file)?e.file:!1,a&&n.canUpload()&&(this._file=a,this._name=a.name||a.fileName,this._size=a.size||a.fileSize,this._type=a.type,a.hasOwnProperty("lastModifiedDate")&&(this._dateModified=a.lastModifiedDate)),this._id=t()},_uploadEventHandler:function(e){var t=this._xhr,a=e.type;switch(a){case"progress":this.emit("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this._size,percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this._size)/100)}),this._bytesUploaded=e.loaded;break;case"load":if(t.status>=200&&299>=t.status){this.emit("uploadcomplete",{originEvent:e,data:e.target.responseText});var r=t.upload,i=this._boundEventHandler;r.removeEventListener("progress",i),r.removeEventListener("crror",i),r.removeEventListener("abort",i),t.removeEventListener("load",i),t.removeEventListener("error",i),t.removeEventListener("readystatechange",i),this._xhr=null}else this.emit("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"http"});break;case"error":this.emit("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"FileHTML5"});break;case"abort":this.emit("uploadcancel",{originEvent:e});break;case"readystatechange":this.emit("readystatechange",{originEvent:e,readyState:e.target.readyState})}},startUpload:function(e,t,r){this._bytesUploaded=0,this._xhr=new XMLHttpRequest,this._boundEventHandler=a(this._uploadEventHandler,this);var i,s=new FormData,n=r,d=this._xhr,o=d.upload,l=this._boundEventHandler;for(i in t)s.append(i,t[i]);if(n&&s.append(n,this._file),d.addEventListener("loadstart",l,!1),d.addEventListener("load",l,!1),d.addEventListener("error",l,!1),d.addEventListener("abort",l,!1),d.addEventListener("loadend",l,!1),d.addEventListener("readystatechange",l,!1),o.addEventListener("progress",l,!1),o.addEventListener("error",l,!1),o.addEventListener("abort",l,!1),d.open("POST",e,!0),d.withCredentials=!0,this._xhrHeaders)for(i in this._xhrHeaders)d.setRequestHeader(i,this._xhrHeaders[i]);d.send(s),this.emit("uploadstart",{xhr:d})},cancelUpload:function(){this._xhr&&this._xhr.abort()}});n.isValidFile=function(e){return s&&s.File&&e instanceof s.File},n.canUpload=function(){return s&&s.FormData&&s.XMLHttpRequest};var d=0;return n});