define("lightsaber",function(e,t,n){"use strict";function c(){var e=new p;return N(e,r.prototype),e.request=new d,e.response=new v,e.init(),e}function p(){}function d(e){this.enableFullUrlPath=!!e,this.session={},this.path="/",this.method="GET",this.updateUrl()}function v(e,t){this.path=e,this.title=document.title,this.state=t||{}}function m(e){e=e||{};var t=this;this.map=[],this.params={},this._params=[],this.caseSensitive=e.caseSensitive,this.strict=e.strict,this.middleware=function(n,r,i){t._dispatch(n,r,i)}}function g(e,t,n){n=n||{},this.path=e,this.callbacks=t,this.regexp=k(e,this.keys=[],n.sensitive,n.strict)}function y(e,t,n){t=t||{},this.name=e,this.root=t.root,this.engine=t.engine,this.ext=x(e),this.timestamp=n||"",this.path=this.lookup(e)}function b(e){return function(n,r,i){n.app=r.app=e,n.next=i,r.locals=r.locals||T(r),i()}}function w(){return++w.id}function E(e,t,n){var r=e.length;if(!r)return-1;n||(n=0);if(n>r)return-1;n<0&&(n=Math.max(0,r+n));for(;n<r;++n)if(n in e&&e[n]===t)return n;return-1}function S(e,t,n,r,s){return i.get(t,function(t){var i,o=t;s!=="html"&&(i=e.compile(t),o=i(n)),r(o)})}function x(e){return e.split(".")[1]||"html"}function T(e){function t(e){for(var n in e)t[n]=e[n];return e}return e.viewCallbacks=e.viewCallbacks||[],t}function N(e,t){var n;if(e&&t)for(n in t)e[n]=t[n];return e}function k(e,t,n,r){return e instanceof RegExp?e:(C(e)&&(e="("+e.join("|")+")"),e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,n,r,i,s,o,u){return t.push({name:i,optional:!!o}),n=n||"",""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(u?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",n?"":"i"))}var r=e("emitter"),i=e("jquery")||e("zepto"),s=i.proxy,o=window.location,u=window.history,a,f="/",l=!1;i(window).on("load",function(e){l=!0,setTimeout(function(){l=!1},0)}),t=n.exports=c;var h;t.version="0.0.5",h=p.prototype,h.historySupport=a=(u!==null?u.pushState:void 0)!==null,i.browser&&i.browser.opera&&(h.historySupport=a=!1),h.init=function(){this.route=f,this.stack=[],this.cache={},this.settings={},this.engines={},this.viewCallbacks=[],this.defaultConfiguration()},h.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(b(this)),this._usedRouter=!1,this._router=new m(this),this.routes=this._router.map,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=T(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},h.use=function(e,t){return"string"!=typeof e&&(t=e,e=f),f!==e&&f===e[e.length-1]&&(e=e.slice(0,-1)),this.stack.push({route:e,handle:t}),this},h.engine=function(e,t){if("function"!=typeof t)throw new Error("callback function required");return"."!==e[0]&&(e="."+e),this.engines[e]=t,this},h.set=function(e,t){if(1!==arguments.length)return this.settings[e]=t,this;if(this.settings.hasOwnProperty(e))return this.settings[e]},h.enabled=function(e){return!!this.set(e)},h.disabled=function(e){return!this.set(e)},h.enable=function(e){return this.set(e,!0)},h.disable=function(e){return this.set(e,!1)},h.configure=function(e,t){var n="all",r=[].slice.call(arguments);return t=r.pop(),r.length&&(n=r),("all"===n||~E(n,this.settings.env))&&t.call(this),this},h.render=function(e,t,n){var r=this,i={},s=this.cache,o=this.engine,u;"function"==typeof t&&(n=t,t={}),N(i,this.locals),t.locals&&N(i,t.locals),N(i,t),i.cache=null===i.cache?this.enabled("view cache"):i.cache,i.cache&&(u=s[e]);if(!u){u=new y(e,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp"));if(!u.path){var a=new Error('Failed to lookup view "'+e+'"');return a.view=u,n(a)}i.cache&&(s[e]=u)}try{u.render(i,n)}catch(a){n(a)}},h.path=function(){return this.route},h.param=function(e,t){var n=[].slice.call(arguments,1),r=0,i;if(C(e))for(i=e.length;r<i;++r)for(var s=0,o=n.length;s<o;++s)this.param(e[r],n[s]);else if("function"==typeof e)this._router.param(e);else{":"===e[0]&&(e=e.substr(1));for(i=n.length;r<i;++r)this._router.param(e,t)}return this},h.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},h.get=function(){var e=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,e)},h.handle=function(e,t){function o(u){var a=n[s++],f;i&&(e.url=e.url.substr(1),i=!1),e.url=r+e.url;if(!a)return;try{f=e.url;if(0!==f.indexOf(a.route))return o(u);var l=a.handle.length;r=a.route,e.url=e.url.substr(r.length),"/"!==e.url[0]&&(e.url="/"+e.url,i=!0),u?4===l?a.handle(u,e,t,o):o(u):4>l?a.handle(e,t,o):o()}catch(c){o(c)}}var n=this.stack,r="",i=!1,s=0;o()},h.run=function(e){this.emit("launch"),e=e||{};var t=this.request,n=this.response;if(this.running)return;this.running=!0,!1===e.dispatch&&this.disable("dispatch"),!1!==e.popstate&&(this.historySupport?i(window).on("popstate",s(this.change,this)):i(window).on("hashchange",s(this.change,this)));if(this.disabled("dispatch"))return;this.handle(t,n),this.emit("launched")},h.change=function(e){if(l)return l=!1;var t=this,n=t.request,r=t.response,i=n.url;n.updateUrl();if("/"!==i&&i===n.url)return;return t.handle(n,r),e.stopPropagation(),e.preventDefault(),!1},h.error=function(e,t){var n=new Error(t);return n.status=e,n},h=d.prototype,h.updateUrl=function(){this.host=o.hostname,this.port=o.port||80,this.enableFullUrlPath&&(this.path=o.pathname),this.hash=decodeURIComponent(o.hash),this.querystring=decodeURIComponent(o.search),this.url=this.path+this.querystring+this.hash},h.param=function(e,t){var n=this.params||{},r=this.query||{};return null!=n[e]&&n.hasOwnProperty(e)?n[e]:null!=r[e]?r[e]:t},h.getPath=function(){return this.path},h.getHost=function(){return this.host},h=v.prototype,h.location=function(e){window.setTimeout(function(){o.href=e},16)},h.redirect=function(e){var t=arguments.length,n,r;e=arguments[0];if(e==="back"||e==="forward"){u[e]();return}if(!a){this.location(e);return}n=arguments[1],r=arguments[2]||{},this.path=e,this.title=n||"EXFE.COM",document.title=this.title,this.state=r,this.state.id=w(),this.pushState(),i(window).triggerHandler("popstate")},h.save=function(){u.replaceState(this.state,this.title,this.path)},h.pushState=function(){u.pushState(this.state,this.title,this.path)},h.render=function(e,t,n){var r=this,t=t||{},i=this.app;"function"==typeof t&&(n=t,t={}),t.locals=r.locals,i.render(e,t,n)},h=m.prototype,h.param=function(e,t){if("function"==typeof e){this._params.push(e);return}var n=this._params,r=n.length,i,s;for(s=0;s<r;++s)if(i=n[s](e,t))t=i;if("function"!=typeof t)throw new Error("invalid param() call for "+e+", got "+t);return(this.params[e]=this.params[e]||[]).push(t),this},h._dispatch=function(e,t,n){var r=this.params,i=this;(function s(o,u){function d(t){s(e._route_index+1,t)}function v(t){f=0,p=h[o++],l=p&&e.params[p.name],a=p&&r[p.name];try{"route"===t?d():t?(o=0,g(t)):a&&undefined!==l?m():p?v():(o=0,g())}catch(t){v(t)}}function m(n){var r=a[f++];if(n||!r)return v(n);r(e,t,m,l,p.name)}function g(n){var r=c.callbacks[o++];try{if("route"===n)d();else if(n&&r){if(4>r.length)return g(n);r(n,e,t,g)}else r?r(e,t,g):d(n)}catch(n){g(n)}}var a,f=0,l,c,h,p;e.route=c=i.matchRequest(e,o);if(!c)return n(u);e.params=c.params,h=c.keys,o=0,v(u)})(0)},h.matchRequest=function(e,t){var n=e.url,r=this.map,i=r.length,s;t=t||0;for(;t<i;++t){s=r[t];if(s.match(n))return e._route_index=t,s}},h.route=function(e){e||new Error("Router#get() requires a path");var t=[].slice.call(arguments,1),n=new g(e,t,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(n),this},h=g.prototype,h.match=function(e){this.regexp.lastIndex=0;var t=this.keys,n=this.params=[],r=this.regexp.exec(e),i,s,o,u;if(!r)return!1;for(i=1,s=r.length;i<s;++i)o=t[i-1],u="string"==typeof r[i]?decodeURIComponent(r[i]):r[i],o?n[o.name]=u:n.push(u);return!0},h=y.prototype,h.lookup=function(e){return this.root+"/"+e+"?t="+this.timestamp},h.render=function(e,t){return S(this.engine,this.path,e,t,this.ext)},w.id=0;var C=Array.isArray;C||(C=function(e){return e instanceof Array})});