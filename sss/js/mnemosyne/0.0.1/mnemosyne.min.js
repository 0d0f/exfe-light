define("mnemosyne",function(e){"use strict";var t=0,n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[n[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[r]+"CancelAnimationFrame"]||window[n[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),s=window.setTimeout(function(){e(r+i)},i);return t=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var i=void 0,s,o,u=function(e,t,n,r,i,s){return(e>=0&&e<=i||n>=0&&n<=i)&&(r>=0&&r<=s||t>=0&&t<=s)},a=function(e){var t=e.getBoundingClientRect();return u(t.top,t.right,t.bottom,t.left,o,s)},f=function(e,t){var n=e.length,r=[];for(;t<n;++t)r.push(e[t]);return t},l=Math.cos,c=Math.sin,h=Math.tan,p=Math.abs,v=Math.asin,m=Math.sqrt,g=Math.atan,y=Math.atan2,b=Math.min,w=Math.PI,E=1e-6,S={precision:E,identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiply:function et(e,t){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];return n[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8],n[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9],n[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10],n[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8],n[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9],n[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10],n[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8],n[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9],n[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10],n[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+t[12],n[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+t[13],n[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+t[14],2>=arguments.length?n:et([n].concat(f(arguments,2)))},move:function(e,t){return t[2]||(t[2]=0),[e[0],e[1],e[2],0,e[4],e[5],e[6],0,e[8],e[9],e[10],0,e[12]+t[0],e[13]+t[1],e[14]+t[2],1]},translate:function(e,t,n){return"number"!=typeof n&&(n=0),[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1]},scale:function(e,t,n){return"number"!=typeof n&&(n=1),[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1]},rotateX:function(e,t){return t=l(e),e=c(e),[1,0,0,0,0,t,e,0,0,-e,t,0,0,0,0,1]},rotateY:function(e,t){return t=l(e),e=c(e),[t,0,-e,0,0,1,0,0,e,0,t,0,0,0,0,1]},rotateZ:function(e,t){return t=l(e),e=c(e),[t,e,0,0,-e,t,0,0,0,0,1,0,0,0,0,1]},rotate:function(e,t,n,r,i,s,o){return r=l(e),e=c(e),i=l(t),t=c(t),s=l(n),n=c(n),o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],o[0]=i*s,o[1]=r*n+e*t*s,o[2]=e*n-r*t*s,o[4]=-i*n,o[5]=r*s-e*t*n,o[6]=e*s+r*t*n,o[8]=t,o[9]=-e*i,o[10]=r*i,o},skew:function(e,t,n){return[1,0,0,0,h(n),1,0,0,h(t),h(e),1,0,0,0,0,1]},equal:function(e,t){if(!e||!t)return!1;if(e==t)return!0;for(var n=0,r=e.length;n<r;++n)if(p(e[n]-t[n])>=E)return!1;return!0},random:function(e){e=e.slice(0);if(e[0]==w/2||e[0]==-w/2)e[0]=-e[0],e[1]=w-e[1],e[2]-=w;e[0]>w/2&&(e[0]-=w,e[1]=w-e[1],e[2]-=w),e[0]<-w/2&&(e[0]+=w,e[1]=-w-e[1],e[2]-=w);for(;e[1]<-w;)e[1]+=2*w;for(;e[1]>=w;)e[1]-=2*w;for(;e[2]<-w;)e[2]+=2*w;for(;e[2]>=w;)e[2]-=2*w;return e},inverse:function(e,t,n,r,i,s,o,u,a,f,l,c){return t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],n=e[5]*e[10]-e[6]*e[9],r=e[4]*e[10]-e[6]*e[8],i=e[4]*e[9]-e[5]*e[8],s=e[1]*e[10]-e[2]*e[9],o=e[0]*e[10]-e[2]*e[8],u=e[0]*e[9]-e[1]*e[8],a=e[1]*e[6]-e[2]*e[5],f=e[0]*e[6]-e[2]*e[4],l=e[0]*e[5]-e[1]*e[4],c=1/(e[0]*n-e[1]*r+e[2]*i),t[0]=c*n,t[1]=-c*s,t[2]=c*a,t[4]=-c*r,t[5]=c*o,t[6]=-c*f,t[8]=c*i,t[9]=-c*u,t[10]=c*l,t[12]=-e[12]*t[0]-e[13]*t[4]-e[14]*t[8],t[13]=-e[12]*t[1]-e[13]*t[5]-e[14]*t[9],t[14]=-e[12]*t[2]-e[13]*t[6]-e[14]*t[10],t},translateValues:function(e){return[e[12],e[13],e[14]]},create:function(e){var t=function(e,t,r){return n||(n=0),m(e*e+t*t+r*r)},n=e[0]+t(e[0],e[1],e[2]),r=2/(n*n+e[1]*e[1]+e[2]*e[2]),i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];i[0]=1-r*n*n,i[1]=-r*n*e[1],i[2]=-r*n*e[2],i[5]=1-r*e[1]*e[1],i[6]=-r*e[1]*e[2],i[10]=1-r*e[2]*e[2],i[4]=i[1],i[8]=i[2],i[9]=i[6],n=S.multiply(e,i),r=t(n[5],n[6]),0<n[5]&&n[5]!=r&&(r*=-1),r=n[5]+r;var s=2/(r*r+n[6]*n[6]),o=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];return o[5]=1-s*r*r,o[6]=-s*r*n[6],o[9]=o[6],o[10]=1-s*n[6]*n[6],i=S.multiply(i,o),n=S.multiply(e,i),r=S.scale(0>n[0]?-1:1,0>n[5]?-1:1,0>n[10]?-1:1),n=S.multiply(r,n),i=S.multiply(i,r),r={},r.translate=S.translateValues(e),r.rotate=[y(-i[6],i[10]),v(i[2]),y(-i[1],i[0])],r.rotate[0]||(r.rotate[0]=0,r.rotate[2]=y(i[4],i[5])),r.scale=[n[0],n[5],n[10]],r.skew=[g(n[9]/r.scale[2]),g(n[8]/r.scale[2]),g(n[4]/r.scale[0])],r},translateTo:function(e){var t=S.scale(e.scale[0],e.scale[1],e.scale[2]),n=S.skew(e.skew[0],e.skew[1],e.skew[2]),r=S.rotate(e.rotate[0],e.rotate[1],e.rotate[2]);return S.move(S.multiply(t,n,r),e.translate)},toCSSMatrix3d:function(e,t,n){e=e.slice(0),t=0,n=e.length;for(;t<n;++t)p(e[t])<E&&(e[t]=0);return"matrix3d("+e.join()+")"}},x=e("jquery"),T=e("tween"),N=e("rex"),C=e("humantime"),k=e("handlebars"),L=e("panel"),A=e("api").request,O=function(e,t,n){return A("photox_like",{type:"POST",data:{id:e}},t,n)},M=function(e,t,n){return A("photox_like",{type:"POST",data:{id:e,LIKE:!1}},t,n)},_=function(e,t){return A("photox_getLikes",{resources:{photox_id:e}},t)},D=function(e,t,n,r){return A("photox_getPhotoX",{resources:{photox_id:e},beforeSend:t},n,r)},P=Math.random,H;k.registerHelper("photoxPrintTime",function(e){var t=C.parseISO(C.toISO(e));return C.printTime(t)});var B=function(e,t,n,r){var i=new Image,s=function(t){t.onload=t.onerror=t=e=undefined};i.onload=function(){n&&n(i,e),s(i)},i.onerror=function(){r&&r(i,e),s(i)},i.src=t},j=0,F=function(e,t,n){for(n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e},I=function(e){return parseInt(e*P())+1},q=function(e,t){return e*t},R=function(e,t,n,r){var i=n/r,s=n/e,o=r/t,n=b(e,n),r=b(t,r);return s<o?n=r*i:r=n/i,[n,r]},U=function(e,t,n,r){var i=n/r,s=e/t;return s>i?(n=e,r=n/i):(r=t,n=r*i),[n,r]},z=function(e){return F({id:j++},e)},W=function(e,t,n,r,i,s,o,u,a){e.setAttribute("data-gid",t),e.style.opacity=1,e.style.width=s+"px",e.style.height=i+"px";var f=S.translate(u,o,6);e.style.webkitTransform=S.toCSSMatrix3d(f),e.style.transform=S.toCSSMatrix3d(f),e._m4=f,a==="instagram"&&(r*=1.1,n*=1.1);if(e.getAttribute("data-lazy")==="-1")e.setAttribute("data-whlt",[r,n,(s-r)/2,(i-n)/2].join(","));else{var l=e.querySelector("img").style;l.width=r+"px",l.height=n+"px",l.top=(i-n)/2+"px",l.left=(s-r)/2+"px"}},X=[[{type:"G",name:"1",aspect_ratio:0,cells:[{type:"Rect",x:0,y:0,width:1,height:1,margin:{top:6,right:6,bottom:6,left:6}}]}],[{type:"G",name:"2A1",aspect_ratio:.5,cells:[{type:"Rect",x:0,y:0,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.5,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}}]},{type:"G",name:"2A2",aspect_ratio:.75,cells:[{type:"Rect",x:0,y:0,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.5,width:1,height:.5,margin:{top:6,right:6,bottom:6,left:6}}]},{type:"G",name:"2B1",aspect_ratio:4/3,cells:[{type:"Rect",x:0,y:0,width:.5,height:1,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:.5,y:0,width:.5,height:1,margin:{top:6,right:6,bottom:6,left:6}}]}],[{type:"G",name:"3A1",aspect_ratio:2/3,cells:[{type:"Rect",x:0,y:0,width:1,height:.666666,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.666666,width:.5,height:.333333,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:.5,y:.666666,width:.5,height:.333333,margin:{top:6,right:6,bottom:6,left:6}}]},{type:"G",name:"3B1",aspect_ratio:1,cells:[{type:"Rect",x:0,y:0,width:.382,height:.382,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:.382,y:0,width:.618,height:.382,margin:{top:6,right:6,bottom:6,left:6}},{type:"Rect",x:0,y:.382,width:1,height:.618,margin:{top:6,right:6,bottom:6,left:6}}]}]],V={},$='<figure class="surface" data-lazy="-1" data-id="{{id}}" data-preview-url="{{images.preview.url}}" data-preview-height="{{images.preview.height}}" data-preview-width="{{images.preview.width}}" data-fullsize-url="{{images.fullsize.url}}" data-fullsize-height="{{images.fullsize.height}}" data-fullsize-width="{{images.fullsize.width}}" data-liked="{{like}}" data-provider="{{provider}}" ><div class="photo"></div><div class="mask"></div><div class="btn-like ix-{{#unless like}}un{{/unless}}like"{{#unless like}} style="opacity: 0;"{{/unless}}></div><div class="meta"><div class="avatar"><img width="24" height="24" src="{{by_identity.avatar_filename}}" alt="" /></div><div class="title">{{caption}}</div><time>{{photoxPrintTime updated_at}}</time><div class="place"></div></div></figure>',J=V.Rect=function(e){this.html=k.compile($)(e)};J.prototype.toString=function(){return this.html};var K=function(e,t){return new V[e](t)},Q=function(e,t){var n=0,r="",i,s,o;for(;i=e[n];n++)s=t[n],o=K(s.type,i),r+=o.toString();return r},G=function(){};H=G.prototype,H.defaultLayouts=X,H.genLayouts=function(e){var t=X.slice(0),n=t.length,r=[],i,s,o;while(e)i=I(e<n?e:n),e-=i,s=t[i-1],o=s[I(s.length)-1],r.push(z(o));return r};var Y=function(e,t){this.component=e,this.$element=t,this.animate=!0};Y.prototype.show=function(e){var t=this.$element,n=t[0].style;n.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+x("#app-tmp").scrollLeft()+", 0, 10, 1)",n.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+x("#app-tmp").scrollLeft()+", 0, 10, 1)",this.$element.attr("tabindex","-1").focus(),this.clone(e)},Y.prototype.exit=function(){var e=this.$element,t=e[0].style;e.attr("tabindex","none"),(new T.Tween({o:1})).to({o:0},400).interpolation(T.Interpolation.Bezier).easing(T.Easing.Exponential.Out).onUpdate(function(){t.opacity=this.o}).onComplete(function(){e.empty()}).start(),this.img=this.curr=i,this.lockup=!1},Y.prototype._clone_0=function(e){this.$element.empty(),this.lockup=!0;var t=this,n=e.getBoundingClientRect(),r=e.clientWidth,s=e.clientHeight,o=n.left,u=n.top,a=this.$element[0].style,f=e.getAttribute("data-preview-url"),l=e.getAttribute("data-fullsize-url"),c=+e.getAttribute("data-fullsize-width"),h=+e.getAttribute("data-fullsize-height"),p=r/c,v=s/h,m=document.createElement("div");m.setAttribute("class","pic"),m.style.width=c+"px",m.style.height=h+"px";var g=new Image;g.src=f;var y=S.move(S.multiply(S.scale(p,v),S.identity()),[o,u,1]);m.style.webkitTransform=m.style.transform=y,B(m,l,function(e,t){e.width=c,e.height=h,e.src=l,t.appendChild(e),e=i},function(e,t){d.setAttribute("class","load-failed")}),this.$element.append(m),this.curr=e;var b=this.cal(c,h),w=m.style;return m._m4=b,(new T.Tween(y)).to(b,400).interpolation(T.Interpolation.Bezier).easing(T.Easing.Exponential.Out).onUpdate(function(e){var t=S.toCSSMatrix3d(this);w.webkitTransform=w.transform=t,a.opacity=e}).onComplete(function(){t.lockup=!1,m._tween=null,T.remove(this)}).start(),m},Y.prototype.prev=function(){if(this.lockup)return;var e=this.img,t=x(this.curr),n=t.prev(".surface"),r;this.curr=(n.length?n:t.parent().find(".surface").last())[0],r=this.clone(this.curr),this.effect(e,r,-1)},Y.prototype.next=function(){if(this.lockup)return;var e=this.img,t=x(this.curr),n=t.next(".surface"),r;this.curr=(n.length?n:t.parent().find(".surface").first())[0],r=this.clone(this.curr),this.effect(e,r,1)},Y.prototype.effect=function(e,t,n){this.lookup=!0;var r=this,i=e._m4,s=t._m4,o=e.style,u=t.style,a=50*n;s=S.move(s,[-a,0,0]),u.webkitTransform=u.transform=S.toCSSMatrix3d(s),(new T.Tween({x:0})).to({x:a},400).easing(T.Easing.Quadratic.InOut).onStart(function(){r.lockup=!0,x(e).prevAll().remove()}).onUpdate(function(e){o.opacity=1-e,o.webkitTransform=o.transform=S.toCSSMatrix3d(S.move(i,[this.x,0,1-e])),u.opacity=e,u.webkitTransform=u.transform=S.toCSSMatrix3d(S.move(s,[this.x,0,e]))}).onComplete(function(){u.opacity=1,r.lockup=!1,T.remove(this)}).start()},Y.prototype.update=function(){var e=this.img,t=e.style,n=e._m4,r=this.curr,i=+r.getAttribute("data-fullsize-width"),s=+r.getAttribute("data-fullsize-height"),o=this.cal(i,s),u=S.toCSSMatrix3d;(new T.Tween(n)).to(o,144).easing(T.Easing.Quadratic.InOut).onUpdate(function(){t.webkitTransform=t.transform=u([].slice.call(this))}).onComplete(function(){T.remove(this)}).start()},Y.prototype.cal=function(e,t){var n=this.vw,r=this.vh,i=R(n,r,e,t),s=i[0],o=i[1],u=s/e,a=o/t,f=(n-s)/2,l=(r-o)/2;return S.move(S.multiply(S.scale(u,a),S.identity()),[f,l,1])},Y.prototype._clone_1=function(e){var t=e.getAttribute("data-preview-url"),n=e.getAttribute("data-fullsize-url"),r=+e.getAttribute("data-fullsize-width"),s=+e.getAttribute("data-fullsize-height"),o=this.cal(r,s),u=document.createElement("div");u.setAttribute("class","pic"),u.style.width=r+"px",u.style.height=s+"px",u._m4=o;var a=new Image;return a.src=t,o=S.toCSSMatrix3d(o),u.style.webkitTransform=u.style.transform=o,u.style.opacity=0,B(u,n,function(e,t){e.width=r,e.height=s,e.src=n,t.appendChild(e),e=i},function(e,t){t.setAttribute("class","load-failed")}),this.$element.append(u),u},Y.prototype.resize=function(e,t){this.vw=e,this.vh=t,this.img&&this.update()},Y.prototype.clone=function(e){var t=!!this.curr;return this.curr=e,this.img=this["_clone_"+(t?1:0)](e)};var Z=L.extend({options:{template:'<div class="panel mnemosyne-panel perspective" tabindex="-1"><div class="panel-body perspective"><div class="gallery perspective group"></div></div></div><div class="slideshow-panel perspective group"></div>'},init:function(){var e=this.options,t;this.crossId=e.crossId,this.userId=e.userId,delete e.crossId,this.render(),t=this.element,this.$appTmp=x("#app-tmp"),this.$mnemosyne=t.eq(0),this.$gallery=this.$mnemosyne.find(".gallery"),this.$slideshow=t.eq(1),this.typesetting=new G,this.slideshow=new Y(this,this.$slideshow),this.i=0,this.n=0,this.offsetTop=0,this.offsetLeft=24,this.paddingRight=30,this.scrollLeft=0,this.showPhotoStatus=!1,this.listen()},listen:function(){function f(){e.frame=requestAnimationFrame(f),T.update()}var e=this,t=e.typesetting,n=e.slideshow,r=e.$mnemosyne,i=e.$gallery,s=e.$slideshow,o=e.$appTmp,u=x(window);f(),r.on("mouseenter.mnemosyne mouseleave.mnemosyne",".gallery .surface",function(e){e.preventDefault();var t=this,n=t.style,r=x(t),i=this._m4,s=e.type==="mouseenter",o=r.data("tween"),u=+r.attr("data-liked"),a=t.querySelector(".mask").style,f=t.querySelector(".btn-like").style,l=t.querySelector(".meta").style,c=S.multiply,h=S.scale,p=S.toCSSMatrix3d;o||(o=(new T.Tween({v:1})).easing(T.Easing.Cubic.InOut),r.data("tween",o)),o.stop(),s?o.delay(233).to({v:1.01},150).onUpdate(function(e){a.opacity=(this.v-1)*4,l.opacity=e,u!==1&&(f.opacity=e),n.transform=n.webkitTransform=p(c(h(this.v,this.v),i))}):o.delay(0).to({v:1},150).onUpdate(function(e){a.opacity=(this.v-1)*4,l.opacity=(1-e)*.99,u!==1&&(f.opacity=1-e),t.style.transform=n.webkitTransform=p(c(h(this.v,this.v),i))}).onComplete(function(){r.data("tween",null),T.remove(this)}),o.start()}).on("click.mnemosyne",".gallery .surface",function(t){t.preventDefault(),e.scrollLeft=o.scrollLeft(),o.addClass("show-slideshow"),e.emit("launch-slideshow",this)}).on("click.mnemosyne",".surface .btn-like",function(e){e.preventDefault(),e.stopPropagation();var t=x(this),n=t.parent(),r=+n.data("id"),i=+n.attr("data-liked");if(i===-2)return;n.attr("data-liked",-2);if(i===1){M(r,function(e){n.attr("data-liked",0),t.addClass("ix-unlike").removeClass("ix-like")},function(){n.attr("data-liked",1)});return}O(r,function(e){n.attr("data-liked",1),t.addClass("ix-like").removeClass("ix-unlike")},function(){n.attr("data-liked",0)})}),s.on("keydown.mnemosyne",function(t){t.preventDefault();var r=t.keyCode;switch(r){case 39:case 40:n.next();break;case 38:case 37:n.prev();break;case 27:t.stopPropagation(),e.emit("exit-slideshow")}}),s.on("click.mnemosyne",function(t){t.preventDefault(),t.target.tagName!=="IMG"&&e.emit("exit-slideshow")}),x("html, body").bind("mousewheel.mnemosyne",function(e,t,n){return!1}),o.bind("mousewheel.mnemosyne",function(e,t,n){var r=x(this).scrollLeft(),i=r+n;return x(this).scrollLeft(i),!1}),o.on("scroll.mnemosyne",function(e){e.preventDefault(),e.stopPropagation();var t=i.find('[data-lazy="-1"]'),n;if(0===t.length)return;var r=function(e,t){if(t){x(t).removeClass("load-failed");var n=t.getAttribute("data-whlt").split(","),r=e.style;t.setAttribute("data-lazy","1"),e.setAttribute("class","pic"),r.width=n[0]+"px",r.height=n[1]+"px",r.left=n[2]+"px",r.top=n[3]+"px",r.opacity=0,t.querySelector(".photo").appendChild(e),(new T.Tween({v:0})).to({v:1}).easing(T.Easing.Cubic.InOut).onUpdate(function(){r.opacity=this.v}).onComplete(function(){T.remove(this)}).start()}},s=function(e,t){t&&(t.setAttribute("data-lazy","-1"),x(t).addClass("load-failed"))};while(n=t.splice(0,1)[0]){if(!a(n))break;n.setAttribute("data-lazy","0"),B(n,n.getAttribute("data-fullsize-url"),r,s)}}),u.on("throttledresize.mnemosyne",function(){e.getViewport(),e.getGallery(),e.updateViewport(),e.update(),o.trigger("scroll.mnemosyne")}),e.on("load-photos",function(e){var t=e.photox.photos,n=t.length;n&&this.emit("draw",t,n)}),e.on("launch-slideshow",function(t){e.showPhotoStatus=!0;var n=i[0].style;(new T.Tween({z:3})).to({z:-610},400).easing(T.Easing.Exponential.Out).onUpdate(function(e){n.transform=n.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, "+this.z+", 1)",n.opacity=.1*e}).onComplete(function(){T.remove(this)}).start(),e.slideshow.show(t)}),e.on("exit-slideshow",function(){e.showPhotoStatus=!1,r.focus(),e.slideshow.exit();var t=i[0].style;(new T.Tween({z:-610})).to({z:1},400).interpolation(T.Interpolation.Bezier).easing(T.Easing.Exponential.Out).onUpdate(function(n){o.scrollLeft(e.scrollLeft),t.transform=t.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, "+this.z+", 1)",t.opacity=.5*(n+1)}).onComplete(function(){o.removeClass("show-slideshow"),T.remove(this)}).start()}),e.on("draw",function(e,n){var r=t.genLayouts(n);this.drawPhotos(e,r,n),u.trigger("throttledresize.mnemosyne")}),x("body").on("click.mnemosyne",".mnemosyne-exit",function(t){t.preventDefault(),t.stopPropagation(),e.hide()})},updateViewport:function(){var e=window.scrollX,t=window.scrollY,n="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 1, 1)",r="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 3, 1)",i="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 17, 1)",s=x(".mnemosyne-bg")[0].style;s.transform=s.webkitTransform=n;var o=this.$appTmp[0].style;o.transform=o.webkitTransform=r;var u=x(".mnemosyne-exit")[0].style;u.transform=u.webkitTransform=i},addMBG:function(){var e="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 1, 1)",t="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 20, 1)";t="-webkit-transform:"+t+";transform:"+t+";",x('<div class="mnemosyne-exit ix-exit" style="'+t+'"></div><div class="mnemosyne-bg perspective" style="-webkit-transform: '+e+"; transform: "+e+';"><div class="mnemosyne-bg-in"></div></div>').prependTo(x("body"))},delMBG:function(){x(".mnemosyne-exit").remove(),x(".mnemosyne-bg").remove()},drawPhotos:function(e,t,n){var r=this.$gallery,i=0,s=0,o,u,a;this.layouts||(this.layouts=[]),this.gid=this.layouts.length;while(o=t[i++])u=o.cells,a=Q(e.slice(s,s+=u.length),u),r.append(a);this.layouts=this.layouts.concat(t),this.i=this.n,this.n+=n},update:function(){var e=this.$gallery,t=e.find("figure").slice(this.i,this.n),n=this.gvw,r=this.gvh,i=this.gid,s=this.layouts.slice(i),o=this.offsetTop,u=this.offsetLeft,a=0,f=r,l=n,c,h,p,d,v,m,g,y,b,w,E,S,x,T;while(c=s.shift()){i=c.id,v=c.aspect_ratio,h=c.cells.slice(),p=h.length,v&&(l=q(r,v));while(d=h.shift()){m=t.eq(a),y=+m.data("preview-height"),g=+m.data("preview-width"),b=m.data("provider"),1===p&&(l=q(r,g/y)),w=d.margin,S=d.height*f-w.top-w.bottom,E=d.width*l-w.left-w.right,T=o+d.y*f+w.top+(r-f)/2,x=u+d.x*l+w.left;var N=U(E,S,g,y);g=N[0],y=N[1],W(m[0],i,y,g,S,E,T,x,b),a++}u+=l}this.addPaddingRight(0,u)},addPaddingRight:function(e,t){var n=this.$gallery,r=n.find(".photos-padding-right");r.size()||(r=x('<div class="photos-padding-right"></div>').css({width:this.paddingRight})),r.css({"-webkit-transform":"translate3d("+t+"px, "+e+"px, 0)","-moz-transform":"translate3d("+t+"px, "+e+"px, 0)","-ms-transform":"translate3d("+t+"px, "+e+"px, 0)","-o-transform":"translate3d("+t+"px, "+e+"px, 0)",transform:"translate3d("+t+"px, "+e+"px, 0)"}),n.append(r)},getPhotos:function(){var e=this,t=this.userId;D(e.crossId,null,function(n){var r=n.likes,i=n.photox.photos;N.each(i,function(e){var n=r[e.id];e.like=0,n&&n.length&&N.each(n,function(n){n.object_id===e.id&&n.by_identity.connected_user_id===t&&(e.like=1)})}),e.emit("load-photos",n)})},getViewport:function(){var e=this.element;this.vw=s=e.width(),this.vh=o=e.height(),this.slideshow.resize(this.vw,this.vh)},getGallery:function(){this.gvw=this.vw,this.gvh=this.vh-40-60},showBefore:function(){x("body").addClass("mnemosyne-start"),x("#app-tmp").css("-webkit-transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 3, 1)"),x("#app-tmp").css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+window.scrollX+", "+window.scrollY+", 3, 1)"),this.getPhotos()},showAfter:function(){var e=x(".mnemosyne-bg"),t=e[0].style,n=e.find(".mnemosyne-bg-in")[0].style,r=this.$mnemosyne,i=r[0].style,s=this.$appTmp,o=this.$gallery,u=o[0].style,a=(new T.Tween({v:0})).to({v:1},750).interpolation(T.Interpolation.Bezier).easing(T.Easing.Cubic.In).onUpdate(function(){t.opacity=this.v}).onComplete(function(){T.remove(this)}),f=(new T.Tween({v:0})).delay(250).to({v:1},1e3).interpolation(T.Interpolation.Bezier).easing(T.Easing.Cubic.In).onUpdate(function(){n.opacity=this.v}).onComplete(function(){T.remove(this)}),l=(new T.Tween({v:2584})).delay(250).to({v:3},1500).interpolation(T.Interpolation.Bezier).easing(T.Easing.Cubic.In).onUpdate(function(){u.webkitTransform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, "+this.v+", 1)"}).onComplete(function(){s.trigger("scroll.mnemosyne"),T.remove(this)});a.start(),f.start(),l.start()},show:function(){return this.emit("showBefore"),this.escapable(),this.element.prependTo(this.parentNode),this.addMBG(),this.emit("showAfter"),this},hide:function(){T.removeAll();var e=this,t=x(".mnemosyne-bg")[0].style,n=e.$mnemosyne[0].style,r=e.$slideshow[0].style;x(document).off("keydown.panel"),this.element.off(),(new T.Tween({o:1})).to({o:0},250).easing(T.Easing.Cubic.In).onUpdate(function(){t.opacity=n.opacity=r.opacity=this.o}).onComplete(function(){e.destory(),T.removeAll()}).start()},destory:function(){this.delMBG(),x("html, body").unbind("mousewheel.mnemosyne"),x("body").off(".mnemosyne").removeClass("mnemosyne-start"),x(".mnemosyne-exit").off("click.mnemosyne"),this.$appTmp.removeClass(".show-mnemosyne").off(".mnemosyne").css({"-webkit-transform":"none",transform:"none"}),x(window).off("throttledresize.mnemosyne"),cancelAnimationFrame(this.frame),this.element.off(),this.element.remove(),this._destory()}});return Z});